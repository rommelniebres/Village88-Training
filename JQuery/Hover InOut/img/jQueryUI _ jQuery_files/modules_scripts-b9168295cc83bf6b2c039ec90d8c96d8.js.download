function triggerFormChange(){switch($(this).attr("id")){case"edit-chapter-name":break;default:hasFormChanged=!0}}function checkBeforeUnload(e){if(0<$(".module-edit").length)return hasFormChanged&&(e.returnValue=hasFormChanged),e.returnValue}function uploadFile(t){for(var e=t.attr("action"),i=$("#upload_file"),r=new FormData,n=0;n<i[0].files.length;n++)r.append("upload[file][]",i[0].files[n]);return r.append("upload[user_id]",$('input[name="upload[user_id]"]').val()),r.append("upload[course_id]",$('input[name="upload[course_id]"]').val()),r.append("upload[chapter_id]",$('input[name="upload[chapter_id]"]').val()),r.append("upload[chapter_module_id]",$('input[name="module_id"]').val()),$(t).find(".actions .fa-spinner").removeClass("hidden"),$(t).find(".actions .btn").val("UPLOADING!!").addClass("disabled"),$(t).find("label").addClass("disabled"),$.ajax({url:e,method:"POST",contentType:!1,cache:!1,processData:!1,data:r,success:function(e){1==e.success&&$("div.uploads-table").find(".table tbody").append(e.partial),$(t).find(".actions .btn").removeClass("disabled"),$(t).find(".actions .fa-spinner").addClass("hidden"),$(t).find(".actions .btn").val("CREATE UPLOAD"),$("#uploaded_file_list").html(""),$(t).find("label").removeClass("disabled"),i.val(""),$(".upload_name").text("No file chosen")}}),!1}function renderError(e){"object"==typeof e&&(e=JSON.stringify(e)),e="Error: "+e,console.error(e),$("#main_content").prepend($("<div />",{"class":"errors",html:e}))}function confirmDeleteChapter(){var e=$(this).closest(".modal").find("input[name='chapter_id']").val();$.ajax({url:"/chapters/"+e,method:"DELETE",contentType:"application/json",success:function(e){location.href=e.refs.redirect.url},error:renderError})}function confirmDeleteModule(){var e=$(this).closest(".modal").find("input[name='module_id']").attr("data-module"),t=$(this).closest(".modal").find("input[name='chapter_id']").attr("data-chapter"),i=$(this).closest(".modal").find("input[name='track_id']").attr("data-track");$.ajax({url:"/modules/"+i+"/"+t+"/"+e,method:"DELETE",contentType:"application/json",success:function(e){location.href=e.refs.redirect.url},error:renderError})}function createNewChapter(){var t=$(this);t.text("SAVING...").addClass("disabled_btn");var e={data:{course_id:$("ul#chapter_list").data("course-id"),title:t.siblings("input[type='text']").val()}};$.ajax({url:"/chapters",method:"POST",contentType:"application/json",data:JSON.stringify(e),success:function(e){console.log("Success handler",e),t.text("SAVE").removeClass("disabled_btn"),location.href=e.refs.edit},error:renderError})}function updateChapterName(){var e=$(this);e.text("SAVING...").addClass("disabled_btn");var t={data:{title:e.siblings("input[type='text']").val()}},i=e.closest(".modal-content").find("input[name='chapter_id']").val();$.ajax({url:"/chapters/"+i,method:"PATCH",data:JSON.stringify(t),contentType:"application/json",success:function(){location.reload(),e.text("SAVE").removeClass("disabled_btn")},error:renderError})}function handleDrop(e){var t=$(e.target),i="",r={data:{}};console.log(t);var n=t.children("li").toArray();(t.hasClass("module-list")||t.hasClass("horizontal_chapter_list_view"))&&(i="/chapters/"+t.data("chapter-id"),"chapter",r.data.modules_order=n.map(function(e){return $(e).data("module-id")}).join(", ")),setTimeout(function(){$(e.target).children("li").css("top","")},10),$.ajax({url:i,method:"PATCH",contentType:"application/json",data:JSON.stringify(r),success:function(e){console.log("handleDrop success handler: ",e)},error:renderError})}function handleAddAssignmentTask(e){e.preventDefault();var t=$("#new-task").val();""!=t?($("ol.tasks").append($("<li />",{html:[$("<span/>",{"class":"drag_icon glyphicon glyphicon-th"}),$("<span/>",{"class":"to_do_task",text:t}),$("<a/>",{"class":"pull-right remove-assignment",href:"#",html:[$("<span/>",{"class":"glyphicon glyphicon-trash"})]})]})),$("#new-task").val("")):$("#new-task").focus()}function selectModuleByListItem(){$(this).data("module-id")}function handleEditModuleSubmit(e){e.preventDefault();var t=$("#description").redactor("core.object");t.source.$textarea.hasClass("open")&&t.source.hide();$('input[name="module_id"]').val();var i=removePrismHighlighting($("#description"));$('input[name="title"]').val(),!1!==i&&$(i).redactor("code.get"),$("section.module-info").data("module-type"),$("input#is_admin_module").prop("checked")}function removePrismHighlighting(e,n){$("div.toolbar").remove(),$("pre").each(function(e,t){var i=$(t).clone(),r=$(i).data("language");r==undefined&&(r=i.find("code").attr("class")),$(t).removeClass(),$(t).text(i.text()),$(t).attr("data-language",r),e==$("pre").length-1&&(attempt_count++,"function"==typeof n&&setTimeout(function(){n()},500*attempt_count))})}function changePrism_to_Rainbow(){var e=0==$("#description").length?$(".module_content").find(".module_description")[0]:$("#description");$(e).find(".lesson_assignment_select").selectpicker(),setTimeout(function(){removePrismHighlighting($(e),function(){var t=$("pre").find(".from-rainbow");t.each(function(e){t[e].length&&$(t[e]).contents().unwrap()}),$(e).find(".lesson_assignment_select").length&&$(e).find(".lesson_assignment_select").selectpicker(),Rainbow.addClass("from-rainbow"),Rainbow.color(),is_rainbow=!0}),setTimeout(function(){$("#programs_content").removeClass("hidden"),search_module?search_key_word(sessionStorage.getItem("search"),"#5F9EA0"):serch_reported_mistake&&doSearch(serch_reported_mistake,"mistake")},1e3)},500)}function getModuleMetadata(e){switch(e.module_type){case"lesson":return getLessonMetadata(e.description);case"quiz":return getQuiztMetadata();case"assignment":return getAssignmentMetadata();case"admin_module":return getLessonMetadata(e.description)}}function getLessonMetadata(e){var t={};return t.with_video=Boolean(e.match(/player.vimeo.com/)),t}function getQuiztMetadata(){var i={questions:[]};return $("ol.questions li.question").each(function(e,t){var r={question:$(t).find("span.question").text(),choices:[]};$(t).find("ol.choices li.choice").each(function(e,t){var i={content:$(t).find("span.option").text()};$(t).find("input").is(":checked")&&(i.is_answer=!0),r.choices.push(i)}),i.questions.push(r)}),i}function getAssignmentMetadata(){var o={};return $("li.module-setting").each(function(e,t){var i,r,n=$(t).find("input, select, textarea")[0];n&&(r=$(n).attr("id"),i="checkbox"===$(n).attr("type")?$(n).is(":checked"):$(n).val(),o[r]=i)}),$("div.module-list").each(function(e,t){var i=$(t).attr("id"),r=$(t).find("li");o[i]=[],r.each(function(e,t){o[i].push($(t).find(".to_do_task").text())})}),o}function addChoiceToQuestion(e){e.preventDefault();var t=$(this),i=t.parent().data("questionIndex"),r=$('ol.choices[data-question-index="'+i+'"]'),n=r.find("li").length,o=t.siblings('input[name="new-choice"]'),a=$("<li/>",{"class":"choice",html:[$("<span/>",{"class":"drag_icon glyphicon glyphicon-th ui-sortable-handle"}),$("<input/>",{type:"radio",id:"choice_"+i+"_"+n,name:"choice_"+i}),$("<label/>",{"for":"choice_"+i+"_"+n,html:[$("<span/>",{"class":"radio_marker",html:[$("<span/>",{"class":"marker"})]})]}),$("<span/>",{"class":"option",contenteditable:!0,text:o.val()}),$("<a />",{"class":"remove-choice",type:"button",href:"#",html:$("<div/>",{"class":"glyphicon glyphicon-trash"})})]});""!=t.siblings("input[type='text']").val()&&(r.append(a),o.val(""))}function addQuestionToQuiz(e){e.preventDefault();var t=$(this).siblings('input[name="new-question"]'),i=$("li.question").length,r=$("<li/>",{"class":"question",html:[$("<h4 />",{html:[$("<span/>",{"class":"drag_icon glyphicon glyphicon-th ui-sortable-handle"}),$("<span/>",{"class":"question",contenteditable:!0,text:t.val()}),$("<a />",{"class":"remove-question",href:"#",html:$("<div/>",{"class":"glyphicon glyphicon-trash"})})]}),$("<ol />",{"class":"choices list-unstyled","data-question-index":i}),$("<div />",{"class":"add-new-choice","data-question-index":i,html:[$("<input/>",{type:"text",name:"new-choice",placeholder:"New choice"}),$("<input/>",{type:"submit","class":"btn-sm btn btn-primary",value:"Add choice"})]})]});""!=$(this).siblings("input[type='text']").val()?($("ol.questions").append(r),t.val("")):$(this).siblings("input[type='text']").focus()}function invokeCorrectSubmitButton(e){13===e.keyCode&&(e.preventDefault(),console.log(),$(this).siblings('input[type="submit"]').trigger("click"))}function removeQuestionFromQuiz(){$(this).closest("li").remove()}function removeChoiceFromQuestion(e){e.preventDefault(),$(this).closest("li").remove()}function removeAssignmentTask(e){e.preventDefault(),$(this).closest("li").remove()}function show_copy_to_clipboard(e){if(is_rainbow){var t=$(e.target),i=$("<div>",{id:"copy-toolbar-container"}),r=$("<span>",{id:"copy-toolbar",text:"copy"});t.position().top;i.append(r),t.addClass("active_pre"),i.css({cursor:"pointer",position:"absolute",top:"5px",right:"5px","background-position ":" left top",padding:"0px 3px",background:" #f5f2f0",background:"rgba(224,224,224,0.2)","box-shadow":"0 2px 0 0 rgba(0,0,0,0.2)",color:"#bbb","border-radius":".5em","font-size":".8em"}),t.append(i)}}function remove_copy_to_clipboard(e){var t=$(e.target);$("#copy-toolbar-container").remove(),t.removeClass("active_pre")}function change_solution_to_rainbow(){$(".solution-content");crawlCodeBlocksAndApplyPrismHighlighting()}function show_elaborate_textarea(e){e.closest(".survey_question").find(".elaborate_survey_container").slideDown(function(){$(this).find("textarea").focus()})}function save_survey_answer(e){for(var t=[],i={question_id:e.parents(".survey_question").attr("data-question-id"),question_answer:e.val(),comment:""},r=0;r<survey_answer_array.length;r++)t.push(survey_answer_array[r].question_id);if(t.includes(i.question_id))for(r=0;r<survey_answer_array.length;r++)survey_answer_array[r].question_id===i.question_id&&("textarea"==e[0].type?survey_answer_array[r].comment=e.val():survey_answer_array[r].question_answer=e.val());else survey_answer_array.push(i)}function submit_survey_answer(){$.ajax({url:"/submit_chapter_survey/"+$("#survey_track_id").val()+"/"+$("#survey_chapter_id").val(),method:"POST",data:JSON.stringify({data:survey_answer_array}),contentType:"application/json",success:function(e){$("#success_survey_modal").modal("show"),$("#submit_survey_btn").removeClass("disabled"),$("#submit_survey_btn").find(".submit_text").text("Submit"),$("#submit_survey_btn").find(".loading_animation").addClass("hidden"),$("#success_survey_modal").find("modal_body p").text(e.message),0<e.data.length&&e.data.forEach(function(){"function"==typeof save_activity_log&&save_activity_log(6.1,null)}),setTimeout(function(){$("#success_survey_modal").modal("hide")},1500)}})}function search_key_word(e,t){if(is_rainbow){var i=$(".module_content"),r=new RegExp(e+"(?![^<>]*>)","gi"),n=i.html().replace(r,function(e){return'<span style="background-color: '+t+';">'+e+"</span>"});i.html(n),setTimeout(function(){sessionStorage.removeItem("search")},500),is_rainbow=!1}}function create_solution(t){$.post(t.attr("action"),t.serialize(),function(e){!0===e.status?($("#solutions_table").find("tbody").append(e.html),t[0].reset()):alert(e.message)},"json")}function delete_solution(e){var t=$(".current").parent();$.post("/delete_solution",{authenticity_token:AUTH_TOKEN,solution_id:e.closest("tr").attr("data-solution-id"),chapter_id:t.data("chapter-id")},function(){e.closest("tr").fadeOut(300,function(){$(this).remove()})},"json")}function showing_edit_module_title(){var e=$(this),t=null;t="MODULE TITLE"==e.siblings(".module_title").text()||"LINK TITLE"==e.siblings(".module_title").text()?"":e.siblings(".module_title").text(),e.removeClass("color_red").addClass("hidden").siblings().removeClass("color_red").siblings(".module_title").addClass("hidden").siblings(".module_title_input").removeClass("hidden").val(t).focus()}function update_module_title(e){var t=null;""==(e=$(this)).val()?e.parent().hasClass("edit_module_container")?t="MODULE TITLE":e.parent().hasClass("link_title_container")&&(t="LINK TITLE"):t=e.val(),e.addClass("hidden").siblings(".edit_module_title").removeClass("hidden").siblings(".module_title").removeClass("hidden").text(t)}function initialize_module_redactor(){$("#description").redactor({imageUpload:"/upload.php",imageManagerJson:"/images/images.json",imageResizable:!0,imagePosition:!0,toolbarFixed:!0,linkSize:1e6,fileUpload:"/upload.php",fileManagerJson:"/files/files.json",buttons:["format","bold","italic","underline","lists","image","video","file","table","link","align"],plugins:["codemirror","table","imagemanager","video","filemanager","alignment","custom_save"],codemirror:{lineNumbers:!0,lineWrapping:!0,theme:"monokai",indentUnit:4},callbacks:{change:function(){$(".preview_module_btn").attr("disabled","disabled")},blur:function(){if(!1===$(".active_pre").hasClass("rainbow"))$(".active_pre").find("span:not(.from-rainbow)").contents().unwrap();else{var e=$(".active_pre").find(".from-rainbow");$(".active_pre").removeClass("rainbow"),e.length&&e.contents().unwrap()}Rainbow.addClass("from-rainbow"),Rainbow.color()},focus:function(){$(".preview_module_btn").attr("disabled",!0)},init:function(){$("#description").addClass("redactor-styles")},visual:function(){$("pre.rainbow").each(function(){var e=$(this).find(".from-rainbow");$(this).removeClass("rainbow"),e.length&&e.contents().unwrap(),Rainbow.addClass("from-rainbow"),Rainbow.color()})},source:function(){var e=this.code.get(),t=$("<div></div>");return t.html(e),t.find("pre span").contents().unwrap(),t.html()}}})}function show_module_form(e){var t="true"==$("li .current").attr("data-first_module"),i=$("li .current").attr("data-chapter-id"),r="new"!==e?"EDIT MODULE":"NEW MODULE";if("new"!==e)var n=$(this).find("span").data("module-id");$.ajax({url:"/modules/modal",method:"POST",data:{chapter_id:i,module_id:n,is_first_module:t},success:function(e){$(".manage_module_modal").find(".modal_head h4").text(r),$(".manage_module_modal").find(".modal_body").html(e.result)}})}function saving_edited_module(e){e.preventDefault();var t=$(this),i=$("li .current").attr("data-module-id"),r="true"==$("li .current").attr("data-first_module");if(t.find(".module_title_input").each(function(){""==$(this).val()?$(this).siblings().addClass("color_red"):$(this).siblings().removeClass("color_red")}),0!=t.find(".color_red").length||0!=t.find(".border_red").length)return!1;var n=$(".tab_list .current"),o=t.find("input[name='module_options']:checked").attr("data-option-value"),a=t.find(".edit_module_container h4").text(),s=t.find(".link_title_container h5").text(),l=(i=$('input[name="module_id"]').val(),$(".current").parent());n.find(".tab_details h4").text(s),$("#description > h1:first-child").text(a),$("li.current").find(".tab_details h4").text(s),n.removeClass().addClass(o+" completed_tab current").attr("data-module-type",o),t.closest(".modal").modal("hide");var c={data:{content:$("#description").redactor("code.get"),content_title:a,title:s},chapter_id:l.data("chapter-id")};r?(c.data.module_type=o,c.first_module=r,$(".module-info, .uploads, #assignment-solutions").remove(),$(".loading_container").removeClass("hidden"),$(".switch_horizontal_tab_view").addClass("hidden"),$(".preview_module_btn").addClass("hidden"),$(".module_title_input").val(""),$.ajax({url:"/modules/"+i,method:"PATCH",data:JSON.stringify(c),contentType:"application/json",success:function(){window.location.reload()},error:function(e){console.warn(e)}})):$.ajax({url:"/modules/"+i,method:"PATCH",data:JSON.stringify(c),contentType:"application/json",success:function(e){$("#breadcrumbs .module_title").text(e.result.data.title)},error:function(e){console.warn(e)}})}function duplicate_module(){var e=$(this),t=e.closest(".current").clone(),i="Copy - "+e.closest(".current").find(".tab_details h4").text();t.removeClass("current").find(".tab_details h4").text(i),e.closest(".horizontal_chapter_list_view").length&&$(".scroll_right_module").show();var r={module_id:e.data("module-id"),chapter_id:e.data("chapter-id"),title:i};$(".loading_container").removeClass("hidden"),$.ajax({url:"/modules/duplicate",method:"POST",data:JSON.stringify(r),contentType:"application/json",success:function(e){window.location.href=e.result.url,console.log(e)},error:function(e){console.warn(e)}})}function handleSaveModule(e){$(".preview_module_btn").attr("disabled",!1),e.preventDefault();$(".module_modal_form");var t=$(".current").parent(),i=$(".current h4"),r="/modules/content/"+$('input[name="module_id"]').val(),n=$("section.module-info").data("module-type"),o=$("textarea.open"),a={chapter_id:t.data("chapter-id"),module_type:n,title:$("#description h1").text(),link_title:i[i.length-1].textContent,description:$("#description").redactor("code.get")};a.metadata=getModuleMetadata(a),0==o.length&&($(".re-custom_save").attr("disabled","disabled"),$(".re-custom_save").text("Saving..."),$.ajax({url:r,method:"PATCH",data:JSON.stringify(a),contentType:"application/json",success:function(){$("#alert_modal").modal("show"),$(".info_container").find(".updated_at").text("Updated just now"),$(".info_container").find(".updated_at").attr("data-original-title","Updated less than a minute ago"),$('[data-toggle="tooltip"]').tooltip(),setTimeout(function(){$(".re-custom_save").removeAttr("disabled","disabled"),$(".re-custom_save").text("Save Module Changes"),$("#alert_modal").find(".failed_to_save_content").addClass("hidden"),$("#alert_modal").find(".save_successfully_content").removeClass("hidden")},1500)},error:function(){$(".re-custom_save").text("Saving Failed.."),$("#alert_modal").modal("show"),setTimeout(function(){$(".re-custom_save").removeAttr("disabled","disabled"),$(".re-custom_save").text("Save Module Changes"),$("#alert_modal").find(".failed_to_save_content").removeClass("hidden"),$("#alert_modal").find(".save_successfully_content").addClass("hidden")},1500)}}),setTimeout(function(){$("#alert_modal").modal("hide")},3e3))}function generateModuleType(e){switch(e){case"lesson":return 0;case"quiz":return 1;case"assignment":return 2;default:return 0}}function handleNewModuleCancel(){console.log("Logic to cancel creation...")}function init_language_settings(){if($(".module-edit").length){var e=$(this),t=$(".language_rainbow_dropup"),i=e.offset().top,r=e.offset().left;e.hasClass("active_pre")?t.removeClass("hidden"):t.removeClass("hidden open"),t.css({top:i+1,left:r+e.outerWidth()-36}),e.addClass("active_pre").siblings("pre").removeClass("active_pre"),t.children(".selected_rainbow_option").attr("class","selected_rainbow_option "+e.attr("data-language")+"_rainbow_option")}}function copy_to_clipboard(e){var t=$("<textarea>"),i=$(e.target).parents("pre").text();i=i.substring(0,i.length-4);var r=!1;$("body").append(t),t.val(i).select(),r=document.execCommand("copy"),t.remove(),r&&($("#copy-toolbar").text("copied!"),setTimeout(function(){$("#copy-toolbar").text("copy")},1500))}function manage_language_settings(e){e.preventDefault();var t=$(this),i=t.children("a").attr("data-option-language"),r=$(".active_pre");$(".selected_rainbow_option").attr("class","selected_rainbow_option "+t.children("a").attr("class")),$(".popover").popover("destroy"),$(r).removeClass(),$(r).attr("data-language",i),$(r).addClass("active_pre language-"+i),$(r).find("span:not(.from-rainbow)").contents().unwrap();var n=$(".active_pre").find(".from-rainbow");n.length&&n.contents().unwrap(),Rainbow.addClass("from-rainbow"),Rainbow.color()}function horizontal_tab_view(){var e=$(this),t=$(".horizontal_chapter_list_view");e.removeClass("switch_horizontal_tab_view").addClass("switch_vertical_tab_view"),t.html($("#chapter_list > li.active .tab_list").html()),$("#sidebar, .hidden_chapter_title, .glyphicon-menu-hamburger").fadeOut(),$(".hidden_chapter_title").css("visibility","hidden"),$(".horizontal_chapter_view_container, #full_view_chapter_title").fadeIn(),$("#full_view_chapter_title h1").text($("#chapter_list li.active .chapter-title").text()),$("#main_content").addClass("full_view"),$(".horizontal_chapter_view_container .add_new_module ").removeClass("hidden"),t.sortable({items:"li:not(.dropdown-menu li)",axis:"x",cursor:"move",stop:handleDrop,start:function(e,t){$(t.item[0]).find(".dropdown").removeClass("open").children(".dropdown-toggle").attr("aria-expanded",!1)}}),t.disableSelection();var i=0;t.children("li:lt("+t.children("li.current").index()+")").each(function(){i+=Number($(this).outerWidth())}),$(".horizontal_chapter_list_view li.current").is(":first-child")?$(".scroll_left_module").hide():$(".scroll_left_module").show(),$(".horizontal_chapter_list_view li.current").is(":last-child")?$(".scroll_right_module").hide():$(".scroll_right_module").show(),t.outerWidth()<"827"&&$(".scroll_right_module, .scroll_left_module").hide(),t.scrollLeft(i),document.cookie="course_editor_view=horizontal_view; path=/"}function vertical_tab_view(){$(this).addClass("switch_horizontal_tab_view").removeClass("switch_vertical_tab_view"),$("#chapter_list > li.active .tab_list").html($(".horizontal_chapter_list_view").html()),$("#sidebar, .hidden_chapter_title, .glyphicon-menu-hamburger").fadeIn(),$(".hidden_chapter_title").css("visibility","visible"),$(".horizontal_chapter_view_container, #full_view_chapter_title").fadeOut(),$("#main_content").removeClass("full_view"),$(".dropdown-menu").attr("style",""),document.cookie="course_editor_view=vertical_view; path=/"}function navigate_module_ui_adjustment(){var e=$(this),t=$(".horizontal_chapter_list_view"),i=t[0].scrollWidth-t[0].clientWidth;e.hasClass("scroll_right_module")?t.stop().animate({scrollLeft:"+=200"},300):t.stop().animate({scrollLeft:"-=200"},300),setTimeout(function(){e.hasClass("scroll_right_module")?(0<t.scrollLeft()&&$(".scroll_left_module").show(),t.scrollLeft()==i&&$(".scroll_right_module").hide()):(0==t.scrollLeft()&&$(".scroll_left_module").hide(),$(".scroll_right_module").show())},300)}function move_next_prev_chapter(){var e=$(this);if($("#chapter_list li.active li.current").removeClass("current"),"next"==e.attr("data-move-direction")){var t=$("#chapter_list").data("track-id"),i=$("li.active").next().find("ul.tab_list").data("chapter-id"),r=$("li.active").next().find(".chapter_title").data("chapter-module");r===undefined&&i===undefined||(window.location.href="/modules/edit/"+t+"/"+i+"/"+r)}else{var n=$("#chapter_list").data("track-id"),o=$("li.active").prev().find("ul.tab_list").data("chapter-id"),a=$("li.active").prev().find(".chapter_title").data("chapter-module");a===undefined&&o===undefined||(window.location.href="/modules/edit/"+n+"/"+o+"/"+a)}$(".nano").nanoScroller({scrollTo:$("#chapter_list").find("li.active")}),e.siblings("h1").text($("#chapter_list li.active a.chapter_title h3 span").text());var s=$(".horizontal_chapter_list_view");s.html($("#chapter_list li.active .tab_list").html()),0==s[0].scrollWidth-s[0].clientWidth?$(".scroll_left_module, .scroll_right_module").hide():$(".scroll_right_module").show()}function saving_new_module(e){var t=$(".tab_list .current, .horizontal_chapter_list_view .current").index();if(e.find(".module_title_input").each(function(){""==$(this).val()?$(this).siblings().addClass("color_red"):$(this).siblings().removeClass("color_red")}),1<=e.find(".program_type_checkbox:checked").length?e.find(".program_type_checkbox").siblings(".checkbox_marker").removeClass("border_red").siblings(".checkbox_label").removeClass("color_red"):e.find(".program_type_checkbox").siblings(".checkbox_marker").addClass("border_red").siblings(".checkbox_label").addClass("color_red"),0!=e.find(".color_red").length)return!1;$(".module-info, .uploads, #assignment-solutions").remove();var i=e.find("input[name='module_options']:checked").attr("data-option-value"),r=[];e.find(".program_type_checkbox").each(function(){$(this)[0].checked&&r.push($(this).val())}),$("#chapter_list li.active .tab_list li.completed_tab:eq("+t+"), .horizontal_chapter_list_view li.completed_tab:eq("+t+")").removeClass("current"),e.find(".btn-group .active input").trigger("click"),e.closest(".modal").modal("hide"),$(".loading_container").removeClass("hidden"),$(".switch_horizontal_tab_view").addClass("hidden"),$(".preview_module_btn").addClass("hidden"),console.log(e),$(".module_title_input").val("");var n=$(".module_modal_form").find('input[name="chapter_id"]').val(),o=$(".module_title_container"),a={chapter_id:n,track_id:$("#chapter_list").data("track-id"),program_type:r.join(),module_type:i,description:"<h1>"+o.find(".edit_module_container .module_title").text()+"</h1>",title:o.find(".edit_module_container .module_title").text(),link_title:o.find(".link_title_container .module_title").text(),metadata:!1};$.ajax({url:"/modules",method:"POST",data:JSON.stringify(a),contentType:"application/json",success:function(e){window.location.href=e.result.url,console.log(e)},error:function(e){console.warn(e)}})}function show_confirm_modal(){var e=$(".action_confirm_modal"),t=$(this).find("span").text(),i=$(this).attr("data-action");e.find(".modal_body .action_name").text(i),e.find(".modal_body .chapter_title").text(t),e.find(".modal_body .action_btn").text("copy"==i?"COPY MODULE":"MOVE MODULE").addClass("copy"==i?"confirm_copy_to_btn":"confirm_move_to_btn"),e.find(".modal_header h4").text("copy"==i?"COPY MODULE":"MOVE MODULE"),e.find('input[name="chapter_id"]').attr("data-chapter",$(this).find("span").attr("data-chapter-id"))}function process_module(e,t){$(".loading_container").removeClass("hidden");var i=e.parents(".modal-content"),r={module_id:i.find('input[name="module_id"]').attr("data-module"),chapter_id:i.find('input[name="chapter_id"]').attr("data-chapter"),track_id:i.find('input[name="track_id"]').attr("data-track"),current_chapter_id:i.find('input[name="current_chapter_id"]').attr("data-current-chapter"),process_action:t},n="copy"==t?"/modules/duplicate":"/process_module";setTimeout(function(){$.post(n,r,function(e){window.location.href=e.url})},800)}function remove_chapter_upload(){var t=$(this);$.post("/uploads/delete",{id:t.data().id},function(e){console.log(e),e&&t.parents("tr").remove()})}!function(f){"use strict";function l(e,t){return new l.prototype.init(e,t)}Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;return function(){return t.apply(e)}});var i=0;f.fn.redactor=function(r){var n=[],o=Array.prototype.slice.call(arguments,1);return"string"==typeof r?this.each(function(){var e,t=f.data(this,"redactor");if("-1"!==r.search(/\./)?void 0!==t[(e=r.split("."))[0]]&&(e=t[e[0]][e[1]]):e=t[r],void 0!==t&&f.isFunction(e)){var i=e.apply(t,o);void 0!==i&&i!==t&&n.push(i)}else f.error('No such method "'+r+'" for Redactor')}):this.each(function(){f.data(this,"redactor",{}),f.data(this,"redactor",l(this,r))}),0===n.length?this:1===n.length?n[0]:n},f.Redactor=l,f.Redactor.VERSION="2.8.1",f.Redactor.modules=["air","autosave","block","buffer","build","button","caret","clean","code","core","detect","dropdown","events","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","linkify","list","marker","modal","observe","offset","paragraphize","paste","placeholder","progress","selection","shortcuts","storage","toolbar","upload","uploads3","utils","browser"],f.Redactor.settings={},f.Redactor.opts={animation:!1,lang:"en",direction:"ltr",spellcheck:!0,overrideStyles:!0,scrollTarget:document,focus:!1,focusEnd:!1,clickToEdit:!1,structure:!1,tabindex:!1,minHeight:!1,maxHeight:!1,maxWidth:!1,plugins:!1,callbacks:{},placeholder:!1,linkify:!0,enterKey:!0,pastePlainText:!1,pasteImages:!0,pasteLinks:!0,pasteBlockTags:["pre","h1","h2","h3","h4","h5","h6","table","tbody","thead","tfoot","th","tr","td","ul","ol","li","blockquote","p","figure","figcaption"],pasteInlineTags:["br","strong","ins","code","del","span","samp","kbd","sup","sub","mark","var","cite","small","b","u","em","i"],preClass:!1,preSpaces:4,tabAsSpaces:!1,tabKey:!0,autosave:!1,autosaveName:!1,autosaveFields:!1,imageUpload:null,imageUploadParam:"file",imageUploadFields:!1,imageUploadForms:!1,imageTag:"figure",imageEditable:!0,imageCaption:!0,imagePosition:!1,imageResizable:!1,imageFloatMargin:"10px",dragImageUpload:!0,multipleImageUpload:!0,clipboardImageUpload:!0,fileUpload:null,fileUploadParam:"file",fileUploadFields:!1,fileUploadForms:!1,dragFileUpload:!0,s3:!1,linkNewTab:!1,linkTooltip:!0,linkNofollow:!1,linkSize:30,pasteLinkTarget:!1,videoContainerClass:"video-container",toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarOverflow:!1,air:!1,airWidth:!1,formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,buttons:["format","bold","italic","deleted","lists","image","file","link","horizontalrule"],buttonsTextLabeled:!1,buttonsHide:[],buttonsHideOnMobile:[],script:!0,removeNewlines:!1,removeComments:!0,replaceTags:{b:"strong",i:"em",strike:"del"},keepStyleAttr:[],shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,activeButtons:["deleted","italic","bold"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted"},langs:{en:{format:"Format",image:"Image",file:"File",link:"Link",bold:"Bold",italic:"Italic",deleted:"Strikethrough",underline:"Underline","bold-abbr":"B","italic-abbr":"I","deleted-abbr":"S","underline-abbr":"U",lists:"Lists","link-insert":"Insert link","link-edit":"Edit link","link-in-new-tab":"Open link in new tab",unlink:"Unlink",cancel:"Cancel",close:"Close",insert:"Insert",save:"Save","delete":"Delete",text:"Text",edit:"Edit",title:"Title",paragraph:"Normal text",quote:"Quote",code:"Code",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",filename:"Name",optional:"optional",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",horizontalrule:"Line","upload-label":"Drop file here or ",caption:"Caption",bulletslist:"Bullets",numberslist:"Numbers","image-position":"Position",none:"None",left:"Left",right:"Right",center:"Center","accessibility-help-label":"Rich text editor"}},type:"textarea",inline:!1,inlineTags:["a","span","strong","strike","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],blockTags:["pre","ul","ol","li","p","h1","h2","h3","h4","h5","h6","dl","dt","dd","div","td","blockquote","output","figcaption","figure","address","section","header","footer","aside","article","iframe"],paragraphize:!0,paragraphizeBlocks:["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",emptyHtmlRendered:f("").html("\u200b").html(),imageTypes:["image/png","image/jpeg","image/gif"],userAgent:navigator.userAgent.toLowerCase(),observe:{dropdowns:[]},regexps:{linkyoutube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,linkvimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,linkimage:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi}},l.fn=f.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(e,t){if(this.$element=f(e),this.uuid=i++,this.sBuffer=[],this.sRebuffer=[],this.loadOptions(t),this.loadModules(),this.opts.clickToEdit&&!this.$element.hasClass("redactor-click-to-edit"))return this.loadToEdit(t);this.$element.hasClass("redactor-click-to-edit")&&this.$element.removeClass("redactor-click-to-edit"),this.reIsBlock=new RegExp("^("+this.opts.blockTags.join("|").toUpperCase()+")$","i"),this.reIsInline=new RegExp("^("+this.opts.inlineTags.join("|").toUpperCase()+")$","i"),this.opts.dragImageUpload=null!==this.opts.imageUpload&&this.opts.dragImageUpload,this.opts.dragFileUpload=null!==this.opts.fileUpload&&this.opts.dragFileUpload,this.formatting={},this.lang.load(),f.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.$editor=this.$element,this.detectType(),
this.core.callback("start"),this.core.callback("startToEdit"),this.start=!0,this.build.start()},detectType:function(){this.build.isInline()||this.opts.inline?this.opts.type="inline":this.build.isTag("DIV")?this.opts.type="div":this.build.isTag("PRE")&&(this.opts.type="pre")},loadToEdit:function(e){this.$element.on("click.redactor-click-to-edit",f.proxy(function(){this.initToEdit(e)},this)),this.$element.addClass("redactor-click-to-edit")},initToEdit:function(t){f.extend(t.callbacks,{startToEdit:function(){this.insert.node(this.marker.get(),!1)},initToEdit:function(){this.selection.restore(),this.clickToCancelStorage=this.code.get(),f(this.opts.clickToCancel).off(".redactor-click-to-edit"),f(this.opts.clickToCancel).show().on("click.redactor-click-to-edit",f.proxy(function(e){e.preventDefault(),this.core.destroy(),this.events.syncFire=!1,this.$element.html(this.clickToCancelStorage),this.core.callback("cancel",this.clickToCancelStorage),this.events.syncFire=!0,this.clickToCancelStorage="",f(this.opts.clickToCancel).hide(),f(this.opts.clickToSave).hide(),this.$element.on("click.redactor-click-to-edit",f.proxy(function(){this.initToEdit(t)},this)),this.$element.addClass("redactor-click-to-edit")},this)),f(this.opts.clickToSave).off(".redactor-click-to-edit"),f(this.opts.clickToSave).show().on("click.redactor-click-to-edit",f.proxy(function(e){e.preventDefault(),this.core.destroy(),this.core.callback("save",this.code.get()),f(this.opts.clickToCancel).hide(),f(this.opts.clickToSave).hide(),this.$element.on("click.redactor-click-to-edit",f.proxy(function(){this.initToEdit(t)},this)),this.$element.addClass("redactor-click-to-edit")},this))}}),this.$element.redactor(t),this.$element.off(".redactor-click-to-edit")},loadOptions:function(e){var t={};void 0!==f.Redactor.settings.namespace?this.$element.hasClass(f.Redactor.settings.namespace)&&(t=f.Redactor.settings):t=f.Redactor.settings,this.opts=f.extend({},f.Redactor.opts,this.$element.data(),e),this.opts=f.extend({},this.opts,t)},getModuleMethods:function(t){return Object.getOwnPropertyNames(t).filter(function(e){return"function"==typeof t[e]})},loadModules:function(){for(var e=f.Redactor.modules.length,t=0;t<e;t++)this.bindModuleMethods(f.Redactor.modules[t])},bindModuleMethods:function(e){if(void 0!==this[e]){this[e]=this[e]();for(var t=this.getModuleMethods(this[e]),i=t.length,r=0;r<i;r++)this[e][t[r]]=this[e][t[r]].bind(this)}},air:function(){return{enabled:!1,collapsed:function(){this.opts.air&&this.selection.get().collapseToStart()},collapsedEnd:function(){this.opts.air&&this.selection.get().collapseToEnd()},build:function(){this.detect.isMobile()||(this.button.hideButtons(),this.button.hideButtonsOnMobile(),0!==this.opts.buttons.length&&(this.$air=this.air.createContainer(),!1!==this.opts.airWidth&&this.$air.css("width",this.opts.airWidth),this.air.append(),this.button.$toolbar=this.$air,this.button.setFormatting(),this.button.load(this.$air),this.core.editor().on("mouseup.redactor",this,f.proxy(function(e){""!==this.selection.text()&&this.air.show(e)},this))))},append:function(){this.$air.appendTo("body")},createContainer:function(){return f("<ul>").addClass("redactor-air").attr({id:"redactor-air-"+this.uuid,role:"toolbar"}).hide()},show:function(e){this.selection.saveInstant(),f(".redactor-air").hide();var t=0,i=this.$air.innerWidth();f(window).width()<e.clientX+i&&(t=200),this.$air.css({left:e.clientX-t+"px",top:e.clientY+10+f(document).scrollTop()+"px"}).show(),this.air.enabled=!0,this.air.bindHide()},bindHide:function(){f(document).on("mousedown.redactor-air."+this.uuid,f.proxy(function(e){var t=f(e.target).closest(".redactor-dropdown").length;0===f(e.target).closest(this.$air).length&&0===t&&!1!==this.air.hide(e)&&this.marker.remove()},this)).on("keydown.redactor-air."+this.uuid,f.proxy(function(e){var t=e.which;if((this.utils.isRedactorParent(e.target)||f(e.target).hasClass("redactor-in"))&&0===f(e.target).closest("#redactor-modal").length){if(t===this.keyCode.ESC)this.selection.get().collapseToStart();else if(t===this.keyCode.BACKSPACE||t===this.keyCode.DELETE){var i=this.selection.get();this.selection.range(i).deleteContents()}else t===this.keyCode.ENTER&&this.selection.get().collapseToEnd();this.air.enabled?this.air.hide(e):this.selection.get().collapseToStart()}},this))},hide:function(e){if(e.ctrlKey||e.metaKey||e.shiftKey&&e.altKey)return!1;this.button.setInactiveAll(),this.$air.fadeOut(100),this.air.enabled=!1,f(document).off("mousedown.redactor-air."+this.uuid),f(document).off("keydown.redactor-air."+this.uuid)}}},autosave:function(){return{enabled:!1,html:!1,init:function(){this.opts.autosave&&(this.autosave.enabled=!0,this.autosave.name=this.opts.autosaveName?this.opts.autosaveName:this.$textarea.attr("name"))},is:function(){return this.autosave.enabled},send:function(){if(this.opts.autosave&&(this.autosave.source=this.code.get(),this.autosave.html!==this.autosave.source)){var e={};e.name=this.autosave.name,e[this.autosave.name]=this.autosave.source,e=this.autosave.getHiddenFields(e),f.ajax({url:this.opts.autosave,type:"post",data:e}).done(this.autosave.success)}},getHiddenFields:function(i){return!1===this.opts.autosaveFields||"object"!=typeof this.opts.autosaveFields||f.each(this.opts.autosaveFields,f.proxy(function(e,t){null!==t&&0===t.toString().indexOf("#")&&(t=f(t).val()),i[e]=t},this)),i},success:function(e){var t;try{t=JSON.parse(e)}catch(i){t=e}var i=void 0===t.error?"autosave":"autosaveError";this.core.callback(i,this.autosave.name,t),this.autosave.html=this.autosave.source},disable:function(){this.autosave.enabled=!1,clearInterval(this.autosaveTimeout)}}},block:function(){return{format:function(e,t,i,r){if(e="quote"===e?"blockquote":e,this.block.tags=["p","blockquote","pre","h1","h2","h3","h4","h5","h6","div","figure"],-1!==f.inArray(e,this.block.tags))return"p"===e&&void 0===t&&(t="class"),this.placeholder.hide(),this.buffer.set(),this.utils.isCollapsed()?this.block.formatCollapsed(e,t,i,r):this.block.formatUncollapsed(e,t,i,r)},formatCollapsed:function(e,t,i,r){this.selection.save();var n=this.selection.block(),o=n.tagName.toLowerCase();if(-1!==f.inArray(o,this.block.tags)){var a,s=!1;if(o===e&&void 0===t&&(e="p",s=!0),s&&(this.block.removeAllClass(),this.block.removeAllAttr()),"blockquote"===o&&this.utils.isEndOfElement(n)){this.marker.remove(),(a=document.createElement("p")).innerHTML=this.opts.invisibleSpace,f(n).after(a),this.caret.start(a);var l=f(n).children().last();0!==l.length&&"BR"===l[0].tagName&&l.remove()}else a=this.utils.replaceToTag(n,e);if("object"==typeof t)for(var c in r=i,t)a=this.block.setAttr(a,c,t[c],r);else a=this.block.setAttr(a,t,i,r);return"pre"===e&&1===a.length&&f(a).html(f.trim(f(a).html())),this.selection.restore(),this.block.removeInlineTags(a),a}this.selection.restore()},formatUncollapsed:function(e,t,i,r){this.selection.save();var n=[],o=this.selection.blocks();o[0]&&(f(o[0]).hasClass("redactor-in")||f(o[0]).hasClass("redactor-box"))&&(o=this.core.editor().find(this.opts.blockTags.join(", ")));for(var a=o.length,s=0;s<a;s++){var l=o[s].tagName.toLowerCase();if(-1!==f.inArray(l,this.block.tags)&&"figure"!==l){var c=this.utils.replaceToTag(o[s],e);if("object"==typeof t)for(var d in r=i,t)c=this.block.setAttr(c,d,t[d],r);else c=this.block.setAttr(c,t,i,r);n.push(c),this.block.removeInlineTags(c)}}if(this.selection.restore(),"pre"===e&&0!==n.length){var u=n[0];f.each(n,function(e,t){0!==e&&(f(u).append("\n"+f.trim(t.html())),f(t).remove())}),(n=[]).push(u)}return n},removeInlineTags:function(e){e=e[0]||e;var t=this.opts.inlineTags,i=["PRE","H1","H2","H3","H4","H5","H6"];if(-1!==f.inArray(e.tagName,i)){if("PRE"!==e.tagName){var r=t.indexOf("a");t.splice(r,1)}f(e).find(t.join(",")).not(".redactor-selection-marker").contents().unwrap()}},setAttr:function(e,t,i,r){if(void 0===t)return e;var n=void 0===r?"replace":r;return"class"===t?this.block[n+"Class"](i,e):"remove"===n?this.block[n+"Attr"](t,e):"removeAll"===n?this.block[n+"Attr"](t,e):this.block[n+"Attr"](t,i,e)},getBlocks:function(e){if(e=void 0===e?this.selection.blocks():e,f(e).hasClass("redactor-box")){var i=[],t=this.core.editor().children();return f.each(t,f.proxy(function(e,t){this.utils.isBlock(t)&&i.push(t)},this)),i}return e},replaceClass:function(e,t){return f(this.block.getBlocks(t)).removeAttr("class").addClass(e)[0]},toggleClass:function(e,t){return f(this.block.getBlocks(t)).toggleClass(e)[0]},addClass:function(e,t){return f(this.block.getBlocks(t)).addClass(e)[0]},removeClass:function(e,t){return f(this.block.getBlocks(t)).removeClass(e)[0]},removeAllClass:function(e){return f(this.block.getBlocks(e)).removeAttr("class")[0]},replaceAttr:function(e,t,i){return i=this.block.removeAttr(e,i),f(i).attr(e,t)[0]},toggleAttr:function(i,r,e){e=this.block.getBlocks(e);var n=this,o=[];return f.each(e,function(e,t){f(t).attr(i)?o.push(n.block.removeAttr(i,t)):o.push(n.block.addAttr(i,r,t))}),o},addAttr:function(e,t,i){return f(this.block.getBlocks(i)).attr(e,t)[0]},removeAttr:function(e,t){return f(this.block.getBlocks(t)).removeAttr(e)[0]},removeAllAttr:function(e){e=this.block.getBlocks(e);var o=[];return f.each(e,function(e,t){void 0===t.attributes&&o.push(t);for(var i=f(t),r=t.attributes.length,n=0;n<r;n++)i.removeAttr(t.attributes[n].name);o.push(i[0])}),o}}},buffer:function(){return{set:function(e){void 0===e&&this.buffer.clear(),void 0===e||"undo"===e?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){var e=this.selection.saveInstant(),t=this.sBuffer[this.sBuffer.length-1],i=this.core.editor().html();(void 0===t||t[0]!==i)&&this.sBuffer.push([i,e])},setRedo:function(){var e=this.selection.saveInstant();this.sRebuffer.push([this.core.editor().html(),e])},add:function(){this.sBuffer.push([this.core.editor().html(),0])},undo:function(){if(0!==this.sBuffer.length){var e=this.sBuffer.pop();this.buffer.set("redo"),this.core.editor().html(e[0]),this.selection.restoreInstant(e[1]),this.observe.load()}},redo:function(){if(0!==this.sRebuffer.length){var e=this.sRebuffer.pop();this.buffer.set("undo"),this.core.editor().html(e[0]),this.selection.restoreInstant(e[1]),this.observe.load()}},clear:function(){this.sRebuffer=[]}}},build:function(){return{start:function(){"inline"===this.opts.type?this.opts.type="inline":"div"===this.opts.type?""===f.trim(this.$editor.html())&&this.$editor.html(this.opts.emptyHtml):"textarea"===this.opts.type&&this.build.startTextarea(),this.build.setIn(),this.build.setId(),this.build.enableEditor(),this.build.setOptions(),this.build.callEditor()},createContainerBox:function(){this.$box=f('<div class="redactor-box" role="application" />')},setIn:function(){this.core.editor().addClass("redactor-in")},setId:function(){var e="textarea"===this.opts.type?"redactor-uuid-"+this.uuid:this.$element.attr("id");this.core.editor().attr("id",void 0===e?"redactor-uuid-"+this.uuid:e)},getName:function(){var e=this.$element.attr("name");return void 0===e?"content-"+this.uuid:e},loadFromTextarea:function(){this.$editor=f("<div />"),this.$textarea=this.$element,this.$element.attr("name",this.build.getName()),this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element),this.$editor.addClass("redactor-layer"),this.opts.overrideStyles&&this.$editor.addClass("redactor-styles"),this.$element.hide(),this.$box.prepend('<span class="redactor-voice-label" id="redactor-voice-'+this.uuid+'" aria-hidden="false">'+this.lang.get("accessibility-help-label")+"</span>"),this.$editor.attr({"aria-labelledby":"redactor-voice-"+this.uuid,role:"presentation"})},startTextarea:function(){this.build.createContainerBox(),this.build.loadFromTextarea(),this.code.start(this.core.textarea().val()),this.core.textarea().val(this.clean.onSync(this.$editor.html()))},isTag:function(e){return this.$element[0].tagName===e},isInline:function(){return!this.build.isTag("TEXTAREA")&&!this.build.isTag("DIV")&&!this.build.isTag("PRE")},enableEditor:function(){this.core.editor().attr({contenteditable:!0})},setOptions:function(){"inline"===this.opts.type&&(this.opts.enterKey=!1),"inline"!==this.opts.type&&"pre"!==this.opts.type||(this.opts.toolbarMobile=!1,this.opts.toolbar=!1,this.opts.air=!1,this.opts.linkify=!1),this.core.editor().attr("spellcheck",this.opts.spellcheck),this.opts.structure&&this.core.editor().addClass("redactor-structure"),"textarea"===this.opts.type&&(this.core.box().attr("dir",this.opts.direction),this.core.editor().attr("dir",this.opts.direction),this.opts.tabindex&&this.core.editor().attr("tabindex",this.opts.tabindex),this.opts.minHeight?this.core.editor().css("min-height",this.opts.minHeight):this.core.editor().css("min-height","40px"),this.opts.maxHeight&&this.core.editor().css("max-height",this.opts.maxHeight),this.opts.maxWidth&&this.core.editor().css({"max-width":this.opts.maxWidth,margin:"auto"}))},callEditor:function(){this.build.disableBrowsersEditing(),this.events.init(),this.build.setHelpers(),(this.opts.toolbar||this.opts.air)&&(this.toolbarsButtons=this.button.init()),this.opts.air?this.air.build():this.opts.toolbar&&this.toolbar.build(),this.detect.isMobile()&&this.opts.toolbarMobile&&this.opts.air&&(this.opts.toolbar=!0,this.toolbar.build()),(this.opts.air||this.opts.toolbar)&&(this.core.editor().on("mouseup.redactor-observe."+this.uuid+" keyup.redactor-observe."+this.uuid+" focus.redactor-observe."+this.uuid+" touchstart.redactor-observe."+this.uuid,f.proxy(this.observe.toolbar,this)),this.core.element().on("blur.callback.redactor",f.proxy(function(){this.button.setInactiveAll()},this))),this.modal.templates(),this.build.plugins(),this.autosave.init(),this.code.html=this.code.cleaned(this.core.editor().html()),this.core.callback("init"),this.core.callback("initToEdit"),this.storage.observe(),this.start=!1},setHelpers:function(){this.opts.linkify&&this.linkify.format(),this.placeholder.init(),this.opts.focus?setTimeout(this.focus.start,100):this.opts.focusEnd&&setTimeout(this.focus.end,100)},disableBrowsersEditing:function(){try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1),document.execCommand("AutoUrlDetect",!1,!1)}catch(f){}},plugins:function(){this.opts.plugins&&f.each(this.opts.plugins,f.proxy(function(e,t){var i="undefined"!=typeof RedactorPlugins&&void 0!==RedactorPlugins[t]?RedactorPlugins:l.fn;if(f.isFunction(i[t])){this[t]=i[t]();for(var r=this.getModuleMethods(this[t]),n=r.length,o=0;o<n;o++)this[t][r[o]]=this[t][r[o]].bind(this);if(void 0!==this[t].langs){var a={};void 0!==this[t].langs[this.opts.lang]?a=this[t].langs[this.opts.lang]:void 0===this[t].langs[this.opts.lang]&&void 0!==this[t].langs.en&&(a=this[t].langs.en);var s=this;f.each(a,function(e,t){void 0===s.opts.curLang[e]&&(s.opts.curLang[e]=t)})}f.isFunction(this[t].init)&&this[t].init()}},this))}}},button:function(){return{toolbar:function(){return void 0!==this.button.$toolbar&&this.button.$toolbar?this.button.$toolbar:this.$toolbar},init:function(){return{format:{title:this.lang.get("format"),icon:!0,dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("heading1"),func:"block.format"},h2:{title:this.lang.get("heading2"),func:"block.format"},h3:{title:this.lang.get("heading3"),func:"block.format"},h4:{title:this.lang.get("heading4"),func:"block.format"},h5:{title:this.lang.get("heading5"),func:"block.format"},h6:{title:this.lang.get("heading6"),func:"block.format"}}},bold:{title:this.lang.get("bold-abbr"),icon:!0,label:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic-abbr"),icon:!0,label:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted-abbr"),icon:!0,label:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline-abbr"),icon:!0,label:this.lang.get("underline"),func:"inline.format"},lists:{title:this.lang.get("lists"),icon:!0,dropdown:{unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease",observe:{element:"li",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase",observe:{element:"li",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},ul:{title:"&bull; "+this.lang.get("bulletslist"),icon:!0,func:"list.toggle"},ol:{title:"1. "+this.lang.get("numberslist"),icon:!0,func:"list.toggle"},outdent:{title:this.lang.get("outdent"),icon:!0,func:"indent.decrease"},indent:{title:this.lang.get("indent"),icon:!0,func:"indent.increase"},image:{title:this.lang.get("image"),icon:!0,func:"image.show"},file:{title:this.lang.get("file"),icon:!0,func:"file.show"},link:{title:this.lang.get("link"),icon:!0,dropdown:{link:{title:this.lang.get("link-insert"),func:"link.show",observe:{element:"a","in":{title:this.lang.get("link-edit")},out:{title:this.lang.get("link-insert")}}},unlink:{title:this.lang.get("unlink"),func:"link.unlink",observe:{element:"a",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},horizontalrule:{title:this.lang.get("horizontalrule"),icon:!0,func:"line.insert"}}},setFormatting:function(){f.each(this.toolbarsButtons.format.dropdown,f.proxy(function(e){-1===f.inArray(e,this.opts.formatting)&&delete this.toolbarsButtons.format.dropdown[e]},this))},hideButtons:function(){0!==this.opts.buttonsHide.length&&this.button.hideButtonsSlicer(this.opts.buttonsHide)},hideButtonsOnMobile:function(){this.detect.isMobile()&&0!==this.opts.buttonsHideOnMobile.length&&this.button.hideButtonsSlicer(this.opts.buttonsHideOnMobile)},hideButtonsSlicer:function(e){f.each(e,f.proxy(function(e,t){var i=this.opts.buttons.indexOf(t);-1!==i&&this.opts.buttons.splice(i,1)},this))},load:function(i){this.button.buttons=[],f.each(this.opts.buttons,f.proxy(function(e,t){!this.toolbarsButtons[t]||"file"===t&&!this.file.is()||"image"===t&&!this.image.is()||i.append(f("<li>").append(this.button.build(t,this.toolbarsButtons[t])))},this))},buildButtonTooltip:function(e,t){if(!this.opts.air&&!this.detect.isMobile()){var i=f("<span>");i.addClass("re-button-tooltip"),i.html(t),e.append(i),e.on("mouseover",function(){f(this).hasClass("redactor-button-disabled")||(i.show(),i.css("margin-left",-i.innerWidth()/2))}).on("mouseout",function(){i.hide()})}},build:function(e,t){if(!1!==this.opts.toolbar){var i=void 0!==t.label?t.label:t.title,r=f('<a href="javascript:void(null);" alt="'+i+'" rel="'+e+'" />');if(r.addClass("re-button re-"+e),r.attr({role:"button","aria-label":i,tabindex:"-1"}),void 0===t.icon||this.opts.buttonsTextLabeled)r.html(t.title);else{var n=f("<i>");n.addClass("re-icon-"+e),r.append(n),r.addClass("re-button-icon"),this.button.buildButtonTooltip(r,i)}if((t.func||t.command||t.dropdown)&&this.button.setEvent(r,e,t),t.dropdown){r.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var o=f('<ul class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+e+'" style="display: none;">');r.data("dropdown",o),this.dropdown.build(e,o,t.dropdown)}return this.button.buttons.push(r),r}},getButtons:function(){return this.button.toolbar().find("a.re-button")},getButtonsKeys:function(){return this.button.buttons},setEvent:function(r,n,o){r.on("mousedown",f.proxy(function(e){if(e.preventDefault(),r.hasClass("redactor-button-disabled"))return!1;var t="func",i=o.func;return o.command?(t="command",i=o.command):o.dropdown&&(i=!(t="dropdown")),this.button.toggle(e,n,t,i),!1},this))},toggle:function(e,t,i,r,n){!this.detect.isIe()&&this.detect.isDesktop()||(this.utils.freezeScroll(),e.returnValue=!1),"command"===i?this.inline.format(r):"dropdown"===i?this.dropdown.show(e,t):this.button.clickCallback(e,r,t,n),"dropdown"!==i&&this.dropdown.hideAll(!1),this.opts.air&&"dropdown"!==i&&this.air.hide(e),!this.detect.isIe()&&this.detect.isDesktop()||this.utils.unfreezeScroll()},clickCallback:function(e,t,i,r){var n;if(r=void 0===r?i:r,f.isFunction(t))t.call(this,i);else if("-1"!==t.search(/\./)){if(void 0===this[(n=t.split("."))[0]])return;"object"==typeof r?this[n[0]][n[1]].apply(this,r):this[n[0]][n[1]].call(this,r)}else"object"==typeof r?this[t].apply(this,r):this[t].call(this,r);this.observe.buttons(e,i)},all:function(){return this.button.buttons},get:function(e){if(!1!==this.opts.toolbar)return this.button.toolbar().find("a.re-"+e)},set:function(e,t){if(!1!==this.opts.toolbar){var i=this.button.toolbar().find("a.re-"+e);return i.html(t).attr("aria-label",t),i}},add:function(e,t){if(!0!==this.button.isAdded(e))return f();var i=this.button.build(e,{title:t});return this.button.toolbar().append(f("<li>").append(i)),i},addFirst:function(e,t){if(!0!==this.button.isAdded(e))return f();var i=this.button.build(e,{title:t});return this.button.toolbar().prepend(f("<li>").append(i)),i},addAfter:function(e,t,i){if(!0!==this.button.isAdded(t))return f();var r=this.button.build(t,{title:i}),n=this.button.get(e);return 0!==n.length?n.parent().after(f("<li>").append(r)):this.button.toolbar().append(f("<li>").append(r)),r},addBefore:function(e,t,i){if(!0!==this.button.isAdded(t))return f();var r=this.button.build(t,{title:i}),n=this.button.get(e);return 0!==n.length?n.parent().before(f("<li>").append(r)):this.button.toolbar().append(f("<li>").append(r)),r},isAdded:function(e){var t=this.opts.buttonsHideOnMobile.indexOf(e);return!(!1===this.opts.toolbar||-1!==t&&this.detect.isMobile())},setIcon:function(e,t){this.opts.buttonsTextLabeled||(e.html(t).addClass("re-button-icon"),this.button.buildButtonTooltip(e,e.attr("alt")))},changeIcon:function(e,t){var i=this.button.get(e);0!==i.length&&i.find("i").removeAttr("class").addClass("re-icon-"+t)},addCallback:function(t,i){if(void 0!==t&&!1!==this.opts.toolbar){var r="dropdown"===i?"dropdown":"func",n=t.attr("rel");t.on("mousedown",f.proxy(function(e){if(t.hasClass("redactor-button-disabled"))return!1;this.button.toggle(e,n,r,i)},this))}},addDropdown:function(e,t){if(!1!==this.opts.toolbar){e.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var i=e.attr("rel");this.button.addCallback(e,"dropdown");var r=f('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+i+'" style="display: none;">');return e.data("dropdown",r),t&&this.dropdown.build(i,r,t),r}},setActive:function(e){this.button.get(e).addClass("redactor-act")},setInactive:function(e){this.button.get(e).removeClass("redactor-act")},setInactiveAll:function(e){var t=this.button.toolbar().find("a.re-button");void 0!==e&&(t=t.not(".re-"+e)),t.removeClass("redactor-act")},disable:function(e){this.button.get(e).addClass("redactor-button-disabled")},enable:function(e){this.button.get(e).removeClass("redactor-button-disabled")},disableAll:function(e){var t=this.button.toolbar().find("a.re-button");void 0!==e&&(t=t.not(".re-"+e)),t.addClass("redactor-button-disabled")},enableAll:function(){this.button.toolbar().find("a.re-button").removeClass("redactor-button-disabled")},remove:function(e){this.button.get(e).remove()}}},caret:function(){return{set:function(e,t,i){var r=this.core.editor().scrollTop();this.core.editor().focus(),this.core.editor().scrollTop(r),i=void 0===i?0:1,e=e[0]||e,t=t[0]||t;var n=this.selection.get(),o=this.selection.range(n);try{o.setStart(e,0),o.setEnd(t,i)}catch(e){}this.selection.update(n,o)},prepare:function(e){return this.detect.isFirefox()&&void 0!==this.start&&this.core.editor().focus(),e[0]||e},start:function(e){var t,i;if(e=this.caret.prepare(e)){if("BR"===e.tagName)return this.caret.before(e);var r=f(e).children().first(),n=this.utils.isInlineTag(e.tagName);""===e.innerHTML||n?this.caret.setStartEmptyOrInline(e,n):r&&0!==r.length&&this.utils.isInlineTag(r[0].tagName)&&""===r.text()?this.caret.setStartEmptyOrInline(r[0],!0):((t=window.getSelection()).removeAllRanges(),(i=document.createRange()).selectNodeContents(e),i.collapse(!0),t.addRange(i))}},setStartEmptyOrInline:function(e,t){var i=window.getSelection(),r=document.createRange(),n=document.createTextNode("\u200b");r.setStart(e,0),r.insertNode(n),r.setStartAfter(n),r.collapse(!0),i.removeAllRanges(),i.addRange(r),t||this.core.editor().on("keydown.redactor-remove-textnode",function(){f(n).remove(),f(this).off("keydown.redactor-remove-textnode")})},end:function(e){var t,i;if(e=this.caret.prepare(e)){if("BR"!==e.tagName&&""===e.innerHTML)return this.caret.start(e);if("BR"===e.tagName){var r=document.createElement("span");return r.className="redactor-invisible-space",r.innerHTML="&#x200b;",f(e).after(r),(t=window.getSelection()).removeAllRanges(),(i=document.createRange()).setStartBefore(r),i.setEndBefore(r),t.addRange(i),void f(r).replaceWith(function(){return f(this).contents()})}if(e.lastChild&&1===e.lastChild.nodeType)return this.caret.after(e.lastChild);if((t=window.getSelection()).getRangeAt||t.rangeCount)try{(i=t.getRangeAt(0)).selectNodeContents(e),i.collapse(!1),t.removeAllRanges(),t.addRange(i)}catch(f){}}},after:function(e){var t,i;if(e=this.caret.prepare(e)){if("BR"===e.tagName)return this.caret.end(e);if(this.utils.isBlockTag(e.tagName)){var r=this.caret.next(e);void 0===r?this.caret.end(e):("TABLE"===r.tagName?r=f(r).find("th, td").first()[0]:"UL"!==r.tagName&&"OL"!==r.tagName||(r=f(r).find("li").first()[0]),this.caret.start(r))}else{var n=document.createTextNode("\u200b");(t=window.getSelection()).removeAllRanges(),(i=document.createRange()).setStartAfter(e),i.insertNode(n),i.setStartAfter(n),i.collapse(!0),t.addRange(i)}}},before:function(e){var t,i;if(e=this.caret.prepare(e))if(this.utils.isBlockTag(e.tagName)){var r=this.caret.prev(e);void 0===r?this.caret.start(e):("TABLE"===r.tagName?r=f(r).find("th, td").last()[0]:"UL"!==r.tagName&&"OL"!==r.tagName||(r=f(r).find("li").last()[0]),this.caret.end(r))}else(t=window.getSelection()).removeAllRanges(),(i=document.createRange()).setStartBefore(e),i.collapse(!0),t.addRange(i)},next:function(e){var t=f(e).next();return t.hasClass("redactor-script-tag, redactor-selection-marker")?t.next()[0]:t[0]},prev:function(e){var t=f(e).prev();return t.hasClass("redactor-script-tag, redactor-selection-marker")?t.prev()[0]:t[0]},offset:function(e){return this.offset.get(e)}}},clean:function(){return{onSet:function(e){e=this.clean.savePreCode(e),e=this.clean.saveFormTags(e),this.opts.script&&(e=e.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" $1>$2</pre>')),e=(e=(e=(e=(e=e.replace(/\$/g,"&#36;")).replace(/&amp;/g,"&")).replace(/<a href="(.*?[^>]?)\xae(.*?[^>]?)">/gi,'<a href="$1&reg$2">')).replace(/<span id="selection-marker-1"(.*?[^>]?)>\u200b<\/span>/gi,"###marker1###")).replace(/<span id="selection-marker-2"(.*?[^>]?)>\u200b<\/span>/gi,"###marker2###");var i=this,t=f("<div/>").html(f.parseHTML(e,document,!0)),r=this.opts.replaceTags;if(r){var n=Object.keys(this.opts.replaceTags);t.find(n.join(",")).each(function(e,t){i.utils.replaceToTag(t,r[t.tagName.toLowerCase()])})}t.find("span, a").attr("data-redactor-span",!0),t.find(this.opts.inlineTags.join(",")).each(function(){var e=f(this);e.attr("style")&&e.attr("data-redactor-style-cache",e.attr("style"))}),e=t.html();var o=["font","html","head","link","body","meta","applet"];return this.opts.script||o.push("script"),e=this.clean.stripTags(e,o),this.opts.removeComments&&(e=e.replace(/<!--[\s\S]*?-->/gi,"")),-1!==(e=(e=(e=this.paragraphize.load(e)).replace("###marker1###",'<span id="selection-marker-1" class="redactor-selection-marker">\u200b</span>')).replace("###marker2###",'<span id="selection-marker-2" class="redactor-selection-marker">\u200b</span>')).search(/^(||\s||<br\s?\/?>||&nbsp;)$/i)?this.opts.emptyHtml:e},onGet:function(e){return this.clean.onSync(e)},onSync:function(i){if(-1!==(i=(i=i.replace(/\u200B/g,"")).replace(/&#x200b;/gi,"")).search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i))return"";i=(i=(i=(i=i.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>")).replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,"")).replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,"")).replace(/<img(.*?)style="(.*?)opacity: 0\.5;(.*?)"(.*?)>/gi,'<img$1style="$2$3"$4>');var e=f("<div/>").html(f.parseHTML(i,document,!0));e.find('*[style=""]').removeAttr("style"),e.find('*[class=""]').removeAttr("class"),e.find('*[rel=""]').removeAttr("rel"),e.find('*[data-image=""]').removeAttr("data-image"),e.find('*[alt=""]').removeAttr("alt"),e.find('*[title=""]').removeAttr("title"),e.find("*[data-redactor-style-cache]").removeAttr("data-redactor-style-cache"),e.find(".redactor-invisible-space, .redactor-unlink").each(function(){f(this).contents().unwrap()}),e.find("span, a").removeAttr("data-redactor-span data-redactor-style-cache").each(function(){0===this.attributes.length&&f(this).contents().unwrap()}),e.find("img").removeAttr("rel"),e.find(".redactor-selection-marker, #redactor-insert-marker").remove(),i=e.html(),this.opts.script&&(i=i.replace(/<pre class="redactor-script-tag"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2</script>")),i=(i=(i=(i=(i=this.clean.restoreFormTags(i)).replace(new RegExp("<br\\s?/?></h","gi"),"</h")).replace(new RegExp("<br\\s?/?></li>","gi"),"</li>")).replace(new RegExp("</li><br\\s?/?>","gi"),"</li>")).replace(/<pre>/gi,"<pre>\n"),this.opts.preClass&&(i=i.replace(/<pre>/gi,'<pre class="'+this.opts.preClass+'">')),this.opts.linkNofollow&&(i=(i=i.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>")).replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">'));var t={"\u2122":"&trade;","\xa9":"&copy;","\u2026":"&hellip;","\u2014":"&mdash;","\u2010":"&dash;"};return f.each(t,function(e,t){i=i.replace(new RegExp(e,"g"),t)}),i=(i=i.replace(/&amp;/g,"&")).replace(/\n{2,}/g,"\n"),this.opts.removeNewlines&&(i=i.replace(/\r?\n/g,"")),i},onPaste:function(e,t,i){return!0!==i&&(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2")).replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3")).replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*(font-style: italic; font-weight: 700|font-weight: 700; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>")).replace(/<span[^>]*font-style: italic[^>]*>([\w\W]*?)<\/span>/gi,"<i>$1</i>")).replace(/<span[^>]*font-weight: bold[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")).replace(/<span[^>]*font-weight: 700[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>")).replace(/<o:p[^>]*>/gi,"")).replace(/<\/o:p>/gi,""),this.clean.isHtmlMsWord(e)&&(e=this.clean.cleanMsWord(e))),e=f.trim(e),t.pre?this.opts.preSpaces&&(e=e.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))):(e=this.clean.replaceBrToNl(e),e=this.clean.removeTagsInsidePre(e)),!0!==i&&(e=this.clean.removeEmptyInlineTags(e),!1===t.encode&&(e=e.replace(/&/g,"&amp;"),e=this.clean.convertTags(e,t),e=this.clean.getPlainText(e),e=this.clean.reconvertTags(e,t))),t.text&&(e=this.clean.replaceNbspToSpaces(e),e=this.clean.getPlainText(e)),t.lists&&(e=e.replace("\n","<br>")),t.encode&&(e=this.clean.encodeHtml(e)),t.paragraphize&&(e=(e=e.replace(/ \n/g," ")).replace(/\n /g," "),e=(e=this.paragraphize.load(e)).replace(/<p><\/p>/g,"")),(e=e.replace(/<li><p>/g,"<li>")).replace(/<\/p><\/li>/g,"</li>")},getCurrentType:function(e,t){var i=this.selection.blocks(),r={text:!1,encode:!1,paragraphize:!0,line:this.clean.isHtmlLine(e),blocks:this.clean.isHtmlBlocked(e),pre:!1,lists:!1,block:!0,inline:!0,links:!0,images:!0};return 1===i.length&&this.utils.isCurrentOrParent(["h1","h2","h3","h4","h5","h6","a","figcaption"])?(r.text=!0,r.paragraphize=!1,r.inline=!1,r.images=!1,r.links=!1,r.line=!0):"inline"===this.opts.type||!1===this.opts.enterKey?(r.paragraphize=!1,r.block=!1,r.line=!0):1===i.length&&this.utils.isCurrentOrParent(["li"])?(r.lists=!0,r.block=!1,r.paragraphize=!1,r.images=!1):1===i.length&&this.utils.isCurrentOrParent(["th","td","blockquote"])?(r.block=!1,r.paragraphize=!1):("pre"===this.opts.type||1===i.length&&this.utils.isCurrentOrParent("pre"))&&(r.inline=!1,r.block=!1,r.encode=!0,r.pre=!0,r.paragraphize=!1,r.images=!1,r.links=!1),!0===r.line&&(r.paragraphize=!1),!0===t&&(r.text=!1),r},isHtmlBlocked:function(e){var t=e.match(new RegExp("</("+this.opts.blockTags.join("|").toUpperCase()+")>","gi")),i=e.match(new RegExp("<hr(.*?[^>])>","gi"));return null!==t||null!==i},isHtmlLine:function(e){if(this.clean.isHtmlBlocked(e))return!1;var t=e.match(/<br\s?\/?>/gi),i=e.match(/\n/gi);return!t&&!i},isHtmlMsWord:function(e){
return e.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)},removeEmptyInlineTags:function(e){var t=this.opts.inlineTags,i=f("<div/>").html(f.parseHTML(e,document,!0)),r=this,n=i.find("span"),o=i.find(t.join(","));return o.removeAttr("style"),o.each(function(){var e=f(this).html();0===this.attributes.length&&r.utils.isEmpty(e)&&f(this).replaceWith(function(){return f(this).contents()})}),n.each(function(){f(this).html(),0===this.attributes.length&&f(this).replaceWith(function(){return f(this).contents()})}),e=(e=(e=(e=i.html()).replace("<!--?php","<?php")).replace("<!--?","<?")).replace("?-->","?>"),i.remove(),e},cleanMsWord:function(e){e=(e=(e=(e=e.replace(/<!--[\s\S]*?-->/g,"")).replace(/<o:p>[\s\S]*?<\/o:p>/gi,"")).replace(/\n/g," ")).replace(/<br\s?\/?>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n\n");var c=f("<div/>").html(e),d=!1,u=1,h=[];return c.find("p[style]").each(function(){var e=f(this).attr("style").match(/mso\-list\:l([0-9]+)\slevel([0-9]+)/);if(e){var t=parseInt(e[1]),i=parseInt(e[2]),r=f(this).html().match(/^[\w]+\./)?"ol":"ul",n=f("<li/>").html(f(this).html());if(n.html(n.html().replace(/^([\w\.]+)</,"<")),n.find("span:first").remove(),1==i&&-1==f.inArray(t,h)){var o=f("<"+r+"/>").attr({"data-level":i,"data-list":t}).html(n);f(this).replaceWith(o),d=t,h.push(t)}else{if(u<i){for(var a=l=c.find('[data-level="'+u+'"][data-list="'+d+'"]'),s=u;s<i;s++)(o=f("<"+r+"/>")).appendTo(a.find("li").last()),a=o;a.attr({"data-level":i,"data-list":t}).html(n)}else{var l=c.find('[data-level="'+i+'"][data-list="'+t+'"]').last();l.append(n)}u=i,d=t,f(this).remove()}}}),c.find("[data-level][data-list]").removeAttr("data-level data-list"),c.html()},replaceNbspToSpaces:function(e){return e.replace("&nbsp;"," ")},replaceBrToNl:function(e){return e.replace(/<br\s?\/?>/gi,"\n")},replaceNlToBr:function(e){return e.replace(/\n/g,"<br />")},convertTags:function(e,t){var i=f("<div>").html(e);i.find("iframe").remove();var r=i.find("a");if(r.removeAttr("style"),!1!==this.opts.pasteLinkTarget&&r.attr("target",this.opts.pasteLinkTarget),t.links&&this.opts.pasteLinks&&i.find("a").each(function(e,t){if(t.href){for(var i,r='##%a href="'+t.href+'"',n=0,o=t.attributes.length;n<o;n++)"href"!==(i=t.attributes.item(n)).name&&(r+=" "+i.name+'="'+i.value+'"');t.outerHTML=r+"%##"+t.innerHTML+"##%/a%##"}}),e=i.html(),t.images&&this.opts.pasteImages&&(e=e.replace(/<img(.*?)src="(.*?)"(.*?[^>])>/gi,'##%img$1src="$2"$3%##')),this.opts.pastePlainText)return e;for(var n,o=t.lists?["ul","ol","li"]:this.opts.pasteBlockTags,a=(n=t.block||t.lists?t.inline?o.concat(this.opts.pasteInlineTags):o:t.inline?this.opts.pasteInlineTags:[]).length,s=0;s<a;s++)e=e.replace(new RegExp("</"+n[s]+">","gi"),"###/"+n[s]+"###"),e="td"===n[s]||"th"===n[s]?e.replace(new RegExp("<"+n[s]+'(.*?[^>])((colspan|rowspan)="(.*?[^>])")?(.*?[^>])>',"gi"),"###"+n[s]+" $2###"):this.utils.isInlineTag(n[s])?(e=(e=e.replace(new RegExp("<"+n[s]+'([^>]*)class="([^>]*)"[^>]*>',"gi"),"###"+n[s]+' class="$2"###')).replace(new RegExp("<"+n[s]+'([^>]*)data-redactor-style-cache="([^>]*)"[^>]*>',"gi"),"###"+n[s]+' cache="$2"###')).replace(new RegExp("<"+n[s]+"[^>]*>","gi"),"###"+n[s]+"###"):e.replace(new RegExp("<"+n[s]+"[^>]*>","gi"),"###"+n[s]+"###");return e},reconvertTags:function(e,t){if((t.links&&this.opts.pasteLinks||t.images&&this.opts.pasteImages)&&(e=(e=e.replace(new RegExp("##%","gi"),"<")).replace(new RegExp("%##","gi"),">")),this.opts.pastePlainText)return e;for(var i,r=t.lists?["ul","ol","li"]:this.opts.pasteBlockTags,n=(i=t.block||t.lists?t.inline?r.concat(this.opts.pasteInlineTags):r:t.inline?this.opts.pasteInlineTags:[]).length,o=0;o<n;o++)e=e.replace(new RegExp("###/"+i[o]+"###","gi"),"</"+i[o]+">");for(o=0;o<n;o++)e=e.replace(new RegExp("###"+i[o]+"###","gi"),"<"+i[o]+">");for(o=0;o<n;o++)if("td"===i[o]||"th"===i[o])e=e.replace(new RegExp("###"+i[o]+"s?(.*?[^#])###","gi"),"<"+i[o]+"$1>");else if(this.utils.isInlineTag(i[o])){var a="span"===i[o]?' data-redactor-span="true"':"";e=(e=e.replace(new RegExp("###"+i[o]+' cache="(.*?[^#])"###',"gi"),"<"+i[o]+' style="$1"'+a+' data-redactor-style-cache="$1">')).replace(new RegExp("###"+i[o]+"s?(.*?[^#])###","gi"),"<"+i[o]+"$1>")}return e},cleanPre:function(e){e=void 0===e?f(this.selection.block()).closest("pre",this.core.editor()[0]):e,f(e).find("br").replaceWith(function(){return document.createTextNode("\n")}),f(e).find("p").replaceWith(function(){return f(this).contents()})},removeTagsInsidePre:function(e){var t=f("<div />").append(e);return t.find("pre").replaceWith(function(){var e=f(this).html();return e=(e=e.replace(/<br\s?\/?>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n")).replace(/(<([^>]+)>)/gi,""),f("<pre />").append(e)}),e=t.html(),t.remove(),e},getPlainText:function(e){e=(e=(e=(e=(e=(e=e.replace(/<!--[\s\S]*?-->/gi,"")).replace(/<style[\s\S]*?style>/gi,"")).replace(/<p><\/p>/g,"")).replace(/<\/div>|<\/li>|<\/td>/gi,"\n")).replace(/<\/p>/gi,"\n\n")).replace(/<\/H[1-6]>/gi,"\n\n");var t=document.createElement("div");return t.innerHTML=e,e=t.textContent||t.innerText,f.trim(e)},savePreCode:function(e){return e=this.clean.savePreFormatting(e),e=this.clean.saveCodeFormatting(e),this.clean.restoreSelectionMarkers(e)},savePreFormatting:function(s){var e=s.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null===e||f.each(e,f.proxy(function(e,t){var i,r,n,o=[],a=!1;t.match(/<pre(.*?)>(([\n\r\s]+)?)<code(.*?)>/i)?(a=!0,i=(o=t.match(/<pre(.*?)>(([\n\r\s]+)?)<code(.*?)>([\w\W]*?)<\/code>(([\n\r\s]+)?)<\/pre>/i))[5],r=o[1],n=o[4]):(i=(o=t.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i))[2],r=o[1]),i=(i=i.replace(/<br\s?\/?>/g,"\n")).replace(/&nbsp;/g," "),this.opts.preSpaces&&(i=i.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))),i=(i=this.clean.encodeEntities(i)).replace(/\$/g,"&#36;"),s=a?s.replace(t,"<pre"+r+"><code"+n+">"+i+"</code></pre>"):s.replace(t,"<pre"+r+">"+i+"</pre>")},this)),s},saveCodeFormatting:function(r){var e=r.match(/<code(.*?)>([\w\W]*?)<\/code>/gi);return null===e||f.each(e,f.proxy(function(e,t){var i=t.match(/<code(.*?)>([\w\W]*?)<\/code>/i);i[2]=i[2].replace(/&nbsp;/g," "),i[2]=this.clean.encodeEntities(i[2]),i[2]=i[2].replace(/\$/g,"&#36;"),r=r.replace(t,"<code"+i[1]+">"+i[2]+"</code>")},this)),r},restoreSelectionMarkers:function(e){return e.replace(/&lt;span id=&quot;selection-marker-([0-9])&quot; class=&quot;redactor-selection-marker&quot;&gt;\u200b&lt;\/span&gt;/g,'<span id="selection-marker-$1" class="redactor-selection-marker">\u200b</span>')},saveFormTags:function(e){return e.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(e){return e.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")},encodeHtml:function(e){return e=(e=(e=(e=e.replace(/\u201d/g,'"')).replace(/\u201c/g,'"')).replace(/\u2018/g,"'")).replace(/\u2019/g,"'"),this.clean.encodeEntities(e)},encodeEntities:function(e){return(e=String(e).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},stripTags:function(e,i){if(void 0===i)return e.replace(/(<([^>]+)>)/gi,"");var t=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return e.replace(t,function(e,t){return-1===i.indexOf(t.toLowerCase())?e:""})},removeMarkers:function(e){return e.replace(/<span(.*?[^>]?)class="redactor-selection-marker"(.*?[^>]?)>([\w\W]*?)<\/span>/gi,"")},removeSpaces:function(e){return(e=(e=(e=(e=(e=(e=(e=(e=f.trim(e)).replace(/\n/g,"")).replace(/[\t]*/g,"")).replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/g," ")).replace(/[\s\n]*$/g," ")).replace(/>\s{2,}</g,"> <")).replace(/\n\n/g,"\n")).replace(/\u200B/g,"")},removeSpacesHard:function(e){return(e=(e=(e=(e=(e=(e=(e=(e=f.trim(e)).replace(/\n/g,"")).replace(/[\t]*/g,"")).replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/g,"")).replace(/[\s\n]*$/g,"")).replace(/>\s{2,}</g,"><")).replace(/\n\n/g,"\n")).replace(/\u200B/g,"")},normalizeCurrentHeading:function(){var e=this.selection.block();this.utils.isCurrentOrParentHeader()&&e&&e.normalize()}}},code:function(){return{syncFire:!0,html:!1,start:function(e){e=(e=f.trim(e)).replace(/^(<span id="selection-marker-1" class="redactor-selection-marker">\u200b<\/span>)/,""),"textarea"===this.opts.type?e=this.clean.onSet(e):"div"===this.opts.type&&""===e&&(e=this.opts.emptyHtml),e=e.replace(/<p><span id="selection-marker-1" class="redactor-selection-marker">\u200b<\/span><\/p>/,""),this.events.stopDetectChanges(),this.core.editor().html(e),this.observe.load(),this.events.startDetectChanges()},set:function(e,t){e=f.trim(e),(t=t||{}).start&&(this.start=t.start),"textarea"===this.opts.type?e=this.clean.onSet(e):"div"===this.opts.type&&""===e&&(e=this.opts.emptyHtml),this.core.editor().html(e),"textarea"===this.opts.type&&this.code.sync(),this.placeholder.enable()},get:function(){if("textarea"===this.opts.type)return this.core.textarea().val();var e=this.core.editor().html();return this.clean.onGet(e)},sync:function(){if(this.code.syncFire){var e=this.core.editor().html(),t=this.code.cleaned(e);if(!this.code.isSync(t)){if(this.code.html=t,"textarea"!==this.opts.type)return this.core.callback("sync",e),void this.core.callback("change",e);"textarea"===this.opts.type&&setTimeout(f.proxy(function(){this.code.startSync(e)},this),10)}}},startSync:function(e){e=this.core.callback("syncBefore",e),e=this.clean.onSync(e),this.core.textarea().val(e),this.core.callback("sync",e),!1===this.start&&this.core.callback("change",e),this.start=!1},isSync:function(e){var t=!1!==this.code.html&&this.code.html;return!1!==t&&t===e},cleaned:function(e){return e=e.replace(/\u200B/g,""),this.clean.removeMarkers(e)}}},core:function(){return{id:function(){return this.$editor.attr("id")},element:function(){return this.$element},editor:function(){return void 0===this.$editor?f():this.$editor},textarea:function(){return this.$textarea},box:function(){return"textarea"===this.opts.type?this.$box:this.$element},toolbar:function(){return!!this.$toolbar&&this.$toolbar},air:function(){return!!this.$air&&this.$air},object:function(){return f.extend({},this)},structure:function(){this.core.editor().toggleClass("redactor-structure")},addEvent:function(e){this.core.event=e},getEvent:function(){return this.core.event},callback:function(e,t,i){var r=!1,n=f._data(this.core.element()[0],"events");if(void 0!==n&&void 0!==n[e])for(var o=n[e].length,a=0;a<o;a++)if("callback.redactor"===n[e][a].namespace){var s=n[e][a].handler,l=void 0===i?[t]:[t,i];r=void 0===l?s.call(this,t):s.call(this,t,l)}if(r)return r;if(void 0===this.opts.callbacks[e])return void 0===i?t:i;var c=this.opts.callbacks[e];return f.isFunction(c)?void 0===i?c.call(this,t):c.call(this,t,i):void 0===i?t:i},destroy:function(){this.opts.destroyed=!0,this.core.callback("destroy"),this.placeholder.destroy(),this.progress.destroy(),f("#redactor-voice-"+this.uuid).remove(),this.core.editor().removeClass("redactor-in redactor-styles redactor-structure redactor-layer-img-edit"),this.core.editor().off("keydown.redactor-remove-textnode"),this.core.editor().off(".redactor-observe."+this.uuid),this.$element.off(".redactor").removeData("redactor"),this.core.editor().off(".redactor"),f(document).off(".redactor-dropdown"),f(document).off(".redactor-air."+this.uuid),f(document).off("mousedown.redactor-blur."+this.uuid),f(document).off("mousedown.redactor."+this.uuid),f(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid),f(window).off(".redactor-toolbar."+this.uuid),f(window).off("touchmove.redactor."+this.uuid),f("body").off("scroll.redactor."+this.uuid),f(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid);var i=this;!1!==this.opts.plugins&&f.each(this.opts.plugins,function(e,t){f(window).off(".redactor-plugin-"+t),f(document).off(".redactor-plugin-"+t),f("body").off(".redactor-plugin-"+t),i.core.editor().off(".redactor-plugin-"+t)}),this.$element.off("click.redactor-click-to-edit"),this.$element.removeClass("redactor-click-to-edit"),this.core.editor().removeClass("redactor-layer"),this.core.editor().removeAttr("contenteditable");var e=this.code.get();this.opts.toolbar&&this.$toolbar&&this.$toolbar.find("a").each(function(){var e=f(this);e.data("dropdown")&&(e.data("dropdown").remove(),e.data("dropdown",{}))}),"textarea"===this.opts.type&&(this.$box.after(this.$element),this.$box.remove(),this.$element.val(e).show()),this.opts.air&&this.$air.remove(),this.opts.toolbar&&this.$toolbar&&this.$toolbar.remove(),this.$modalBox&&this.$modalBox.remove(),this.$modalOverlay&&this.$modalOverlay.remove(),f(".redactor-link-tooltip").remove(),clearInterval(this.autosaveTimeout)}}},detect:function(){return{isWebkit:function(){return/webkit/.test(this.opts.userAgent)},isFirefox:function(){return-1<this.opts.userAgent.indexOf("firefox")},isIe:function(e){return document.documentMode||/Edge/.test(navigator.userAgent)?"edge":((t=RegExp("msie"+(isNaN(e)?"":"\\s"+e),"i").test(navigator.userAgent))||(t=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)),t);var t},isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isIpad:function(){return/iPad/.test(navigator.userAgent)}}},dropdown:function(){return{active:!1,button:!1,key:!1,position:[],getDropdown:function(){return this.dropdown.active},build:function(r,n,e){e=this.dropdown.buildFormatting(r,e),f.each(e,f.proxy(function(e,t){var i=this.dropdown.buildItem(e,t);this.observe.addDropdown(i,e,t),n.attr("rel",r).append(i)},this))},buildFormatting:function(e,r){return"format"!==e||!1===this.opts.formattingAdd||f.each(this.opts.formattingAdd,f.proxy(function(e,t){var i=this.utils.isBlockTag(t.args[0])?"block":"inline";r[e]={func:"block"===i?"block.format":"inline.format",args:t.args,title:t.title}},this)),r},buildItem:function(t,i){var e=f("<li />");if(void 0!==i.classname&&e.addClass(i.classname),-1!==t.search(/^divider/i))return e.addClass("redactor-dropdown-divider"),e;var r=f('<a href="#" class="redactor-dropdown-'+t+'" role="button" />'),n=f("<span />").html(i.title);return r.append(n),r.on("mousedown",f.proxy(function(e){e.preventDefault(),this.dropdown.buildClick(e,t,i)},this)),e.append(r),e},buildClick:function(e,t,i){if(!f(e.target).hasClass("redactor-dropdown-link-inactive")){var r=this.dropdown.buildCommand(i);void 0!==i.args?this.button.toggle(e,t,r.type,r.callback,i.args):this.button.toggle(e,t,r.type,r.callback)}},buildCommand:function(e){var t={type:"func"};return t.callback=e.func,e.command?(t.type="command",t.callback=e.command):e.dropdown&&(t.type="dropdown",t.callback=e.dropdown),t},show:function(e,t){this.detect.isDesktop()&&this.core.editor().focus(),this.dropdown.hideAll(!1,t),this.dropdown.key=t,this.dropdown.button=this.button.get(this.dropdown.key),this.dropdown.button.hasClass("dropact")?this.dropdown.hide():(this.dropdown.active=this.dropdown.button.data("dropdown").appendTo(document.body),this.core.callback("dropdownShow",{dropdown:this.dropdown.active,key:this.dropdown.key,button:this.dropdown.button}),this.button.setActive(this.dropdown.key),this.dropdown.button.addClass("dropact"),this.dropdown.getButtonPosition(),this.button.toolbar().hasClass("toolbar-fixed-box")&&this.detect.isDesktop()?this.dropdown.showIsFixedToolbar():this.dropdown.showIsUnFixedToolbar(),this.detect.isDesktop()&&!this.detect.isFirefox()&&(this.dropdown.active.on("mouseover.redactor-dropdown",f.proxy(this.utils.disableBodyScroll,this)),this.dropdown.active.on("mouseout.redactor-dropdown mousedown.redactor-dropdown",f.proxy(this.utils.enableBodyScroll,this))),e.stopPropagation())},showIsFixedToolbar:function(){var e=this.dropdown.button.position().top+this.dropdown.button.innerHeight()+this.opts.toolbarFixedTopOffset,t="fixed";this.opts.toolbarFixedTarget!==document&&(e=this.dropdown.button.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,t="absolute"),this.dropdown.active.css({position:t,left:this.dropdown.position.left+"px",top:e+"px"}).show(),this.dropdown.active.redactorAnimation("slideDown",{duration:.2},f.proxy(function(){this.dropdown.enableCallback(),this.dropdown.enableEvents()},this))},showIsUnFixedToolbar:function(){this.dropdown.active.css({position:"absolute",left:this.dropdown.position.left+"px",top:this.dropdown.button.innerHeight()+this.dropdown.position.top+"px"}).show(),this.dropdown.active.redactorAnimation(this.opts.animation?"slideDown":"show",{duration:.2},f.proxy(function(){this.dropdown.enableCallback(),this.dropdown.enableEvents()},this))},enableEvents:function(){f(document).on("mousedown.redactor-dropdown",f.proxy(this.dropdown.hideAll,this)),this.core.editor().on("touchstart.redactor-dropdown",f.proxy(this.dropdown.hideAll,this)),f(document).on("keyup.redactor-dropdown",f.proxy(this.dropdown.closeHandler,this))},enableCallback:function(){this.core.callback("dropdownShown",{dropdown:this.dropdown.active,key:this.dropdown.key,button:this.dropdown.button})},getButtonPosition:function(){this.dropdown.position=this.dropdown.button.offset();var e=this.dropdown.active.width();this.dropdown.position.left+e>f(document).width()&&(this.dropdown.position.left=Math.max(0,this.dropdown.position.left-e+parseInt(this.dropdown.button.innerWidth())))},closeHandler:function(e){e.which===this.keyCode.ESC&&(this.dropdown.hideAll(e),this.core.editor().focus())},hideAll:function(e,t){if(this.detect.isDesktop()&&this.utils.enableBodyScroll(),!1===e||0===f(e.target).closest(".redactor-dropdown").length){var i=void 0===t?this.button.toolbar().find("a.dropact"):this.button.toolbar().find("a.dropact").not(".re-"+t),r=void 0===t?f(".redactor-dropdown-"+this.uuid):f(".redactor-dropdown-"+this.uuid).not(".redactor-dropdown-box-"+t);0!==r.length&&(f(document).off(".redactor-dropdown"),this.core.editor().off(".redactor-dropdown"),f.each(r,f.proxy(function(e,t){var i=f(t);this.core.callback("dropdownHide",i),i.hide(),i.off("mouseover mouseout").off(".redactor-dropdown")},this)),i.removeClass("redactor-act dropact"))}},hide:function(){!1!==this.dropdown.active&&(this.detect.isDesktop()&&this.utils.enableBodyScroll(),this.dropdown.active.redactorAnimation(this.opts.animation?"slideUp":"hide",{duration:.2},f.proxy(function(){f(document).off(".redactor-dropdown"),this.core.editor().off(".redactor-dropdown"),this.dropdown.hideOut()},this)))},hideOut:function(){this.core.callback("dropdownHide",this.dropdown.active),this.dropdown.button.removeClass("redactor-act dropact"),this.dropdown.active.off("mouseover mouseout").off(".redactor-dropdown"),this.dropdown.button=!1,this.dropdown.key=!1,this.dropdown.active=!1}}},events:function(){return{focused:!1,blured:!0,dropImage:!1,stopChanges:!1,stopDetectChanges:function(){this.events.stopChanges=!0},startDetectChanges:function(){var e=this;setTimeout(function(){e.events.stopChanges=!1},1)},dragover:function(e){e.preventDefault(),e.stopPropagation(),"IMG"===e.target.tagName&&f(e.target).addClass("redactor-image-dragover")},dragleave:function(){this.core.editor().find("img").removeClass("redactor-image-dragover")},drop:function(e){return e=e.originalEvent||e,this.core.editor().find("img").removeClass("redactor-image-dragover"),"inline"===this.opts.type||"pre"===this.opts.type?(e.preventDefault(),!1):void 0===window.FormData||!e.dataTransfer||(0===e.dataTransfer.files.length?this.events.onDrop(e):(this.events.onDropUpload(e),void this.core.callback("drop",e)))},click:function(e){var t=this.core.getEvent(),i="click"!==t&&"arrow"!==t&&"click";this.core.addEvent(i),this.utils.disableSelectAll(),this.core.callback("click",e)},focus:function(e){if(!this.rtePaste&&(this.events.isCallback("focus")&&this.core.callback("focus",e),this.events.focused=!0,(this.events.blured=!1)===this.selection.current())){var t=this.selection.get(),i=this.selection.range(t);i.setStart(this.core.editor()[0],0),i.setEnd(this.core.editor()[0],0),this.selection.update(t,i)}},blur:function(e){this.start||this.rtePaste||0===f(e.target).closest("#"+this.core.id()+", .redactor-toolbar, .redactor-dropdown, #redactor-modal-box").length&&(!this.events.blured&&this.events.isCallback("blur")&&this.core.callback("blur",e),this.events.focused=!1,this.events.blured=!0)},touchImageEditing:function(){var e=-1;this.events.imageEditing=!1,f(window).on("touchmove.redactor."+this.uuid,f.proxy(function(){this.events.imageEditing=!0,-1!==e&&clearTimeout(e),e=setTimeout(f.proxy(function(){this.events.imageEditing=!1},this),500)},this))},init:function(){this.core.editor().on("dragover.redactor dragenter.redactor",f.proxy(this.events.dragover,this)),this.core.editor().on("dragleave.redactor",f.proxy(this.events.dragleave,this)),this.core.editor().on("drop.redactor",f.proxy(this.events.drop,this)),this.core.editor().on("click.redactor",f.proxy(this.events.click,this)),this.core.editor().on("paste.redactor",f.proxy(this.paste.init,this)),this.core.editor().on("keydown.redactor",f.proxy(this.keydown.init,this)),this.core.editor().on("keyup.redactor",f.proxy(this.keyup.init,this)),this.core.editor().on("focus.redactor",f.proxy(this.events.focus,this)),f(document).on("mousedown.redactor-blur."+this.uuid,f.proxy(this.events.blur,this)),this.events.touchImageEditing(),this.events.createObserver(),this.events.setupObserver()},createObserver:function(){var t=this;this.events.observer=new MutationObserver(function(e){e.forEach(f.proxy(t.events.iterateObserver,t))})},iterateObserver:function(e){var t=!1;(("textarea"===this.opts.type||"div"===this.opts.type)&&!this.detect.isFirefox()&&e.target===this.core.editor()[0]||"class"===e.attributeName&&e.target===this.core.editor()[0])&&(t=!0),t||(this.observe.load(),this.events.changeHandler())},setupObserver:function(){this.events.observer.observe(this.core.editor()[0],{attributes:!0,subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0})},changeHandler:function(){this.events.stopChanges||(this.code.sync(),this.autosave.is()&&(clearTimeout(this.autosaveTimeout),this.autosaveTimeout=setTimeout(f.proxy(this.autosave.send,this),300)))},onDropUpload:function(e){if(e.preventDefault(),e.stopPropagation(),(this.opts.dragImageUpload||this.opts.dragFileUpload)&&(null!==this.opts.imageUpload||null!==this.opts.fileUpload)){"IMG"===e.target.tagName&&(this.events.dropImage=e.target);for(var t=e.dataTransfer.files,i=t.length,r=0;r<i;r++)this.upload.directUpload(t[r],e)}},onDrop:function(e){this.core.callback("drop",e)},isCallback:function(e){return void 0!==this.opts.callbacks[e]&&f.isFunction(this.opts.callbacks[e])},stopDetect:function(){this.events.stopDetectChanges()},startDetect:function(){this.events.startDetectChanges()}}},file:function(){return{is:function(){return!(!this.opts.fileUpload||!this.opts.fileUpload&&!this.opts.s3)},show:function(){this.modal.load("file",this.lang.get("file"),700),this.upload.init("#redactor-modal-file-upload",this.opts.fileUpload,this.file.insert),f("#redactor-filename").val(this.selection.get().toString()),this.modal.show()},insert:function(e,t,i){if(void 0!==e.error)return this.modal.close(),void this.core.callback("fileUploadError",e);this.file.release(i,t),this.buffer.set(),this.air.collapsed();var r=this.file.text(e),n=f("<a />").attr("href",e.url).text(r),o=void 0===e.id?"":e.id,a=void 0===e.s3?"file":"s3";n.attr("data-"+a,o),n=f(this.insert.node(n)),this.caret.after(n),this.storage.add({type:a,node:n[0],url:e.url,id:o}),null!==t&&this.core.callback("fileUpload",n,e)},release:function(e,t){t?(this.marker.remove(),this.insert.nodeToPoint(e,this.marker.get()),this.selection.restore()):this.modal.close()},text:function(e){var t=f("#redactor-filename").val();return void 0===t||""===t?e.name:t}}},focus:function(){return{start:function(){if(this.core.editor().focus(),"inline"!==this.opts.type){var e=this.focus.first();!1!==e&&this.caret.start(e)}},end:function(){this.core.editor().focus();var e=this.opts.inline?this.core.editor():this.focus.last();if(0!==e.length){var t=this.focus.lastChild(e);if(this.detect.isWebkit()||!1===t){var i=this.selection.get(),r=this.selection.range(i);null!==r?(r.selectNodeContents(e[0]),r.collapse(!1),this.selection.update(i,r)):this.caret.end(e)}else this.caret.end(t)}},first:function(){var e=this.core.editor().children().first();return(0!==e.length||0!==e[0].length&&"BR"!==e[0].tagName&&"HR"!==e[0].tagName&&3!==e[0].nodeType)&&("UL"===e[0].tagName||"OL"===e[0].tagName?e.find("li").first():e)},last:function(){return this.core.editor().children().last()},lastChild:function(e){var t=e[0].lastChild;return!(null===t||!this.utils.isInlineTag(t.tagName))&&t},is:function(){return this.core.editor()[0]===document.activeElement}}},image:function(){return{is:function(){return!(!this.opts.imageUpload||!this.opts.imageUpload&&!this.opts.s3)},show:function(){this.modal.load("image",this.lang.get("image"),700),this.upload.init("#redactor-modal-image-droparea",this.opts.imageUpload,this.image.insert),this.modal.show()},insert:function(e,t,i){var r;if(void 0!==e.error)return this.modal.close(),this.events.dropImage=!1,void this.core.callback("imageUploadError",e,i);if(!1!==this.events.dropImage)return r=f(this.events.dropImage),this.core.callback("imageDelete",r[0].src,r),r.attr("src",e.url),this.events.dropImage=!1,void this.core.callback("imageUpload",r,e);this.placeholder.hide();var n=f("<"+this.opts.imageTag+">");(r=f("<img>")).attr("src",e.url);var o=void 0===e.id?"":e.id,a=void 0===e.s3?"image":"s3";r.attr("data-"+a,o),n.append(r);var s=this.utils.isTag(this.selection.current(),"pre");if(t){this.air.collapsed(),this.marker.remove();var l=this.insert.nodeToPoint(i,this.marker.get()),c=f(l).next();this.selection.restore(),this.buffer.set(),void 0!==c&&0!==c.length&&"IMG"===c[0].tagName?(this.core.callback("imageDelete",c[0].src,c),c.closest("figure, p",this.core.editor()[0]).replaceWith(n)):s?f(s).after(n):this.insert.node(n),this.caret.after(n)}else this.modal.close(),this.buffer.set(),this.air.collapsed(),s?f(s).after(n):this.insert.node(n),this.caret.after(n);this.events.dropImage=!1,this.storage.add({type:a,node:r[0],url:e.url,id:o});var d=r[0].nextSibling,u=n.next(),h=f(d).text().replace(/\u200B/g,""),p=u.text().replace(/\u200B/g,"");""===h&&f(d).remove(),1===u.length&&"FIGURE"===u[0].tagName&&""===p&&u.remove(),null!==t?this.core.callback("imageUpload",r,e):this.core.callback("imageInserted",r,e)},setEditable:function(t){if(t.on("dragstart",function(e){e.preventDefault()}),this.opts.imageResizable){var e=f.proxy(function(){this.observe.image=t,this.image.resizer=this.image.loadEditableControls(t),f(document).on("mousedown.redactor-image-resize-hide."+this.uuid,f.proxy(this.image.hideResize,this)),this.image.resizer&&this.image.resizer.on("mousedown.redactor touchstart.redactor",f.proxy(function(e){this.image.setResizable(e,t)},this))},this);t.off("mousedown.redactor").on("mousedown.redactor",f.proxy(this.image.hideResize,this)),t.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",e)}else t.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",f.proxy(function(){setTimeout(f.proxy(function(){this.image.showEdit(t)},this),200)},this))},setResizable:function(e,t){e.preventDefault(),this.image.resizeHandle={x:e.pageX,y:e.pageY,el:t,ratio:t.width()/t.height(),h:t.height()},(e=e.originalEvent||e).targetTouches&&(this.image.resizeHandle.x=e.targetTouches[0].pageX,this.image.resizeHandle.y=e.targetTouches[0].pageY),this.image.startResize()},startResize:function(){f(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",f.proxy(this.image.moveResize,this)),f(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",f.proxy(this.image.stopResize,this))},moveResize:function(e){e.preventDefault(),e=e.originalEvent||e;var t=this.image.resizeHandle.h;e.targetTouches?t+=e.targetTouches[0].pageY-this.image.resizeHandle.y:t+=e.pageY-this.image.resizeHandle.y;var i=Math.round(t*this.image.resizeHandle.ratio);t<50||i<100||(this.image.resizeHandle.el.attr({width:i,height:t}),this.image.resizeHandle.el.width(i),this.image.resizeHandle.el.height(t),this.code.sync())},stopResize:function(){this.handle=!1,f(document).off(".redactor-image-resize"),this.image.hideResize()},hideResize:function(e){if(!e||0===f(e.target).closest("#redactor-image-box",this.$editor[0]).length){e&&"IMG"==e.target.tagName&&f(e.target);var t=this.$editor.find("#redactor-image-box");0!==t.length&&(f("#redactor-image-editter").remove(),f("#redactor-image-resizer").remove(),t.find("img").css({marginTop:t[0].style.marginTop,marginBottom:t[0].style.marginBottom,marginLeft:t[0].style.marginLeft,marginRight:t[0].style.marginRight}),t.css("margin",""),t.find("img").css("opacity",""),t.replaceWith(function(){return f(this).contents()}),f(document).off("mousedown.redactor-image-resize-hide."+this.uuid),void 0!==this.image.resizeHandle&&this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style")))}},loadResizableControls:function(e,t){if(!this.opts.imageResizable||this.detect.isMobile())return t.append(e),!1;var i=f('<span id="redactor-image-resizer" data-redactor="verified"></span>');return this.detect.isDesktop()||i.css({width:"15px",height:"15px"}),i.attr("contenteditable",!1),t.append(i),t.append(e),i},loadEditableControls:function(e){if(0===f("#redactor-image-box").length){var t=f('<span id="redactor-image-box" data-redactor="verified">');if(t.css("float",e.css("float")).attr("contenteditable",!1),"auto"!=e[0].style.margin?(t.css({marginTop:e[0].style.marginTop,marginBottom:e[0].style.marginBottom,marginLeft:e[0].style.marginLeft,marginRight:e[0].style.marginRight}),e.css("margin","")):t.css({display:"block",margin:"auto"}),e.css("opacity",".5").after(t),this.opts.imageEditable){this.image.editter=f('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>"),this.image.editter.attr("contenteditable",!1),this.image.editter.on("click",f.proxy(function(){this.image.showEdit(e)},this)),t.append(this.image.editter);var i=this.image.editter.innerWidth();this.image.editter.css("margin-left","-"+i/2+"px")}return this.image.loadResizableControls(e,t)}},showEdit:function(e){if(!this.events.imageEditing){var t=(this.observe.image=e).closest("a",this.$editor[0]),i=e.closest("figure",this.$editor[0]),r=0!==i.length?i:e;if(this.modal.load("image-edit",this.lang.get("edit"),705),this.image.buttonDelete=this.modal.getDeleteButton().text(this.lang.get("delete")),this.image.buttonSave=this.modal.getActionButton().text(this.lang.get("save")),this.image.buttonDelete.on("click",f.proxy(this.image.remove,this)),this.image.buttonSave.on("click",f.proxy(this.image.update,this)),!1===this.opts.imageCaption)f("#redactor-image-caption").val("").hide().prev().hide();else{var n=e.closest(this.opts.imageTag,this.$editor[0]).find("figcaption");0!==n&&f("#redactor-image-caption").val(n.text()).show()}if(this.opts.imagePosition){var o=(0!==i.length?"center"===r.css("text-align"):"block"==r.css("display")&&"none"==r.css("float"))?"center":r.css("float");f("#redactor-image-align").val(o)}else f(".redactor-image-position-option").hide();f("#redactor-image-preview").html(f('<img src="'+e.attr("src")+'" style="max-width: 100%;">')),f("#redactor-image-title").val(e.attr("alt")),0!==t.length&&(f("#redactor-image-link").val(t.attr("href")),"_blank"===t.attr("target")&&f("#redactor-image-link-blank").prop("checked",!0)),f(".redactor-link-tooltip").remove(),this.modal.show(),this.detect.isDesktop()&&f("#redactor-image-title").focus()}},update:function(){var e=this.observe.image,t=e.closest("a",this.core.editor()[0]),i=f("#redactor-image-title").val().replace(/(<([^>]+)>)/gi,"");e.attr("alt",i).attr("title",i),this.image.setFloating(e);var r=f.trim(f("#redactor-image-link").val()).replace(/(<([^>]+)>)/gi,"");if(""!==r){var n="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",o=new RegExp("^(http|ftp|https)://"+n,"i"),a=new RegExp("^"+n,"i");-1===r.search(o)&&0===r.search(a)&&this.opts.linkProtocol&&(r=this.opts.linkProtocol+"://"+r);var s=!!f("#redactor-image-link-blank").prop("checked");if(0===t.length){var l=f('<a href="'+r+'" id="redactor-img-tmp">'+this.utils.getOuterHtml(e)+"</a>");s&&l.attr("target","_blank"),e=e.replaceWith(l),(t=this.core.editor().find("#redactor-img-tmp")).removeAttr("id")}else t.attr("href",r),s?t.attr("target","_blank"):t.removeAttr("target")}else 0!==t.length&&t.replaceWith(this.utils.getOuterHtml(e));this.image.addCaption(e,t),this.modal.close(),this.buffer.set()},setFloating:function(e){var t=e.closest("figure",this.$editor[0]),i=0!==t.length?t:e,r="",n="",o="",a="";switch(f("#redactor-image-align").val()){case"left":r="left",
o="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":r="right",o="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":0!==t.length?a="center":(n="block",o="auto")}i.css({"float":r,display:n,margin:o,"text-align":a}),i.attr("rel",e.attr("style"))},addCaption:function(e,t){var i=f("#redactor-image-caption").val(),r=0!==t.length?t:e,n=r.next();0!==n.length&&"FIGCAPTION"===n[0].tagName||(n=!1),""!==i?!1===n?(n=f("<figcaption />").text(i),r.after(n)):n.text(i):!1!==n&&n.remove()},remove:function(e,t){t=void 0===t?f(this.observe.image):t,"boolean"!=typeof e&&this.buffer.set(),this.events.stopDetectChanges();var i,r,n=t.closest("a",this.core.editor()[0]),o=t.closest(this.opts.imageTag,this.core.editor()[0]);if(t.parent(),!1===this.core.callback("imageDelete",e,t[0]))return e&&e.preventDefault(),!1;0!==f("#redactor-image-box").length&&f("#redactor-image-box").parent(),0!==o.length?(r=o.prev(),i=o.next(),o.remove()):0!==n.length?(n.parent(),n.remove()):t.remove(),f("#redactor-image-box").remove(),!1!==e&&(i&&0!==i.length?this.caret.start(i):r&&0!==r.length&&this.caret.end(r)),"boolean"!=typeof e&&this.modal.close(),this.utils.restoreScroll(),this.observe.image=!1,this.events.startDetectChanges(),this.placeholder.enable(),this.code.sync()}}},indent:function(){return{increase:function(){if(this.list.get()){var e=f(this.selection.current()).closest("li"),t=e.closest("ul, ol",this.core.editor()[0]),i=e.closest("li").prev();if(0!==i.length&&"LI"===i[0].tagName)if(this.buffer.set(),this.utils.isCollapsed()){var r=t[0].tagName,n=f("<"+r+" />");this.selection.save();var o=i.find("ol").first();1===o.length?o.append(e):(r=t[0].tagName,(n=f("<"+r+" />")).append(e),i.append(n)),this.selection.restore()}else document.execCommand("indent"),this.selection.save(),this.indent.removeEmpty(),this.indent.normalize(),this.selection.restore()}},decrease:function(){if(this.list.get()){f(this.selection.current()).closest("li").closest("ul, ol",this.core.editor()[0]),this.buffer.set(),document.execCommand("outdent");var e=f(this.selection.current()).closest("li",this.core.editor()[0]);if(this.utils.isCollapsed()&&this.indent.repositionItem(e),0===e.length){document.execCommand("formatblock",!1,"p");var t=(e=f(this.selection.current())).next();0!==t.length&&"BR"===t[0].tagName&&t.remove()}this.selection.save(),this.indent.removeEmpty(),this.indent.normalize(),this.selection.restore()}},repositionItem:function(e){var t=e.next();0===t.length||"UL"===t[0].tagName&&"OL"===t[0].tagName||e.append(t);var i=e.prev();0!==i.length&&"LI"!==i[0].tagName&&(this.selection.save(),e.parents("li",this.core.editor()[0]).after(e),this.selection.restore())},normalize:function(){this.core.editor().find("li").each(f.proxy(function(e,t){var i=f(t);i.find(this.opts.inlineTags.join(",")).each(function(){f(this).removeAttr("style")});var r=i.parent();if(0===r.length||"LI"!==r[0].tagName){var n=i.next();0===n.length||"UL"!==n[0].tagName&&"OL"!==n[0].tagName||i.append(n)}else r.after(i)},this))},removeEmpty:function(){var e=this.core.editor().find("ul, ol"),t=this.core.editor().find("li");t.each(f.proxy(function(e,t){this.indent.removeItemEmpty(t)},this)),e.each(f.proxy(function(e,t){this.indent.removeItemEmpty(t)},this)),t.each(f.proxy(function(e,t){this.indent.removeItemEmpty(t)},this))},removeItemEmpty:function(e){var t=e.innerHTML.replace(/[\t\s\n]/g,"");""===(t=t.replace(/<span><\/span>/g,""))&&f(e).remove()}}},inline:function(){return{format:function(e,t,i,r){if(!this.utils.isCurrentOrParent(["PRE","CODE"])){var n=this.inline.getParams(t,i,r);e=this.inline.arrangeTag(e),this.placeholder.hide(),this.buffer.set(),this.utils.isCollapsed()?this.inline.formatCollapsed(e,n):this.inline.formatUncollapsed(e,n)}},formatCollapsed:function(e,t){var i,r=this.selection.inline();if(r){var n=r.tagName.toLowerCase();if(n===e)this.utils.isEmpty(r.innerHTML)?(this.caret.after(r),f(r).remove()):(o=this.inline.insertBreakpoint(r,n),this.caret.after(o));else if(0===f(r).closest(e).length)i=this.inline.insertInline(e),i=this.inline.setParams(i,t);else{var o=this.inline.insertBreakpoint(r,n);this.caret.after(o)}}else i=this.inline.insertInline(e),i=this.inline.setParams(i,t)},formatUncollapsed:function(n,o){this.selection.save();var e=this.inline.getClearedNodes();this.inline.setNodesStriked(e,n,o),this.selection.restore(),document.execCommand("strikethrough"),this.selection.saveInstant();var a=this;this.core.editor().find("strike").each(function(){var e=a.utils.replaceToTag(this,n);a.inline.setParams(e[0],o);var t=e.find(n),i=e.parent(),r=i.parent();if(0!==r.length&&r[0].tagName.toLowerCase()===n&&r.html()==i[0].outerHTML)return e.replaceWith(function(){return f(this).contents()}),void r.replaceWith(function(){return f(this).contents()});0!==t.length&&a.inline.cleanInsideOrParent(t,o),i.html()==e[0].outerHTML&&a.inline.cleanInsideOrParent(i,o),a.detect.isFirefox()&&a.core.editor().find(n+":empty").remove()}),this.selection.restoreInstant()},cleanInsideOrParent:function(e,t){if(t)for(var i in t.data)this.inline.removeSpecificAttr(e,i,t.data[i])},getClearedNodes:function(){for(var e=this.selection.nodes(),t=[],i=e.length,r=0,n=0;n<i;n++)if(f(e[n]).hasClass("redactor-selection-marker")){r=n+2;break}for(n=0;n<i;n++)r<=n&&!this.utils.isBlockTag(e[n].tagName)&&t.push(e[n]);return t},isConvertableAttr:function(e,t,i){var r=f(e).attr(t);if(r)if("style"===t){for(var n=(i=f.trim(i).replace(/;$/,"")).split(";"),o=0,a=0;a<n.length;a++){var s=n[a].split(":"),l=f.trim(s[0]),c=f.trim(s[1]);if(-1!==l.search(/color/)){var d=f(e).css(l);!d||d!==c&&this.utils.rgb2hex(d)!==c||o++}else f(e).css(l)===c&&o++}if(o===n.length)return 1}else if(r===i)return 1;return 0},isConvertable:function(e,t,i,r){if(t===i){if(!r)return!0;var n=0;for(var o in r.data)n+=this.inline.isConvertableAttr(e,o,r.data[o]);if(n===Object.keys(r.data).length)return!0}return!1},setNodesStriked:function(e,t,i){for(var r=0;r<e.length;r++){var n=e[r].tagName?e[r].tagName.toLowerCase():void 0,o=e[r].parentNode,a=o&&o.tagName?o.tagName.toLowerCase():void 0,s=this.inline.isConvertable(o,a,t,i);s&&f(o).replaceWith(function(){return f("<strike>").append(f(this).contents())}).attr("data-redactor-inline-converted"),(s=this.inline.isConvertable(e[r],n,t,i))&&f(e[r]).replaceWith(function(){return f("<strike>").append(f(this).contents())})}},insertBreakpoint:function(e,t){var i=document.createElement("span");i.id="redactor-inline-breakpoint",i=this.insert.node(i);var r=this.utils.isEndOfElement(e),n=this.utils.getOuterHtml(e),o=r?"":"<"+t+">";n=n.replace(/<span id="redactor-inline-breakpoint"><\/span>/i,"</"+t+">"+o);var a=f(n);return f(e).replaceWith(a),""!==o&&this.utils.cloneAttributes(e,a.last()),a.first()},insertInline:function(e){var t=document.createElement(e);return this.insert.node(t),this.caret.start(t),t},arrangeTag:function(e){var t=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],i=["strong","strong","em","em","u","del","del","sup","sub"];e=e.toLowerCase();for(var r=0;r<t.length;r++)e===t[r]&&(e=i[r]);return e},getStyleParams:function(e){for(var t={},i=e.trim().replace(/;$/,"").split(";"),r=0;r<i.length;r++){var n=i[r].split(":");n&&(t[n[0].trim()]=n[1].trim())}return t},getParams:function(e,t,i){var r=!1,n="toggle";return"object"==typeof e?(r=e,n=void 0!==t?t:n):void 0!==e&&void 0!==t&&((r={})[e]=t,n=void 0!==i?i:n),!!r&&{func:n,data:r}},setParams:function(e,t){if(t)for(var i in t.data){var r=f(e);"style"===i?(e=this.inline[t.func+"Style"](t.data[i],e),r.attr("data-redactor-style-cache",r.attr("style"))):e="class"===i?this.inline[t.func+"Class"](t.data[i],e):"remove"===t.func?this.inline[t.func+"Attr"](i,e):this.inline[t.func+"Attr"](i,t.data[i],e),"style"===i&&"SPAN"===e.tagName&&r.attr("data-redactor-span",!0)}return e},eachInline:function(e,t){var i,r=void 0===e?this.selection.inlines():[e];if(r)for(var n=0;n<r.length;n++)i=t(r[n])[0];return i},replaceClass:function(t,e){return this.inline.eachInline(e,function(e){return f(e).removeAttr("class").addClass(t)})},toggleClass:function(t,e){return this.inline.eachInline(e,function(e){return f(e).toggleClass(t)})},addClass:function(t,e){return this.inline.eachInline(e,function(e){return f(e).addClass(t)})},removeClass:function(t,e){return this.inline.eachInline(e,function(e){return f(e).removeClass(t)})},removeAllClass:function(e){return this.inline.eachInline(e,function(e){return f(e).removeAttr("class")})},replaceAttr:function(t,e,i){return this.inline.eachInline(i,function(e){return f(e).removeAttr(t).attr(t.value)})},toggleAttr:function(t,e,i){return this.inline.eachInline(i,function(e){return f(e).attr(t)?f(e).removeAttr(t):f(e).attr(t.value)})},addAttr:function(t,i,e){return this.inline.eachInline(e,function(e){return f(e).attr(t,i)})},removeAttr:function(i,e){return this.inline.eachInline(e,function(e){var t=f(e);return t.removeAttr(i),"style"===i&&t.removeAttr("data-redactor-style-cache"),t})},removeAllAttr:function(e){return this.inline.eachInline(e,function(e){for(var t=f(e),i=e.attributes.length,r=0;r<i;r++)t.removeAttr(e.attributes[r].name);return t})},removeSpecificAttr:function(e,t,i){var r=f(e);if("style"===t){var n=i.split(":")[0].trim();r.css(n,""),this.utils.removeEmptyAttr(e,"style")&&r.removeAttr("data-redactor-style-cache")}else r.removeAttr(t)[0]},hasParentStyle:function(e){var t=e.parent();return 1===t.length&&t[0].tagName===e[0].tagName&&t.html()===e[0].outerHTML&&t},addParentStyle:function(e){var t=this.inline.hasParentStyle(e);if(t){var i=this.inline.getStyleParams(e.attr("style"));t.css(i),t.attr("data-redactor-style-cache",t.attr("style")),e.replaceWith(function(){return f(this).contents()})}else e.attr("data-redactor-style-cache",e.attr("style"));return e},replaceStyle:function(r,e){r=this.inline.getStyleParams(r);var n=this;return this.inline.eachInline(e,function(e){var t=f(e);t.removeAttr("style").css(r);var i=t.attr("style");return i&&t.attr("style",i.replace(/"/g,"'")),n.inline.addParentStyle(t)})},toggleStyle:function(a,e){a=this.inline.getStyleParams(a);var s=this;return this.inline.eachInline(e,function(e){var t=f(e);for(var i in a){var r=a[i],n=t.css(i);(n=s.utils.isRgb(n)?s.utils.rgb2hex(n):n.replace(/"/g,""))===(r=s.utils.isRgb(r)?s.utils.rgb2hex(r):r.replace(/"/g,""))?t.css(i,""):t.css(i,r)}var o=t.attr("style");return o&&t.attr("style",o.replace(/"/g,"'")),s.utils.removeEmptyAttr(e,"style")?t.removeAttr("data-redactor-style-cache"):t=s.inline.addParentStyle(t),t})},addStyle:function(r,e){r=this.inline.getStyleParams(r);var n=this;return this.inline.eachInline(e,function(e){var t=f(e);t.css(r);var i=t.attr("style");return i&&t.attr("style",i.replace(/"/g,"'")),n.inline.addParentStyle(t)})},removeStyle:function(r,e){r=this.inline.getStyleParams(r);var n=this;return this.inline.eachInline(e,function(e){var t=f(e);for(var i in r)t.css(i,"");return n.utils.removeEmptyAttr(e,"style")?t.removeAttr("data-redactor-style-cache"):t.attr("data-redactor-style-cache",t.attr("style")),t})},removeAllStyle:function(e){return this.inline.eachInline(e,function(e){return f(e).removeAttr("style").removeAttr("data-redactor-style-cache")})},removeStyleRule:function(e){var t=this.selection.parent(),i=this.selection.inlines();this.buffer.set(),t&&"SPAN"===t.tagName&&this.inline.removeStyleRuleAttr(f(t),e);for(var r=0;r<i.length;r++){var n=i[r],o=f(n);-1==f.inArray(n.tagName.toLowerCase(),this.opts.inlineTags)||o.hasClass("redactor-selection-marker")||this.inline.removeStyleRuleAttr(o,e)}},removeStyleRuleAttr:function(e,t){e.css(t,""),this.utils.removeEmptyAttr(e,"style")?e.removeAttr("data-redactor-style-cache"):e.attr("data-redactor-style-cache",e.attr("style"))},update:function(e,t,i,r){e=this.inline.arrangeTag(e);var n=this.inline.getParams(t,i,r),o=this.selection.inlines(),a=[];if(o)for(var s=0;s<o.length;s++){var l=o[s];"*"!==e&&l.tagName.toLowerCase()!==e||a.push(this.inline.setParams(l,n))}return a},removeFormat:function(){this.selection.save();for(var e=this.inline.getClearedNodes(),t=0;t<e.length;t++)1===e[t].nodeType&&f(e[t]).replaceWith(function(){return f(this).contents()});this.selection.restore()}}},insert:function(){return{set:function(e){this.placeholder.hide(),this.code.set(e),this.focus.end(),this.placeholder.enable()},html:function(e,t){this.placeholder.hide(),this.core.editor().focus();var i=this.selection.block(),r=this.selection.inline();void 0===t&&(t=this.clean.getCurrentType(e,!0),e=this.clean.onPaste(e,t,!0)),e=f.parseHTML(e);var n=f(e).last(),o=this.selection.get(),a=this.selection.range(o);if(a.deleteContents(),this.selection.update(o,a),t.lists){var s=f(e);if(0!==s.length&&("UL"===s[0].tagName||"OL"===s[0].tagName))return void this.insert.appendLists(i,s)}if(t.blocks&&i)if(this.utils.isSelectAll())this.core.editor().html(e),this.focus.end();else{var l=this.utils.breakBlockTag();!1===l?this.insert.placeHtml(e):(f(e).children().last().append(this.marker.get()),"start"===l.type?l.$block.before(e):l.$block.after(e),this.selection.restore(),this.core.editor().find("p").each(function(){""===f.trim(this.innerHTML)&&f(this).remove()}))}else{if(r){var c=f("<div/>").html(e);c.find(r.tagName.toLowerCase()).each(function(){f(this).contents().unwrap()}),e=c.html()}if(this.utils.isSelectAll()){var d=f(this.opts.emptyHtml);this.core.editor().html("").append(d),d.html(e),this.caret.end(d)}else this.insert.placeHtml(e)}this.utils.disableSelectAll(),t.pre&&this.clean.cleanPre(),this.caret.end(n),this.linkify.format()},text:function(e){e=e.toString(),e=f.trim(e);var t=document.createElement("div");if(t.innerHTML=e,void 0!==(e=t.textContent||t.innerText)){this.placeholder.hide(),this.core.editor().focus();var i=this.selection.blocks();if(e=e.replace(/\n/g," "),this.utils.isSelectAll()){var r=f(this.opts.emptyHtml);this.core.editor().html("").append(r),r.html(e),this.caret.end(r)}else{var n=this.selection.get(),o=document.createTextNode(e);if(n.getRangeAt&&n.rangeCount){var a=n.getRangeAt(0);a.deleteContents(),a.insertNode(o),a.setStartAfter(o),a.collapse(!0),this.selection.update(n,a)}1<i.length&&(f(o).wrap("<p>"),this.caret.after(o))}this.utils.disableSelectAll(),this.linkify.format(),this.clean.normalizeCurrentHeading()}},raw:function(e){this.placeholder.hide(),this.core.editor().focus();var t=this.selection.get(),i=this.selection.range(t);i.deleteContents();var r=document.createElement("div");r.innerHTML=e;for(var n,o,a=document.createDocumentFragment();n=r.firstChild;)o=a.appendChild(n);i.insertNode(a),o&&((i=i.cloneRange()).setStartAfter(o),i.collapse(!0),t.removeAllRanges(),t.addRange(i))},node:function(e,t){this.placeholder.hide(),void 0!==this.start&&this.core.editor().focus(),e=e[0]||e;var i=this.selection.block(),r=this.utils.isBlockTag(e.tagName),n=!0;if(this.utils.isSelectAll())r?this.core.editor().html(e):this.core.editor().html(f("<p>").html(e)),this.code.sync();else if(r&&i){var o=this.utils.breakBlockTag();!1===o?this.insert.placeNode(e,t):("start"===o.type?o.$block.before(e):o.$block.after(e),this.core.editor().find("p:empty").remove())}else n=this.insert.placeNode(e,t);return this.utils.disableSelectAll(),n&&this.caret.end(e),e},appendLists:function(e,t){var i,r=f(e),n=this.utils.isEmpty(e.innerHTML);if(n||this.utils.isEndOfElement(e))i=r,t.find("li").each(function(){i.after(this),i=f(this)}),n&&r.remove();else if(this.utils.isStartOfElement(e))t.find("li").each(function(){r.before(this),i=f(this)});else{var o=this.selection.extractEndOfNode(e);r.after(f("<li>").append(o)),r.append(t),i=t}this.marker.remove(),i&&this.caret.end(i),this.linkify.format()},placeHtml:function(e){var t=document.createElement("span");t.id="redactor-insert-marker",t=this.insert.node(t),f(t).before(e),this.selection.restore(),this.caret.after(t),f(t).remove()},placeNode:function(e,t){var i=this.selection.get(),r=this.selection.range(i);if(null==r)return!1;!1!==t&&r.deleteContents(),r.insertNode(e),r.collapse(!1),this.selection.update(i,r)},nodeToPoint:function(e,t){if(this.placeholder.hide(),t=t[0]||t,this.utils.isEmpty())return t=this.utils.isBlock(t)?t:f("<p />").append(t),this.core.editor().html(t),t;var i,r=e.clientX,n=e.clientY;if(document.caretPositionFromPoint){var o=document.caretPositionFromPoint(r,n);(i=document.getSelection().getRangeAt(0)).setStart(o.offsetNode,o.offset),i.collapse(!0),i.insertNode(t)}else if(document.caretRangeFromPoint)(i=document.caretRangeFromPoint(r,n)).insertNode(t);else if(void 0!==document.body.createTextRange){(i=document.body.createTextRange()).moveToPoint(r,n);var a=i.duplicate();a.moveToPoint(r,n),i.setEndPoint("EndToEnd",a),i.select()}return t},nodeToCaretPositionFromPoint:function(e,t){this.insert.nodeToPoint(e,t)},marker:function(){this.marker.insert()}}},keydown:function(){return{init:function(e){if(!this.rtePaste){var t=e.which,i=37<=t&&t<=40;if(this.keydown.ctrl=e.ctrlKey||e.metaKey,this.keydown.parent=this.selection.parent(),this.keydown.current=this.selection.current(),this.keydown.block=this.selection.block(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.keydown.figure=this.utils.isTag(this.keydown.current,"figure"),!1===this.core.callback("keydown",e))return e.preventDefault(),!1;if(this.shortcuts.init(e,t),this.keydown.checkEvents(i,t),this.keydown.setupBuffer(e,t),this.utils.isSelectAll()&&(t===this.keyCode.ENTER||t===this.keyCode.BACKSPACE||t===this.keyCode.DELETE))return e.preventDefault(),this.code.set(this.opts.emptyHtml),void this.events.changeHandler();if(this.keydown.addArrowsEvent(i),this.keydown.setupSelectAll(e,t),this.opts.enterKey||t!==this.keyCode.ENTER){if(this.opts.enterKey&&t===this.keyCode.DOWN&&this.keydown.onArrowDown(),this.opts.enterKey&&t===this.keyCode.UP&&this.keydown.onArrowUp(),("textarea"===this.opts.type||"div"===this.opts.type)&&this.keydown.current&&3===this.keydown.current.nodeType&&f(this.keydown.parent).hasClass("redactor-in")&&this.keydown.wrapToParagraph(),!this.keyup.lastShiftKey&&t===this.keyCode.SPACE&&(e.ctrlKey||e.shiftKey))return e.preventDefault(),this.keydown.onShiftSpace();if(t===this.keyCode.ENTER&&(e.ctrlKey||e.shiftKey))return e.preventDefault(),this.keydown.onShiftEnter(e);if(t===this.keyCode.ENTER&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey)return this.keydown.onEnter(e);if(t===this.keyCode.TAB||e.metaKey&&221===t||e.metaKey&&219===t)return this.keydown.onTab(e,t);if(this.detect.isFirefox()&&t===this.keyCode.BACKSPACE&&this.keydown.block&&"P"===this.keydown.block.tagName&&this.utils.isStartOfElement(this.keydown.block)&&0!==(r=f(this.keydown.block).prev()).length)return e.preventDefault(),r.append(this.marker.get()),r.append(f(this.keydown.block).html()),f(this.keydown.block).remove(),void this.selection.restore();if(t===this.keyCode.BACKSPACE||t===this.keyCode.DELETE){if(this.observe.image&&void 0!==this.observe.image&&0!==f("#redactor-image-box").length){e.preventDefault();var r=this.observe.image.closest("figure, p").prev();return this.image.remove(!1),this.observe.image=!1,void(r&&0!==r.length?this.caret.end(r):this.core.editor().focus())}this.keydown.onBackspaceAndDeleteBefore()}if(t===this.keyCode.DELETE){var n=f(this.keydown.block).next();if(this.utils.isEndOfElement(this.keydown.block)&&0!==n.length&&"FIGURE"===n[0].tagName)return n.remove(),!1;if(this.keydown.block&&"LI"===this.keydown.block.tagName&&this.keydown.block){var o=f(this.keydown.block).parents("ul, ol").last(),a=o.next();if(this.utils.isRedactorParent(o)&&this.utils.isEndOfElement(o)&&0!==a.length&&("UL"===a[0].tagName||"OL"===a[0].tagName))return e.preventDefault(),o.append(a.contents()),a.remove(),!1}if(this.utils.isEndOfElement(this.keydown.block)&&0!==n.length&&"PRE"===n[0].tagName)return f(this.keydown.block).append(n.text()),n.remove(),!1}if(t===this.keyCode.DELETE&&0!==f("#redactor-image-box").length&&this.image.remove(),t===this.keyCode.BACKSPACE){if(this.detect.isFirefox()&&this.line.removeOnBackspace(e),this.list.combineAfterAndBefore(this.keydown.block))return void e.preventDefault();var s=this.selection.block();if(s&&"LI"===s.tagName&&this.utils.isCollapsed()&&this.utils.isStartOfElement())return this.indent.decrease(),void e.preventDefault();this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(e)}t!==this.keyCode.BACKSPACE&&t!==this.keyCode.DELETE||this.keydown.onBackspaceAndDeleteAfter(e)}else{e.preventDefault();var l=this.selection.get(),c=this.selection.range(l);c.collapsed||c.deleteContents()}}},onShiftSpace:function(){return this.buffer.set(),this.insert.raw("&nbsp;"),!1},onShiftEnter:function(e){return this.buffer.set(),this.keydown.pre?this.keydown.insertNewLine(e):this.insert.raw("<br>")},onBackspaceAndDeleteBefore:function(){this.utils.saveScroll()},onBackspaceAndDeleteAfter:function(t){setTimeout(f.proxy(function(){this.code.syncFire=!1,this.keydown.removeEmptyLists();var e="";0!==this.opts.keepStyleAttr.length&&(e=","+this.opts.keepStyleAttr.join(",")),this.core.editor().find("*[style]").not("img, figure, iframe, #redactor-image-box, #redactor-image-editter, [data-redactor-style-cache], [data-redactor-span]"+e).removeAttr("style"),this.keydown.formatEmpty(t),this.code.syncFire=!0},this),1)},onEnter:function(e){if(!1===this.core.callback("enter",e))return e.preventDefault(),!1;if(this.keydown.blockquote&&!0===this.keydown.exitFromBlockquote(e))return!1;if(this.keydown.pre)return this.keydown.insertNewLine(e);if(this.keydown.blockquote||this.keydown.figcaption)return this.keydown.insertBreakLine(e);if(this.keydown.figure)setTimeout(f.proxy(function(){this.keydown.replaceToParagraph("FIGURE")},this),1);else if(this.keydown.block){if(setTimeout(f.proxy(function(){this.keydown.replaceToParagraph("DIV")},this),1),"LI"===this.keydown.block.tagName){var t=this.selection.current(),i=f(t).closest("li",this.$editor[0]),r=i.parents("ul,ol",this.$editor[0]).last();if(0!==i.length&&this.utils.isEmpty(i.html())&&0===r.next().length&&this.utils.isEmpty(r.find("li").last().html())){r.find("li").last().remove();var n=f(this.opts.emptyHtml);return r.after(n),this.caret.start(n),!1}}}else if(!this.keydown.block)return this.keydown.insertParagraph(e);this.detect.isFirefox()&&this.utils.isInline(this.keydown.parent)?this.keydown.insertBreakLine(e):setTimeout(f.proxy(function(){var e=this.selection.inline();if(e&&this.utils.isEmpty(e.innerHTML)){var t=this.selection.block();f(e).remove();var i=document.createRange();i.setStart(t,0);var r=document.createTextNode("\u200b");i.insertNode(r),i.setStartAfter(r),i.collapse(!0);var n=window.getSelection();n.removeAllRanges(),n.addRange(i)}},this),1)},checkEvents:function(e,t){e||"click"!==this.core.getEvent()&&"arrow"!==this.core.getEvent()||(this.core.addEvent(!1),this.keydown.checkKeyEvents(t)&&this.buffer.set())},checkKeyEvents:function(e){var t=this.keyCode,i=[t.BACKSPACE,t.DELETE,t.ENTER,t.ESC,t.TAB,t.CTRL,t.META,t.ALT,t.SHIFT];return-1===f.inArray(e,i)},addArrowsEvent:function(e){e&&("click"!==this.core.getEvent()&&"arrow"!==this.core.getEvent()?this.core.addEvent("arrow"):this.core.addEvent(!1))},setupBuffer:function(e,t){return this.keydown.ctrl&&90===t&&!e.shiftKey&&!e.altKey&&this.sBuffer.length?(e.preventDefault(),void this.buffer.undo()):this.keydown.ctrl&&90===t&&e.shiftKey&&!e.altKey&&0!==this.sRebuffer.length?(e.preventDefault(),void this.buffer.redo()):void(this.keydown.ctrl||t!==this.keyCode.SPACE&&t!==this.keyCode.BACKSPACE&&t!==this.keyCode.DELETE&&(t!==this.keyCode.ENTER||e.ctrlKey||e.shiftKey)||this.buffer.set())},exitFromBlockquote:function(e){if(this.utils.isEndOfElement(this.keydown.blockquote)&&-1!==this.clean.removeSpacesHard(f(this.keydown.blockquote).html()).search(/(<br\s?\/?>){1}$/i)){e.preventDefault(),f(this.keydown.blockquote).children().last().filter("br").remove(),f(this.keydown.blockquote).children().last().filter("span").remove();var t=f(this.opts.emptyHtml);return f(this.keydown.blockquote).after(t),this.caret.start(t),!0}},onArrowDown:function(){for(var e=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],t=0;t<e.length;t++)if(e[t])return this.keydown.insertAfterLastElement(e[t]),!1},onArrowUp:function(){for(var e=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],t=0;t<e.length;t++)if(e[t])return this.keydown.insertBeforeFirstElement(e[t]),!1},insertAfterLastElement:function(e){if(this.utils.isEndOfElement(e)){var t=this.core.editor().contents().last();if(0===("FIGCAPTION"===e.tagName?f(this.keydown.block).parent().next():f(this.keydown.block).next()).length)if(0!==t.length||t[0]===e){var i=f(this.opts.emptyHtml);"FIGCAPTION"===e.tagName?f(e).parent().after(i):f(e).after(i),this.caret.start(i)}else this.caret.start(t)}},insertBeforeFirstElement:function(e){if(this.utils.isStartOfElement()&&!(1<this.core.editor().contents().length&&this.core.editor().contents().first()[0]!==e)){var t=f(this.opts.emptyHtml);f(e).before(t),this.caret.start(t)}},onTab:function(e,t){if(!this.opts.tabKey)return!0;var i=this.keydown.block&&"LI"===this.keydown.block.tagName;if(this.utils.isEmpty(this.code.get())||!i&&!this.keydown.pre&&!1===this.opts.tabAsSpaces)return!0;e.preventDefault(),this.buffer.set();var r,n=i&&this.utils.isStartOfElement(this.keydown.block);return this.keydown.pre&&!e.shiftKey?(r=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join("\xa0")):document.createTextNode("\t"),this.insert.node(r)):!1===this.opts.tabAsSpaces||n?e.metaKey&&219===t?this.indent.decrease():e.metaKey&&221===t?this.indent.increase():e.shiftKey?this.indent.decrease():this.indent.increase():(r=document.createTextNode(Array(this.opts.tabAsSpaces+1).join("\xa0")),this.insert.node(r)),!1},setupSelectAll:function(e,t){this.keydown.ctrl&&65===t?this.utils.enableSelectAll():t===this.keyCode.LEFT_WIN||this.keydown.ctrl||this.utils.disableSelectAll()},insertNewLine:function(e){e.preventDefault();var t=document.createTextNode("\n"),i=this.selection.get(),r=this.selection.range(i);return r.deleteContents(),r.insertNode(t),this.caret.after(t),!1},insertParagraph:function(e){e.preventDefault();var t=document.createElement("p");t.innerHTML="<br>";var i=this.selection.get(),r=this.selection.range(i);return r.deleteContents(),r.insertNode(t),this.caret.start(t),!1},insertBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e)},insertDblBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e,!0)},insertBreakLineProcessing:function(e,t){e.stopPropagation();var i=document.createElement("br");if(this.insert.node(i),!0===t){var r=document.createElement("br");this.insert.node(r),this.caret.after(r)}else this.caret.after(i);return!1},wrapToParagraph:function(){var e=f(this.keydown.current),t=f("<p>").append(e.clone());e.replaceWith(t);var i=f(t).next();void 0!==i[0]&&"BR"===i[0].tagName&&i.remove(),this.caret.end(t)},replaceToParagraph:function(e){var i=this.selection.block(),t=f(i).prev(),r=i.innerHTML.replace(/<br\s?\/?>/gi,"");if(i.tagName===e&&this.utils.isEmpty(r)&&!f(i).hasClass("redactor-in"))return n=document.createElement("p"),f(i).replaceWith(n),this.keydown.setCaretToParagraph(n),!1;if("P"===i.tagName)return f(i).removeAttr("class").removeAttr("style"),this.detect.isIe()&&this.utils.isEmpty(r)&&this.utils.isInline(this.keydown.parent)&&f(i).on("input",f.proxy(function(){var e=this.selection.parent();if(this.utils.isInline(e)){var t=f(e).html();f(i).html(t),this.caret.end(i)}f(i).off("keyup")},this)),!1;if(t.hasClass(this.opts.videoContainerClass)){t.removeAttr("class");var n=document.createElement("p");return t.replaceWith(n),this.keydown.setCaretToParagraph(n),!1}},setCaretToParagraph:function(e){var t=document.createRange();t.setStart(e,0);var i=document.createTextNode("\u200b");t.insertNode(i),t.setStartAfter(i),t.collapse(!0);var r=window.getSelection();r.removeAllRanges(),r.addRange(t)},removeInvisibleSpace:function(){var e=f(this.keydown.current);0===e.text().search(/^\u200B$/g)&&e.remove()},removeEmptyListInTable:function(e){var t=f(this.keydown.current),i=f(this.keydown.parent),r=t.closest("td",this.$editor[0]);if(0!==r.length&&t.closest("li",this.$editor[0])&&1===i.children("li").length){if(!this.utils.isEmpty(t.text()))return;e.preventDefault(),t.remove(),i.remove(),this.caret.start(r)}},removeEmptyLists:function(){var e=function(){""===f.trim(this.innerHTML).replace(/\/t\/n/g,"")&&f(this).remove()};this.core.editor().find("li").each(e),this.core.editor().find("ul, ol").each(e)},formatEmpty:function(e){var t=f.trim(this.core.editor().html());if(this.utils.isEmpty(t))return e.preventDefault(),"inline"===this.opts.type||"pre"===this.opts.type?(this.core.editor().html(this.marker.html()),this.selection.restore()):(this.core.editor().html(this.opts.emptyHtml),this.focus.start()),!1}}},keyup:function(){return{init:function(e){if(!this.rtePaste){var t=e.which;if(this.keyup.block=this.selection.block(),this.keyup.current=this.selection.current(),this.keyup.parent=this.selection.parent(),this.keyup.lastShiftKey=e.shiftKey,!1===this.core.callback("keyup",e))return e.preventDefault(),!1;if(t===this.keyCode.ENTER&&this.keyup.block&&"FIGURE"===this.keyup.block.tagName){var i=f(this.keyup.block).prev();if(0!==i.length&&"FIGURE"===i[0].tagName){var r=this.utils.replaceToTag(i,"p");return void this.caret.start(r)}}if(t===this.keyCode.BACKSPACE||t===this.keyCode.DELETE){if(this.utils.isSelectAll())return this.focus.start(),void this.toolbar.setUnfixed();if(this.keyup.block&&this.keydown.block&&"FIGURE"===this.keyup.block.tagName&&this.utils.isStartOfElement(this.keydown.block)){e.preventDefault(),this.selection.save(),f(this.keyup.block).find("figcaption").remove(),f(this.keyup.block).find("img").first().remove(),this.utils.replaceToTag(this.keyup.block,"p");var n=this.marker.find();return f("html, body").animate({scrollTop:n.position().top+20},500),void this.selection.restore()}if(this.keyup.block&&"P"===this.keyup.block.tagName){var o=f(this.keyup.block).find("img").length;""===f(this.keyup.block).text().replace(/\u200B/g,"")&&0!==o&&this.utils.replaceToTag(this.keyup.block,"figure")}this.keyup.block&&"FIGURE"===this.keyup.block.tagName&&0===f(this.keyup.block).find("img").length&&(this.selection.save(),this.utils.replaceToTag(this.keyup.block,"p"),this.selection.restore())}this.linkify.isKey(t)&&this.linkify.format()}}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(e){return void 0!==this.opts.curLang[e]?this.opts.curLang[e]:""}}},line:function(){return{insert:function(){this.buffer.set(),this.insert.html(this.line.getLineHtml());var e=this.core.editor().find("#redactor-hr-tmp-id");return e.removeAttr("id"),this.core.callback("insertedLine",e),e},getLineHtml:function(){var e='<hr id="redactor-hr-tmp-id" />';return!this.detect.isFirefox()&&this.utils.isEmpty()&&(e+="<p>"+this.opts.emptyHtml+"</p>"),e},removeOnBackspace:function(e){if(this.utils.isCollapsed()){var t=f(this.selection.block());if(0!==t.length&&this.utils.isStartOfElement(t)){var i=t.prev();i&&0!==i.length&&"HR"===i[0].tagName&&(e.preventDefault(),i.remove())}}}}},link:function(){return{get:function(){return f(this.selection.inlines("a"))},is:function(){var e=this.selection.nodes(),t=f(this.selection.current()).closest("a",this.core.editor()[0]);return!(0===t.length||1<e.length)&&t},unlink:function(e){void 0!==e&&e.preventDefault&&e.preventDefault(),this.buffer.set();var t=this.selection.inlines("a");if(0!==t.length){var i=this.link.replaceLinksToText(t);this.observe.closeAllTooltip(),this.core.callback("deletedLink",i)}},insert:function(e,t){var i=this.link.is();if(!0!==t&&!1===(e=this.link.buildLinkFromObject(i,e)))return!1;if(this.buffer.set(),e=this.core.callback("beforeInsertingLink",e),!1===i){i=f("<a />"),i=this.link.update(i,e);var r=(i=f(this.insert.node(i))).parent();!1===this.utils.isRedactorParent(r)&&i.wrap("<p>"),r.hasClass("redactor-unlink")&&r.replaceWith(function(){return f(this).contents()}),this.caret.after(i),this.core.callback("insertedLink",i)}else i=this.link.update(i,e),this.caret.after(i);return i},update:function(e,t){return e.text(t.text),e.attr("href",t.url),this.link.target(e,t.target),e},target:function(e,t){return t?e.attr("target","_blank"):e.removeAttr("target")},show:function(e){void 0!==e&&e.preventDefault&&e.preventDefault(),this.observe.closeAllTooltip();var t=this.link.is();this.link.buildModal(t);var i=this.link.buildLinkFromElement(t);i.url=this.link.removeSelfHostFromUrl(i.url),this.opts.linkNewTab&&!t&&(i.target=!0),this.link.setModalValues(i),this.modal.show(),this.detect.isDesktop()&&f("#redactor-link-url").focus()},setModalValues:function(e){f(
"#redactor-link-blank").prop("checked",e.target),f("#redactor-link-url").val(e.url),f("#redactor-link-url-text").val(e.text)},buildModal:function(e){this.modal.load("link",this.lang.get(!1===e?"link-insert":"link-edit"),600),this.modal.getActionButton().text(this.lang.get(!1===e?"insert":"save")).on("click",f.proxy(this.link.callback,this))},callback:function(){var e=this.link.buildLinkFromModal();if(!1===e)return!1;this.modal.close(),this.link.insert(e,!0)},cleanUrl:function(e){return void 0===e?"":f.trim(e.replace(/[^\W\w\D\d+&\'@#/%?=~_|!:,.;\(\)]/gi,""))},cleanText:function(e){return void 0===e?"":f.trim(e.replace(/(<([^>]+)>)/gi,""))},getText:function(e){return""===e.text&&""!==e.url?this.link.truncateUrl(e.url.replace(/<|>/g,"")):e.text},isUrl:function(e){var t="((xn--)?[\\W\\w\\D\\d]+(-[\\W\\w\\D\\d]+)*\\.)+[\\W\\w]{2,}",i=new RegExp("^(http|ftp|https)://"+t,"i"),r=new RegExp("^"+t,"i"),n=new RegExp(".(html|php)$","i"),o=new RegExp("^/","i"),a=new RegExp("^tel:(.*?)","i");return-1===e.search(i)&&-1!==e.search(r)&&-1===e.search(n)&&"/"!==e.substring(0,1)&&(e="http://"+e),(-1!==e.search(i)||-1!==e.search(n)||-1!==e.search(o)||-1!==e.search(a))&&e},isMailto:function(e){return-1!==e.search("@")&&!1===/(http|ftp|https):\/\//i.test(e)},isEmpty:function(e){return""===e.url||""===e.text&&""===e.url},truncateUrl:function(e){return e.length>this.opts.linkSize?e.substring(0,this.opts.linkSize)+"...":e},parse:function(e){return this.link.isMailto(e.url)?e.url="mailto:"+e.url.replace("mailto:",""):0!==e.url.search("#")&&(e.url=this.link.isUrl(e.url)),!this.link.isEmpty(e)&&!1!==e.url&&e},buildLinkFromModal:function(){var e={};return e.url=this.link.cleanUrl(f("#redactor-link-url").val()),e.text=this.link.cleanText(f("#redactor-link-url-text").val()),e.text=this.link.getText(e),e.target=!!f("#redactor-link-blank").prop("checked"),this.link.parse(e)},buildLinkFromObject:function(e,t){return t.url=this.link.cleanUrl(t.url),t.text=void 0===t.text&&this.selection.is()?this.selection.text():this.link.cleanText(t.text),t.text=this.link.getText(t),t.target=!1===e?t.target:this.link.buildTarget(e),this.link.parse(t)},buildLinkFromElement:function(e){var t={url:"",text:this.selection.is()?this.selection.text():"",target:!1};return!1!==e&&(t.url=e.attr("href"),t.text=e.text(),t.target=this.link.buildTarget(e)),t},buildTarget:function(e){return void 0!==e.attr("target")&&"_blank"===e.attr("target")},removeSelfHostFromUrl:function(e){var t=self.location.href.replace("#","").replace(/\/$/i,"");return e.replace(/^\/\#/,"#").replace(t,"").replace("mailto:","")},replaceLinksToText:function(e){var n,t=f.each(e,function(e,t){var i=f(t),r=f('<span class="redactor-unlink" />').append(i.contents());return i.replaceWith(r),0===e&&(n=r),i});return 1===e.length&&this.selection.isCollapsed()&&this.caret.after(n),t}}},linkify:function(){return{isKey:function(e){return e===this.keyCode.ENTER||e===this.keyCode.SPACE},isLink:function(e){return e.nodeValue.match(this.opts.regexps.linkyoutube)||e.nodeValue.match(this.opts.regexps.linkvimeo)||e.nodeValue.match(this.opts.regexps.linkimage)||e.nodeValue.match(this.opts.regexps.url)},isFiltered:function(e,t){return 3===t.nodeType&&""!==f.trim(t.nodeValue)&&!f(t).parent().is("pre")&&this.linkify.isLink(t)},handler:function(e,t){var i=f(t),r=i.text(),n=r;n=n.match(this.opts.regexps.linkyoutube)||n.match(this.opts.regexps.linkvimeo)?this.linkify.convertVideoLinks(n):n.match(this.opts.regexps.linkimage)?this.linkify.convertImages(n):this.linkify.convertLinks(n),i.before(r.replace(r,n)).remove()},format:function(){if(this.opts.linkify&&!this.utils.isCurrentOrParent("pre")){this.core.editor().find(":not(iframe,img,a,pre,code,.redactor-unlink)").addBack().contents().filter(f.proxy(this.linkify.isFiltered,this)).each(f.proxy(this.linkify.handler,this));var e=this.core.editor().find(".redactor-linkify-object").each(f.proxy(function(e,t){var i=f(t);return i.removeClass("redactor-linkify-object"),""===i.attr("class")&&i.removeAttr("class"),"DIV"===t.tagName?this.linkify.breakBlockTag(i,"video"):"IMG"===t.tagName?this.linkify.breakBlockTag(i,"image"):"A"===t.tagName&&this.core.callback("insertedLink",i),i},this));setTimeout(f.proxy(function(){this.code.sync(),this.core.callback("linkify",e)},this),100)}},breakBlockTag:function(e,t){var i=this.utils.breakBlockTag();if(!1!==i){var r=e;"image"===t&&(r=f("<figure />").append(e)),"start"===i.type?i.$block.before(r):i.$block.after(r),"image"===t&&this.caret.after(r)}},convertVideoLinks:function(e){var t='<div class="'+this.opts.videoContainerClass+' redactor-linkify-object"><iframe class="redactor-linkify-object" width="500" height="281" src="',i='" frameborder="0" allowfullscreen></iframe></div>';return e.match(this.opts.regexps.linkyoutube)&&(e=e.replace(this.opts.regexps.linkyoutube,t+"//www.youtube.com/embed/$1"+i)),e.match(this.opts.regexps.linkvimeo)&&(e=e.replace(this.opts.regexps.linkvimeo,t+"//player.vimeo.com/video/$2"+i)),e},convertImages:function(e){var t=e.match(this.opts.regexps.linkimage);return t?e.replace(e,'<img src="'+t+'" class="redactor-linkify-object" />'):e},convertLinks:function(e){var i=e.match(this.opts.regexps.url);if(!i)return e;for(var t=(i=f.grep(i,function(e,t){return f.inArray(e,i)===t})).length,r=0;r<t;r++){var n=i[r],o=n,a=null!==n.match(/(https?|ftp):\/\//i)?"":"http://";o.length>this.opts.linkSize&&(o=o.substring(0,this.opts.linkSize)+"..."),-1===o.search("%")&&(o=decodeURIComponent(o));var s="\\b";-1!==f.inArray(n.slice(-1),["/","&","="])&&(s="");var l=new RegExp("("+n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+s+")","g"),c="";!1!==this.opts.pasteLinkTarget&&(c=' target="'+this.opts.pasteLinkTarget+'"'),e=e.replace(l,'<a href="'+a+f.trim(n)+'"'+c+' class="redactor-linkify-object">'+f.trim(o)+"</a>")}return e}}},list:function(){return{toggle:function(e){if(!this.utils.inBlocks(["table","td","th","tr"])){var i="orderedlist"===e||"ol"===e?"OL":"UL";e="OL"===i?"orderedlist":"unorderedlist";var t=f(this.selection.current()).parentsUntil(".redactor-in","ul, ol").first();if(this.placeholder.hide(),this.buffer.set(),0!==t.length&&t[0].tagName===i&&this.utils.isRedactorParent(t))return this.selection.save(),t.find("ul, ol").each(function(){var e=f(this).closest("li");f(this).find("li").each(function(){f(e).after(this)})}),t.find("ul, ol").remove(),t.find("li").each(function(){return f(this).replaceWith(function(){return f("<p />").append(f(this).contents())})}),t.replaceWith(function(){return f(this).contents()}),void this.selection.restore();this.selection.save(),0!==t.length&&t[0].tagName!==i?t.each(f.proxy(function(e,t){this.utils.replaceToTag(t,i)},this)):document.execCommand("insert"+e),this.selection.restore();var r=this.list.get();if(r){r.find("span").replaceWith(function(){return f(this).contents()}),r.find(this.opts.inlineTags.join(",")).each(function(){f(this).removeAttr("style")});var n=r.parent();this.utils.isRedactorParent(n)&&"LI"!==n[0].tagName&&this.utils.isBlock(n)&&(this.selection.save(),n.replaceWith(n.contents()),this.selection.restore())}else this.selection.block()||document.execCommand("formatblock",!1,"p")}},get:function(){var e=this.selection.current(),t=f(e).closest("ul, ol",this.core.editor()[0]);return 0!==t.length&&t},combineAfterAndBefore:function(e){var t=f(e).prev(),i=f(e).next(),r=e&&"P"===e.tagName&&("<br>"===e.innerHTML||""===e.innerHTML),n=1===t.closest("ol, ul",this.core.editor()[0]).length&&1===i.closest("ol, ul",this.core.editor()[0]).length;return!(!r||!n||(t.children("li").last().append(this.marker.get()),t.append(i.contents()),this.selection.restore(),0))}}},marker:function(){return{get:function(e){e=void 0===e?1:e;var t=document.createElement("span");return t.id="selection-marker-"+e,t.className="redactor-selection-marker",t.innerHTML=this.opts.invisibleSpace,t},html:function(e){return this.utils.getOuterHtml(this.marker.get(e))},find:function(e){return e=void 0===e?1:e,this.core.editor().find("span#selection-marker-"+e)},insert:function(){var e=this.selection.get(),t=this.selection.range(e);this.marker.insertNode(t,this.marker.get(1),!0),t&&!1===t.collapsed&&this.marker.insertNode(t,this.marker.get(2),!1)},remove:function(){this.core.editor().find(".redactor-selection-marker").each(this.marker.iterateRemove)},insertNode:function(e,t,i){var r=this.selection.parent();if(null!==e&&0!==f(r).closest(".redactor-in").length){e=e.cloneRange();try{e.collapse(i),e.insertNode(t)}catch(f){this.focus.start()}}},iterateRemove:function(e,t){var i=f(t),r=i.text().replace(/\u200B/g,"");i.parent()[0],""===r?i.remove():i.replaceWith(function(){return f(this).contents()})}}},modal:function(){return{callbacks:{},templates:function(){this.opts.modal={"image-edit":String()+'<div class="redactor-modal-tab redactor-group" data-title="General"><div id="redactor-image-preview" class="redactor-modal-tab-side"></div><div class="redactor-modal-tab-area"><section><label>'+this.lang.get("title")+'</label><input type="text" id="redactor-image-title" /></section><section><label>'+this.lang.get("caption")+'</label><input type="text" id="redactor-image-caption" aria-label="'+this.lang.get("caption")+'" /></section><section><label>'+this.lang.get("link")+'</label><input type="text" id="redactor-image-link" aria-label="'+this.lang.get("link")+'" /></section><section><label class="redactor-image-position-option">'+this.lang.get("image-position")+'</label><select class="redactor-image-position-option" id="redactor-image-align" aria-label="'+this.lang.get("image-position")+'"><option value="none">'+this.lang.get("none")+'</option><option value="left">'+this.lang.get("left")+'</option><option value="center">'+this.lang.get("center")+'</option><option value="right">'+this.lang.get("right")+'</option></select></section><section><label class="checkbox"><input type="checkbox" id="redactor-image-link-blank" aria-label="'+this.lang.get("link-in-new-tab")+'"> '+this.lang.get("link-in-new-tab")+'</label></section><section><button id="redactor-modal-button-action">'+this.lang.get("insert")+'</button><button id="redactor-modal-button-cancel">'+this.lang.get("cancel")+'</button><button id="redactor-modal-button-delete" class="redactor-modal-button-offset">'+this.lang.get("delete")+"</button></section></div></div>",image:String()+'<div class="redactor-modal-tab" data-title="Upload"><section><div id="redactor-modal-image-droparea"></div></section></div>',file:String()+'<div class="redactor-modal-tab" data-title="Upload"><section><label>'+this.lang.get("filename")+' <span class="desc">('+this.lang.get("optional")+')</span></label><input type="text" id="redactor-filename" aria-label="'+this.lang.get("filename")+'" /><br><br></section><section><div id="redactor-modal-file-upload"></div></section></div>',link:String()+'<div class="redactor-modal-tab" data-title="General"><section><label>URL</label><input type="url" id="redactor-link-url" aria-label="URL" /></section><section><label>'+this.lang.get("text")+'</label><input type="text" id="redactor-link-url-text" aria-label="'+this.lang.get("text")+'" /></section><section><label class="checkbox"><input type="checkbox" id="redactor-link-blank"> '+this.lang.get("link-in-new-tab")+'</label></section><section><button id="redactor-modal-button-action">'+this.lang.get("insert")+'</button><button id="redactor-modal-button-cancel">'+this.lang.get("cancel")+"</button></section></div>"},f.extend(this.opts,this.opts.modal)},addCallback:function(e,t){this.modal.callbacks[e]=t},addTemplate:function(e,t){this.opts.modal[e]=t},getTemplate:function(e){return this.opts.modal[e]},getModal:function(){return this.$modalBody},getActionButton:function(){return this.$modalBody.find("#redactor-modal-button-action")},getCancelButton:function(){return this.$modalBody.find("#redactor-modal-button-cancel")},getDeleteButton:function(){return this.$modalBody.find("#redactor-modal-button-delete")},load:function(e,t,i){void 0!==this.$modalBox&&this.$modalBox.hasClass("open")||(this.modal.templateName=e,this.modal.width=i,this.modal.build(),this.modal.enableEvents(),this.modal.setTitle(t),this.modal.setDraggable(),this.modal.setContent(),void 0!==this.modal.callbacks[e]&&this.modal.callbacks[e].call(this))},show:function(){this.detect.isDesktop()||document.activeElement.blur(),this.selection.save(),this.modal.buildTabber(),this.detect.isMobile()&&(this.modal.width="96%"),setTimeout(f.proxy(this.modal.buildWidth,this),0),f(window).on("resize.redactor-modal",f.proxy(this.modal.buildWidth,this)),this.$modalOverlay.redactorAnimation("fadeIn",{duration:.25}),this.$modalBox.addClass("open").show(),this.$modal.redactorAnimation("fadeIn",{timing:"cubic-bezier(0.175, 0.885, 0.320, 1.105)"},f.proxy(function(){this.utils.saveScroll(),this.utils.disableBodyScroll(),this.core.callback("modalOpened",this.modal.templateName,this.$modal),f(document).off("focusin.modal"),this.$modal.find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor-modal",f.proxy(this.modal.setEnter,this))},this))},buildWidth:function(){var e=f(window).height(),t=f(window).width(),i="number"==typeof this.modal.width;!i&&this.modal.width.match(/%$/)?this.$modal.css({width:this.modal.width,"margin-bottom":"16px"}):parseInt(this.modal.width)>t?this.$modal.css({width:"96%","margin-bottom":"2%"}):(i&&(this.modal.width+="px"),this.$modal.css({width:this.modal.width,"margin-bottom":"16px"}));var r=this.$modal.outerHeight(),n=e/2-r/2+"px";this.detect.isMobile()?n="2%":e<r&&(n="16px"),this.$modal.css("margin-top",n)},buildTabber:function(){this.modal.tabs=this.$modal.find(".redactor-modal-tab"),this.modal.tabs.length<2||(this.modal.$tabsBox=f('<div id="redactor-modal-tabber" />'),f.each(this.modal.tabs,f.proxy(function(e,t){var i=f('<a href="#" rel="'+e+'" />').text(f(t).attr("data-title"));i.on("click",f.proxy(this.modal.showTab,this)),0===e&&i.addClass("active"),this.modal.$tabsBox.append(i)},this)),this.$modalBody.prepend(this.modal.$tabsBox))},showTab:function(e){e.preventDefault();var t=f(e.target),i=t.attr("rel");return this.modal.tabs.hide(),this.modal.tabs.eq(i).show(),f("#redactor-modal-tabber").find("a").removeClass("active"),t.addClass("active"),!1},setTitle:function(e){this.$modalHeader.html(e)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName)),this.modal.getCancelButton().on("mousedown",f.proxy(this.modal.close,this))},setDraggable:function(){void 0!==f.fn.draggable&&(this.$modal.draggable({handle:this.$modalHeader}),this.$modalHeader.css("cursor","move"))},setEnter:function(e){13===e.which&&(e.preventDefault(),this.modal.getActionButton().click())},build:function(){this.modal.buildOverlay(),this.$modalBox=f('<div id="redactor-modal-box"/>').hide(),this.$modal=f('<div id="redactor-modal" role="dialog" />'),this.$modalHeader=f('<div id="redactor-modal-header" />'),this.$modalClose=f('<button type="button" id="redactor-modal-close" aria-label="'+this.lang.get("close")+'" />').html("&times;"),this.$modalBody=f('<div id="redactor-modal-body" />'),this.$modal.append(this.$modalHeader),this.$modal.append(this.$modalBody),this.$modal.append(this.$modalClose),this.$modalBox.append(this.$modal),this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=f('<div id="redactor-modal-overlay">').hide(),f("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.on("mousedown.redactor-modal",f.proxy(this.modal.close,this)),f(document).on("keyup.redactor-modal",f.proxy(this.modal.closeHandler,this)),this.core.editor().on("keyup.redactor-modal",f.proxy(this.modal.closeHandler,this)),this.$modalBox.on("click.redactor-modal",f.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.off("mousedown.redactor-modal"),f(document).off("keyup.redactor-modal"),this.core.editor().off("keyup.redactor-modal"),this.$modalBox.off("click\xa7.redactor-modal"),f(window).off("resize.redactor-modal")},closeHandler:function(e){e.which===this.keyCode.ESC&&this.modal.close(!1)},close:function(e){if(e){if("redactor-modal-button-cancel"!==f(e.target).attr("id")&&e.target!==this.$modalClose[0]&&e.target!==this.$modalBox[0])return;e.preventDefault()}this.$modalBox&&(this.selection.restore(),this.modal.disableEvents(),this.utils.enableBodyScroll(),this.utils.restoreScroll(),this.$modalOverlay.redactorAnimation("fadeOut",{duration:.4},f.proxy(function(){this.$modalOverlay.remove()},this)),this.$modal.redactorAnimation("fadeOut",{duration:.3,timing:"cubic-bezier(0.175, 0.885, 0.320, 1.175)"},f.proxy(function(){void 0!==this.$modalBox&&(this.$modalBox.remove(),this.$modalBox=void 0),this.core.callback("modalClosed",this.modal.templateName)},this)))}}},observe:function(){return{load:function(){void 0===this.opts.destroyed&&(this.observe.links(),this.observe.images())},isCurrent:function(e,t){return void 0===t&&(t=f(this.selection.current())),t.is(e)||0<t.parents(e).length},toolbar:function(){this.observe.buttons(),this.observe.dropdowns()},buttons:function(e,t){var n=this.selection.current(),o=this.selection.parent();!1!==e?this.button.setInactiveAll():this.button.setInactiveAll(t),!1!==e||"html"===t?this.utils.isRedactorParent(n)&&("none"!==this.core.editor().css("display")&&(this.utils.isCurrentOrParentHeader()||this.utils.isCurrentOrParent(["table","pre","blockquote","li"])?this.button.disable("horizontalrule"):this.button.enable("horizontalrule")),f.each(this.opts.activeButtonsStates,f.proxy(function(e,t){var i=f(o).closest(e,this.$editor[0]),r=f(n).closest(e,this.$editor[0]);(0===i.length||this.utils.isRedactorParent(i))&&this.utils.isRedactorParent(r)&&(0===i.length&&0===r.closest(e,this.$editor[0]).length||this.button.setActive(t))},this))):-1!==f.inArray(t,this.opts.activeButtons)&&this.button.toggleActive(t)},dropdowns:function(){var s=f("<div />").html(this.selection.html()).find("a").length,l=f(this.selection.current()),c=this.utils.isRedactorParent(l);f.each(this.opts.observe.dropdowns,f.proxy(function(e,t){var i=t.observe,r=i.element,n=t.item,o=void 0!==i["in"]&&i["in"],a=void 0!==i.out&&i.out;0<l.closest(r).length&&c||"a"===r&&0!==s?this.observe.setDropdownProperties(n,o,a):this.observe.setDropdownProperties(n,a,o)},this))},setDropdownProperties:function(e,t,i){i&&void 0!==i.attr&&this.observe.setDropdownAttr(e,i.attr,!0),void 0!==t.attr&&this.observe.setDropdownAttr(e,t.attr),void 0!==t.title&&e.find("span").text(t.title)},setDropdownAttr:function(i,e,r){f.each(e,function(e,t){"class"===e?r?i.removeClass(t):i.addClass(t):r?i.removeAttr(e):i.attr(e,t)})},addDropdown:function(e,t,i){void 0!==i.observe&&(i.item=e,this.opts.observe.dropdowns.push(i))},images:function(){this.opts.imageEditable&&(this.core.editor().addClass("redactor-layer-img-edit"),this.core.editor().find("img").each(f.proxy(function(e,t){var i=f(t);i.closest("a",this.$editor[0]).on("click",function(e){e.preventDefault()}),this.image.setEditable(i)},this)))},links:function(){this.opts.linkTooltip&&this.core.editor().find("a").each(f.proxy(function(e,t){var i=f(t);!0!==i.data("cached")&&(i.data("cached",!0),i.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,f.proxy(this.observe.showTooltip,this)))},this))},getTooltipPosition:function(e){return e.offset()},showTooltip:function(e){var t=f(e.target);if("IMG"!==t[0].tagName&&("A"!==t[0].tagName&&(t=t.closest("a",this.$editor[0])),"A"===t[0].tagName)){var i=t,r=this.observe.getTooltipPosition(i),n=f('<span class="redactor-link-tooltip"></span>'),o=i.attr("href");void 0===o&&(o=""),24<o.length&&(o=o.substring(0,24)+"...");var a=f('<a href="'+i.attr("href")+'" target="_blank" />').html(o).addClass("redactor-link-tooltip-action"),s=f('<a href="#" />').html(this.lang.get("edit")).on("click",f.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action"),l=f('<a href="#" />').html(this.lang.get("unlink")).on("click",f.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action");n.append(a).append(" | ").append(s).append(" | ").append(l);var c=parseInt(i.css("line-height"),10),d=Math.ceil((e.pageY-r.top)/c),u=r.top+d*c;n.css({top:u+"px",left:r.left+"px"}),f(".redactor-link-tooltip").remove(),f("body").append(n),this.core.editor().on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,f.proxy(this.observe.closeTooltip,this)),f(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,f.proxy(this.observe.closeTooltip,this))}},closeAllTooltip:function(){f(".redactor-link-tooltip").remove()},closeTooltip:function(e){var t=(e=e.originalEvent||e).target,i=f(t).closest("a",this.$editor[0]);0!==i.length&&"A"===i[0].tagName&&"A"!==t.tagName||"A"===t.tagName&&this.utils.isRedactorParent(t)||f(t).hasClass("redactor-link-tooltip-action")||(this.observe.closeAllTooltip(),this.core.editor().off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,f.proxy(this.observe.closeTooltip,this)),f(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,f.proxy(this.observe.closeTooltip,this)))}}},offset:function(){return{get:function(e){var t=this.offset.clone(e);if(!1===t)return 0;var i=document.createElement("div");return i.appendChild(t.cloneContents()),i.innerHTML=i.innerHTML.replace(/<img(.*?[^>])>$/gi,"i"),f.trim(f(i).text()).replace(/[\t\n\r\n]/g,"").replace(/\u200B/g,"").length},clone:function(e){var t=this.selection.get(),i=this.selection.range(t);if(null===i&&void 0===e)return!1;if(!1===(e=void 0===e?this.$editor:e))return!1;e=e[0]||e;var r=i.cloneRange();return r.selectNodeContents(e),r.setEnd(i.endContainer,i.endOffset),r},set:function(e,t){t=void 0===t?e:t,this.focus.is()||this.focus.start();for(var i,r=this.selection.get(),n=this.selection.range(r),o=0,a=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);null!==(i=a.nextNode());)if((o+=i.nodeValue.length)>e&&(n.setStart(i,i.nodeValue.length+e-o),e=1/0),t<=o){n.setEnd(i,i.nodeValue.length+t-o);break}n.collapse(!1),this.selection.update(r,n)}}},paragraphize:function(){return{load:function(e){return!1===this.opts.paragraphize||"inline"===this.opts.type||"pre"===this.opts.type?e:""===e||"<p></p>"===e?this.opts.emptyHtml:(e+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,e=(e=(e=e.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>")).replace(/<\/pre>/gi,"</pre>\n\n")).replace(/<p>\s<br><\/p>/gi,"<p></p>"),e=(e=this.paragraphize.getSafes(e)).replace("<br>","\n"),e=this.paragraphize.convert(e),e=this.paragraphize.clear(e),e=(e=this.paragraphize.restoreSafes(e)).replace(new RegExp("<br\\s?/?>\n?<("+this.opts.paragraphizeBlocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),f.trim(e))},getSafes:function(e){var t=f("<div />").append(e);return t.find("blockquote p").replaceWith(function(){return f(this).append("<br />").contents()}),t.find(this.opts.paragraphizeBlocks.join(", ")).each(f.proxy(function(e,t){return this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=t.outerHTML,f(t).replaceWith("\n#####replace"+this.paragraphize.z+"#####\n\n")},this)),t.find("span.redactor-selection-marker").each(f.proxy(function(e,t){return this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=t.outerHTML,f(t).replaceWith("\n#####replace"+this.paragraphize.z+"#####\n\n")},this)),t.html()},restoreSafes:function(i){return f.each(this.paragraphize.safes,function(e,t){t=void 0!==t?t.replace(/\$/g,"&#36;"):t,i=i.replace("#####replace"+e+"#####",t)}),i},convert:function(e){var t=/\s+/g;e=(e=(e=(e=e.replace(/\r\n/g,"xparagraphmarkerz")).replace(/\n/g,"xparagraphmarkerz")).replace(/\r/g,"xparagraphmarkerz")).replace(t," ");var i=/xparagraphmarkerzxparagraphmarkerz/gi,r=/xparagraphmarkerz/gi;return(e=(e=(e=(e=(e=(e=(e=(e=(e=(e="<p>"+(e=(e=(e=f.trim(e)).replace(i,"</p><p>")).replace(r,"<br>"))+"</p>").replace("<p></p>","")).replace("\r\n\r\n","")).replace(/<\/p><p>/g,"</p>\r\n\r\n<p>")).replace(new RegExp("<br\\s?/?></p>","g"),"</p>")).replace(new RegExp("<p><br\\s?/?>","g"),"<p>")).replace(new RegExp("<p><br\\s?/?>","g"),"<p>")).replace(new RegExp("<br\\s?/?></p>","g"),"</p>")).replace(/<p>&nbsp;<\/p>/gi,"")).replace(/<p>\s?<br>&nbsp;<\/p>/gi,"")).replace(/<p>\s?<br>/gi,"<p>")},clear:function(e){return(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<p>(.*?)#####replace(.*?)#####\s?<\/p>/gi,"<p>$1</p>#####replace$2#####")).replace(/(<br\s?\/?>){2,}<\/p>/gi,"</p>")).replace(new RegExp("</blockquote></p>","gi"),"</blockquote>")).replace(new RegExp("<p></blockquote>","gi"),"</blockquote>")).replace(new RegExp("<p><blockquote>","gi"),"<blockquote>")).replace(new RegExp("<blockquote></p>","gi"),"<blockquote>")).replace(new RegExp("<p><p ","gi"),"<p ")).replace(new RegExp("<p><p>","gi"),"<p>")).replace(new RegExp("</p></p>","gi"),"</p>")).replace(new RegExp("<p>\\s?</p>","gi"),"")).replace(new RegExp("\n</p>","gi"),"</p>")).replace(new RegExp("<p>\t?\t?\n?<p>","gi"),"<p>")).replace(new RegExp("<p>\t*</p>","gi"),"")}}},paste:function(){return{init:function(e){this.rtePaste=!0;var r=!("pre"!==this.opts.type&&!this.utils.isCurrentOrParent("pre"));this.detect.isDesktop()&&!this.paste.pre&&this.opts.clipboardImageUpload&&this.opts.imageUpload&&this.paste.detectClipboardUpload(e)?this.detect.isIe()&&setTimeout(f.proxy(this.paste.clipboardUpload,this),100):(this.utils.saveScroll(),this.selection.save(),this.paste.createPasteBox(r),f(window).on("scroll.redactor-freeze",f.proxy(function(){f(window).scrollTop(this.saveBodyScroll)},this)),setTimeout(f.proxy(function(){var e=this.paste.getPasteBoxCode(r);this.buffer.set(),this.selection.restore(),this.utils.restoreScroll();var t=this.clean.getCurrentType(e);e=this.clean.onPaste(e,t);var i=this.core.callback("paste",e);e=void 0===i?e:i,this.paste.insert(e,t),this.rtePaste=!1,r&&this.clean.cleanPre(),f(window).off("scroll.redactor-freeze")},this),1))},getPasteBoxCode:function(e){var t=e?this.$pasteBox.val():this.$pasteBox.html();return this.$pasteBox.remove(),t},createPasteBox:function(e){var t={position:"fixed",width:"1px",top:0,left:"-9999px"};this.$pasteBox=e?f("<textarea>").css(t):f("<div>").attr("contenteditable","true").css(t),this.paste.appendPasteBox(),this.$pasteBox.focus()},appendPasteBox:function(){if(this.detect.isIe())this.core.box().append(this.$pasteBox);else{var e=f(".modal-body:visible");0<e.length?e.append(this.$pasteBox):f("body").prepend(this.$pasteBox)}},detectClipboardUpload:function(e){var t=(e=e.originalEvent||e).clipboardData;if(this.detect.isIe()||this.detect.isFirefox())return!1;if(-1!==t.types.indexOf("public.tiff"))return e.preventDefault(),!1;if(t.items&&t.items.length){var i=t.items[0].getAsFile();if(null===i)return!1;var r=new FileReader;return r.readAsDataURL(i),r.onload=f.proxy(this.paste.insertFromClipboard,this),!0}},clipboardUpload:function(){var e=this.$editor.find("img");f.each(e,f.proxy(function(e,i){if(-1!==i.src.search(/^data\:image/i)){var t=window.FormData?new FormData:null;if(window.FormData){this.upload.direct=!0,this.upload.type="image",this.upload.url=this.opts.imageUpload,this.upload.callback=f.proxy(function(e){if(this.detect.isIe())f(i).wrap(f("<figure />"));else{var t=f(i).parent();this.utils.replaceToTag(t,"figure")}i.src=e.url,this.core.callback("imageUpload",f(i),e)},this);var r=this.utils.dataURItoBlob(i.src);t.append("clipboard",1),t.append(this.opts.imageUploadParam,r),this.progress.show(),this.upload.send(t,!1),this.code.sync(),this.rtePaste=!1}}},this))},insertFromClipboard:function(e){var t=window.FormData?new FormData:null;if(window.FormData){this.upload.direct=!0,this.upload.type="image",this.upload.url=this.opts.imageUpload,this.upload.callback=this.image.insert;var i=this.utils.dataURItoBlob(e.target.result);t.append("clipboard",1),t.append(this.opts.imageUploadParam,i),this.progress.show(),this.upload.send(t,e),this.rtePaste=!1}},insert:function(e,t){t.pre?this.insert.raw(e):t.text?this.insert.text(e):this.insert.html(e,t),this.detect.isFirefox()&&this.opts.clipboardImageUpload&&setTimeout(f.proxy(this.paste.clipboardUpload,this),100)}}},placeholder:function(){return{enable:function(){setTimeout(f.proxy(function(){return this.placeholder.isEditorEmpty()?this.placeholder.show():this.placeholder.hide()},this),5)},show:function(){this.core.editor().addClass("redactor-placeholder")},update:function(e){this.opts.placeholder=e,this.core.editor().attr("placeholder",e)},hide:function(){this.core.editor().removeClass("redactor-placeholder")},is:function(){return this.core.editor().hasClass("redactor-placeholder")},init:function(){this.placeholder.enabled()&&(this.utils.isEditorRelative()||this.utils.setEditorRelative(),this.placeholder.build(),this.placeholder.buildPosition(),this.placeholder.enable(),this.placeholder.enableEvents())},enabled:function(){return this.opts.placeholder?this.core.element().attr("placeholder",this.opts.placeholder):this.placeholder.isAttr()},enableEvents:function(){this.core.editor().on("keydown.redactor-placeholder."+this.uuid,f.proxy(this.placeholder.enable,this))},disableEvents:function(){this.core.editor().off(".redactor-placeholder."+this.uuid)},build:function(){this.core.editor().attr("placeholder",this.core.element().attr("placeholder"))},buildPosition:function(){var e=f("<style />");e.addClass("redactor-placeholder-style-tag"),e.html("#"+this.core.id()+".redactor-placeholder::after "+this.placeholder.getPosition()),f("head").append(e)},getPosition:function(){return"{ top: "+this.core.editor().css("padding-top")+"; left: "+this.core.editor().css("padding-left")+"; }"},isEditorEmpty:function(){var e=f.trim(this.core.editor().html()).replace(/[\t\n]/g,""),t=["","<p>\u200b</p>","<p>\u200b<br></p>",this.opts.emptyHtmlRendered];return-1!==f.inArray(e,t)},isAttr:function(){return void 0!==this.core.element().attr("placeholder")&&""!==this.core.element().attr("placeholder")},destroy:function(){this.core.editor().removeAttr("placeholder"),this.placeholder.hide(),this.placeholder.disableEvents(),f(".redactor-placeholder-style-tag").remove()}}},progress:function(){return{$box:null,$bar:null,target:document.body,show:function(){this.progress.is()?this.progress.$box.show():(this.progress.build(),this.progress.$box.redactorAnimation("fadeIn"))},hide:function(){this.progress.is()&&this.progress.$box.redactorAnimation("fadeOut",{duration:.35},f.proxy(this.progress.destroy,this))},update:function(e){this.progress.show(),this.progress.$bar.css("width",e+"%")},is:function(){return null!==this.progress.$box},build:function(){this.progress.$bar=f("<span />"),this.progress.$box=f('<div id="redactor-progress" />'),this.progress.$box.append(this.progress.$bar),f(this.progress.target).append(this.progress.$box)},destroy:function(){this.progress.is()&&this.progress.$box.remove(),this.progress.$box=null,this.progress.$bar=null}}},selection:function(){return{get:function(){return window.getSelection?window.getSelection():document.selection&&"Control"!==document.selection.type?document.selection:null},range:function(e){return void 0===e&&(e=this.selection.get()),e.getRangeAt&&e.rangeCount?e.getRangeAt(0):null},is:function(){return!this.selection.isCollapsed()},isRedactor:function(){var e=this.selection.range();if(null!==e){var t=e.startContainer.parentNode;if(f(t).hasClass("redactor-in")||0!==f(t).parents(".redactor-in").length)return!0}return!1},isCollapsed:function(){var e=this.selection.get();return null!==e&&e.isCollapsed},update:function(e,t){null!==t&&(e.removeAllRanges(),e.addRange(t))},current:function(){var e=this.selection.get();return null!==e&&e.anchorNode},parent:function(){var e=this.selection.current();return null!==e&&e.parentNode},block:function(e){for(e=e||this.selection.current();e;){if(this.utils.isBlockTag(e.tagName))return!f(e).hasClass("redactor-in")&&e;e=e.parentNode}return!1},inline:function(e){for(e=e||this.selection.current();e;){if(this.utils.isInlineTag(e.tagName))return!f(e).hasClass("redactor-in")&&e;e=e.parentNode}return!1},element:function(e){for(e||(e=this.selection.current());e;){if(1===e.nodeType)return!f(e).hasClass("redactor-in")&&e;e=e.parentNode}return!1},prev:function(){return null!==this.selection.current()&&this.selection.current().previousSibling},next:function(){return null!==this.selection.current()&&this.selection.current().nextSibling},blocks:function(e){var i=[],t=this.selection.nodes(e);f.each(t,f.proxy(function(e,t){this.utils.isBlock(t)&&i.push(t)},this));var r=this.selection.block();return 0===i.length&&!1===r?[]:0===i.length&&!1!==r?[r]:i},inlines:function(e){var i=[],t=this.selection.nodes(e);f.each(t,f.proxy(function(e,t){this.utils.isInline(t)&&i.push(t)},this));var r=this.selection.inline();return 0===i.length&&!1===r?[]:0===i.length&&!1!==r?[r]:i},nodes:function(e){var r=void 0===e?[]:f.isArray(e)?e:[e],t=this.selection.get(),i=this.selection.range(t),n=[],o=[];if(
this.utils.isCollapsed())n=[this.selection.current()];else{var a=i.startContainer,s=i.endContainer;if(a===s)return[this.selection.parent()];for(;a&&a!==s;)n.push(a=this.selection.nextNode(a));for(a=i.startContainer;a&&a!==i.commonAncestorContainer;)n.unshift(a),a=a.parentNode}return f.each(n,function(e,t){if(t){var i=1===t.nodeType&&t.tagName.toLowerCase();if(f(t).hasClass("redactor-script-tag")||f(t).hasClass("redactor-selection-marker"))return;if(i&&0!==r.length&&-1===f.inArray(i,r))return;o.push(t)}}),0===o.length?[]:o},nextNode:function(e){if(e.hasChildNodes())return e.firstChild;for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null},save:function(){this.marker.insert(),this.savedSel=this.core.editor().html()},restore:function(e){var t=this.marker.find(1),i=this.marker.find(2);this.detect.isFirefox()&&this.core.editor().focus(),0!==t.length&&0!==i.length?this.caret.set(t,i):0!==t.length?this.caret.start(t):this.core.editor().focus(),!1!==e&&(this.marker.remove(),this.savedSel=!1)},saveInstant:function(){var e=this.core.editor()[0],t=e.ownerDocument.defaultView.getSelection();if(t.getRangeAt&&t.rangeCount){var i=t.getRangeAt(0),r=i.cloneRange();r.selectNodeContents(e),r.setEnd(i.startContainer,i.startOffset);var n=r.toString().length;return this.saved={start:n,end:n+i.toString().length,node:i.startContainer},this.saved}},restoreInstant:function(e){if(void 0!==e||this.saved){this.saved=void 0!==e?e:this.saved;var t=this.core.editor().find(this.saved.node);if(0===t.length||0!==t.text().trim().replace(/\u200B/g,"").length){var i=this.core.editor()[0],r=i.ownerDocument,n=r.defaultView,o=0,a=r.createRange();a.setStart(i,0),a.collapse(!0);for(var s,l=[i],c=!1,d=!1;!d&&(s=l.pop());)if(3==s.nodeType){var u=o+s.length;!c&&this.saved.start>=o&&this.saved.start<=u&&(a.setStart(s,this.saved.start-o),c=!0),c&&this.saved.end>=o&&this.saved.end<=u&&(a.setEnd(s,this.saved.end-o),d=!0),o=u}else for(var h=s.childNodes.length;h--;)l.push(s.childNodes[h]);var p=n.getSelection();p.removeAllRanges(),p.addRange(a)}else try{(a=document.createRange()).setStart(t[0],0),(p=window.getSelection()).removeAllRanges(),p.addRange(a)}catch(e){}}},node:function(e){f(e).prepend(this.marker.get(1)),f(e).append(this.marker.get(2)),this.selection.restore()},all:function(){this.core.editor().focus();var e=this.selection.get(),t=this.selection.range(e);t.selectNodeContents(this.core.editor()[0]),this.selection.update(e,t)},remove:function(){this.selection.get().removeAllRanges()},replace:function(e){this.insert.html(e)},text:function(){return this.selection.get().toString()},html:function(){var e="",t=this.selection.get();if(t.rangeCount){for(var i=document.createElement("div"),r=t.rangeCount,n=0;n<r;++n)i.appendChild(t.getRangeAt(n).cloneContents());e=this.clean.onGet(i.innerHTML)}return e},extractEndOfNode:function(e){var t=this.selection.get(),i=this.selection.range(t),r=i.cloneRange();return r.selectNodeContents(e),r.setStart(i.endContainer,i.endOffset),r.extractContents()},removeMarkers:function(){this.marker.remove()},marker:function(e){return this.marker.get(e)},markerHtml:function(e){return this.marker.html(e)}}},shortcuts:function(){return{hotkeysSpecialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},hotkeysShiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},init:function(i,e){if(!1===this.opts.shortcuts)return!i.ctrlKey&&!i.metaKey||66!==e&&73!==e||i.preventDefault(),!1;f.each(this.opts.shortcuts,f.proxy(function(e,t){this.shortcuts.build(i,e,t)},this))},build:function(e,t,i){for(var r=f.proxy(function(){this.shortcuts.buildHandler(i)},this),n=t.split(","),o=n.length,a=0;a<o;a++)"string"==typeof n[a]&&this.shortcuts.handler(e,f.trim(n[a]),r)},buildHandler:function(e){var t;"-1"!==e.func.search(/\./)?void 0!==this[(t=e.func.split("."))[0]]&&this[t[0]][t[1]].apply(this,e.params):this[e.func].apply(this,e.params)},handler:function(i,e,t){e=e.toLowerCase().split(" ");var r=this.shortcuts.hotkeysSpecialKeys[i.keyCode],n=String.fromCharCode(i.which).toLowerCase(),o="",a={};f.each(["alt","ctrl","meta","shift"],function(e,t){i[t+"Key"]&&r!==t&&(o+=t+"+")}),r&&(a[o+r]=!0),n&&(a[o+n]=!0,a[o+this.shortcuts.hotkeysShiftNums[n]]=!0,"shift+"===o&&(a[this.shortcuts.hotkeysShiftNums[n]]=!0));for(var s=e.length,l=0;l<s;l++)if(a[e[l]])return i.preventDefault(),t.apply(this,arguments)}}},storage:function(){return{data:[],add:function(e){e.status=!0,e.url=decodeURI(e.url),this.storage.data[e.url]=e},status:function(e,t){this.storage.data[decodeURI(e)].status=t},observe:function(){var r=this;this.core.editor().find("[data-image]").each(function(e,t){r.storage.add({type:"image",node:t,url:t.src,id:f(t).attr("data-image")})}),this.core.editor().find("[data-file]").each(function(e,t){r.storage.add({type:"file",node:t,url:t.href,id:f(t).attr("data-file")})}),this.core.editor().find("[data-s3]").each(function(e,t){var i="IMG"===t.tagName?t.src:t.href;r.storage.add({type:"s3",node:t,url:i,id:f(t).attr("data-s3")})})},changes:function(){for(var e in this.storage.data){var t=this.storage.data[e],i="IMG"===t.node.tagName?"src":"href";0===this.core.editor().find("[data-"+t.type+"]["+i+'="'+t.url+'"]').length?this.storage.status(t.url,!1):this.storage.status(t.url,!0)}return this.storage.data}}},toolbar:function(){return{build:function(){this.button.hideButtons(),this.button.hideButtonsOnMobile(),this.$toolbar=this.toolbar.createContainer(),this.toolbar.append(),this.button.$toolbar=this.$toolbar,this.button.setFormatting(),this.button.load(this.$toolbar),this.toolbar.setOverflow(),this.toolbar.setFixed()},createContainer:function(){return f("<ul>").addClass("redactor-toolbar").attr({id:"redactor-toolbar-"+this.uuid,role:"toolbar"})},append:function(){this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),f(this.opts.toolbarExternal).html(this.$toolbar)):"textarea"===this.opts.type?this.$box.prepend(this.$toolbar):this.$element.before(this.$toolbar)},setOverflow:function(){this.opts.toolbarOverflow&&this.$toolbar.addClass("redactor-toolbar-overflow")},setFixed:function(){if(this.opts.toolbarFixed&&!this.opts.toolbarExternal){if(this.opts.toolbarFixedTarget!==document){var e=f(this.opts.toolbarFixedTarget);this.toolbar.toolbarOffsetTop=0===e.length?0:this.core.box().offset().top-e.offset().top}var t=0!==this.core.box().closest(".modal-body").length?1e3:0;setTimeout(f.proxy(function(){var e=this;this.toolbar.observeScroll(!1),this.detect.isDesktop()?f(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,function(){e.core.editor().height()<100||e.placeholder.isEditorEmpty()||e.toolbar.observeScroll()}):f(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,function(){e.core.editor().height()<100||e.placeholder.isEditorEmpty()||(e.core.toolbar().hide(),clearTimeout(f.data(this,"scrollCheck")),f.data(this,"scrollCheck",setTimeout(function(){e.core.toolbar().show(),e.toolbar.observeScroll()},250)))})},this),t)}},setUnfixed:function(){this.toolbar.observeScrollDisable()},getBoxTop:function(){return this.opts.toolbarFixedTarget===document?this.core.box().offset().top:this.toolbar.toolbarOffsetTop},observeScroll:function(e){var t=0;!1!==e&&(t=this.opts.toolbarFixedTarget===document?20:0);var i=f(this.opts.toolbarFixedTarget).scrollTop(),r=this.toolbar.getBoxTop();i!==r&&(i+this.opts.toolbarFixedTopOffset+t>r?this.toolbar.observeScrollEnable(i,r):this.toolbar.observeScrollDisable())},observeScrollResize:function(){this.$toolbar.css({width:this.core.box().innerWidth(),left:this.core.box().offset().left})},observeScrollEnable:function(e,t){if(void 0===this.fullscreen||!1!==this.fullscreen.isOpened){var i=t+this.core.box().outerHeight()-32,r=this.core.box().innerWidth(),n=this.detect.isDesktop()?"fixed":"absolute",o=this.detect.isDesktop()?this.opts.toolbarFixedTopOffset:f(this.opts.toolbarFixedTarget).scrollTop()-t+this.opts.toolbarFixedTopOffset,a=this.detect.isDesktop()?this.core.box().offset().left:0;this.opts.toolbarFixedTarget!==document&&(n="absolute",o=this.opts.toolbarFixedTopOffset+f(this.opts.toolbarFixedTarget).scrollTop()-t,a=0),this.$toolbar.addClass("toolbar-fixed-box"),this.$toolbar.css({position:n,width:r,top:o,left:a}),i<e&&f(".redactor-dropdown-"+this.uuid+":visible").hide(),this.toolbar.setDropdownsFixed(),this.$toolbar.css("visibility",e<i?"visible":"hidden"),f(window).on("resize.redactor-toolbar."+this.uuid,f.proxy(this.toolbar.observeScrollResize,this))}else this.toolbar.observeScrollDisable()},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"}),this.toolbar.unsetDropdownsFixed(),this.$toolbar.removeClass("toolbar-fixed-box"),f(window).off("resize.redactor-toolbar."+this.uuid)},setDropdownsFixed:function(){var e=this.opts.toolbarFixedTarget===document&&this.detect.isDesktop()?"fixed":"absolute";this.toolbar.setDropdownPosition(e)},unsetDropdownsFixed:function(){this.toolbar.setDropdownPosition("absolute")},setDropdownPosition:function(r){var n=this;f(".redactor-dropdown-"+this.uuid).each(function(){var e=f(this),t=n.button.get(e.attr("rel")),i="fixed"===r?n.opts.toolbarFixedTopOffset:t.offset().top;e.css({position:r,top:t.innerHeight()+i+"px"})})}}},upload:function(){return{init:function(e,t,i){this.upload.direct=!1,this.upload.callback=i,this.upload.url=t,this.upload.$el=f(e),this.upload.$droparea=f('<div id="redactor-droparea" />'),this.upload.$placeholdler=f('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload-label")),this.upload.$input=f('<input type="file" name="file" multiple />'),this.upload.$placeholdler.append(this.upload.$input),this.upload.$droparea.append(this.upload.$placeholdler),this.upload.$el.append(this.upload.$droparea),this.upload.$droparea.off("redactor.upload"),this.upload.$input.off("redactor.upload"),this.upload.$droparea.on("dragover.redactor.upload",f.proxy(this.upload.onDrag,this)),this.upload.$droparea.on("dragleave.redactor.upload",f.proxy(this.upload.onDragLeave,this)),this.upload.$input.on("change.redactor.upload",f.proxy(function(e){e=e.originalEvent||e;for(var t=this.upload.$input[0].files.length,i=0;i<t;i++){var r=t-1-i;this.upload.traverseFile(this.upload.$input[0].files[r],e)}},this)),this.upload.$droparea.on("drop.redactor.upload",f.proxy(function(e){e.preventDefault(),this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop"),this.upload.onDrop(e)},this))},directUpload:function(e,t){this.upload.direct=!0,this.upload.traverseFile(e,t)},onDrop:function(e){var t=(e=e.originalEvent||e).dataTransfer.files;if(this.opts.multipleImageUpload)for(var i=t.length,r=0;r<i;r++)this.upload.traverseFile(t[r],e);else this.upload.traverseFile(t[0],e)},traverseFile:function(e,t){if(this.opts.s3)return this.upload.setConfig(e),void this.uploads3.send(e,t);var i=window.FormData?new FormData:null;if(window.FormData){this.upload.setConfig(e);var r="image"===this.upload.type?this.opts.imageUploadParam:this.opts.fileUploadParam;i.append(r,e)}this.progress.show(),!1!==this.core.callback("uploadStart",t,i)&&this.upload.send(i,t)},setConfig:function(e){this.upload.getType(e),this.upload.direct&&(this.upload.url="image"===this.upload.type?this.opts.imageUpload:this.opts.fileUpload,this.upload.callback="image"===this.upload.type?this.image.insert:this.file.insert)},getType:function(e){this.upload.type=-1===this.opts.imageTypes.indexOf(e.type)?"file":"image",null===this.opts.imageUpload&&null!==this.opts.fileUpload&&(this.upload.type="file")},getHiddenFields:function(e,i){return!1===e||"object"!=typeof e||f.each(e,f.proxy(function(e,t){null!==t&&0===t.toString().indexOf("#")&&(t=f(t).val()),i.append(e,t)},this)),i},send:function(e,i){e="image"===this.upload.type?(e=this.utils.appendFields(this.opts.imageUploadFields,e),e=this.utils.appendForms(this.opts.imageUploadForms,e),this.upload.getHiddenFields(this.upload.imageFields,e)):(e=this.utils.appendFields(this.opts.fileUploadFields,e),e=this.utils.appendForms(this.opts.fileUploadForms,e),this.upload.getHiddenFields(this.upload.fileFields,e));var r=new XMLHttpRequest;r.open("POST",this.upload.url),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.onreadystatechange=f.proxy(function(){if(4===r.readyState){var e,t=r.responseText;t=(t=t.replace(/^\[/,"")).replace(/\]$/,"");try{e="string"==typeof t?JSON.parse(t):t}catch(t){e={error:!0}}this.progress.hide(),this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),this.upload.callback(e,this.upload.direct,i)}},this),!1!==this.core.callback("uploadBeforeSend",r)&&r.send(e)},onDrag:function(e){e.preventDefault(),this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(e){e.preventDefault(),this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(e,t){this.upload.imageFields[e]=t},removeImageFields:function(e){delete this.upload.imageFields[e]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(e,t){this.upload.fileFields[e]=t},removeFileFields:function(e){delete this.upload.fileFields[e]}}},uploads3:function(){return{send:function(t,i){this.uploads3.executeOnSignedUrl(t,f.proxy(function(e){this.uploads3.sendToS3(t,e,i)},this))},executeOnSignedUrl:function(e,t){var i=new XMLHttpRequest,r=-1===this.opts.s3.search(/\?/)?"?":"&";i.open("GET",this.opts.s3+r+"name="+e.name+"&type="+e.type,!0),i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined");var n=this;i.onreadystatechange=function(){4===this.readyState&&200===this.status&&(n.progress.show(),t(decodeURIComponent(this.responseText)))},i.send()},createCORSRequest:function(e,t){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(e,t,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest).open(e,t):i=null,i},sendToS3:function(e,r,n){var o=this.uploads3.createCORSRequest("PUT",r);o&&(o.onload=f.proxy(function(){var e;if(this.progress.hide(),200!==o.status)return e={error:!0},void this.upload.callback(e,this.upload.direct,o);var t=r.split("?");if(!t[0])return!1;if(this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),e={url:t[0],id:t[0],s3:!0},"file"===this.upload.type){var i=t[0].split("/");e.name=i[i.length-1]}this.upload.callback(e,this.upload.direct,n)},this),o.onerror=function(){},o.upload.onprogress=function(){},o.setRequestHeader("Content-Type",e.type),o.setRequestHeader("x-amz-acl","public-read"),o.send(e))}}},utils:function(){return{isEmpty:function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=void 0===e?this.core.editor().html():e).replace(/[\u200B-\u200D\uFEFF]/g,"")).replace(/&nbsp;/gi,"")).replace(/<\/?br\s?\/?>/g,"")).replace(/\s/g,"")).replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,"")).replace(/<iframe(.*?[^>])>$/i,"iframe")).replace(/<source(.*?[^>])>$/i,"source")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")).replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),""===f.trim(e)},isElement:function(e){try{return e instanceof HTMLElement}catch(l){return"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument}},strpos:function(e,t,i){var r=e.indexOf(t,i);return 0<=r&&r},dataURItoBlob:function(e){var t;t=0<=e.split(",")[0].indexOf("base64")?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var i=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return new Blob([r],{type:i})},getOuterHtml:function(e){return f("<div>").append(f(e).eq(0).clone()).html()},cloneAttributes:function(e,t){e=e[0]||e,t=f(t);for(var i=e.attributes,r=i.length;r--;){var n=i[r];t.attr(n.name,n.value)}return t},breakBlockTag:function(){var e=this.selection.block();if(!e)return!1;var t=this.utils.isEmpty(e.innerHTML),i=e.tagName.toLowerCase();if("pre"===i||"li"===i||"td"===i||"th"===i)return!1;if(!t&&this.utils.isStartOfElement(e))return{$block:f(e),$next:f(e).next(),type:"start"};if(!t&&this.utils.isEndOfElement(e))return{$block:f(e),$next:f(e).next(),type:"end"};var r=this.selection.extractEndOfNode(e),n=f("<"+i+" />").append(r);return n=this.utils.cloneAttributes(e,n),f(e).after(n),{$block:f(e),$next:n,type:"break"}},inBlocks:function(e){e=f.isArray(e)?e:[e];for(var t=this.selection.blocks(),i=t.length,r=!1,n=0;n<i;n++)if(!1!==t[n]){var o=t[n].tagName.toLowerCase();-1!==f.inArray(o,e)&&(r=!0)}return r},inInlines:function(e){e=f.isArray(e)?e:[e];for(var t=this.selection.inlines(),i=t.length,r=!1,n=0;n<i;n++){var o=t[n].tagName.toLowerCase();-1!==f.inArray(o,e)&&(r=!0)}return r},isTag:function(e,t){var i=f(e).closest(t,this.core.editor()[0]);return 1===i.length&&i[0]},isBlock:function(e){return null!==e&&(e=e[0]||e)&&this.utils.isBlockTag(e.tagName)},isBlockTag:function(e){return void 0!==e&&this.reIsBlock.test(e)},isInline:function(e){return(e=e[0]||e)&&this.utils.isInlineTag(e.tagName)},isInlineTag:function(e){return void 0!==e&&this.reIsInline.test(e)},isRedactorParent:function(e){return!!e&&0!==f(e).parents(".redactor-in").length&&!f(e).hasClass("redactor-in")&&e},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(e){var i=this.selection.parent(),r=this.selection.current();if(f.isArray(e)){var n=0;return f.each(e,f.proxy(function(e,t){this.utils.isCurrentOrParentOne(r,i,t)&&n++},this)),0!==n}return this.utils.isCurrentOrParentOne(r,i,e)},isCurrentOrParentOne:function(e,t,i){return i=i.toUpperCase(),t&&t.tagName===i?t:!(!e||e.tagName!==i)&&e},isEditorRelative:function(){var e=this.core.editor().css("position"),t=["absolute","fixed","relative"];return-1!==f.inArray(t,e)},setEditorRelative:function(){this.core.editor().addClass("redactor-relative")},getScrollTarget:function(){var e=f(this.opts.scrollTarget);return 0!==e.length?e:f(document)},freezeScroll:function(){this.freezeScrollTop=this.utils.getScrollTarget().scrollTop(),this.utils.getScrollTarget().scrollTop(this.freezeScrollTop)},unfreezeScroll:function(){void 0!==this.freezeScrollTop&&this.utils.getScrollTarget().scrollTop(this.freezeScrollTop)},saveScroll:function(){this.tmpScrollTop=this.utils.getScrollTarget().scrollTop()},restoreScroll:function(){void 0!==this.tmpScrollTop&&this.utils.getScrollTarget().scrollTop(this.tmpScrollTop)},isStartOfElement:function(e){return!(void 0===e&&!(e=this.selection.block()))&&0===this.offset.get(e)},isEndOfElement:function(e){if(void 0===e&&!(e=this.selection.block()))return!1;var t=f.trim(f(e).text()).replace(/[\t\n\r\n]/g,"").replace(/\u200B/g,"");return this.offset.get(e)===t.length},removeEmptyAttr:function(e,t){var i=f(e);return void 0===i.attr(t)||""===i.attr(t)&&(i.removeAttr(t),!0)},replaceToTag:function(e,t){var i;return f(e).replaceWith(function(){i=f("<"+t+" />").append(f(this).contents());for(var e=0;e<this.attributes.length;e++)i.attr(this.attributes[e].name,this.attributes[e].value);return i}),i},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=!0},disableSelectAll:function(){this.selectAll=!1},disableBodyScroll:function(){var e=f("html"),t=window.innerWidth;if(!t){var i=document.documentElement.getBoundingClientRect();t=i.right-Math.abs(i.left)}var r=document.body.clientWidth<t,n=this.utils.measureScrollbar();e.css("overflow","hidden"),r&&e.css("padding-right",n)},measureScrollbar:function(){var e=f("body"),t=document.createElement("div");t.className="redactor-scrollbar-measure",e.append(t);var i=t.offsetWidth-t.clientWidth;return e[0].removeChild(t),i},enableBodyScroll:function(){f("html").css({overflow:"","padding-right":""}),f("body").remove("redactor-scrollbar-measure")},appendFields:function(e,i){if(!e)return i;if("object"==typeof e)return f.each(e,function(e,t){null!==t&&0===t.toString().indexOf("#")&&(t=f(t).val()),i.append(e,t)}),i;var t=f(e);return 0===t.length||t.each(function(){i.append(f(this).attr("name"),f(this).val())}),i},appendForms:function(e,i){if(!e)return i;var t=f(e);if(0===t.length)return i;var r=t.serializeArray();return f.each(r,function(e,t){i.append(t.name,t.value)}),i},isRgb:function(e){return 0===e.search(/^rgb/i)},rgb2hex:function(e){return(e=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i))&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):""},isCollapsed:function(){return this.selection.isCollapsed()},isMobile:function(){return this.detect.isMobile()},isDesktop:function(){return this.detect.isDesktop()},isPad:function(){return this.detect.isIpad()}}},browser:function(){return{webkit:function(){return this.detect.isWebkit()},ff:function(){return this.detect.isFirefox()},ie:function(){return this.detect.isIe()}}}},f(window).on("load.tools.redactor",function(){f('[data-tools="redactor"]').redactor()}),l.prototype.init.prototype=l.prototype}(jQuery),function(o){function r(e,t,i,r){var n={duration:.5,iterate:1,delay:0,prefix:"redactor-",timing:"linear"};this.animation=t,this.slide="slideDown"===this.animation||"slideUp"===this.animation,this.$element=o(e),this.prefixes=["","-moz-","-o-animation-","-webkit-"],this.queue=[],this.opts="function"==typeof i?(r=i,n):o.extend(n,i),this.slide&&this.$element.height(this.$element.height()),this.init(r)}o.fn.redactorAnimation=function(e,t,i){return this.each(function(){new r(this,e,t,i)})},r.prototype={init:function(e){this.queue.push(this.animation),this.clean(),"show"===this.animation?(this.opts.timing="linear",this.$element.removeClass("hide").show(),"function"==typeof e&&e(this)):"hide"===this.animation?(this.opts.timing="linear",this.$element.hide(),"function"==typeof e&&e(this)):this.animate(e)},animate:function(e){this.$element.addClass("redactor-animated").css("display","").removeClass("hide"),this.$element.addClass(this.opts.prefix+this.queue[0]),this.set(this.opts.duration+"s",this.opts.delay+"s",this.opts.iterate,this.opts.timing);var t=1<this.queue.length?null:e;this.complete("AnimationEnd",o.proxy(function(){this.$element.hasClass(this.opts.prefix+this.queue[0])&&(this.clean(),this.queue.shift(),this.queue.length&&this.animate(e))},this),t)},set:function(e,t,i,r){for(var n=this.prefixes.length;n--;)this.$element.css(this.prefixes[n]+"animation-duration",e),this.$element.css(this.prefixes[n]+"animation-delay",t),this.$element.css(this.prefixes[n]+"animation-iteration-count",i),this.$element.css(this.prefixes[n]+"animation-timing-function",r)},clean:function(){this.$element.removeClass("redactor-animated"),this.$element.removeClass(this.opts.prefix+this.queue[0]),this.set("","","","")},complete:function(e,t,i){this.$element.one(e.toLowerCase()+" webkit"+e+" o"+e+" MS"+e,o.proxy(function(){"function"==typeof t&&t(),"function"==typeof i&&i(this);var e=["fadeOut","slideUp","zoomOut","slideOutUp","slideOutRight","slideOutLeft"];-1!==o.inArray(this.animation,e)&&this.$element.css("display","none"),this.slide&&this.$element.css("height","")},this))}}}(jQuery),jQuery.Redactor.prototype.alignment=function(){return{langs:{en:{align:"Align","align-left":"Align Left","align-center":"Align Center","align-right":"Align Right","align-justify":"Align Justify"}},init:function(){var e=this,t={};t.left={title:e.lang.get("align-left"),func:e.alignment.setLeft},t.center={title:e.lang.get("align-center"),func:e.alignment.setCenter},t.right={title:e.lang.get("align-right"),func:e.alignment.setRight},t.justify={title:e.lang.get("align-justify"),func:e.alignment.setJustify};var i=this.button.add("alignment",this.lang.get("align"));this.button.setIcon(i,'<i class="re-icon-alignment"></i>'),this.button.addDropdown(i,t)},removeAlign:function(){this.block.removeClass("text-center"),this.block.removeClass("text-right")},setLeft:function(){this.buffer.set(),this.alignment.removeAlign()},setCenter:function(){this.buffer.set(),this.alignment.removeAlign(),this.block.addClass("text-center")},setRight:function(){this.buffer.set(),this.alignment.removeAlign(),this.block.addClass("text-right")},setJustify:function(){this.buffer.set(),this.alignment.removeAlign(),this.block.addClass("text-justify")}}},function(o){o.Redactor.prototype.filemanager=function(){return{langs:{en:{upload:"Upload",choose:"Choose"}},init:function(){this.opts.fileManagerJson&&this.modal.addCallback("file",this.filemanager.load)},load:function(){var t=o('<div  style="overflow: auto; height: 300px; display: none;" class="redactor-modal-tab" data-title="Choose">').hide();this.modal.getModal().append(t),o.ajax({dataType:"json",cache:!1,url:this.opts.fileManagerJson,success:o.proxy(function(e){var n=o('<ul id="redactor-modal-list">');o.each(e,o.proxy(function(e,t){var i=o('<a href="#" data-params="'+encodeURI(JSON.stringify(t))+'" class="redactor-file-manager-link">'+t.title+' <span style="font-size: 11px; color: #888;">'+t.name+'</span> <span style="position: absolute; right: 10px; font-size: 11px; color: #888;">('+t.size+")</span></a>"),r=o("<li />");i.on("click",o.proxy(this.filemanager.insert,this)),r.append(i),n.append(r)},this)),t.append(n)},this)})},insert:function(e){e.preventDefault();var t=o(e.target).closest(".redactor-file-manager-link"),i=o.parseJSON(decodeURI(t.attr("data-params")));this.file.insert(i,null)}}}}(jQuery),function(n){n.Redactor.prototype.imagemanager=function(){return{langs:{en:{upload:"Upload",choose:"Choose"}},init:function(){this.opts.imageManagerJson&&this.modal.addCallback("image",this.imagemanager.load)},load:function(){var r=n('<div style="overflow: auto; height: 300px; display: none;" class="redactor-modal-tab" data-title="Choose">');this.modal.getModal().append(r),n.ajax({dataType:"json",cache:!1,url:this.opts.imageManagerJson,success:n.proxy(function(e){n.each(e,n.proxy(function(e,t){"undefined"!=typeof t.title&&t.title;var i=n('<img src="'+t.thumb+'"  data-params="'+encodeURI(JSON.stringify(t))+'" style="width: 100px; height: 75px; cursor: pointer;" />');r.append(i),n(i).click(n.proxy(this.imagemanager.insert,this))},this))},this)})},insert:function(e){var t=n(e.target),i=n.parseJSON(decodeURI(t.attr("data-params")));this.image.insert(i,null)}}}}(jQuery),function(d){d.Redactor.prototype.table=function(){return{langs:{en:{table:"Table","insert-table":"Insert table","insert-row-above":"Insert row above","insert-row-below":"Insert row below","insert-column-left":"Insert column left","insert-column-right":"Insert column right","add-head":"Add head","delete-head":"Delete head","delete-column":"Delete column","delete-row":"Delete row","delete-table":"Delete table"}},init:function(){var e={};e.insert_table={title:this.lang.get("insert-table"),func:this.table.insert,observe:{element:"table","in":{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.insert_row_above={title:this.lang.get("insert-row-above"),func:this.table.addRowAbove,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.insert_row_below={title:this.lang.get("insert-row-below"),func:this.table.addRowBelow,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.insert_column_left={title:this.lang.get("insert-column-left"),func:this.table.addColumnLeft,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.insert_column_right={title:this.lang.get("insert-column-right"),func:this.table.addColumnRight,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.add_head={title:this.lang.get("add-head"),func:this.table.addHead,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.delete_head={title:this.lang.get("delete-head"),func:this.table.deleteHead,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.delete_column={title:this.lang.get("delete-column"),func:this.table.deleteColumn,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.delete_row={title:this.lang.get("delete-row"),func:this.table.deleteRow,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}},e.delete_table={title:this.lang.get("delete-table"),func:this.table.deleteTable,observe:{element:"table",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}};var t=this.button.addBefore("link","table",this.lang.get("table"));this.button.setIcon(t,'<i class="re-icon-table"></i>'),this.button.addDropdown(t,e)},insert:function(){if(!this.table.getTable()){this.placeholder.hide();for(var e=2,t=3,i=d("<div>"),r=d("<table />"),n=0;n<e;n++){for(var o=d("<tr>"),a=0;a<t;a++){var s=d("<td>"+this.opts.invisibleSpace+"</td>");0===n&&0===a&&s.append(this.marker.get()),d(o).append(s)}r.append(o)}i.append(r);var l=i.html();this.buffer.set();var c=this.selection.current();0!==d(c).closest("li",this.core.editor()[0]).length?d(c).closest("ul, ol").first().after(l):(this.air.collapsed(),this.insert.html(l)),this.selection.restore(),this.core.callback("insertedTable",r)}},getTable:function(){var e=d(this.selection.current()).closest("table");return!!this.utils.isRedactorParent(e)&&(0!==e.length&&e)},restoreAfterDelete:function(e){this.selection.restore(),e.find("span.redactor-selection-marker").remove()},deleteTable:function(){var e=this.table.getTable();if(e){this.buffer.set();var t=e.next();this.opts.linebreaks||0===t.length?this.caret.after(e):this.caret.start(t),e.remove()}},deleteRow:function(){var e=this.table.getTable();if(e){var t=d(this.selection.current());this.buffer.set();var i=t.closest("tr"),r=i.prev().length?i.prev():i.next();if(r.length){var n=r.children("td, th").first();n.length&&n.prepend(this.marker.get())}i.remove(),this.table.restoreAfterDelete(e)}},deleteColumn:function(){var e=this.table.getTable();if(e){this.buffer.set();var n=d(this.selection.current()).closest("td, th")[0].cellIndex;e.find("tr").each(d.proxy(function(e,t){var i=d(t),r=n-1<0?n+1:n-1;0===e&&i.find("td, th").eq(r).prepend(this.marker.get()),i.find("td, th").eq(n).remove()},this)),this.table.restoreAfterDelete(e)}},addHead:function(){var e=this.table.getTable();if(e)if(this.buffer.set(),0===e.find("thead").length){var t=e.find("tr").first().clone();t.find("td").replaceWith(d.proxy(function(){return d("<th>").html(this.opts.invisibleSpace)},this)),$thead=d("<thead></thead>").append(t),e.prepend($thead)}else this.table.deleteHead()},deleteHead:function(){var e=this.table.getTable();if(e){var t=e.find("thead");0!==t.length&&(this.buffer.set(),t.remove())}},addRowAbove:function(){this.table.addRow("before")},addRowBelow:function(){this.table.addRow("after")},addColumnLeft:function(){this.table.addColumn("before")},addColumnRight:function(){this.table.addColumn("after")},addRow:function(e){if(this.table.getTable()){this.buffer.set();var t=d(this.selection.current()).closest("tr"),i=t.clone();i.find("th").replaceWith(function(){var e=d("<td>");return e[0].attributes=this.attributes,e.append(d(this).contents())}),i.find("td").html(this.opts.invisibleSpace),"after"===e?t.after(i):t.before(i)}},addColumn:function(n){var e=this.table.getTable();if(e){var o=0,t=d(this.selection.current());this.buffer.set();var i=t.closest("tr"),r=t.closest("td, th");i.find("td, th").each(d.proxy(function(e,t){d(t)[0]===r[0]&&(o=e)},this)),e.find("tr").each(d.proxy(function(e,t){var i=d(t).find("td, th").eq(o),r=i.clone();r.html(this.opts.invisibleSpace),"after"===n?i.after(r):i.before(r)},this))}}}}}(jQuery),function(r){r.Redactor.prototype.video=function(){return{reUrlYoutube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,reUrlVimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,langs:{en:{video:"Video","video-html-code":"Video Embed Code or Youtube/Vimeo Link"}},getTemplate:function(){return String()+'<div class="modal-section" id="redactor-modal-video-insert"><section><label>'+this.lang.get("video-html-code"
)+'</label><textarea id="redactor-insert-video-area" style="height: 160px;"></textarea></section><section><button id="redactor-modal-button-action">Insert</button><button id="redactor-modal-button-cancel">Cancel</button></section></div>'},init:function(){var e=this.button.addAfter("image","video",this.lang.get("video"));this.button.setIcon(e,'<i class="re-icon-video"></i>'),this.button.addCallback(e,this.video.show)},show:function(){this.modal.addTemplate("video",this.video.getTemplate()),this.modal.load("video",this.lang.get("video"),700),this.modal.getActionButton().text(this.lang.get("insert")).on("click",this.video.insert),this.modal.show(),this.detect.isDesktop()&&setTimeout(function(){r("#redactor-insert-video-area").focus()},1)},insert:function(){var e=r("#redactor-insert-video-area").val();if(!e.match(/<iframe|<video/gi)){e=this.clean.stripTags(e),this.opts.videoContainerClass="undefined"==typeof this.opts.videoContainerClass?"video-container":this.opts.videoContainerClass;var t='<div class="'+this.opts.videoContainerClass+'"><iframe style="width: 500px; height: 281px;" src="',i='" frameborder="0" allowfullscreen></iframe></div>';e.match(this.video.reUrlYoutube)?e=e.replace(this.video.reUrlYoutube,t+"//www.youtube.com/embed/$1"+i):e.match(this.video.reUrlVimeo)&&(e=e.replace(this.video.reUrlVimeo,t+"//player.vimeo.com/video/$2"+i))}this.modal.close(),this.placeholder.hide(),this.buffer.set(),this.air.collapsed(),this.insert.html(e)}}}}(jQuery),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.CodeMirror=t()}(this,function(){"use strict";function s(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}function f(e){for(var t=e.childNodes.length;0<t;--t)e.removeChild(e.firstChild);return e}function o(e,t){return f(e).appendChild(t)}function w(e,t,i,r){var n=document.createElement(e);if(i&&(n.className=i),r&&(n.style.cssText=r),"string"==typeof t)n.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)n.appendChild(t[o]);return n}function u(e,t,i,r){var n=w(e,t,i,r);return n.setAttribute("role","presentation"),n}function g(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if(11==t.nodeType&&(t=t.host),t==e)return!0}while(t=t.parentNode)}function h(){var e;try{e=document.activeElement}catch(t){e=document.body||null}for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}function r(e,t){var i=e.className;s(t).test(i)||(e.className+=(i?" ":"")+t)}function l(e,t){for(var i=e.split(" "),r=0;r<i.length;r++)i[r]&&!s(i[r]).test(t)&&(t+=" "+i[r]);return t}function c(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function p(e,t,i){for(var r in t||(t={}),e)!e.hasOwnProperty(r)||!1===i&&t.hasOwnProperty(r)||(t[r]=e[r]);return t}function C(e,t,i,r,n){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var o=r||0,a=n||0;;){var s=e.indexOf("\t",o);if(s<0||t<=s)return a+(t-o);a+=s-o,a+=i-a%i,o=s+1}}function m(e,t){for(var i=0;i<e.length;++i)if(e[i]==t)return i;return-1}function T(e,t,i){for(var r=0,n=0;;){var o=e.indexOf("\t",r);-1==o&&(o=e.length);var a=o-r;if(o==e.length||t<=n+a)return r+Math.min(a,t-n);if(n+=o-r,r=o+1,t<=(n+=i-n%i))return r}}function k(e){for(;ja.length<=e;)ja.push(U(ja)+" ");return ja[e]}function U(e){return e[e.length-1]}function v(e,t){for(var i=[],r=0;r<e.length;r++)i[r]=t(e[r],r);return i}function a(e,t,i){for(var r=0,n=i(t);r<e.length&&i(e[r])<=n;)r++;e.splice(r,0,t)}function n(){}function i(e,t){var i;return i=Object.create?Object.create(e):(n.prototype=e,new n),t&&p(t,i),i}function d(e){return/\w/.test(e)||"\x80"<e&&(e.toUpperCase()!=e.toLowerCase()||qa.test(e))}function b(e,t){return t?!!(-1<t.source.indexOf("\\w")&&d(e))||t.test(e):d(e)}function y(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}function x(e){return 768<=e.charCodeAt(0)&&Ga.test(e)}function _(e,t,i){for(;(i<0?0<t:t<e.length)&&x(e.charAt(t));)t+=i;return t}function S(e,t,i){for(;;){if(Math.abs(t-i)<=1)return e(t)?t:i;var r=Math.floor((t+i)/2);e(r)?i=r:t=r}}function E(e,t,i){var r=this;this.input=i,r.scrollbarFiller=w("div",null,"CodeMirror-scrollbar-filler"),r.scrollbarFiller.setAttribute("cm-not-content","true"),r.gutterFiller=w("div",null,"CodeMirror-gutter-filler"),r.gutterFiller.setAttribute("cm-not-content","true"),r.lineDiv=u("div",null,"CodeMirror-code"),r.selectionDiv=w("div",null,null,"position: relative; z-index: 1"),r.cursorDiv=w("div",null,"CodeMirror-cursors"),r.measure=w("div",null,"CodeMirror-measure"),r.lineMeasure=w("div",null,"CodeMirror-measure"),r.lineSpace=u("div",[r.measure,r.lineMeasure,r.selectionDiv,r.cursorDiv,r.lineDiv],null,"position: relative; outline: none");var n=u("div",[r.lineSpace],"CodeMirror-lines");r.mover=w("div",[n],null,"position: relative"),r.sizer=w("div",[r.mover],"CodeMirror-sizer"),r.sizerWidth=null,r.heightForcer=w("div",null,null,"position: absolute; height: "+Ba+"px; width: 1px;"),r.gutters=w("div",null,"CodeMirror-gutters"),r.lineGutter=null,r.scroller=w("div",[r.sizer,r.heightForcer,r.gutters],"CodeMirror-scroll"),r.scroller.setAttribute("tabIndex","-1"),r.wrapper=w("div",[r.scrollbarFiller,r.gutterFiller,r.scroller],"CodeMirror"),fa&&ma<8&&(r.gutters.style.zIndex=-1,r.scroller.style.paddingRight=0),ga||da&&Ta||(r.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(r.wrapper):e(r.wrapper)),r.viewFrom=r.viewTo=t.first,r.reportedViewFrom=r.reportedViewTo=t.first,r.view=[],r.renderedView=null,r.externalMeasured=null,r.viewOffset=0,r.lastWrapHeight=r.lastWrapWidth=0,r.updateLineNumbers=null,r.nativeBarWidth=r.barHeight=r.barWidth=0,r.scrollbarsClipped=!1,r.lineNumWidth=r.lineNumInnerWidth=r.lineNumChars=null,r.alignWidgets=!1,r.cachedCharWidth=r.cachedTextHeight=r.cachedPaddingH=null,r.maxLine=null,r.maxLineLength=0,r.maxLineChanged=!1,r.wheelDX=r.wheelDY=r.wheelStartX=r.wheelStartY=null,r.shift=!1,r.selForContextMenu=null,r.activeTouch=null,i.init(r)}function $(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var i=e;!i.lines;)for(var r=0;;++r){var n=i.children[r],o=n.chunkSize();if(t<o){i=n;break}t-=o}return i.lines[t]}function A(e,i,r){var n=[],o=i.line;return e.iter(i.line,r.line+1,function(e){var t=e.text;o==r.line&&(t=t.slice(0,r.ch)),o==i.line&&(t=t.slice(i.ch)),n.push(t),++o}),n}function L(e,t,i){var r=[];return e.iter(t,i,function(e){r.push(e.text)}),r}function N(e,t){var i=t-e.height;if(i)for(var r=e;r;r=r.parent)r.height+=i}function O(e){if(null==e.parent)return null;for(var t=e.parent,i=m(t.lines,e),r=t.parent;r;r=(t=r).parent)for(var n=0;r.children[n]!=t;++n)i+=r.children[n].chunkSize();return i+t.first}function M(e,t){var i=e.first;e:do{for(var r=0;r<e.children.length;++r){var n=e.children[r],o=n.height;if(t<o){e=n;continue e}t-=o,i+=n.chunkSize()}return i}while(!e.lines);for(var a=0;a<e.lines.length;++a){var s=e.lines[a].height;if(t<s)break;t-=s}return i+a}function I(e,t){return t>=e.first&&t<e.first+e.size}function P(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function R(e,t,i){if(void 0===i&&(i=null),!(this instanceof R))return new R(e,t,i);this.line=e,this.ch=t,this.sticky=i}function D(e,t){return e.line-t.line||e.ch-t.ch}function F(e,t){return e.sticky==t.sticky&&0==D(e,t)}function B(e){return R(e.line,e.ch)}function H(e,t){return D(e,t)<0?t:e}function z(e,t){return D(e,t)<0?e:t}function W(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function j(e,t){if(t.line<e.first)return R(e.first,0);var i=e.first+e.size-1;return t.line>i?R(i,$(e,i).text.length):q(t,$(e,t.line).text.length)}function q(e,t){var i=e.ch;return null==i||t<i?R(e.line,t):i<0?R(e.line,0):e}function G(e,t){for(var i=[],r=0;r<t.length;r++)i[r]=j(e,t[r]);return i}function K(){Ka=!0}function V(){Va=!0}function Y(e,t,i){this.marker=e,this.from=t,this.to=i}function X(e,t){if(e)for(var i=0;i<e.length;++i){var r=e[i];if(r.marker==t)return r}}function Q(e,t){for(var i,r=0;r<e.length;++r)e[r]!=t&&(i||(i=[])).push(e[r]);return i}function Z(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}function J(e,t,i){var r;if(e)for(var n=0;n<e.length;++n){var o=e[n],a=o.marker;if(null==o.from||(a.inclusiveLeft?o.from<=t:o.from<t)||o.from==t&&"bookmark"==a.type&&(!i||!o.marker.insertLeft)){var s=null==o.to||(a.inclusiveRight?o.to>=t:o.to>t);(r||(r=[])).push(new Y(a,o.from,s?null:o.to))}}return r}function ee(e,t,i){var r;if(e)for(var n=0;n<e.length;++n){var o=e[n],a=o.marker;if(null==o.to||(a.inclusiveRight?o.to>=t:o.to>t)||o.from==t&&"bookmark"==a.type&&(!i||o.marker.insertLeft)){var s=null==o.from||(a.inclusiveLeft?o.from<=t:o.from<t);(r||(r=[])).push(new Y(a,s?null:o.from-t,null==o.to?null:o.to-t))}}return r}function te(e,t){if(t.full)return null;var i=I(e,t.from.line)&&$(e,t.from.line).markedSpans,r=I(e,t.to.line)&&$(e,t.to.line).markedSpans;if(!i&&!r)return null;var n=t.from.ch,o=t.to.ch,a=0==D(t.from,t.to),s=J(i,n,a),l=ee(r,o,a),c=1==t.text.length,d=U(t.text).length+(c?n:0);if(s)for(var u=0;u<s.length;++u){var h=s[u];if(null==h.to){var p=X(l,h.marker);p?c&&(h.to=null==p.to?null:p.to+d):h.to=n}}if(l)for(var f=0;f<l.length;++f){var m=l[f];if(null!=m.to&&(m.to+=d),null==m.from)X(s,m.marker)||(m.from=d,c&&(s||(s=[])).push(m));else m.from+=d,c&&(s||(s=[])).push(m)}s&&(s=ie(s)),l&&l!=s&&(l=ie(l));var g=[s];if(!c){var v,b=t.text.length-2;if(0<b&&s)for(var y=0;y<s.length;++y)null==s[y].to&&(v||(v=[])).push(new Y(s[y].marker,null,null));for(var w=0;w<b;++w)g.push(v);g.push(l)}return g}function ie(e){for(var t=0;t<e.length;++t){var i=e[t];null!=i.from&&i.from==i.to&&!1!==i.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function re(e,t,i){var r=null;if(e.iter(t.line,i.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var i=e.markedSpans[t].marker;!i.readOnly||r&&-1!=m(r,i)||(r||(r=[])).push(i)}}),!r)return null;for(var n=[{from:t,to:i}],o=0;o<r.length;++o)for(var a=r[o],s=a.find(0),l=0;l<n.length;++l){var c=n[l];if(!(D(c.to,s.from)<0||0<D(c.from,s.to))){var d=[l,1],u=D(c.from,s.from),h=D(c.to,s.to);(u<0||!a.inclusiveLeft&&!u)&&d.push({from:c.from,to:s.from}),(0<h||!a.inclusiveRight&&!h)&&d.push({from:s.to,to:c.to}),n.splice.apply(n,d),l+=d.length-3}}return n}function ne(e){var t=e.markedSpans;if(t){for(var i=0;i<t.length;++i)t[i].marker.detachLine(e);e.markedSpans=null}}function oe(e,t){if(t){for(var i=0;i<t.length;++i)t[i].marker.attachLine(e);e.markedSpans=t}}function ae(e){return e.inclusiveLeft?-1:0}function se(e){return e.inclusiveRight?1:0}function le(e,t){var i=e.lines.length-t.lines.length;if(0!=i)return i;var r=e.find(),n=t.find(),o=D(r.from,n.from)||ae(e)-ae(t);if(o)return-o;var a=D(r.to,n.to)||se(e)-se(t);return a||t.id-e.id}function t(e,t){var i,r=Va&&e.markedSpans;if(r)for(var n=void 0,o=0;o<r.length;++o)(n=r[o]).marker.collapsed&&null==(t?n.from:n.to)&&(!i||le(i,n.marker)<0)&&(i=n.marker);return i}function ce(e){return t(e,!0)}function de(e){return t(e,!1)}function ue(e,t,i,r,n){var o=$(e,t),a=Va&&o.markedSpans;if(a)for(var s=0;s<a.length;++s){var l=a[s];if(l.marker.collapsed){var c=l.marker.find(0),d=D(c.from,i)||ae(l.marker)-ae(n),u=D(c.to,r)||se(l.marker)-se(n);if(!(0<=d&&u<=0||d<=0&&0<=u)&&(d<=0&&(l.marker.inclusiveRight&&n.inclusiveLeft?0<=D(c.to,i):0<D(c.to,i))||0<=d&&(l.marker.inclusiveRight&&n.inclusiveLeft?D(c.from,r)<=0:D(c.from,r)<0)))return!0}}}function he(e){for(var t;t=ce(e);)e=t.find(-1,!0).line;return e}function pe(e){for(var t;t=de(e);)e=t.find(1,!0).line;return e}function fe(e){for(var t,i;t=de(e);)e=t.find(1,!0).line,(i||(i=[])).push(e);return i}function me(e,t){var i=$(e,t),r=he(i);return i==r?t:O(r)}function ge(e,t){if(t>e.lastLine())return t;var i,r=$(e,t);if(!ve(e,r))return t;for(;i=de(r);)r=i.find(1,!0).line;return O(r)+1}function ve(e,t){var i=Va&&t.markedSpans;if(i)for(var r=void 0,n=0;n<i.length;++n)if((r=i[n]).marker.collapsed){if(null==r.from)return!0;if(!r.marker.widgetNode&&0==r.from&&r.marker.inclusiveLeft&&be(e,t,r))return!0}}function be(e,t,i){if(null==i.to){var r=i.marker.find(1,!0);return be(e,r.line,X(r.line.markedSpans,i.marker))}if(i.marker.inclusiveRight&&i.to==t.text.length)return!0;for(var n=void 0,o=0;o<t.markedSpans.length;++o)if((n=t.markedSpans[o]).marker.collapsed&&!n.marker.widgetNode&&n.from==i.to&&(null==n.to||n.to!=i.from)&&(n.marker.inclusiveLeft||i.marker.inclusiveRight)&&be(e,t,n))return!0}function ye(e){for(var t=0,i=(e=he(e)).parent,r=0;r<i.lines.length;++r){var n=i.lines[r];if(n==e)break;t+=n.height}for(var o=i.parent;o;o=(i=o).parent)for(var a=0;a<o.children.length;++a){var s=o.children[a];if(s==i)break;t+=s.height}return t}function we(e){if(0==e.height)return 0;for(var t,i=e.text.length,r=e;t=ce(r);){var n=t.find(0,!0);r=n.from.line,i+=n.from.ch-n.to.ch}for(r=e;t=de(r);){var o=t.find(0,!0);i-=r.text.length-o.from.ch,i+=(r=o.to.line).text.length-o.to.ch}return i}function ke(e){var i=e.display,t=e.doc;i.maxLine=$(t,t.first),i.maxLineLength=we(i.maxLine),i.maxLineChanged=!0,t.iter(function(e){var t=we(e);t>i.maxLineLength&&(i.maxLineLength=t,i.maxLine=e)})}function xe(e,t,i,r){if(!e)return r(t,i,"ltr");for(var n=!1,o=0;o<e.length;++o){var a=e[o];(a.from<i&&a.to>t||t==i&&a.to==t)&&(r(Math.max(a.from,t),Math.min(a.to,i),1==a.level?"rtl":"ltr"),n=!0)}n||r(t,i,"ltr")}function _e(e,t,i){var r;Ya=null;for(var n=0;n<e.length;++n){var o=e[n];if(o.from<t&&o.to>t)return n;o.to==t&&(o.from!=o.to&&"before"==i?r=n:Ya=n),o.from==t&&(o.from!=o.to&&"before"!=i?r=n:Ya=n)}return null!=r?r:Ya}function Ce(e,t){var i=e.order;return null==i&&(i=e.order=Xa(e.text,t)),i}function Te(e,t,i){var r=_(e.text,t+i,i);return r<0||r>e.text.length?null:r}function Se(e,t,i){var r=Te(e,t.ch,i);return null==r?null:new R(t.line,r,i<0?"after":"before")}function Ee(e,t,i,r,n){if(e){var o=Ce(i,t.doc.direction);if(o){var a,s=n<0?U(o):o[0],l=n<0==(1==s.level)?"after":"before";if(0<s.level){var c=Qt(t,i);a=n<0?i.text.length-1:0;var d=Zt(t,c,a).top;a=S(function(e){return Zt(t,c,e).top==d},n<0==(1==s.level)?s.from:s.to-1,a),"before"==l&&(a=Te(i,a,1))}else a=n<0?s.to:s.from;return new R(r,a,l)}}return new R(r,n<0?i.text.length:0,n<0?"before":"after")}function $e(t,i,s,e){var l=Ce(i,t.doc.direction);if(!l)return Se(i,s,e);s.ch>=i.text.length?(s.ch=i.text.length,s.sticky="before"):s.ch<=0&&(s.ch=0,s.sticky="after");var r=_e(l,s.ch,s.sticky),n=l[r];if("ltr"==t.doc.direction&&n.level%2==0&&(0<e?n.to>s.ch:n.from<s.ch))return Se(i,s,e);var o,c=function(e,t){return Te(i,e instanceof R?e.ch:e,t)},a=function(e){return t.options.lineWrapping?(o=o||Qt(t,i),gi(t,i,o,e)):{begin:0,end:i.text.length}},d=a("before"==s.sticky?c(s,-1):s.ch);if("rtl"==t.doc.direction||1==n.level){var u=1==n.level==e<0,h=c(s,u?1:-1);if(null!=h&&(u?h<=n.to&&h<=d.end:h>=n.from&&h>=d.begin)){var p=u?"before":"after";return new R(s.line,h,p)}}var f=function(e,t,i){for(var r=function(e,t){return t?new R(s.line,c(e,1),"before"):new R(s.line,e,"after")};0<=e&&e<l.length;e+=t){var n=l[e],o=0<t==(1!=n.level),a=o?i.begin:c(i.end,-1);if(n.from<=a&&a<n.to)return r(a,o);if(a=o?n.from:c(n.to,-1),i.begin<=a&&a<i.end)return r(a,o)}},m=f(r+e,e,d);if(m)return m;var g=0<e?d.end:c(d.begin,-1);return null==g||0<e&&g==i.text.length||!(m=f(0<e?0:l.length-1,e,a(g)))?null:m}function Ae(e,t){return e._handlers&&e._handlers[t]||Qa}function Le(e,t,i){if(e.removeEventListener)e.removeEventListener(t,i,!1);else if(e.detachEvent)e.detachEvent("on"+t,i);else{var r=e._handlers,n=r&&r[t];if(n){var o=m(n,i);-1<o&&(r[t]=n.slice(0,o).concat(n.slice(o+1)))}}}function Ne(e,t){var i=Ae(e,t);if(i.length)for(var r=Array.prototype.slice.call(arguments,2),n=0;n<i.length;++n)i[n].apply(null,r)}function Oe(e,t,i){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),Ne(e,i||t.type,e,t),De(t)||t.codemirrorIgnore}function Me(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var i=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),r=0;r<t.length;++r)-1==m(i,t[r])&&i.push(t[r])}function Ie(e,t){return 0<Ae(e,t).length}function e(e){e.prototype.on=function(e,t){Za(this,e,t)},e.prototype.off=function(e,t){Le(this,e,t)}}function Pe(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function Re(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function De(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function Fe(e){Pe(e),Re(e)}function Be(e){return e.target||e.srcElement}function He(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),Sa&&e.ctrlKey&&1==t&&(t=3),t}function ze(e){if(null==Ra){var t=w("span","\u200b");o(e,w("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(Ra=t.offsetWidth<=1&&2<t.offsetHeight&&!(fa&&ma<8))}var i=Ra?w("span","\u200b"):w("span","\xa0",null,"display: inline-block; width: 1px; margin-right: -1px");return i.setAttribute("cm-text",""),i}function We(e){if(null!=Da)return Da;var t=o(e,document.createTextNode("A\u062eA")),i=La(t,0,1).getBoundingClientRect(),r=La(t,1,2).getBoundingClientRect();return f(e),!(!i||i.left==i.right)&&(Da=r.right-i.right<3)}function Ue(e){if(null!=rs)return rs;var t=o(e,w("span","x")),i=t.getBoundingClientRect(),r=La(t,0,1).getBoundingClientRect();return rs=1<Math.abs(i.left-r.left)}function je(e,t){2<arguments.length&&(t.dependencies=Array.prototype.slice.call(arguments,2)),ns[e]=t}function qe(e,t){os[e]=t}function Ge(e){if("string"==typeof e&&os.hasOwnProperty(e))e=os[e];else if(e&&"string"==typeof e.name&&os.hasOwnProperty(e.name)){var t=os[e.name];"string"==typeof t&&(t={name:t}),(e=i(t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return Ge("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return Ge("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function Ke(e,t){t=Ge(t);var i=ns[t.name];if(!i)return Ke(e,"text/plain");var r=i(e,t);if(as.hasOwnProperty(t.name)){var n=as[t.name];for(var o in n)n.hasOwnProperty(o)&&(r.hasOwnProperty(o)&&(r["_"+o]=r[o]),r[o]=n[o])}if(r.name=t.name,t.helperType&&(r.helperType=t.helperType),t.modeProps)for(var a in t.modeProps)r[a]=t.modeProps[a];return r}function Ve(e,t){p(t,as.hasOwnProperty(e)?as[e]:as[e]={})}function Ye(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var i={};for(var r in t){var n=t[r];n instanceof Array&&(n=n.concat([])),i[r]=n}return i}function Xe(e,t){for(var i;e.innerMode&&(i=e.innerMode(t))&&i.mode!=e;)t=i.state,e=i.mode;return i||{mode:e,state:t}}function Qe(e,t,i){return!e.startState||e.startState(t,i)}function Ze(t,i,r,e){var l=[t.state.modeGen],n={};at(t,i.text,t.doc.mode,r,function(e,t){return l.push(e,t)},n,e);for(var o=r.state,a=function(e){var o=t.state.overlays[e],a=1,s=0;r.state=!0,at(t,i.text,o.mode,r,function(e,t){for(var i=a;s<e;){var r=l[a];e<r&&l.splice(a,1,e,l[a+1],r),a+=2,s=Math.min(e,r)}if(t)if(o.opaque)l.splice(i,a-i,e,"overlay "+t),a=i+2;else for(;i<a;i+=2){var n=l[i+1];l[i+1]=(n?n+" ":"")+"overlay "+t}},n)},s=0;s<t.state.overlays.length;++s)a(s);return r.state=o,{styles:l,classes:n.bgClass||n.textClass?n:null}}function Je(e,t,i){if(!t.styles||t.styles[0]!=e.state.modeGen){var r=et(e,O(t)),n=t.text.length>e.options.maxHighlightLength&&Ye(e.doc.mode,r.state),o=Ze(e,t,r);n&&(r.state=n),t.stateAfter=r.save(!n),t.styles=o.styles,o.classes?t.styleClasses=o.classes:t.styleClasses&&(t.styleClasses=null),i===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function et(i,r,e){var t=i.doc,n=i.display;if(!t.mode.startState)return new cs(t,!0,r);var o=st(i,r,e),a=o>t.first&&$(t,o-1).stateAfter,s=a?cs.fromSaved(t,a,o):new cs(t,Qe(t.mode),o);return t.iter(o,r,function(e){tt(i,e.text,s);var t=s.line;e.stateAfter=t==r-1||t%5==0||t>=n.viewFrom&&t<n.viewTo?s.save():null,s.nextLine()}),e&&(t.modeFrontier=s.line),s}function tt(e,t,i,r){var n=e.doc.mode,o=new ss(t,e.options.tabSize,i);for(o.start=o.pos=r||0,""==t&&it(n,i.state);!o.eol();)rt(n,o,i.state),o.start=o.pos}function it(e,t){if(e.blankLine)return e.blankLine(t);if(e.innerMode){var i=Xe(e,t);return i.mode.blankLine?i.mode.blankLine(i.state):void 0}}function rt(e,t,i,r){for(var n=0;n<10;n++){r&&(r[0]=Xe(e,i).mode);var o=e.token(t,i);if(t.pos>t.start)return o}throw new Error("Mode "+e.name+" failed to advance stream.")}function nt(e,t,i,r){var n,o,a=e.doc,s=a.mode,l=$(a,(t=j(a,t)).line),c=et(e,t.line,i),d=new ss(l.text,e.options.tabSize,c);for(r&&(o=[]);(r||d.pos<t.ch)&&!d.eol();)d.start=d.pos,n=rt(s,d,c.state),r&&o.push(new ds(d,n,Ye(a.mode,c.state)));return r?o:new ds(d,n,c.state)}function ot(e,t){if(e)for(;;){var i=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!i)break;e=e.slice(0,i.index)+e.slice(i.index+i[0].length);var r=i[1]?"bgClass":"textClass";null==t[r]?t[r]=i[2]:new RegExp("(?:^|s)"+i[2]+"(?:$|s)").test(t[r])||(t[r]+=" "+i[2])}return e}function at(e,t,i,r,n,o,a){var s=i.flattenSpans;null==s&&(s=e.options.flattenSpans);var l,c=0,d=null,u=new ss(t,e.options.tabSize,r),h=e.options.addModeClass&&[null];for(""==t&&ot(it(i,r.state),o);!u.eol();){if(l=u.pos>e.options.maxHighlightLength?(s=!1,a&&tt(e,t,r,u.pos),u.pos=t.length,null):ot(rt(i,u,r.state,h),o),h){var p=h[0].name;p&&(l="m-"+(l?p+" "+l:p))}if(!s||d!=l){for(;c<u.start;)n(c=Math.min(u.start,c+5e3),d);d=l}u.start=u.pos}for(;c<u.pos;){var f=Math.min(u.pos,c+5e3);n(f,d),c=f}}function st(e,t,i){for(var r,n,o=e.doc,a=i?-1:t-(e.doc.mode.innerMode?1e3:100),s=t;a<s;--s){if(s<=o.first)return o.first;var l=$(o,s-1),c=l.stateAfter;if(c&&(!i||s+(c instanceof ls?c.lookAhead:0)<=o.modeFrontier))return s;var d=C(l.text,null,e.options.tabSize);(null==n||d<r)&&(n=s-1,r=d)}return n}function lt(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),!(e.highlightFrontier<t-10)){for(var i=e.first,r=t-1;i<r;r--){var n=$(e,r).stateAfter;if(n&&(!(n instanceof ls)||r+n.lookAhead<t)){i=r+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,i)}}function ct(e,t,i,r){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),ne(e),oe(e,i);var n=r?r(e):1;n!=e.height&&N(e,n)}function dt(e){e.parent=null,ne(e)}function ut(e,t){if(!e||/^\s*$/.test(e))return null;var i=t.addModeClass?fs:ps;return i[e]||(i[e]=e.replace(/\S+/g,"cm-$&"))}function ht(e,t){var i=u("span",null,null,ga?"padding-right: .1px":null),r={pre:u("pre",[i],"CodeMirror-line"),content:i,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:(fa||ga)&&e.getOption("lineWrapping")};t.measure={};for(var n=0;n<=(t.rest?t.rest.length:0);n++){var o=n?t.rest[n-1]:t.line,a=void 0;r.pos=0,r.addToken=ft,We(e.display.measure)&&(a=Ce(o,e.doc.direction))&&(r.addToken=gt(r.addToken,a)),r.map=[],bt(o,r,Je(e,o,t!=e.display.externalMeasured&&O(o))),o.styleClasses&&(o.styleClasses.bgClass&&(r.bgClass=l(o.styleClasses.bgClass,r.bgClass||"")),o.styleClasses.textClass&&(r.textClass=l(o.styleClasses.textClass,r.textClass||""))),0==r.map.length&&r.map.push(0,0,r.content.appendChild(ze(e.display.measure))),0==n?(t.measure.map=r.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(r.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(ga){var s=r.content.lastChild;(/\bcm-tab\b/.test(s.className)||s.querySelector&&s.querySelector(".cm-tab"))&&(r.content.className="cm-tab-wrap-hack")}return Ne(e,"renderLine",e,t.line,r.pre),r.pre.className&&(r.textClass=l(r.pre.className,r.textClass||"")),r}function pt(e){var t=w("span","\u2022","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function ft(e,t,i,r,n,o,a){if(t){var s,l=e.splitSpaces?mt(t,e.trailingSpace):t,c=e.cm.state.specialChars,d=!1;if(c.test(t)){s=document.createDocumentFragment();for(var u=0;;){c.lastIndex=u;var h=c.exec(t),p=h?h.index-u:t.length-u;if(p){var f=document.createTextNode(l.slice(u,u+p));fa&&ma<9?s.appendChild(w("span",[f])):s.appendChild(f),e.map.push(e.pos,e.pos+p,f),e.col+=p,e.pos+=p}if(!h)break;u+=p+1;var m=void 0;if("\t"==h[0]){var g=e.cm.options.tabSize,v=g-e.col%g;(m=s.appendChild(w("span",k(v),"cm-tab"))).setAttribute("role","presentation"),m.setAttribute("cm-text","\t"),e.col+=v}else"\r"==h[0]||"\n"==h[0]?(m=s.appendChild(w("span","\r"==h[0]?"\u240d":"\u2424","cm-invalidchar"))).setAttribute("cm-text",h[0]):((m=e.cm.options.specialCharPlaceholder(h[0])).setAttribute("cm-text",h[0]),fa&&ma<9?s.appendChild(w("span",[m])):s.appendChild(m)),e.col+=1;e.map.push(e.pos,e.pos+1,m),e.pos++}}else e.col+=t.length,s=document.createTextNode(l),e.map.push(e.pos,e.pos+t.length,s),fa&&ma<9&&(d=!0),e.pos+=t.length;if(e.trailingSpace=32==l.charCodeAt(t.length-1),i||r||n||d||a){var b=i||"";r&&(b+=r),n&&(b+=n);var y=w("span",[s],b,a);return o&&(y.title=o),e.content.appendChild(y)}e.content.appendChild(s)}}function mt(e,t){if(1<e.length&&!/  /.test(e))return e;for(var i=t,r="",n=0;n<e.length;n++){var o=e.charAt(n);" "!=o||!i||n!=e.length-1&&32!=e.charCodeAt(n+1)||(o="\xa0"),r+=o,i=" "==o}return r}function gt(u,h){return function(e,t,i,r,n,o,a){i=i?i+" cm-force-border":"cm-force-border";for(var s=e.pos,l=s+t.length;;){for(var c=void 0,d=0;d<h.length&&!((c=h[d]).to>s&&c.from<=s);d++);if(c.to>=l)return u(e,t,i,r,n,o,a);u(e,t.slice(0,c.to-s),i,r,null,o,a),r=null,t=t.slice(c.to-s),s=c.to}}}function vt(e,t,i,r){var n=!r&&i.widgetNode;n&&e.map.push(e.pos,e.pos+t,n),!r&&e.cm.display.input.needsContentAttribute&&(n||(n=e.content.appendChild(document.createElement("span"))),n.setAttribute("cm-marker",i.id)),n&&(e.cm.display.input.setUneditable(n),e.content.appendChild(n)),e.pos+=t,e.trailingSpace=!1}function bt(e,t,i){var r=e.markedSpans,n=e.text,o=0;if(r)for(var a,s,l,c,d,u,h,p=n.length,f=0,m=1,g="",v=0;;){if(v==f){l=c=d=u=s="",h=null,v=Infinity;for(var b=[],y=void 0,w=0;w<r.length;++w){var k=r[w],x=k.marker;"bookmark"==x.type&&k.from==f&&x.widgetNode?b.push(x):k.from<=f&&(null==k.to||k.to>f||x.collapsed&&k.to==f&&k.from==f)?(null!=k.to&&k.to!=f&&v>k.to&&(v=k.to,c=""),x.className&&(l+=" "+x.className),x.css&&(s=(s?s+";":"")+x.css),x.startStyle&&k.from==f&&(d+=" "+x.startStyle),x.endStyle&&k.to==v&&(y||(y=[])).push(x.endStyle,k.to),x.title&&!u&&(u=x.title),x.collapsed&&(!h||le(h.marker,x)<0)&&(h=k)):k.from>f&&v>k.from&&(v=k.from)}if(y)for(var _=0;_<y.length;_+=2)y[_+1]==v&&(c+=" "+y[_]);if(!h||h.from==f)for(var C=0;C<b.length;++C)vt(t,0,b[C]);if(h&&(h.from||0)==f){if(vt(t,(null==h.to?p+1:h.to)-f,h.marker,null==h.from),null==h.to)return;h.to==f&&(h=!1)}}if(p<=f)break;for(var T=Math.min(p,v);;){if(g){var S=f+g.length;if(!h){var E=T<S?g.slice(0,T-f):g;t.addToken(t,E,a?a+l:l,d,f+E.length==v?c:"",u,s)}if(T<=S){g=g.slice(T-f),f=T;break}f=S,d=""}g=n.slice(o,o=i[m++]),a=ut(i[m++],t.cm.options)}}else for(var $=1;$<i.length;$+=2)t.addToken(t,n.slice(o,o=i[$]),ut(i[$+1],t.cm.options))}function yt(e,t,i){this.line=t,this.rest=fe(t),this.size=this.rest?O(U(this.rest))-i+1:1,this.node=this.text=null,this.hidden=ve(e,t)}function wt(e,t,i){for(var r,n=[],o=t;o<i;o=r){var a=new yt(e.doc,$(e.doc,o),o);r=o+a.size,n.push(a)}return n}function kt(e){ms?ms.ops.push(e):e.ownsGroup=ms={ops:[e],delayedCallbacks:[]}}function xt(e){var t=e.delayedCallbacks,i=0;do{for(;i<t.length;i++)t[i].call(null);for(var r=0;r<e.ops.length;r++){var n=e.ops[r];if(n.cursorActivityHandlers)for(;n.cursorActivityCalled<n.cursorActivityHandlers.length;)n.cursorActivityHandlers[n.cursorActivityCalled++].call(null,n.cm)}}while(i<t.length)}function _t(e,t){var i=e.ownsGroup;if(i)try{xt(i)}finally{ms=null,t(i)}}function Ct(e,t){var i=Ae(e,t);if(i.length){var r,n=Array.prototype.slice.call(arguments,2);ms?r=ms.delayedCallbacks:gs?r=gs:(r=gs=[],setTimeout(Tt,0));for(var o=function(e){r.push(function(){return i[e].apply(null,n)})},a=0;a<i.length;++a)o(a)}}function Tt(){var e=gs;gs=null;for(var t=0;t<e.length;++t)e[t]()}function St(e,t,i,r){for(var n=0;n<t.changes.length;n++){var o=t.changes[n];"text"==o?Lt(e,t):"gutter"==o?Ot(e,t,i,r):"class"==o?Nt(e,t):"widget"==o&&Mt(e,t,r)}t.changes=null}function Et(e){return e.node==e.text&&(e.node=w("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),fa&&ma<8&&(e.node.style.zIndex=2)),e.node}function $t(e,t){var i=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(i&&(i+=" CodeMirror-linebackground"),t.background)i?t.background.className=i:(t.background.parentNode.removeChild(t.background),t.background=null);else if(i){var r=Et(t);t.background=r.insertBefore(w("div",null,i),r.firstChild),e.display.input.setUneditable(t.background)}}function At(e,t){var i=e.display.externalMeasured;return i&&i.line==t.line?(e.display.externalMeasured=null,t.measure=i.measure,i.built):ht(e,t)}function Lt(e,t){var i=t.text.className,r=At(e,t);t.text==t.node&&(t.node=r.pre),t.text.parentNode.replaceChild(r.pre,t.text),t.text=r.pre,r.bgClass!=t.bgClass||r.textClass!=t.textClass?(t.bgClass=r.bgClass,t.textClass=r.textClass,Nt(e,t)):i&&(t.text.className=i)}function Nt(e,t){$t(e,t),t.line.wrapClass?Et(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var i=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=i||""}function Ot(e,t,i,r){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){var n=Et(t);t.gutterBackground=w("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px; width: "+r.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),n.insertBefore(t.gutterBackground,t.text)}var o=t.line.gutterMarkers;if(e.options.lineNumbers||o){var a=Et(t),s=t.gutter=w("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px");if(e.display.input.setUneditable(s),a.insertBefore(s,t.text),t.line.gutterClass&&(s.className+=" "+t.line.gutterClass),!e.options.lineNumbers||o&&o["CodeMirror-linenumbers"]||(t.lineNumber=s.appendChild(w("div",P(e.options,i),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+r.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),o)for(var l=0;l<e.options.gutters.length;++l){var c=e.options.gutters[l],d=o.hasOwnProperty(c)&&o[c];d&&s.appendChild(w("div",[d],"CodeMirror-gutter-elt","left: "+r.gutterLeft[c]+"px; width: "+r.gutterWidth[c]+"px"))}}}function Mt(e,t,i){t.alignable&&(t.alignable=null);for(var r=t.node.firstChild,n=void 0;r;r=n)n=r.nextSibling,"CodeMirror-linewidget"==r.className&&t.node.removeChild(r);Pt(e,t,i)}function It(e,t,i,r){var n=At(e,t);return t.text=t.node=n.pre,n.bgClass&&(t.bgClass=n.bgClass),n.textClass&&(t.textClass=n.textClass),Nt(e,t),Ot(e,t,i,r),Pt(e,t,r),t.node}function Pt(e,t,i){if(Rt(e,t.line,t,i,!0),t.rest)for(var r=0;r<t.rest.length;r++)Rt(e,t.rest[r],t,i,!1)}function Rt(e,t,i,r,n){if(t.widgets)for(var o=Et(i),a=0,s=t.widgets;a<s.length;++a){var l=s[a],c=w("div",[l.node],"CodeMirror-linewidget");l.handleMouseEvents||c.setAttribute("cm-ignore-events","true"),Dt(l,c,i,r),e.display.input.setUneditable(c),n&&l.above?o.insertBefore(c,i.gutter||i.text):o.appendChild(c),Ct(l,"redraw")}}function Dt(e,t,i,r){if(e.noHScroll){(i.alignable||(i.alignable=[])).push(t);var n=r.wrapperWidth;t.style.left=r.fixedPos+"px",e.coverGutter||(n-=r.gutterTotalWidth,t.style.paddingLeft=r.gutterTotalWidth+"px"),t.style.width=n+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-r.gutterTotalWidth+"px"))}function Ft(e){if(null!=e.height)return e.height;var t=e.doc.cm;if(!t)return 0;if(!g(document.body,e.node)){var i="position: relative;";e.coverGutter&&(i+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(i+="width: "+t.display.wrapper.clientWidth+"px;"),o(t.display.measure,w("div",[e.node],null,i))}return e.height=e.node.parentNode.offsetHeight}function Bt(e,t){for(var i=Be(t);i!=e.wrapper;i=i.parentNode)if(!i||1==i.nodeType&&"true"==i.getAttribute("cm-ignore-events")||i.parentNode==e.sizer&&i!=e.mover)return!0}function Ht(e){return e.lineSpace.offsetTop}function zt(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function Wt(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=o(e.measure,w("pre","x")),i=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,r={left:parseInt(i.paddingLeft),right:parseInt(i.paddingRight)};return isNaN(r.left)||isNaN(r.right)||(e.cachedPaddingH=r),r}function Ut(e){return Ba-e.display.nativeBarWidth}function jt(e){return e.display.scroller.clientWidth-Ut(e)-e.display.barWidth}function qt(e){return e.display.scroller.clientHeight-Ut(e)-e.display.barHeight}function Gt(e,t,i){var r=e.options.lineWrapping,n=r&&jt(e)
;if(!t.measure.heights||r&&t.measure.width!=n){var o=t.measure.heights=[];if(r){t.measure.width=n;for(var a=t.text.firstChild.getClientRects(),s=0;s<a.length-1;s++){var l=a[s],c=a[s+1];2<Math.abs(l.bottom-c.bottom)&&o.push((l.bottom+c.top)/2-i.top)}}o.push(i.bottom-i.top)}}function Kt(e,t,i){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var r=0;r<e.rest.length;r++)if(e.rest[r]==t)return{map:e.measure.maps[r],cache:e.measure.caches[r]};for(var n=0;n<e.rest.length;n++)if(O(e.rest[n])>i)return{map:e.measure.maps[n],cache:e.measure.caches[n],before:!0}}function Vt(e,t){var i=O(t=he(t)),r=e.display.externalMeasured=new yt(e.doc,t,i);r.lineN=i;var n=r.built=ht(e,r);return r.text=n.pre,o(e.display.lineMeasure,n.pre),r}function Yt(e,t,i,r){return Zt(e,Qt(e,t),i,r)}function Xt(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[Ti(e,t)];var i=e.display.externalMeasured;return i&&t>=i.lineN&&t<i.lineN+i.size?i:void 0}function Qt(e,t){var i=O(t),r=Xt(e,i);r&&!r.text?r=null:r&&r.changes&&(St(e,r,i,wi(e)),e.curOp.forceUpdate=!0),r||(r=Vt(e,t));var n=Kt(r,t,i);return{line:t,view:r,rect:null,map:n.map,cache:n.cache,before:n.before,hasHeights:!1}}function Zt(e,t,i,r,n){t.before&&(i=-1);var o,a=i+(r||"");return t.cache.hasOwnProperty(a)?o=t.cache[a]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(Gt(e,t.view,t.rect),t.hasHeights=!0),(o=ti(e,t,i,r)).bogus||(t.cache[a]=o)),{left:o.left,right:o.right,top:n?o.rtop:o.top,bottom:n?o.rbottom:o.bottom}}function Jt(e,t,i){for(var r,n,o,a,s,l,c=0;c<e.length;c+=3)if(s=e[c],l=e[c+1],t<s?(n=0,o=1,a="left"):t<l?o=(n=t-s)+1:(c==e.length-3||t==l&&e[c+3]>t)&&(n=(o=l-s)-1,l<=t&&(a="right")),null!=n){if(r=e[c+2],s==l&&i==(r.insertLeft?"left":"right")&&(a=i),"left"==i&&0==n)for(;c&&e[c-2]==e[c-3]&&e[c-1].insertLeft;)r=e[2+(c-=3)],a="left";if("right"==i&&n==l-s)for(;c<e.length-3&&e[c+3]==e[c+4]&&!e[c+5].insertLeft;)r=e[(c+=3)+2],a="right";break}return{node:r,start:n,end:o,collapse:a,coverStart:s,coverEnd:l}}function ei(e,t){var i=vs;if("left"==t)for(var r=0;r<e.length&&(i=e[r]).left==i.right;r++);else for(var n=e.length-1;0<=n&&(i=e[n]).left==i.right;n--);return i}function ti(e,t,i,r){var n,o=Jt(t.map,i,r),a=o.node,s=o.start,l=o.end,c=o.collapse;if(3==a.nodeType){for(var d=0;d<4;d++){for(;s&&x(t.line.text.charAt(o.coverStart+s));)--s;for(;o.coverStart+l<o.coverEnd&&x(t.line.text.charAt(o.coverStart+l));)++l;if((n=fa&&ma<9&&0==s&&l==o.coverEnd-o.coverStart?a.parentNode.getBoundingClientRect():ei(La(a,s,l).getClientRects(),r)).left||n.right||0==s)break;l=s,s-=1,c="right"}fa&&ma<11&&(n=ii(e.display.measure,n))}else{var u;0<s&&(c=r="right"),n=e.options.lineWrapping&&1<(u=a.getClientRects()).length?u["right"==r?u.length-1:0]:a.getBoundingClientRect()}if(fa&&ma<9&&!s&&(!n||!n.left&&!n.right)){var h=a.parentNode.getClientRects()[0];n=h?{left:h.left,right:h.left+yi(e.display),top:h.top,bottom:h.bottom}:vs}for(var p=n.top-t.rect.top,f=n.bottom-t.rect.top,m=(p+f)/2,g=t.view.measure.heights,v=0;v<g.length-1&&!(m<g[v]);v++);var b=v?g[v-1]:0,y=g[v],w={left:("right"==c?n.right:n.left)-t.rect.left,right:("left"==c?n.left:n.right)-t.rect.left,top:b,bottom:y};return n.left||n.right||(w.bogus=!0),e.options.singleCursorHeightPerLine||(w.rtop=p,w.rbottom=f),w}function ii(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!Ue(e))return t;var i=screen.logicalXDPI/screen.deviceXDPI,r=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*i,right:t.right*i,top:t.top*r,bottom:t.bottom*r}}function ri(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function ni(e){e.display.externalMeasure=null,f(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)ri(e.display.view[t])}function oi(e){ni(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function ai(){return ba&&Ca?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function si(){return ba&&Ca?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function li(e,t,i,r,n){if(!n&&t.widgets)for(var o=0;o<t.widgets.length;++o)if(t.widgets[o].above){var a=Ft(t.widgets[o]);i.top+=a,i.bottom+=a}if("line"==r)return i;r||(r="local");var s=ye(t);if("local"==r?s+=Ht(e.display):s-=e.display.viewOffset,"page"==r||"window"==r){var l=e.display.lineSpace.getBoundingClientRect();s+=l.top+("window"==r?0:si());var c=l.left+("window"==r?0:ai());i.left+=c,i.right+=c}return i.top+=s,i.bottom+=s,i}function ci(e,t,i){if("div"==i)return t;var r=t.left,n=t.top;if("page"==i)r-=ai(),n-=si();else if("local"==i||!i){var o=e.display.sizer.getBoundingClientRect();r+=o.left,n+=o.top}var a=e.display.lineSpace.getBoundingClientRect();return{left:r-a.left,top:n-a.top}}function di(e,t,i,r,n){return r||(r=$(e.doc,t.line)),li(e,r,Yt(e,r,t.ch,n),i)}function ui(r,e,n,o,a,s){function l(e,t){var i=Zt(r,a,e,t?"right":"left",s);return t?i.left=i.right:i.right=i.left,li(r,o,i,n)}function t(e,t,i){return l(i?e-1:e,c[t].level%2!=0!=i)}o=o||$(r.doc,e.line),a||(a=Qt(r,o));var c=Ce(o,r.doc.direction),i=e.ch,d=e.sticky;if(i>=o.text.length?(i=o.text.length,d="before"):i<=0&&(i=0,d="after"),!c)return l("before"==d?i-1:i,"before"==d);var u=_e(c,i,d),h=Ya,p=t(i,u,"before"==d);return null!=h&&(p.other=t(i,h,"before"!=d)),p}function hi(e,t){var i=0;t=j(e.doc,t),e.options.lineWrapping||(i=yi(e.display)*t.ch);var r=$(e.doc,t.line),n=ye(r)+Ht(e.display);return{left:i,right:i,top:n,bottom:n+r.height}}function pi(e,t,i,r,n){var o=R(e,t,i);return o.xRel=n,r&&(o.outside=!0),o}function fi(e,t,i){var r=e.doc;if((i+=e.display.viewOffset)<0)return pi(r.first,0,null,!0,-1);var n=M(r,i),o=r.first+r.size-1;if(o<n)return pi(r.first+r.size-1,$(r,o).text.length,null,!0,1);t<0&&(t=0);for(var a=$(r,n);;){var s=vi(e,a,n,t,i),l=de(a),c=l&&l.find(0,!0);if(!l||!(s.ch>c.from.ch||s.ch==c.from.ch&&0<s.xRel))return s;n=O(a=c.to.line)}}function mi(t,i,r,n){var o=function(e){return li(t,i,Zt(t,r,e),"line")},e=i.text.length,a=S(function(e){return o(e-1).bottom<=n},e,0);return{begin:a,end:e=S(function(e){return o(e).top>n},a,e)}}function gi(e,t,i,r){return mi(e,t,i,li(e,t,Zt(e,i,r),"line").top)}function vi(i,r,e,n,o){o-=ye(r);var t,a=0,s=r.text.length,l=Qt(i,r);if(Ce(r,i.doc.direction)){var c;if(i.options.lineWrapping)a=(c=mi(i,r,l,o)).begin,s=c.end;t=new R(e,Math.floor(a+(s-a)/2));var d,u,h=ui(i,t,"line",r,l).left,p=h<n?1:-1,f=h-n,m=Math.ceil((s-a)/4);e:do{d=f,u=t;for(var g=0;g<m;++g){var v=t;if(null==(t=$e(i,r,t,p))||t.ch<a||s<=("before"==t.sticky?t.ch-1:t.ch)){t=v;break e}}if(f=ui(i,t,"line",r,l).left-n,1<m){var b=Math.abs(f-d)/m;m=Math.min(m,Math.ceil(Math.abs(f)/b)),p=f<0?1:-1}}while(0!=f&&(1<m||p<0!=f<0&&Math.abs(f)<=Math.abs(d)));if(Math.abs(f)>Math.abs(d)){if(f<0==d<0)throw new Error("Broke out of infinite loop in coordsCharInner");t=u}}else{var y=S(function(e){var t=li(i,r,Zt(i,l,e),"line");return t.top>o?(s=Math.min(e,s),!0):!(t.bottom<=o)&&(t.left>n||!(t.right<n)&&n-t.left<t.right-n)},a,s);t=new R(e,y=_(r.text,y,1),y==s?"before":"after")}var w=ui(i,t,"line",r,l);return(o<w.top||w.bottom<o)&&(t.outside=!0),t.xRel=n<w.left?-1:n>w.right?1:0,t}function bi(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==hs){hs=w("pre");for(var t=0;t<49;++t)hs.appendChild(document.createTextNode("x")),hs.appendChild(w("br"));hs.appendChild(document.createTextNode("x"))}o(e.measure,hs);var i=hs.offsetHeight/50;return 3<i&&(e.cachedTextHeight=i),f(e.measure),i||1}function yi(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=w("span","xxxxxxxxxx"),i=w("pre",[t]);o(e.measure,i);var r=t.getBoundingClientRect(),n=(r.right-r.left)/10;return 2<n&&(e.cachedCharWidth=n),n||10}function wi(e){for(var t=e.display,i={},r={},n=t.gutters.clientLeft,o=t.gutters.firstChild,a=0;o;o=o.nextSibling,++a)i[e.options.gutters[a]]=o.offsetLeft+o.clientLeft+n,r[e.options.gutters[a]]=o.clientWidth;return{fixedPos:ki(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:i,gutterWidth:r,wrapperWidth:t.wrapper.clientWidth}}function ki(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function xi(r){var n=bi(r.display),o=r.options.lineWrapping,a=o&&Math.max(5,r.display.scroller.clientWidth/yi(r.display)-3);return function(e){if(ve(r.doc,e))return 0;var t=0;if(e.widgets)for(var i=0;i<e.widgets.length;i++)e.widgets[i].height&&(t+=e.widgets[i].height);return o?t+(Math.ceil(e.text.length/a)||1)*n:t+n}}function _i(e){var t=e.doc,i=xi(e);t.iter(function(e){var t=i(e);t!=e.height&&N(e,t)})}function Ci(e,t,i,r){var n=e.display;if(!i&&"true"==Be(t).getAttribute("cm-not-content"))return null;var o,a,s=n.lineSpace.getBoundingClientRect();try{o=t.clientX-s.left,a=t.clientY-s.top}catch(t){return null}var l,c=fi(e,o,a);if(r&&1==c.xRel&&(l=$(e.doc,c.line).text).length==c.ch){var d=C(l,l.length,e.options.tabSize)-l.length;c=R(c.line,Math.max(0,Math.round((o-Wt(e.display).left)/yi(e.display))-d))}return c}function Ti(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var i=e.display.view,r=0;r<i.length;r++)if((t-=i[r].size)<0)return r}function Si(e){e.display.input.showSelection(e.display.input.prepareSelection())}function Ei(e,t){for(var i=e.doc,r={},n=r.cursors=document.createDocumentFragment(),o=r.selection=document.createDocumentFragment(),a=0;a<i.sel.ranges.length;a++)if(!1!==t||a!=i.sel.primIndex){var s=i.sel.ranges[a];if(!(s.from().line>=e.display.viewTo||s.to().line<e.display.viewFrom)){var l=s.empty();(l||e.options.showCursorWhenSelecting)&&$i(e,s.head,n),l||Ai(e,s,o)}}return r}function $i(e,t,i){var r=ui(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),n=i.appendChild(w("div","\xa0","CodeMirror-cursor"));if(n.style.left=r.left+"px",n.style.top=r.top+"px",n.style.height=Math.max(0,r.bottom-r.top)*e.options.cursorHeight+"px",r.other){var o=i.appendChild(w("div","\xa0","CodeMirror-cursor CodeMirror-secondarycursor"));o.style.display="",o.style.left=r.other.left+"px",o.style.top=r.other.top+"px",o.style.height=.85*(r.other.bottom-r.other.top)+"px"}}function Ai(n,e,t){function f(e,t,i,r){t<0&&(t=0),t=Math.round(t),r=Math.round(r),a.appendChild(w("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(null==i?g-e:i)+"px;\n                             height: "+(r-t)+"px"))}function i(i,l,c){function d(e,t){return di(n,R(i,e),"div",r,t)}var u,h,r=$(o,i),p=r.text.length;return xe(Ce(r,o.direction),l||0,null==c?p:c,function(e,t,i){var r,n,o,a=d(e,"left");if(e==t)n=o=(r=a).left;else{if(r=d(t-1,"right"),"rtl"==i){var s=a;a=r,r=s}n=a.left,o=r.right}null==l&&0==e&&(n=m),3<r.top-a.top&&(f(n,a.top,null,a.bottom),n=m,a.bottom<r.top&&f(n,a.bottom,null,r.top)),null==c&&t==p&&(o=g),(!u||a.top<u.top||a.top==u.top&&a.left<u.left)&&(u=a),(!h||r.bottom>h.bottom||r.bottom==h.bottom&&r.right>h.right)&&(h=r),n<m+1&&(n=m),f(n,r.top,o-n,r.bottom)}),{start:u,end:h}}var r=n.display,o=n.doc,a=document.createDocumentFragment(),s=Wt(n.display),m=s.left,g=Math.max(r.sizerWidth,jt(n)-r.sizer.offsetLeft)-s.right,l=e.from(),c=e.to();if(l.line==c.line)i(l.line,l.ch,c.ch);else{var d=$(o,l.line),u=$(o,c.line),h=he(d)==he(u),p=i(l.line,l.ch,h?d.text.length+1:null).end,v=i(c.line,h?0:null,c.ch).start;h&&(p.top<v.top-2?(f(p.right,p.top,null,p.bottom),f(m,v.top,v.left,v.bottom)):f(p.right,p.top,v.left-p.right,p.bottom)),p.bottom<v.top&&f(m,p.bottom,null,v.top)}t.appendChild(a)}function Li(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var i=!0;t.cursorDiv.style.visibility="",0<e.options.cursorBlinkRate?t.blinker=setInterval(function(){return t.cursorDiv.style.visibility=(i=!i)?"":"hidden"},e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function Ni(e){e.state.focused||(e.display.input.focus(),Mi(e))}function Oi(e){e.state.delayingBlurEvent=!0,setTimeout(function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,Ii(e))},100)}function Mi(e,t){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(Ne(e,"focus",e,t),e.state.focused=!0,r(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),ga&&setTimeout(function(){return e.display.input.reset(!0)},20)),e.display.input.receivedFocus()),Li(e))}function Ii(e,t){e.state.delayingBlurEvent||(e.state.focused&&(Ne(e,"blur",e,t),e.state.focused=!1,Ma(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150))}function Pi(e){for(var t=e.display,i=t.lineDiv.offsetTop,r=0;r<t.view.length;r++){var n=t.view[r],o=void 0;if(!n.hidden){if(fa&&ma<8){var a=n.node.offsetTop+n.node.offsetHeight;o=a-i,i=a}else{var s=n.node.getBoundingClientRect();o=s.bottom-s.top}var l=n.line.height-o;if(o<2&&(o=bi(t)),(.005<l||l<-.005)&&(N(n.line,o),Ri(n.line),n.rest))for(var c=0;c<n.rest.length;c++)Ri(n.rest[c])}}}function Ri(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t)e.widgets[t].height=e.widgets[t].node.parentNode.offsetHeight}function Di(e,t,i){var r=i&&null!=i.top?Math.max(0,i.top):e.scroller.scrollTop;r=Math.floor(r-Ht(e));var n=i&&null!=i.bottom?i.bottom:r+e.wrapper.clientHeight,o=M(t,r),a=M(t,n);if(i&&i.ensure){var s=i.ensure.from.line,l=i.ensure.to.line;s<o?a=M(t,ye($(t,o=s))+e.wrapper.clientHeight):Math.min(l,t.lastLine())>=a&&(o=M(t,ye($(t,l))-e.wrapper.clientHeight),a=l)}return{from:o,to:Math.max(a,o+1)}}function Fi(e){var t=e.display,i=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var r=ki(t)-t.scroller.scrollLeft+e.doc.scrollLeft,n=t.gutters.offsetWidth,o=r+"px",a=0;a<i.length;a++)if(!i[a].hidden){e.options.fixedGutter&&(i[a].gutter&&(i[a].gutter.style.left=o),i[a].gutterBackground&&(i[a].gutterBackground.style.left=o));var s=i[a].alignable;if(s)for(var l=0;l<s.length;l++)s[l].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=r+n+"px")}}function Bi(e){if(!e.options.lineNumbers)return!1;var t=e.doc,i=P(e.options,t.first+t.size-1),r=e.display;if(i.length==r.lineNumChars)return!1;var n=r.measure.appendChild(w("div",[w("div",i)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=n.firstChild.offsetWidth,a=n.offsetWidth-o;return r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(o,r.lineGutter.offsetWidth-a)+1,r.lineNumWidth=r.lineNumInnerWidth+a,r.lineNumChars=r.lineNumInnerWidth?i.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px",Lr(e),!0}function Hi(e,t){if(!Oe(e,"scrollCursorIntoView")){var i=e.display,r=i.sizer.getBoundingClientRect(),n=null;if(t.top+r.top<0?n=!0:t.bottom+r.top>(window.innerHeight||document.documentElement.clientHeight)&&(n=!1),null!=n&&!xa){var o=w("div","\u200b",null,"position: absolute;\n                         top: "+(t.top-i.viewOffset-Ht(e.display))+"px;\n                         height: "+(t.bottom-t.top+Ut(e)+i.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(o),o.scrollIntoView(n),e.display.lineSpace.removeChild(o)}}}function zi(e,t,i,r){var n;null==r&&(r=0),e.options.lineWrapping||t!=i||(i="before"==(t=t.ch?R(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t).sticky?R(t.line,t.ch+1,"before"):t);for(var o=0;o<5;o++){var a=!1,s=ui(e,t),l=i&&i!=t?ui(e,i):s,c=Ui(e,n={left:Math.min(s.left,l.left),top:Math.min(s.top,l.top)-r,right:Math.max(s.left,l.left),bottom:Math.max(s.bottom,l.bottom)+r}),d=e.doc.scrollTop,u=e.doc.scrollLeft;if(null!=c.scrollTop&&(Xi(e,c.scrollTop),1<Math.abs(e.doc.scrollTop-d)&&(a=!0)),null!=c.scrollLeft&&(Zi(e,c.scrollLeft),1<Math.abs(e.doc.scrollLeft-u)&&(a=!0)),!a)break}return n}function Wi(e,t){var i=Ui(e,t);null!=i.scrollTop&&Xi(e,i.scrollTop),null!=i.scrollLeft&&Zi(e,i.scrollLeft)}function Ui(e,t){var i=e.display,r=bi(e.display);t.top<0&&(t.top=0);var n=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:i.scroller.scrollTop,o=qt(e),a={};t.bottom-t.top>o&&(t.bottom=t.top+o);var s=e.doc.height+zt(i),l=t.top<r,c=t.bottom>s-r;if(t.top<n)a.scrollTop=l?0:t.top;else if(t.bottom>n+o){var d=Math.min(t.top,(c?s:t.bottom)-o);d!=n&&(a.scrollTop=d)}var u=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:i.scroller.scrollLeft,h=jt(e)-(e.options.fixedGutter?i.gutters.offsetWidth:0),p=t.right-t.left>h;return p&&(t.right=t.left+h),t.left<10?a.scrollLeft=0:t.left<u?a.scrollLeft=Math.max(0,t.left-(p?0:10)):t.right>h+u-3&&(a.scrollLeft=t.right+(p?0:10)-h),a}function ji(e,t){null!=t&&(Vi(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t)}function qi(e){Vi(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function Gi(e,t,i){null==t&&null==i||Vi(e),null!=t&&(e.curOp.scrollLeft=t),null!=i&&(e.curOp.scrollTop=i)}function Ki(e,t){Vi(e),e.curOp.scrollToPos=t}function Vi(e){var t=e.curOp.scrollToPos;t&&(e.curOp.scrollToPos=null,Yi(e,hi(e,t.from),hi(e,t.to),t.margin))}function Yi(e,t,i,r){var n=Ui(e,{left:Math.min(t.left,i.left),top:Math.min(t.top,i.top)-r,right:Math.max(t.right,i.right),bottom:Math.max(t.bottom,i.bottom)+r});Gi(e,n.scrollLeft,n.scrollTop)}function Xi(e,t){Math.abs(e.doc.scrollTop-t)<2||(da||$r(e,{top:t}),Qi(e,t,!0),da&&$r(e),kr(e,100))}function Qi(e,t,i){t=Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t),(e.display.scroller.scrollTop!=t||i)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function Zi(e,t,i,r){t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),(i?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!r||(e.doc.scrollLeft=t,Fi(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function Ji(e){var t=e.display,i=t.gutters.offsetWidth,r=Math.round(e.doc.height+zt(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?i:0,docHeight:r,scrollHeight:r+Ut(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:i}}function er(e,t){t||(t=Ji(e));var i=e.display.barWidth,r=e.display.barHeight;tr(e,t);for(var n=0;n<4&&i!=e.display.barWidth||r!=e.display.barHeight;n++)i!=e.display.barWidth&&e.options.lineWrapping&&Pi(e),tr(e,Ji(e)),i=e.display.barWidth,r=e.display.barHeight}function tr(e,t){var i=e.display,r=i.scrollbars.update(t);i.sizer.style.paddingRight=(i.barWidth=r.right)+"px",i.sizer.style.paddingBottom=(i.barHeight=r.bottom)+"px",i.heightForcer.style.borderBottom=r.bottom+"px solid transparent",r.right&&r.bottom?(i.scrollbarFiller.style.display="block",i.scrollbarFiller.style.height=r.bottom+"px",i.scrollbarFiller.style.width=r.right+"px"):i.scrollbarFiller.style.display="",r.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(i.gutterFiller.style.display="block",i.gutterFiller.style.height=r.bottom+"px",i.gutterFiller.style.width=t.gutterWidth+"px"):i.gutterFiller.style.display=""}function ir(i){i.display.scrollbars&&(i.display.scrollbars.clear(),i.display.scrollbars.addClass&&Ma(i.display.wrapper,i.display.scrollbars.addClass)),i.display.scrollbars=new ws[i.options.scrollbarStyle](function(e){i.display.wrapper.insertBefore(e,i.display.scrollbarFiller),Za(e,"mousedown",function(){i.state.focused&&setTimeout(function(){return i.display.input.focus()},0)}),e.setAttribute("cm-not-content","true")},function(e,t){"horizontal"==t?Zi(i,e):Xi(i,e)},i),i.display.scrollbars.addClass&&r(i.display.wrapper,i.display.scrollbars.addClass)}function rr(e){e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++ks},kt(e.curOp)}function nr(e){_t(e.curOp,function(e){for(var t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;or(e)})}function or(e){for(var t=e.ops,i=0;i<t.length;i++)ar(t[i]);for(var r=0;r<t.length;r++)sr(t[r]);for(var n=0;n<t.length;n++)lr(t[n]);for(var o=0;o<t.length;o++)cr(t[o]);for(var a=0;a<t.length;a++)dr(t[a])}function ar(e){var t=e.cm,i=t.display;_r(t),e.updateMaxLine&&ke(t),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<i.viewFrom||e.scrollToPos.to.line>=i.viewTo)||i.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new xs(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function sr(e){e.updatedDisplay=e.mustUpdate&&Sr(e.cm,e.update)}function lr(e){var t=e.cm,i=t.display;e.updatedDisplay&&Pi(t),e.barMeasure=Ji(t),i.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=Yt(t,i.maxLine,i.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(i.scroller.clientWidth,i.sizer.offsetLeft+e.adjustWidthTo+Ut(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,i.sizer.offsetLeft+e.adjustWidthTo-jt(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=i.input.prepareSelection(e.focus))}function cr(e){var t=e.cm;null!=e.adjustWidthTo&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&Zi(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);var i=e.focus&&e.focus==h()&&(!document.hasFocus||document.hasFocus());e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,i),(e.updatedDisplay||e.startHeight!=t.doc.height)&&er(t,e.barMeasure),e.updatedDisplay&&Nr(t,e.barMeasure),e.selectionChanged&&Li(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),i&&Ni(e.cm)}function dr(e){var t=e.cm,i=t.display,r=t.doc;(e.updatedDisplay&&Er(t,e.update),null==i.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(i.wheelStartX=i.wheelStartY=null),null!=e.scrollTop&&Qi(t,e.scrollTop,e.forceScroll),null!=e.scrollLeft&&Zi(t,e.scrollLeft,!0,!0),e.scrollToPos)&&Hi(t,zi(t,j(r,e.scrollToPos.from),j(r,e.scrollToPos.to),e.scrollToPos.margin));var n=e.maybeHiddenMarkers,o=e.maybeUnhiddenMarkers;if(n)for(var a=0;a<n.length;++a)n[a].lines.length||Ne(n[a],"hide");if(o)for(var s=0;s<o.length;++s)o[s].lines.length&&Ne(o[s],"unhide");i.wrapper.offsetHeight&&(r.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&Ne(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function ur(e,t){if(e.curOp)return t();rr(e);try{return t()}finally{nr(e)}}function hr(e,t){return function(){if(e.curOp)return t.apply(e,arguments);rr(e);try{return t.apply(e,arguments)}finally{nr(e)}}}function pr(e){return function(){if(this.curOp)return e.apply(this,arguments);rr(this);try{return e.apply(this,arguments)}finally{nr(this)}}}function fr(t){return function(){var e=this.cm;if(!e||e.curOp)return t.apply(this,arguments);rr(e);try{return t.apply(this,arguments)}finally{nr(e)}}}function mr(e,t,i,r){null==t&&(t=e.doc.first),null==i&&(i=e.doc.first+e.doc.size),r||(r=0);var n=e.display;if(r&&i<n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>t)&&(n.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=n.viewTo)Va&&me(e.doc,t)<n.viewTo&&vr(e);else if(i<=n.viewFrom)Va&&ge(e.doc,i+r)>n.viewFrom?vr(e):(n.viewFrom+=r,n.viewTo+=r);else if(t<=n.viewFrom&&i>=n.viewTo)vr(e);else if(t<=n.viewFrom){var o=br(e,i,i+r,1);o?(n.view=n.view.slice(o.index),n.viewFrom=o.lineN,n.viewTo+=r):vr(e)}else if(i>=n.viewTo){var a=br(e,t,t,-1);a?(n.view=n.view.slice(0,a.index),n.viewTo=a.lineN):vr(e)}else{var s=br(e,t,t,-1),l=br(e,i,i+r,1);s&&l?(n.view=n.view.slice(0,s.index).concat(wt(e,s.lineN,l.lineN)).concat(n.view.slice(l.index)),n.viewTo+=r):vr(e)}var c=n.externalMeasured;c&&(i<c.lineN?c.lineN+=r:t<c.lineN+c.size&&(n.externalMeasured=null))}function gr(e,t,i){e.curOp.viewChanged=!0;var r=e.display,n=e.display.externalMeasured;if(n&&t>=n.lineN&&t<n.lineN+n.size&&(r.externalMeasured=null),!(t<r.viewFrom||t>=r.viewTo)){var o=r.view[Ti(e,t)];if(null!=o.node){var a=o.changes||(o.changes=[]);-1==m(a,i)&&a.push(i)}}}function vr(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function br(e,t,i,r){var n,o=Ti(e,t),a=e.display.view;if(!Va||i==e.doc.first+e.doc.size)return{index:o,lineN:i};for(var s=e.display.viewFrom,l=0;l<o;l++)s+=a[l].size;if(s!=t){if(0<r){if(o==a.length-1)return null;n=s+a[o].size-t,o++}else n=s-t;t+=n,i+=n}for(;me(e.doc,i)!=i;){if(o==(r<0?0:a.length-1))return null;i+=r*a[o-(r<0?1:0)].size,o+=r}return{index:o,lineN:i}}function yr(e,t,i){var r=e.display;0==r.view.length||t>=r.viewTo||i<=r.viewFrom?(r.view=wt(e,t,i),r.viewFrom=t):(r.viewFrom>t?r.view=wt(e,t,r.viewFrom).concat(r.view):r.viewFrom<t&&(r.view=r.view.slice(Ti(e,t))),r.viewFrom=t,r.viewTo<i?r.view=r.view.concat(wt(e,r.viewTo,i)):r.viewTo>i&&(r.view=r.view.slice(0,Ti(e,i)))),r.viewTo=i}function wr(e){for(var t=e.display.view,i=0,r=0;r<t.length;r++){var n=t[r];n.hidden||n.node&&!n.changes||++i}return i}function kr(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,c(xr,e))}function xr(l){var c=l.doc;if(!(c.highlightFrontier>=l.display.viewTo)){var d=+new Date+l.options.workTime,u=et(l,c.highlightFrontier),h=[];c.iter(u.line,Math.min(c.first+c.size,l.display.viewTo+500),function(e){if(u.line>=l.display.viewFrom){var t=e.styles,i=e.text.length>l.options.maxHighlightLength?Ye(c.mode,u.state):null,r=Ze(l,e,u,!0);i&&(u.state=i),e.styles=r.styles;var n=e.styleClasses,o=r.classes;o?e.styleClasses=o:n&&(e.styleClasses=null);for(var a=!t||t.length!=e.styles.length||n!=o&&(!n||!o||n.bgClass!=o.bgClass||n.textClass!=o.textClass),s=0;!a&&s<t.length;++s)a=t[s]!=e.styles[s];a&&h.push(u.line),e.stateAfter=u.save(),u.nextLine()}else e.text.length<=l.options.maxHighlightLength&&tt(l,e.text,u),e.stateAfter=u.line%5==0?u.save():null,u.nextLine();if(+new Date>d)return kr(l,l.options.workDelay),!0}),c.highlightFrontier=u.line,c.modeFrontier=Math.max(c.modeFrontier,u.line),h.length&&ur(l,function(){for(var e=0;e<h.length;e++)gr(l,h[e],"text")})}}function _r(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=Ut(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=Ut(e)+"px",t.scrollbarsClipped=!0)}function Cr(e){if(e.hasFocus())return null;var t=h();if(!t||!g(e.display.lineDiv,t))return null;var i={activeElt:t};if(window.getSelection){var r=window.getSelection();r.anchorNode&&r.extend&&g(e.display.lineDiv,r.anchorNode)&&(i.anchorNode=r.anchorNode,i.anchorOffset=r.anchorOffset,i.focusNode=r.focusNode,i.focusOffset=r.focusOffset)}return i}function Tr(e){if(e&&e.activeElt&&e.activeElt!=h()&&(e.activeElt.focus(),e.anchorNode&&g(document.body,e.anchorNode)&&g(document.body,e.focusNode))){var t=window.getSelection(),i=document.createRange();i.setEnd(e.anchorNode,e.anchorOffset),i.collapse(!1),t.removeAllRanges(),t.addRange(i),t.extend(e.focusNode,e.focusOffset)}}function Sr(e,t){var i=e.display,r=e.doc;if(t.editorIsHidden)return vr(e),!1;if(!t.force&&t.visible.from>=i.viewFrom&&t.visible.to<=i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo)&&i.renderedView==i.view&&0==wr(e))return!1;Bi(e)&&(vr(e),t.dims=wi(e));var n=r.first+r.size,o=Math.max(t.visible.from-e.options.viewportMargin,r.first),a=Math.min(n,t.visible.to+e.options.viewportMargin);i.viewFrom<o&&o-i.viewFrom<20&&(o=Math.max(r.first,i.viewFrom)),i.viewTo>a&&i.viewTo-a<20&&(a=Math.min(n,i.viewTo)),Va&&(o=me(e.doc,o),a=ge(e.doc,a));var s=o!=i.viewFrom||a!=i.viewTo||i.lastWrapHeight!=t.wrapperHeight||i.lastWrapWidth!=t.wrapperWidth;yr(e,o,a),i.viewOffset=ye($(e.doc,i.viewFrom)),e.display.mover.style.top=i.viewOffset+"px";var l=wr(e);if(!s&&0==l&&!t.force&&i.renderedView==i.view&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo))return!1;var c=Cr(e);return 4<l&&(i.lineDiv.style.display="none"),Ar(e,i.updateLineNumbers,t.dims),4<l&&(i.lineDiv.style.display=""),i.renderedView=i.view,Tr(c),f(i.cursorDiv),f(i.selectionDiv),i.gutters.style.height=i.sizer.style.minHeight=0,s&&(i.lastWrapHeight=t.wrapperHeight,i.lastWrapWidth=t.wrapperWidth,kr(e,400)),!(i.updateLineNumbers=null)}function Er(e,t){for(var i=t.viewport,r=!0;(r&&e.options.lineWrapping&&t.oldDisplayWidth!=jt(e)||(i&&null!=i.top&&(i={top:Math.min(e.doc.height+zt(e.display)-qt(e),i.top)}),t.visible=Di(e.display,e.doc,i),!(t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)))&&Sr(e,t);r=!1){Pi(e);var n=Ji(e);Si(e),er(e,n),Nr(e,n),t.force=!1}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function $r(e,t){var i=new xs(e,t);if(Sr(e,i)){Pi(e),Er(e,i);var r=Ji(e);Si(e),er(e,r),Nr(e,r),i.finish()}}function Ar(i,e,t){function r(e){var t=e.nextSibling;return ga&&Sa&&i.display.currentWheelTarget==e?e.style.display="none":e.parentNode.removeChild(e),t}for(var n=i.display,o=i.options.lineNumbers,a=n.lineDiv,s=a.firstChild,l=n.view,c=n.viewFrom,d=0;d<l.length;d++){var u=l[d];if(u.hidden);else if(u.node&&u.node.parentNode==a){for(;s!=u.node;)s=r(s);var h=o&&null!=e&&e<=c&&u.lineNumber;u.changes&&(-1<m(u.changes,"gutter")&&(h=!1),St(i,u,c,t)),h&&(f(u.lineNumber),u.lineNumber.appendChild(document.createTextNode(P(i.options,c)))),s=u.node.nextSibling}else{var p=It(i,u,c,t);a.insertBefore(p,s)}c+=u.size}for(;s;)s=r(s)}function Lr(e){var t=e.display.gutters.offsetWidth;e.display.sizer.style.marginLeft=t+"px"}function Nr(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+Ut(e)+"px"}function Or(e){var t=e.display.gutters,i=e.options.gutters;f(t);for(var r=0;r<i.length;++r){var n=i[r],o=t.appendChild(w("div",null,"CodeMirror-gutter "+n));"CodeMirror-linenumbers"==n&&((e.display.lineGutter=o).style.width=(e.display.lineNumWidth||1)+"px")}t.style.display=r?"":"none",Lr(e)}function Mr(e){var t=m(e.gutters,"CodeMirror-linenumbers");-1==t&&e.lineNumbers?e.gutters=e.gutters.concat(["CodeMirror-linenumbers"]):-1<t&&!e.lineNumbers&&(e.gutters=e.gutters.slice(0),e.gutters.splice(t,1))}function Ir(e){var t=e.wheelDeltaX,i=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==i&&e.detail&&e.axis==e.VERTICAL_AXIS?i=e.detail:null==i&&(i=e.wheelDelta),{x:t,y:i}}function Pr(e){var t=Ir(e);return t.x*=Cs,t.y*=Cs,t}function Rr(e,t){var i=Ir(t),r=i.x,n=i.y,o=e.display,a=o.scroller,s=a.scrollWidth>a.clientWidth,l=a.scrollHeight>a.clientHeight;if(r&&s||n&&l){if(n&&Sa&&ga)e:for(var c=t.target,d=o.view;c!=a;c=c.parentNode)for(var u=0;u<d.length;u++)if(d[u].node==c){e.display.currentWheelTarget=c;break e}if(r&&!da&&!ya&&null!=Cs)return n&&l&&Xi(e,Math.max(0,a.scrollTop+n*Cs)),Zi(e,Math.max(0,a.scrollLeft+r*Cs)),(!n||n&&l)&&Pe(t),void(o.wheelStartX=null);if(n&&null!=Cs){var h=n*Cs,p=e.doc.scrollTop,f=p+o.wrapper.clientHeight;h<0?p=Math.max(0,p+h-50):f=Math.min(e.doc.height,f+h+50),$r(e,{top:p,bottom:f})}_s<20&&(null==o.wheelStartX?(o.wheelStartX=a.scrollLeft,o.wheelStartY=a.scrollTop,o.wheelDX=r,o.wheelDY=n,setTimeout(function(){if(null!=o.wheelStartX){var e=a.scrollLeft-o.wheelStartX,t=a.scrollTop-o.wheelStartY,i=t&&o.wheelDY&&t/o.wheelDY||e&&o.wheelDX&&e/o.wheelDX;o.wheelStartX=o.wheelStartY=null,i&&(Cs=(Cs*_s+i)/(_s+1),++_s)}},200)):(o.wheelDX+=r,o.wheelDY+=n))}}function Dr(e,t){var i=e[t];e.sort(function(e,t){return D(e.from(),t.from())}),t=m(e,i);for(var r=1;r<e.length;r++){var n=e[r],o=e[r-1];if(0<=D(o.to(),n.from())){var a=z(o.from(),n.from()),s=H(o.to(),n.to()),l=o.empty()?n.from()==n.head:o.from()==o.head;r<=t&&--t,e.splice(--r,2,new Ss(l?s:a,l?a:s))}}return new Ts(e,t)}function Fr(e,t){return new Ts([new Ss(e,t||e)],0)}function Br(e){return e.text?R(e.from.line+e.text.length-1,U(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function Hr(e,t){if(D(e,t.from)<0)return e;if(D(e,t.to)<=0)return Br(t);var i=e.line+t.text.length-(t.to.line-t.from.line)-1,r=e.ch;return e.line==t.to.line&&(r+=Br(t).ch-t.to.ch),R(i,r)}function zr(e,t){for(var i=[],r=0;r<e.sel.ranges.length;r++){var n=e.sel.ranges[r];i.push(new Ss(Hr(n.anchor,t),Hr(n.head,t)))}return Dr(i,e.sel.primIndex)}function Wr(
e,t,i){return e.line==t.line?R(i.line,e.ch-t.ch+i.ch):R(i.line+(e.line-t.line),e.ch)}function Ur(e,t,i){for(var r=[],n=R(e.first,0),o=n,a=0;a<t.length;a++){var s=t[a],l=Wr(s.from,n,o),c=Wr(Br(s),n,o);if(n=s.to,o=c,"around"==i){var d=e.sel.ranges[a],u=D(d.head,d.anchor)<0;r[a]=new Ss(u?c:l,u?l:c)}else r[a]=new Ss(l,l)}return new Ts(r,e.sel.primIndex)}function jr(e){e.doc.mode=Ke(e.options,e.doc.modeOption),qr(e)}function qr(e){e.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,kr(e,100),e.state.modeGen++,e.curOp&&mr(e)}function Gr(e,t){return 0==t.from.ch&&0==t.to.ch&&""==U(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function Kr(e,r,t,n){function o(e){return t?t[e]:null}function i(e,t,i){ct(e,t,i,n),Ct(e,"change",e,r)}function a(e,t){for(var i=[],r=e;r<t;++r)i.push(new us(c[r],o(r),n));return i}var s=r.from,l=r.to,c=r.text,d=$(e,s.line),u=$(e,l.line),h=U(c),p=o(c.length-1),f=l.line-s.line;if(r.full)e.insert(0,a(0,c.length)),e.remove(c.length,e.size-c.length);else if(Gr(e,r)){var m=a(0,c.length-1);i(u,u.text,p),f&&e.remove(s.line,f),m.length&&e.insert(s.line,m)}else if(d==u)if(1==c.length)i(d,d.text.slice(0,s.ch)+h+d.text.slice(l.ch),p);else{var g=a(1,c.length-1);g.push(new us(h+d.text.slice(l.ch),p,n)),i(d,d.text.slice(0,s.ch)+c[0],o(0)),e.insert(s.line+1,g)}else if(1==c.length)i(d,d.text.slice(0,s.ch)+c[0]+u.text.slice(l.ch),o(0)),e.remove(s.line+1,f);else{i(d,d.text.slice(0,s.ch)+c[0],o(0)),i(u,h+u.text.slice(l.ch),p);var v=a(1,c.length-1);1<f&&e.remove(s.line+1,f-1),e.insert(s.line+1,v)}Ct(e,"change",e,r)}function Vr(e,a,s){function l(e,t,i){if(e.linked)for(var r=0;r<e.linked.length;++r){var n=e.linked[r];if(n.doc!=t){var o=i&&n.sharedHist;s&&!o||(a(n.doc,o),l(n.doc,e,o))}}}l(e,null,!0)}function Yr(e,t){if(t.cm)throw new Error("This document is already in use.");_i((e.doc=t).cm=e),jr(e),Xr(e),e.options.lineWrapping||ke(e),e.options.mode=t.modeOption,mr(e)}function Xr(e){("rtl"==e.doc.direction?r:Ma)(e.display.lineDiv,"CodeMirror-rtl")}function Qr(e){ur(e,function(){Xr(e),mr(e)})}function Zr(e){this.done=[],this.undone=[],this.undoDepth=Infinity,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function Jr(e,t){var i={from:B(t.from),to:Br(t),text:A(e,t.from,t.to)};return sn(e,i,t.from.line,t.to.line+1),Vr(e,function(e){return sn(e,i,t.from.line,t.to.line+1)},!0),i}function en(e){for(;e.length;){if(!U(e).ranges)break;e.pop()}}function tn(e,t){return t?(en(e.done),U(e.done)):e.done.length&&!U(e.done).ranges?U(e.done):1<e.done.length&&!e.done[e.done.length-2].ranges?(e.done.pop(),U(e.done)):void 0}function rn(e,t,i,r){var n=e.history;n.undone.length=0;var o,a,s=+new Date;if((n.lastOp==r||n.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&n.lastModTime>s-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0)))&&(o=tn(n,n.lastOp==r)))a=U(o.changes),0==D(t.from,t.to)&&0==D(t.from,a.to)?a.to=Br(t):o.changes.push(Jr(e,t));else{var l=U(n.done);for(l&&l.ranges||an(e.sel,n.done),o={changes:[Jr(e,t)],generation:n.generation},n.done.push(o);n.done.length>n.undoDepth;)n.done.shift(),n.done[0].ranges||n.done.shift()}n.done.push(i),n.generation=++n.maxGeneration,n.lastModTime=n.lastSelTime=s,n.lastOp=n.lastSelOp=r,n.lastOrigin=n.lastSelOrigin=t.origin,a||Ne(e,"historyAdded")}function nn(e,t,i,r){var n=t.charAt(0);return"*"==n||"+"==n&&i.ranges.length==r.ranges.length&&i.somethingSelected()==r.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function on(e,t,i,r){var n=e.history,o=r&&r.origin;i==n.lastSelOp||o&&n.lastSelOrigin==o&&(n.lastModTime==n.lastSelTime&&n.lastOrigin==o||nn(e,o,U(n.done),t))?n.done[n.done.length-1]=t:an(t,n.done),n.lastSelTime=+new Date,n.lastSelOrigin=o,n.lastSelOp=i,r&&!1!==r.clearRedo&&en(n.undone)}function an(e,t){var i=U(t);i&&i.ranges&&i.equals(e)||t.push(e)}function sn(t,i,e,r){var n=i["spans_"+t.id],o=0;t.iter(Math.max(t.first,e),Math.min(t.first+t.size,r),function(e){e.markedSpans&&((n||(n=i["spans_"+t.id]={}))[o]=e.markedSpans),++o})}function ln(e){if(!e)return null;for(var t,i=0;i<e.length;++i)e[i].marker.explicitlyCleared?t||(t=e.slice(0,i)):t&&t.push(e[i]);return t?t.length?t:null:e}function cn(e,t){var i=t["spans_"+e.id];if(!i)return null;for(var r=[],n=0;n<t.text.length;++n)r.push(ln(i[n]));return r}function dn(e,t){var i=cn(e,t),r=te(e,t);if(!i)return r;if(!r)return i;for(var n=0;n<i.length;++n){var o=i[n],a=r[n];if(o&&a)e:for(var s=0;s<a.length;++s){for(var l=a[s],c=0;c<o.length;++c)if(o[c].marker==l.marker)continue e;o.push(l)}else a&&(i[n]=a)}return i}function un(e,t,i){for(var r=[],n=0;n<e.length;++n){var o=e[n];if(o.ranges)r.push(i?Ts.prototype.deepCopy.call(o):o);else{var a=o.changes,s=[];r.push({changes:s});for(var l=0;l<a.length;++l){var c=a[l],d=void 0;if(s.push({from:c.from,to:c.to,text:c.text}),t)for(var u in c)(d=u.match(/^spans_(\d+)$/))&&-1<m(t,Number(d[1]))&&(U(s)[u]=c[u],delete c[u])}}}return r}function hn(e,t,i,r){if(r){var n=e.anchor;if(i){var o=D(t,n)<0;o!=D(i,n)<0?(n=t,t=i):o!=D(t,i)<0&&(t=i)}return new Ss(n,t)}return new Ss(i||t,t)}function pn(e,t,i,r,n){null==n&&(n=e.cm&&(e.cm.display.shift||e.extend)),yn(e,new Ts([hn(e.sel.primary(),t,i,n)],0),r)}function fn(e,t,i){for(var r=[],n=e.cm&&(e.cm.display.shift||e.extend),o=0;o<e.sel.ranges.length;o++)r[o]=hn(e.sel.ranges[o],t[o],null,n);yn(e,Dr(r,e.sel.primIndex),i)}function mn(e,t,i,r){var n=e.sel.ranges.slice(0);n[t]=i,yn(e,Dr(n,e.sel.primIndex),r)}function gn(e,t,i,r){yn(e,Fr(t,i),r)}function vn(r,e,t){var i={ranges:e.ranges,update:function(e){var t=this;this.ranges=[];for(var i=0;i<e.length;i++)t.ranges[i]=new Ss(j(r,e[i].anchor),j(r,e[i].head))},origin:t&&t.origin};return Ne(r,"beforeSelectionChange",r,i),r.cm&&Ne(r.cm,"beforeSelectionChange",r.cm,i),i.ranges!=e.ranges?Dr(i.ranges,i.ranges.length-1):e}function bn(e,t,i){var r=e.history.done,n=U(r);n&&n.ranges?wn(e,r[r.length-1]=t,i):yn(e,t,i)}function yn(e,t,i){wn(e,t,i),on(e,e.sel,e.cm?e.cm.curOp.id:NaN,i)}function wn(e,t,i){(Ie(e,"beforeSelectionChange")||e.cm&&Ie(e.cm,"beforeSelectionChange"))&&(t=vn(e,t,i)),kn(e,_n(e,t,i&&i.bias||(D(t.primary().head,e.sel.primary().head)<0?-1:1),!0)),i&&!1===i.scroll||!e.cm||qi(e.cm)}function kn(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=!0,Me(e.cm)),Ct(e,"cursorActivity",e))}function xn(e){kn(e,_n(e,e.sel,null,!1))}function _n(e,t,i,r){for(var n,o=0;o<t.ranges.length;o++){var a=t.ranges[o],s=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],l=Tn(e,a.anchor,s&&s.anchor,i,r),c=Tn(e,a.head,s&&s.head,i,r);(n||l!=a.anchor||c!=a.head)&&(n||(n=t.ranges.slice(0,o)),n[o]=new Ss(l,c))}return n?Dr(n,t.primIndex):t}function Cn(e,t,i,r,n){var o=$(e,t.line);if(o.markedSpans)for(var a=0;a<o.markedSpans.length;++a){var s=o.markedSpans[a],l=s.marker;if((null==s.from||(l.inclusiveLeft?s.from<=t.ch:s.from<t.ch))&&(null==s.to||(l.inclusiveRight?s.to>=t.ch:s.to>t.ch))){if(n&&(Ne(l,"beforeCursorEnter"),l.explicitlyCleared)){if(o.markedSpans){--a;continue}break}if(!l.atomic)continue;if(i){var c=l.find(r<0?1:-1),d=void 0;if((r<0?l.inclusiveRight:l.inclusiveLeft)&&(c=Sn(e,c,-r,c&&c.line==t.line?o:null)),c&&c.line==t.line&&(d=D(c,i))&&(r<0?d<0:0<d))return Cn(e,c,t,r,n)}var u=l.find(r<0?-1:1);return(r<0?l.inclusiveLeft:l.inclusiveRight)&&(u=Sn(e,u,r,u.line==t.line?o:null)),u?Cn(e,u,t,r,n):null}}return t}function Tn(e,t,i,r,n){var o=r||1,a=Cn(e,t,i,o,n)||!n&&Cn(e,t,i,o,!0)||Cn(e,t,i,-o,n)||!n&&Cn(e,t,i,-o,!0);return a||(e.cantEdit=!0,R(e.first,0))}function Sn(e,t,i,r){return i<0&&0==t.ch?t.line>e.first?j(e,R(t.line-1)):null:0<i&&t.ch==(r||$(e,t.line)).text.length?t.line<e.first+e.size-1?R(t.line+1,0):null:new R(t.line,t.ch+i)}function En(e){e.setSelection(R(e.firstLine(),0),R(e.lastLine()),za)}function $n(n,e,t){var o={canceled:!1,from:e.from,to:e.to,text:e.text,origin:e.origin,cancel:function(){return o.canceled=!0}};return t&&(o.update=function(e,t,i,r){e&&(o.from=j(n,e)),t&&(o.to=j(n,t)),i&&(o.text=i),r!==undefined&&(o.origin=r)}),Ne(n,"beforeChange",n,o),n.cm&&Ne(n.cm,"beforeChange",n.cm,o),o.canceled?null:{from:o.from,to:o.to,text:o.text,origin:o.origin}}function An(e,t,i){if(e.cm){if(!e.cm.curOp)return hr(e.cm,An)(e,t,i);if(e.cm.state.suppressEdits)return}if(!(Ie(e,"beforeChange")||e.cm&&Ie(e.cm,"beforeChange"))||(t=$n(e,t,!0))){var r=Ka&&!i&&re(e,t.from,t.to);if(r)for(var n=r.length-1;0<=n;--n)Ln(e,{from:r[n].from,to:r[n].to,text:n?[""]:t.text});else Ln(e,t)}}function Ln(e,i){if(1!=i.text.length||""!=i.text[0]||0!=D(i.from,i.to)){var t=zr(e,i);rn(e,i,t,e.cm?e.cm.curOp.id:NaN),Mn(e,i,t,te(e,i));var r=[];Vr(e,function(e,t){t||-1!=m(r,e.history)||(Fn(e.history,i),r.push(e.history)),Mn(e,i,null,te(e,i))})}}function Nn(n,o,e){if(!n.cm||!n.cm.state.suppressEdits||e){for(var a,t=n.history,i=n.sel,s="undo"==o?t.done:t.undone,r="undo"==o?t.undone:t.done,l=0;l<s.length&&(a=s[l],e?!a.ranges||a.equals(n.sel):a.ranges);l++);if(l!=s.length){for(t.lastOrigin=t.lastSelOrigin=null;(a=s.pop()).ranges;){if(an(a,r),e&&!a.equals(n.sel))return void yn(n,a,{clearRedo:!1});i=a}var c=[];an(i,r),r.push({changes:c,generation:t.generation}),t.generation=a.generation||++t.maxGeneration;for(var d=Ie(n,"beforeChange")||n.cm&&Ie(n.cm,"beforeChange"),u=function(e){var i=a.changes[e];if(i.origin=o,d&&!$n(n,i,!1))return s.length=0,{};c.push(Jr(n,i));var t=e?zr(n,i):U(s);Mn(n,i,t,dn(n,i)),!e&&n.cm&&n.cm.scrollIntoView({from:i.from,to:Br(i)});var r=[];Vr(n,function(e,t){t||-1!=m(r,e.history)||(Fn(e.history,i),r.push(e.history)),Mn(e,i,null,dn(e,i))})},h=a.changes.length-1;0<=h;--h){var p=u(h);if(p)return p.v}}}}function On(e,t){if(0!=t&&(e.first+=t,e.sel=new Ts(v(e.sel.ranges,function(e){return new Ss(R(e.anchor.line+t,e.anchor.ch),R(e.head.line+t,e.head.ch))}),e.sel.primIndex),e.cm)){mr(e.cm,e.first,e.first-t,t);for(var i=e.cm.display,r=i.viewFrom;r<i.viewTo;r++)gr(e.cm,r,"gutter")}}function Mn(e,t,i,r){if(e.cm&&!e.cm.curOp)return hr(e.cm,Mn)(e,t,i,r);if(t.to.line<e.first)On(e,t.text.length-1-(t.to.line-t.from.line));else if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var n=t.text.length-1-(e.first-t.from.line);On(e,n),t={from:R(e.first,0),to:R(t.to.line+n,t.to.ch),text:[U(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:R(o,$(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=A(e,t.from,t.to),i||(i=zr(e,t)),e.cm?In(e.cm,t,r):Kr(e,t,r),wn(e,i,za)}}function In(e,t,i){var r=e.doc,n=e.display,o=t.from,a=t.to,s=!1,l=o.line;e.options.lineWrapping||(l=O(he($(r,o.line))),r.iter(l,a.line+1,function(e){if(e==n.maxLine)return s=!0})),-1<r.sel.contains(t.from,t.to)&&Me(e),Kr(r,t,i,xi(e)),e.options.lineWrapping||(r.iter(l,o.line+t.text.length,function(e){var t=we(e);t>n.maxLineLength&&(n.maxLine=e,n.maxLineLength=t,n.maxLineChanged=!0,s=!1)}),s&&(e.curOp.updateMaxLine=!0)),lt(r,o.line),kr(e,400);var c=t.text.length-(a.line-o.line)-1;t.full?mr(e):o.line!=a.line||1!=t.text.length||Gr(e.doc,t)?mr(e,o.line,a.line+1,c):gr(e,o.line,"text");var d=Ie(e,"changes"),u=Ie(e,"change");if(u||d){var h={from:o,to:a,text:t.text,removed:t.removed,origin:t.origin};u&&Ct(e,"change",e,h),d&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(h)}e.display.selForContextMenu=null}function Pn(e,t,i,r,n){if(r||(r=i),D(r,i)<0){var o=r;r=i,i=o}"string"==typeof t&&(t=e.splitLines(t)),An(e,{from:i,to:r,text:t,origin:n})}function Rn(e,t,i,r){i<e.line?e.line+=r:t<e.line&&(e.line=t,e.ch=0)}function Dn(e,t,i,r){for(var n=0;n<e.length;++n){var o=e[n],a=!0;if(o.ranges){o.copied||((o=e[n]=o.deepCopy()).copied=!0);for(var s=0;s<o.ranges.length;s++)Rn(o.ranges[s].anchor,t,i,r),Rn(o.ranges[s].head,t,i,r)}else{for(var l=0;l<o.changes.length;++l){var c=o.changes[l];if(i<c.from.line)c.from=R(c.from.line+r,c.from.ch),c.to=R(c.to.line+r,c.to.ch);else if(t<=c.to.line){a=!1;break}}a||(e.splice(0,n+1),n=0)}}}function Fn(e,t){var i=t.from.line,r=t.to.line,n=t.text.length-(r-i)-1;Dn(e.done,i,r,n),Dn(e.undone,i,r,n)}function Bn(e,t,i,r){var n=t,o=t;return"number"==typeof t?o=$(e,W(e,t)):n=O(t),null==n?null:(r(o,n)&&e.cm&&gr(e.cm,n,i),o)}function Hn(e){var t=this;this.lines=e,this.parent=null;for(var i=0,r=0;r<e.length;++r)e[r].parent=t,i+=e[r].height;this.height=i}function zn(e){var t=this;this.children=e;for(var i=0,r=0,n=0;n<e.length;++n){var o=e[n];i+=o.chunkSize(),r+=o.height,o.parent=t}this.size=i,this.height=r,this.parent=null}function Wn(e,t,i){ye(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&ji(e,i)}function Un(r,e,t,i){var n=new Es(r,t,i),o=r.cm;return o&&n.noHScroll&&(o.display.alignWidgets=!0),Bn(r,e,"widget",function(e){var t=e.widgets||(e.widgets=[]);if(null==n.insertAt?t.push(n):t.splice(Math.min(t.length-1,Math.max(0,n.insertAt)),0,n),n.line=e,o&&!ve(r,e)){var i=ye(e)<r.scrollTop;N(e,e.height+Ft(n)),i&&ji(o,n.height),o.curOp.forceUpdate=!0}return!0}),Ct(o,"lineWidgetAdded",o,n,"number"==typeof e?e:O(e)),n}function jn(t,i,r,e,n){if(e&&e.shared)return qn(t,i,r,e,n);if(t.cm&&!t.cm.curOp)return hr(t.cm,jn)(t,i,r,e,n);var o=new As(t,n),a=D(i,r);if(e&&p(e,o,!1),0<a||0==a&&!1!==o.clearWhenEmpty)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=u("span",[o.replacedWith],"CodeMirror-widget"),e.handleMouseEvents||o.widgetNode.setAttribute("cm-ignore-events","true"),e.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(ue(t,i.line,i,r,o)||i.line!=r.line&&ue(t,r.line,i,r,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");V()}o.addToHistory&&rn(t,{from:i,to:r,origin:"markText"},t.sel,NaN);var s,l=i.line,c=t.cm;if(t.iter(l,r.line+1,function(e){c&&o.collapsed&&!c.options.lineWrapping&&he(e)==c.display.maxLine&&(s=!0),o.collapsed&&l!=i.line&&N(e,0),Z(e,new Y(o,l==i.line?i.ch:null,l==r.line?r.ch:null)),++l}),o.collapsed&&t.iter(i.line,r.line+1,function(e){ve(t,e)&&N(e,0)}),o.clearOnEnter&&Za(o,"beforeCursorEnter",function(){return o.clear()}),o.readOnly&&(K(),(t.history.done.length||t.history.undone.length)&&t.clearHistory()),o.collapsed&&(o.id=++$s,o.atomic=!0),c){if(s&&(c.curOp.updateMaxLine=!0),o.collapsed)mr(c,i.line,r.line+1);else if(o.className||o.title||o.startStyle||o.endStyle||o.css)for(var d=i.line;d<=r.line;d++)gr(c,d,"text");o.atomic&&xn(c.doc),Ct(c,"markerAdded",c,o)}return o}function qn(e,i,r,n,o){(n=p(n)).shared=!1;var a=[jn(e,i,r,n,o)],s=a[0],l=n.widgetNode;return Vr(e,function(e){l&&(n.widgetNode=l.cloneNode(!0)),a.push(jn(e,j(e,i),j(e,r),n,o));for(var t=0;t<e.linked.length;++t)if(e.linked[t].isParent)return;s=U(a)}),new Ls(a,s)}function Gn(e){return e.findMarks(R(e.first,0),e.clipPos(R(e.lastLine())),function(e){return e.parent})}function Kn(e,t){for(var i=0;i<t.length;i++){var r=t[i],n=r.find(),o=e.clipPos(n.from),a=e.clipPos(n.to);if(D(o,a)){var s=jn(e,o,a,r.primary,r.primary.type);r.markers.push(s),s.parent=r}}}function Vn(o){for(var e=function(e){var t=o[e],i=[t.primary.doc];Vr(t.primary.doc,function(e){return i.push(e)});for(var r=0;r<t.markers.length;r++){var n=t.markers[r];-1==m(i,n.doc)&&(n.parent=null,t.markers.splice(r--,1))}},t=0;t<o.length;t++)e(t)}function Yn(e){var n=this;if(Zn(n),!Oe(n,e)&&!Bt(n.display,e)){Pe(e),fa&&(Ms=+new Date);var o=Ci(n,e,!0),t=e.dataTransfer.files;if(o&&!n.isReadOnly())if(t&&t.length&&window.FileReader&&window.File)for(var a=t.length,s=Array(a),l=0,i=function(e,i){if(!n.options.allowDropFileTypes||-1!=m(n.options.allowDropFileTypes,e.type)){var r=new FileReader;r.onload=hr(n,function(){var e=r.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(e)&&(e=""),s[i]=e,++l==a){var t={from:o=j(n.doc,o),to:o,text:n.doc.splitLines(s.join(n.doc.lineSeparator())),origin:"paste"};An(n.doc,t),bn(n.doc,Fr(o,Br(t)))}}),r.readAsText(e)}},r=0;r<a;++r)i(t[r],r);else{if(n.state.draggingText&&-1<n.doc.sel.contains(o))return n.state.draggingText(e),void setTimeout(function(){return n.display.input.focus()},20);try{var c=e.dataTransfer.getData("Text");if(c){var d;if(n.state.draggingText&&!n.state.draggingText.copy&&(d=n.listSelections()),wn(n.doc,Fr(o,o)),d)for(var u=0;u<d.length;++u)Pn(n.doc,"",d[u].anchor,d[u].head,"drag");n.replaceSelection(c,"around","paste"),n.display.input.focus()}}catch(e){}}}}function Xn(e,t){if(fa&&(!e.state.draggingText||+new Date-Ms<100))Fe(t);else if(!Oe(e,t)&&!Bt(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!wa)){var i=w("img",null,null,"position: fixed; left: 0; top: 0;");i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",ya&&(i.width=i.height=1,e.display.wrapper.appendChild(i),i._top=i.offsetTop),t.dataTransfer.setDragImage(i,0,0),ya&&i.parentNode.removeChild(i)}}function Qn(e,t){var i=Ci(e,t);if(i){var r=document.createDocumentFragment();$i(e,i,r),e.display.dragCursor||(e.display.dragCursor=w("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),o(e.display.dragCursor,r)}}function Zn(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function Jn(e){if(document.getElementsByClassName)for(var t=document.getElementsByClassName("CodeMirror"),i=0;i<t.length;i++){var r=t[i].CodeMirror;r&&e(r)}}function eo(){Is||(to(),Is=!0)}function to(){var e;Za(window,"resize",function(){null==e&&(e=setTimeout(function(){e=null,Jn(io)},100))}),Za(window,"blur",function(){return Jn(Ii)})}function io(e){var t=e.display;t.lastWrapHeight==t.wrapper.clientHeight&&t.lastWrapWidth==t.wrapper.clientWidth||(t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize())}function ro(e){var t,i,r,n,o=e.split(/-(?!$)/);e=o[o.length-1];for(var a=0;a<o.length-1;a++){var s=o[a];if(/^(cmd|meta|m)$/i.test(s))n=!0;else if(/^a(lt)?$/i.test(s))t=!0;else if(/^(c|ctrl|control)$/i.test(s))i=!0;else{if(!/^s(hift)?$/i.test(s))throw new Error("Unrecognized modifier name: "+s);r=!0}}return t&&(e="Alt-"+e),i&&(e="Ctrl-"+e),n&&(e="Cmd-"+e),r&&(e="Shift-"+e),e}function no(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];if(/^(name|fallthrough|(de|at)tach)$/.test(i))continue;if("..."==r){delete e[i];continue}for(var n=v(i.split(" "),ro),o=0;o<n.length;o++){var a=void 0,s=void 0;a=o==n.length-1?(s=n.join(" "),r):(s=n.slice(0,o+1).join(" "),"...");var l=t[s];if(l){if(l!=a)throw new Error("Inconsistent bindings for "+s)}else t[s]=a}delete e[i]}for(var c in t)e[c]=t[c];return e}function oo(e,t,i,r){var n=(t=co(t)).call?t.call(e,r):t[e];if(!1===n)return"nothing";if("..."===n)return"multi";if(null!=n&&i(n))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return oo(e,t.fallthrough,i,r);for(var o=0;o<t.fallthrough.length;o++){var a=oo(e,t.fallthrough[o],i,r);if(a)return a}}}function ao(e){var t="string"==typeof e?e:Ps[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function so(e,t,i){var r=e;return t.altKey&&"Alt"!=r&&(e="Alt-"+e),(Na?t.metaKey:t.ctrlKey)&&"Ctrl"!=r&&(e="Ctrl-"+e),(Na?t.ctrlKey:t.metaKey)&&"Cmd"!=r&&(e="Cmd-"+e),!i&&t.shiftKey&&"Shift"!=r&&(e="Shift-"+e),e}function lo(e,t){if(ya&&34==e.keyCode&&e["char"])return!1;var i=Ps[e.keyCode];return null!=i&&!e.altGraphKey&&so(i,e,t)}function co(e){return"string"==typeof e?Bs[e]:e}function uo(t,e){for(var i=t.doc.sel.ranges,r=[],n=0;n<i.length;n++){for(var o=e(i[n]);r.length&&D(o.from,U(r).to)<=0;){var a=r.pop();if(D(a.from,o.from)<0){o.from=a.from;break}}r.push(o)}ur(t,function(){for(var e=r.length-1;0<=e;e--)Pn(t.doc,"",r[e].from,r[e].to,"+delete");qi(t)})}function ho(e,t){var i=$(e.doc,t),r=he(i);return r!=i&&(t=O(r)),Ee(!0,e,r,t,1)}function po(e,t){var i=$(e.doc,t),r=pe(i);return r!=i&&(t=O(r)),Ee(!0,e,i,t,-1)}function fo(e,t){var i=ho(e,t.line),r=$(e.doc,i.line),n=Ce(r,e.doc.direction);if(n&&0!=n[0].level)return i;var o=Math.max(0,r.text.search(/\S/)),a=t.line==i.line&&t.ch<=o&&t.ch;return R(i.line,a?0:o,i.sticky)}function mo(e,t,i){if("string"==typeof t&&!(t=Ws[t]))return!1;e.display.input.ensurePolled();var r=e.display.shift,n=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),i&&(e.display.shift=!1),n=t(e)!=Ha}finally{e.display.shift=r,e.state.suppressEdits=!1}return n}function go(e,t,i){for(var r=0;r<e.state.keyMaps.length;r++){var n=oo(t,e.state.keyMaps[r],i,e);if(n)return n}return e.options.extraKeys&&oo(t,e.options.extraKeys,i,e)||oo(t,e.options.keyMap,i,e)}function vo(e,t,i,r){var n=e.state.keySeq;if(n){if(ao(t))return"handled";Us.set(50,function(){e.state.keySeq==n&&(e.state.keySeq=null,e.display.input.reset())}),t=n+" "+t}var o=go(e,t,r);return"multi"==o&&(e.state.keySeq=t),"handled"==o&&Ct(e,"keyHandled",e,t,i),"handled"!=o&&"multi"!=o||(Pe(i),Li(e)),n&&!o&&/\'$/.test(t)?(Pe(i),!0):!!o}function bo(t,e){var i=lo(e,!0);return!!i&&(e.shiftKey&&!t.state.keySeq?vo(t,"Shift-"+i,e,function(e){return mo(t,e,!0)})||vo(t,i,e,function(e){if("string"==typeof e?/^go[A-Z]/.test(e):e.motion)return mo(t,e)}):vo(t,i,e,function(e){return mo(t,e)}))}function yo(t,e,i){return vo(t,"'"+i+"'",e,function(e){return mo(t,e,!0)})}function wo(e){var t=this;if(t.curOp.focus=h(),!Oe(t,e)){fa&&ma<11&&27==e.keyCode&&(e.returnValue=!1);var i=e.keyCode;t.display.shift=16==i||e.shiftKey;var r=bo(t,e);ya&&(js=r?i:null,!r&&88==i&&!is&&(Sa?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),18!=i||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||ko(t)}}function ko(e){function t(e){18!=e.keyCode&&e.altKey||(Ma(i,"CodeMirror-crosshair"),Le(document,"keyup",t),Le(document,"mouseover",t))}var i=e.display.lineDiv;r(i,"CodeMirror-crosshair"),Za(document,"keyup",t),Za(document,"mouseover",t)}function xo(e){16==e.keyCode&&(this.doc.sel.shift=!1),Oe(this,e)}function _o(e){var t=this;if(!(Bt(t.display,e)||Oe(t,e)||e.ctrlKey&&!e.altKey||Sa&&e.metaKey)){var i=e.keyCode,r=e.charCode;if(ya&&i==js)return js=null,void Pe(e);if(!ya||e.which&&!(e.which<10)||!bo(t,e)){var n=String.fromCharCode(null==r?i:r);"\b"!=n&&(yo(t,e,n)||t.display.input.onKeyPress(e))}}}function Co(e,t){var i=+new Date;return zs&&zs.compare(i,e,t)?(Hs=zs=null,"triple"):Hs&&Hs.compare(i,e,t)?(zs=new Gs(i,e,t),Hs=null,"double"):(Hs=new Gs(i,e,t),zs=null,"single")}function To(e){var t=this,i=t.display;if(!(Oe(t,e)||i.activeTouch&&i.input.supportsTouch()))if(i.input.ensurePolled(),i.shift=e.shiftKey,Bt(i,e))ga||(i.scroller.draggable=!1,setTimeout(function(){return i.scroller.draggable=!0},100));else if(!Mo(t,e)){var r=Ci(t,e),n=He(e),o=r?Co(r,n):"single";window.focus(),1==n&&t.state.selectingText&&t.state.selectingText(e),r&&So(t,n,r,o,e)||(1==n?r?$o(t,r,o,e):Be(e)==i.scroller&&Pe(e):2==n?(r&&pn(t.doc,r),setTimeout(function(){return i.input.focus()},20)):3==n&&(Oa?Io(t,e):Oi(t)))}}function So(i,e,r,t,n){var o="Click";return"double"==t?o="Double"+o:"triple"==t&&(o="Triple"+o),vo(i,so(o=(1==e?"Left":2==e?"Middle":"Right")+o,n),n,function(e){if("string"==typeof e&&(e=Ws[e]),!e)return!1;var t=!1;try{i.isReadOnly()&&(i.state.suppressEdits=!0),t=e(i,r)!=Ha}finally{i.state.suppressEdits=!1}return t})}function Eo(e,t,i){var r=e.getOption("configureMouse"),n=r?r(e,t,i):{};if(null==n.unit){var o=Ea?i.shiftKey&&i.metaKey:i.altKey;n.unit=o?"rectangle":"single"==t?"char":"double"==t?"word":"line"}return(null==n.extend||e.doc.extend)&&(n.extend=e.doc.extend||i.shiftKey),null==n.addNew&&(n.addNew=Sa?i.metaKey:i.ctrlKey),null==n.moveOnDrag&&(n.moveOnDrag=!(Sa?i.altKey:i.ctrlKey)),n}function $o(e,t,i,r){fa?setTimeout(c(Ni,e),0):e.curOp.focus=h();var n,o=Eo(e,i,r),a=e.doc.sel;e.options.dragDrop&&Ja&&!e.isReadOnly()&&"single"==i&&-1<(n=a.contains(t))&&(D((n=a.ranges[n]).from(),t)<0||0<t.xRel)&&(0<D(n.to(),t)||t.xRel<0)?Ao(e,r,t,o):No(e,r,t,o)}function Ao(t,i,r,n){var o=t.display,a=!1,s=hr(t,function(e){ga&&(o.scroller.draggable=!1),t.state.draggingText=!1,Le(document,"mouseup",s),Le(document,"mousemove",l),Le(o.scroller,"dragstart",c),Le(o.scroller,"drop",s),a||(Pe(e),n.addNew||pn(t.doc,r,null,null,n.extend),ga||fa&&9==ma?setTimeout(function(){document.body.focus(),o.input.focus()},20):o.input.focus())}),l=function(e){a=a||10<=Math.abs(i.clientX-e.clientX)+Math.abs(i.clientY-e.clientY)},c=function(){return a=!0};ga&&(o.scroller.draggable=!0),(t.state.draggingText=s).copy=!n.moveOnDrag,o.scroller.dragDrop&&o.scroller.dragDrop(),Za(document,"mouseup",s),Za(document,"mousemove",l),Za(o.scroller,"dragstart",c),Za(o.scroller,"drop",s),Oi(t),setTimeout(function(){return o.input.focus()},20)}function Lo(e,t,i){if("char"==i)return new Ss(t,t);if("word"==i)return e.findWordAt(t);if("line"==i)return new Ss(R(t.line,0),j(e.doc,R(t.line+1,0)));var r=i(e,t);return new Ss(r.from,r.to)}function No(g,e,v,b){function o(e){if(0!=D(_,e))if(_=e,"rectangle"==b.unit){for(var t=[],i=g.options.tabSize,r=C($(y,v.line).text,v.ch,i),n=C($(y,e.line).text,e.ch,i),o=Math.min(r,n),a=Math.max(r,n),s=Math.min(v.line,e.line),l=Math.min(g.lastLine(),Math.max(v.line,e.line));s<=l;s++){var c=$(y,s).text,d=T(c,o,i);o==a?t.push(new Ss(R(s,d),R(s,d))):c.length>d&&t.push(new Ss(R(s,d),R(s,T(c,a,i))))}t.length||t.push(new Ss(v,v)),yn(y,Dr(x.ranges.slice(0,k).concat(t),k),{origin:"*mouse",scroll:!1}),g.scrollIntoView(e)}else{var u,h=w,p=Lo(g,e,b.unit),f=h.anchor;f=0<D(p.anchor,f)?(u=p.head,z(h.from(),p.anchor)):(u=p.anchor,H(h.to(),p.head));var m=x.ranges.slice(0);m[k]=new Ss(j(y,f),u),yn(y,Dr(m,k),Wa)}}function a(e){var t=++c,i=Ci(g,e,!0,"rectangle"==b.unit);if(i)if(0!=D(i,_)){g.curOp.focus=h(),o(i);var r=Di(s,y);(i.line>=r.to||i.line<r.from)&&setTimeout(hr(g,function(){c==t&&a(e)}),150)}else{var n=e.clientY<l.top?-20:e.clientY>l.bottom?20:0;n&&setTimeout(hr(g,function(){c==t&&(s.scroller.scrollTop+=n,a(e))}),50)}}function t(e){g.state.selectingText=!1,c=Infinity,Pe(e),s.input.focus(),Le(document,"mousemove",n),Le(document,"mouseup",d),y.history.lastSelOrigin=null}var s=g.display,y=g.doc;Pe(e);var w,k,x=y.sel,i=x.ranges;if(b.addNew&&!b.extend?(k=y.sel.contains(v),w=-1<k?i[k]:new Ss(v,v)):(w=y.sel.primary(),k=y.sel.primIndex),"rectangle"==b.unit)b.addNew||(w=new Ss(v,v)),v=Ci(g,e,!0,!0),k=-1;else{var r=Lo(g,v,b.unit);w=b.extend?hn(w,r.anchor,r.head,b.extend):r}b.addNew?-1==k?(k=i.length,yn(y,Dr(i.concat([w]),k),{scroll:!1,origin:"*mouse"})):1<i.length&&i[k].empty()&&"char"==b.unit&&!b.extend?(yn(y,Dr(i.slice(0,k).concat(i.slice(k+1)),0),{scroll:!1,origin:"*mouse"}),x=y.sel):mn(y,k,w,Wa):(yn(y,new Ts([w],k=0),Wa),x=y.sel);var _=v,l=s.wrapper.getBoundingClientRect(),c=0,n=hr(g,function(e){He(e)?a(e):t(e)}),d=hr(g,t);g.state.selectingText=d,Za(document,"mousemove",n),Za(document,"mouseup",d)}function Oo(e,t,i,r){var n,o;try{n=t.clientX,o=t.clientY}catch(t){return!1}if(n>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;r&&Pe(t);var a=e.display,s=a.lineDiv.getBoundingClientRect();if(o>s.bottom||!Ie(e,i))return De(t);o-=s.top-a.viewOffset;for(var l=0;l<e.options.gutters.length;++l){var c=a.gutters.childNodes[l];if(c&&c.getBoundingClientRect().right>=n)return Ne(e,i,e,M(e.doc,o),e.options.gutters[l],t),De(t)}}function Mo(e,t){return Oo(e,t,"gutterClick",!0)}function Io(e,t){Bt(e.display,t)||Po(e,t)||Oe(e,t,"contextmenu")||e.display.input.onContextMenu(t)}function Po(e,t){return!!Ie(e,"gutterContextMenu")&&Oo(e,t,"gutterContextMenu",!1)}function Ro(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),oi(e)}function Do(n){function e(e,t,r,i){n.defaults[e]=t,r&&(o[e]=i?function(e,t,i){i!=Ks&&r(e,t,i)}:r)}var o=n.optionHandlers;n.defineOption=e,n.Init=Ks,e("value","",function(e,t){return e.setValue(t)},!0),e("mode",null,function(e,t){e.doc.modeOption=t,jr(e)},!0),e("indentUnit",2,jr,!0),e("indentWithTabs",!1),e("smartIndent",!0),e("tabSize",4,function(e){qr(e),oi(e),mr(e)},!0),e("lineSeparator",null,function(e,r){if(e.doc.lineSep=r){var n=[],o=e.doc.first;e.doc.iter(function(e){for(var t=0;;){var i=e.text.indexOf(r,t);if(-1==i)break;t=i+r.length,n.push(R(o,i))}o++});for(var t=n.length-1;0<=t;t--)Pn(e.doc,r,n[t],R(n[t].line,n[t].ch+r.length))}}),e("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(e,t,i){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),i!=Ks&&e.refresh()}),e("specialCharPlaceholder",pt,function(e){return e.refresh()},!0),e("electricChars",!0),e("inputStyle",Ta?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),e("spellcheck",!1,function(e,t){return e.getInputField().spellcheck=t},!0),e("rtlMoveVisually",!$a),e("wholeLineUpdateBefore",!0),e("theme","default",function(e){Ro(e),Fo(e)},!0),e("keyMap","default",function(e,t,i){var r=co(t),n=i!=Ks&&co(i);n&&n.detach&&n.detach(e,r),r.attach&&r.attach(e,n||null)}),e("extraKeys",null),e("configureMouse",null),e("lineWrapping",!1,Ho,!0),e("gutters",[],function(e){Mr(e.options),Fo(e)},!0),e("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?ki(e.display)+"px":"0",e.refresh()},!0),e("coverGutterNextToScrollbar",!1,function(e){return er(e)},!0),e("scrollbarStyle","native",function(e){ir(e),er(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)},!0),e("lineNumbers",!1,function(e){Mr(e.options),Fo(e)},!0),e("firstLineNumber",1,Fo,!0),e("lineNumberFormatter",function(e){return e},Fo,!0),e("showCursorWhenSelecting",!1,Si,!0),e("resetSelectionOnContextMenu",!0),e("lineWiseCopyCut",!0),e("pasteLinesPerSelection",!0),e("readOnly",!1,function(e,t){"nocursor"==t&&(Ii(e),e.display.input.blur()),e.display.input.readOnlyChanged(t)}),e("disableInput",!1,function(e,t){t||e.display.input.reset()},!0),e("dragDrop",!0,Bo),e("allowDropFileTypes",null),e("cursorBlinkRate",530),e("cursorScrollMargin",0),e("cursorHeight",1,Si,!0),e("singleCursorHeightPerLine",!0,Si,!0),e("workTime",100),e("workDelay",100),e("flattenSpans",!0,qr,!0),e("addModeClass",!1,qr,!0),e("pollInterval",100),e("undoDepth",200,function(e,t){return e.doc.history.undoDepth=t}),e("historyEventDelay",1250),e("viewportMargin",10,function(e){return e.refresh()},!0),e("maxHighlightLength",1e4,qr,!0),e("moveInputWithCursor",!0,function(e,t){t||e.display.input.resetPosition()}),e("tabindex",null,function(e,t){return e.display.input.getField().tabIndex=t||""}),e("autofocus",null),e("direction","ltr",function(e,t){return e.doc.setDirection(t)},!0)}function Fo(e){Or(e),mr(e),Fi(e)}function Bo(e,t,i){if(!t!=!(i&&i!=Ks)){var r=e.display.dragFunctions,n=t?Za:Le;n(e.display.scroller,"dragstart",r.start),n(e.display.scroller,"dragenter",r.enter),n(e.display.scroller,"dragover",r.over),n(e.display.scroller,"dragleave",r.leave),n(e.display.scroller,"drop",r.drop)}}function Ho(e){e.options.lineWrapping?(r(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(Ma(e.display.wrapper,"CodeMirror-wrap"),ke(e)),_i(e),mr(e),oi(e),setTimeout(function(){return er(e)},100)}function zo(e,t){var i=this;if(!(this instanceof zo))return new zo(e,t);this.options=t=t?p(t):{},p(Vs,t,!1),Mr(t);var r=t.value;"string"==typeof r&&(r=new Os(r,t.mode,null,t.lineSeparator,t.direction)),this.doc=r;var n=new zo.inputStyles[t.inputStyle](this),o=this.display=new E(e,r,n);for(var a in Or(o.wrapper.CodeMirror=this),Ro(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),ir(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new Pa,keySeq:null,specialChars:null},t.autofocus&&!Ta&&o.input.focus(),fa&&ma<11&&setTimeout(function(){return i.display.input.reset(!0)},20),Wo(this),eo(),rr(this),this.curOp.forceUpdate=!0,Yr(this,r),t.autofocus&&!Ta||this.hasFocus()?setTimeout(c(Mi,this),20):Ii(this),Ys)Ys.hasOwnProperty(a)&&Ys[a](i,t[a],Ks);Bi(this),t.finishInit&&t.finishInit(this);for(var s=0;s<Xs.length;++s)Xs[s](i);nr(this),ga&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(o.lineDiv).textRendering&&(o.lineDiv.style.textRendering="auto")}function Wo(n){function o(){s.activeTouch&&(r=setTimeout(function(){return s.activeTouch=null},1e3),(l=s.activeTouch).end=+new Date)}function i(e){if(1!=e.touches.length)return!1;var t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}function a(e,t){if(null==t.left)return!0;var i=t.left-e.left,r=t.top-e.top;return 400<i*i+r*r}var s=n.display;Za(s.scroller,"mousedown",hr(n,To)),Za(s.scroller,"dblclick",fa&&ma<11?hr(n,function(e){if(!Oe(n,e)){var t=Ci(n,e);if(t&&!Mo(n,e)&&!Bt(n.display,e)){Pe(e);var i=n.findWordAt(t);pn(n.doc,i.anchor,i.head)}}}):function(e){return Oe(n,e)||Pe(e)}),Oa||Za(s.scroller,"contextmenu",function(e){return Io(n,e)});var r,l={end:0};Za(s.scroller,"touchstart",function(e){if(!Oe(
n,e)&&!i(e)){s.input.ensurePolled(),clearTimeout(r);var t=+new Date;s.activeTouch={start:t,moved:!1,prev:t-l.end<=300?l:null},1==e.touches.length&&(s.activeTouch.left=e.touches[0].pageX,s.activeTouch.top=e.touches[0].pageY)}}),Za(s.scroller,"touchmove",function(){s.activeTouch&&(s.activeTouch.moved=!0)}),Za(s.scroller,"touchend",function(e){var t=s.activeTouch;if(t&&!Bt(s,e)&&null!=t.left&&!t.moved&&new Date-t.start<300){var i,r=n.coordsChar(s.activeTouch,"page");i=!t.prev||a(t,t.prev)?new Ss(r,r):!t.prev.prev||a(t,t.prev.prev)?n.findWordAt(r):new Ss(R(r.line,0),j(n.doc,R(r.line+1,0))),n.setSelection(i.anchor,i.head),n.focus(),Pe(e)}o()}),Za(s.scroller,"touchcancel",o),Za(s.scroller,"scroll",function(){s.scroller.clientHeight&&(Xi(n,s.scroller.scrollTop),Zi(n,s.scroller.scrollLeft,!0),Ne(n,"scroll",n))}),Za(s.scroller,"mousewheel",function(e){return Rr(n,e)}),Za(s.scroller,"DOMMouseScroll",function(e){return Rr(n,e)}),Za(s.wrapper,"scroll",function(){return s.wrapper.scrollTop=s.wrapper.scrollLeft=0}),s.dragFunctions={enter:function(e){Oe(n,e)||Fe(e)},over:function(e){Oe(n,e)||(Qn(n,e),Fe(e))},start:function(e){return Xn(n,e)},drop:hr(n,Yn),leave:function(e){Oe(n,e)||Zn(n)}};var e=s.input.getField();Za(e,"keyup",function(e){return xo.call(n,e)}),Za(e,"keydown",hr(n,wo)),Za(e,"keypress",hr(n,_o)),Za(e,"focus",function(e){return Mi(n,e)}),Za(e,"blur",function(e){return Ii(n,e)})}function Uo(e,t,i,r){var n,o=e.doc;null==i&&(i="add"),"smart"==i&&(o.mode.indent?n=et(e,t).state:i="prev");var a=e.options.tabSize,s=$(o,t),l=C(s.text,null,a);s.stateAfter&&(s.stateAfter=null);var c,d=s.text.match(/^\s*/)[0];if(r||/\S/.test(s.text)){if("smart"==i&&((c=o.mode.indent(n,s.text.slice(d.length),s.text))==Ha||150<c)){if(!r)return;i="prev"}}else c=0,i="not";"prev"==i?c=t>o.first?C($(o,t-1).text,null,a):0:"add"==i?c=l+e.options.indentUnit:"subtract"==i?c=l-e.options.indentUnit:"number"==typeof i&&(c=l+i),c=Math.max(0,c);var u="",h=0;if(e.options.indentWithTabs)for(var p=Math.floor(c/a);p;--p)h+=a,u+="\t";if(h<c&&(u+=k(c-h)),u!=d)return Pn(o,u,R(t,0),R(t,d.length),"+input"),!(s.stateAfter=null);for(var f=0;f<o.sel.ranges.length;f++){var m=o.sel.ranges[f];if(m.head.line==t&&m.head.ch<d.length){var g=R(t,d.length);mn(o,f,new Ss(g,g));break}}}function jo(e){Qs=e}function qo(e,t,i,r,n){var o=e.doc;e.display.shift=!1,r||(r=o.sel);var a,s=e.state.pasteIncoming||"paste"==n,l=es(t),c=null;if(s&&1<r.ranges.length)if(Qs&&Qs.text.join("\n")==t){if(r.ranges.length%Qs.text.length==0){c=[];for(var d=0;d<Qs.text.length;d++)c.push(o.splitLines(Qs.text[d]))}}else l.length==r.ranges.length&&e.options.pasteLinesPerSelection&&(c=v(l,function(e){return[e]}));for(var u=r.ranges.length-1;0<=u;u--){var h=r.ranges[u],p=h.from(),f=h.to();h.empty()&&(i&&0<i?p=R(p.line,p.ch-i):e.state.overwrite&&!s?f=R(f.line,Math.min($(o,f.line).text.length,f.ch+U(l).length)):Qs&&Qs.lineWise&&Qs.text.join("\n")==t&&(p=f=R(p.line,0))),a=e.curOp.updateInput;var m={from:p,to:f,text:c?c[u%c.length]:l,origin:n||(s?"paste":e.state.cutIncoming?"cut":"+input")};An(e.doc,m),Ct(e,"inputRead",e,m)}t&&!s&&Ko(e,t),qi(e),e.curOp.updateInput=a,e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=!1}function Go(e,t){var i=e.clipboardData&&e.clipboardData.getData("Text");if(i)return e.preventDefault(),t.isReadOnly()||t.options.disableInput||ur(t,function(){return qo(t,i,0,null,"paste")}),!0}function Ko(e,t){if(e.options.electricChars&&e.options.smartIndent)for(var i=e.doc.sel,r=i.ranges.length-1;0<=r;r--){var n=i.ranges[r];if(!(100<n.head.ch||r&&i.ranges[r-1].head.line==n.head.line)){var o=e.getModeAt(n.head),a=!1;if(o.electricChars){for(var s=0;s<o.electricChars.length;s++)if(-1<t.indexOf(o.electricChars.charAt(s))){a=Uo(e,n.head.line,"smart");break}}else o.electricInput&&o.electricInput.test($(e.doc,n.head.line).text.slice(0,n.head.ch))&&(a=Uo(e,n.head.line,"smart"));a&&Ct(e,"electricInput",e,n.head.line)}}}function Vo(e){for(var t=[],i=[],r=0;r<e.doc.sel.ranges.length;r++){var n=e.doc.sel.ranges[r].head.line,o={anchor:R(n,0),head:R(n+1,0)};i.push(o),t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:i}}function Yo(e,t){e.setAttribute("autocorrect","off"),e.setAttribute("autocapitalize","off"),e.setAttribute("spellcheck",!!t)}function Xo(){var e=w("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),t=w("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return ga?e.style.width="1000px":e.setAttribute("wrap","off"),_a&&(e.style.border="1px solid black"),Yo(e),t}function Qo(n){var o=n.optionHandlers,d=n.helpers={};n.prototype={constructor:n,focus:function(){window.focus(),this.display.input.focus()},setOption:function(e,t){var i=this.options,r=i[e];i[e]==t&&"mode"!=e||(i[e]=t,o.hasOwnProperty(e)&&hr(this,o[e])(this,t,r),Ne(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](co(e))},removeKeyMap:function(e){for(var t=this.state.keyMaps,i=0;i<t.length;++i)if(t[i]==e||t[i].name==e)return t.splice(i,1),!0},addOverlay:pr(function(e,t){var i=e.token?e:n.getMode(this.options,e);if(i.startState)throw new Error("Overlays may not be stateful.");a(this.state.overlays,{mode:i,modeSpec:e,opaque:t&&t.opaque,priority:t&&t.priority||0},function(e){return e.priority}),this.state.modeGen++,mr(this)}),removeOverlay:pr(function(e){for(var t=this,i=this.state.overlays,r=0;r<i.length;++r){var n=i[r].modeSpec;if(n==e||"string"==typeof e&&n.name==e)return i.splice(r,1),t.state.modeGen++,void mr(t)}}),indentLine:pr(function(e,t,i){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),I(this.doc,e)&&Uo(this,e,t,i)}),indentSelection:pr(function(e){for(var t=this,i=this.doc.sel.ranges,r=-1,n=0;n<i.length;n++){var o=i[n];if(o.empty())o.head.line>r&&(Uo(t,o.head.line,e,!0),r=o.head.line,n==t.doc.sel.primIndex&&qi(t));else{var a=o.from(),s=o.to(),l=Math.max(r,a.line);r=Math.min(t.lastLine(),s.line-(s.ch?0:1))+1;for(var c=l;c<r;++c)Uo(t,c,e);var d=t.doc.sel.ranges;0==a.ch&&i.length==d.length&&0<d[n].from().ch&&mn(t.doc,n,new Ss(a,d[n].to()),za)}}}),getTokenAt:function(e,t){return nt(this,e,t)},getLineTokens:function(e,t){return nt(this,R(e),t,!0)},getTokenTypeAt:function(e){e=j(this.doc,e);var t,i=Je(this,$(this.doc,e.line)),r=0,n=(i.length-1)/2,o=e.ch;if(0==o)t=i[2];else for(;;){var a=r+n>>1;if((a?i[2*a-1]:0)>=o)n=a;else{if(!(i[2*a+1]<o)){t=i[2*a+2];break}r=a+1}}var s=t?t.indexOf("overlay "):-1;return s<0?t:0==s?null:t.slice(0,s-1)},getModeAt:function(e){var t=this.doc.mode;return t.innerMode?n.innerMode(t,this.getTokenAt(e).state).mode:t},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var i=this,r=[];if(!d.hasOwnProperty(t))return r;var n=d[t],o=this.getModeAt(e);if("string"==typeof o[t])n[o[t]]&&r.push(n[o[t]]);else if(o[t])for(var a=0;a<o[t].length;a++){var s=n[o[t][a]];s&&r.push(s)}else o.helperType&&n[o.helperType]?r.push(n[o.helperType]):n[o.name]&&r.push(n[o.name]);for(var l=0;l<n._global.length;l++){var c=n._global[l];c.pred(o,i)&&-1==m(r,c.val)&&r.push(c.val)}return r},getStateAfter:function(e,t){var i=this.doc;return et(this,(e=W(i,null==e?i.first+i.size-1:e))+1,t).state},cursorCoords:function(e,t){var i=this.doc.sel.primary();return ui(this,null==e?i.head:"object"==typeof e?j(this.doc,e):e?i.from():i.to(),t||"page")},charCoords:function(e,t){return di(this,j(this.doc,e),t||"page")},coordsChar:function(e,t){return fi(this,(e=ci(this,e,t||"page")).left,e.top)},lineAtHeight:function(e,t){return e=ci(this,{top:e,left:0},t||"page").top,M(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,i){var r,n=!1;if("number"==typeof e){var o=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:o<e&&(e=o,n=!0),r=$(this.doc,e)}else r=e;return li(this,r,{top:0,left:0},t||"page",i||n).top+(n?this.doc.height-ye(r):0)},defaultTextHeight:function(){return bi(this.display)},defaultCharWidth:function(){return yi(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,i,r,n){var o=this.display,a=(e=ui(this,j(this.doc,e))).bottom,s=e.left;if(t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),o.sizer.appendChild(t),"over"==r)a=e.top;else if("above"==r||"near"==r){var l=Math.max(o.wrapper.clientHeight,this.doc.height),c=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==r||e.bottom+t.offsetHeight>l)&&e.top>t.offsetHeight?a=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=l&&(a=e.bottom),s+t.offsetWidth>c&&(s=c-t.offsetWidth)}t.style.top=a+"px",t.style.left=t.style.right="","right"==n?(s=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==n?s=0:"middle"==n&&(s=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=s+"px"),i&&Wi(this,{left:s,top:a,right:s+t.offsetWidth,bottom:a+t.offsetHeight})},triggerOnKeyDown:pr(wo),triggerOnKeyPress:pr(_o),triggerOnKeyUp:xo,triggerOnMouseDown:pr(To),execCommand:function(e){if(Ws.hasOwnProperty(e))return Ws[e].call(null,this)},triggerElectric:pr(function(e){Ko(this,e)}),findPosH:function(e,t,i,r){var n=this,o=1;t<0&&(o=-1,t=-t);for(var a=j(this.doc,e),s=0;s<t&&!(a=Zo(n.doc,a,o,i,r)).hitSide;++s);return a},moveH:pr(function(t,i){var r=this;this.extendSelectionsBy(function(e){return r.display.shift||r.doc.extend||e.empty()?Zo(r.doc,e.head,t,i,r.options.rtlMoveVisually):t<0?e.from():e.to()},Ua)}),deleteH:pr(function(i,r){var e=this.doc.sel,n=this.doc;e.somethingSelected()?n.replaceSelection("",null,"+delete"):uo(this,function(e){var t=Zo(n,e.head,i,r,!1);return i<0?{from:t,to:e.head}:{from:e.head,to:t}})}),findPosV:function(e,t,i,r){var n=this,o=1,a=r;t<0&&(o=-1,t=-t);for(var s=j(this.doc,e),l=0;l<t;++l){var c=ui(n,s,"div");if(null==a?a=c.left:c.left=a,(s=Jo(n,c,o,i)).hitSide)break}return s},moveV:pr(function(r,n){var o=this,a=this.doc,s=[],l=!this.display.shift&&!a.extend&&a.sel.somethingSelected();if(a.extendSelectionsBy(function(e){if(l)return r<0?e.from():e.to();var t=ui(o,e.head,"div");null!=e.goalColumn&&(t.left=e.goalColumn),s.push(t.left);var i=Jo(o,t,r,n);return"page"==n&&e==a.sel.primary()&&ji(o,di(o,i,"div").top-t.top),i},Ua),s.length)for(var e=0;e<a.sel.ranges.length;e++)a.sel.ranges[e].goalColumn=s[e]}),findWordAt:function(e){var t=$(this.doc,e.line).text,i=e.ch,r=e.ch;if(t){var n=this.getHelper(e,"wordChars");"before"!=e.sticky&&r!=t.length||!i?++r:--i;for(var o=t.charAt(i),a=b(o,n)?function(e){return b(e,n)}:/\s/.test(o)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!b(e)};0<i&&a(t.charAt(i-1));)--i;for(;r<t.length&&a(t.charAt(r));)++r}return new Ss(R(e.line,i),R(e.line,r))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?r(this.display.cursorDiv,"CodeMirror-overwrite"):Ma(this.display.cursorDiv,"CodeMirror-overwrite"),Ne(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==h()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:pr(function(e,t){Gi(this,e,t)}),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-Ut(this)-this.display.barHeight,width:e.scrollWidth-Ut(this)-this.display.barWidth,clientHeight:qt(this),clientWidth:jt(this)}},scrollIntoView:pr(function(e,t){null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:R(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?Ki(this,e):Yi(this,e.from,e.to,e.margin)}),setSize:pr(function(e,t){var i=this,r=function(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e};null!=e&&(this.display.wrapper.style.width=r(e)),null!=t&&(this.display.wrapper.style.height=r(t)),this.options.lineWrapping&&ni(this);var n=this.display.viewFrom;this.doc.iter(n,this.display.viewTo,function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){gr(i,n,"widget");break}++n}),this.curOp.forceUpdate=!0,Ne(this,"refresh",this)}),operation:function(e){return ur(this,e)},startOperation:function(){return rr(this)},endOperation:function(){return nr(this)},refresh:pr(function(){var e=this.display.cachedTextHeight;mr(this),this.curOp.forceUpdate=!0,oi(this),Gi(this,this.doc.scrollLeft,this.doc.scrollTop),Lr(this),(null==e||.5<Math.abs(e-bi(this.display)))&&_i(this),Ne(this,"refresh",this)}),swapDoc:pr(function(e){var t=this.doc;return t.cm=null,Yr(this,e),oi(this),this.display.input.reset(),Gi(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,Ct(this,"swapDoc",this,t),t}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},e(n),n.registerHelper=function(e,t,i){d.hasOwnProperty(e)||(d[e]=n[e]={_global:[]}),d[e][t]=i},n.registerGlobalHelper=function(e,t,i,r){n.registerHelper(e,t,r),d[e]._global.push({pred:i,val:r})}}function Zo(i,r,n,e,o){function a(){var e=r.line+n;return!(e<i.first||e>=i.first+i.size)&&(r=new R(e,r.ch,r.sticky),c=$(i,e))}function t(e){var t;if(null==(t=o?$e(i.cm,c,r,n):Se(c,r,n))){if(e||!a())return!1;r=Ee(o,i.cm,c,r.line,n)}else r=t;return!0}var s=r,l=n,c=$(i,r.line);if("char"==e)t();else if("column"==e)t(!0);else if("word"==e||"group"==e)for(var d=null,u="group"==e,h=i.cm&&i.cm.getHelper(r,"wordChars"),p=!0;!(n<0)||t(!p);p=!1){var f=c.text.charAt(r.ch)||"\n",m=b(f,h)?"w":u&&"\n"==f?"n":!u||/\s/.test(f)?null:"p";if(!u||p||m||(m="s"),d&&d!=m){n<0&&(n=1,t(),r.sticky="after");break}if(m&&(d=m),0<n&&!t(!p))break}var g=Tn(i,r,s,l,!0);return F(s,g)&&(g.hitSide=!0),g}function Jo(e,t,i,r){var n,o,a=e.doc,s=t.left;if("page"==r){var l=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),c=Math.max(l-.5*bi(e.display),3);n=(0<i?t.bottom:t.top)+i*c}else"line"==r&&(n=0<i?t.bottom+3:t.top-3);for(;(o=fi(e,s,n)).outside;){if(i<0?n<=0:n>=a.height){o.hitSide=!0;break}n+=5*i}return o}function ea(e,t){var i=Xt(e,t.line);if(!i||i.hidden)return null;var r=$(e.doc,t.line),n=Kt(i,r,t.line),o=Ce(r,e.doc.direction),a="left";o&&(a=_e(o,t.ch)%2?"right":"left");var s=Jt(n.map,t.ch,a);return s.offset="right"==s.collapse?s.end:s.start,s}function ta(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}function ia(e,t){return t&&(e.bad=!0),e}function ra(s,e,t,l,c){function d(t){return function(e){return e.id==t}}function u(){f&&(i+=m,f=!1)}function h(e){e&&(u(),i+=e)}function p(e){if(1==e.nodeType){var t=e.getAttribute("cm-text");if(null!=t)return void h(t||e.textContent.replace(/\u200b/g,""));var i,r=e.getAttribute("cm-marker");if(r){var n=s.findMarks(R(l,0),R(c+1,0),d(+r));return void(n.length&&(i=n[0].find())&&h(A(s.doc,i.from,i.to).join(m)))}if("false"==e.getAttribute("contenteditable"))return;var o=/^(pre|div|p)$/i.test(e.nodeName);o&&u();for(var a=0;a<e.childNodes.length;a++)p(e.childNodes[a]);o&&(f=!0)}else 3==e.nodeType&&h(e.nodeValue)}for(var i="",f=!1,m=s.doc.lineSeparator();p(e),e!=t;)e=e.nextSibling;return i}function na(e,t,i){var r;if(t==e.display.lineDiv){if(!(r=e.display.lineDiv.childNodes[i]))return ia(e.clipPos(R(e.display.viewTo-1)),!0);t=null,i=0}else for(r=t;;r=r.parentNode){if(!r||r==e.display.lineDiv)return null;if(r.parentNode&&r.parentNode==e.display.lineDiv)break}for(var n=0;n<e.display.view.length;n++){var o=e.display.view[n];if(o.node==r)return oa(o,t,i)}}function oa(c,e,t){function i(e,t,i){for(var r=-1;r<(u?u.length:0);r++)for(var n=r<0?d.map:u[r],o=0;o<n.length;o+=3){var a=n[o+2];if(a==e||a==t){var s=O(r<0?c.line:c.rest[r]),l=n[o]+i;return(i<0||a!=e)&&(l=n[o+(i?1:0)]),R(s,l)}}}var r=c.text.firstChild,n=!1;if(!e||!g(r,e))return ia(R(O(c.line),0),!0);if(e==r&&(n=!0,e=r.childNodes[t],t=0,!e)){var o=c.rest?U(c.rest):c.line;return ia(R(O(o),o.text.length),n)}var a=3==e.nodeType?e:null,s=e;for(a||1!=e.childNodes.length||3!=e.firstChild.nodeType||(a=e.firstChild,t&&(t=a.nodeValue.length));s.parentNode!=r;)s=s.parentNode;var d=c.measure,u=d.maps,l=i(a,s,t);if(l)return ia(l,n);for(var h=s.nextSibling,p=a?a.nodeValue.length-t:0;h;h=h.nextSibling){if(l=i(h,h.firstChild,0))return ia(R(l.line,l.ch-p),n);p+=h.textContent.length}for(var f=s.previousSibling,m=t;f;f=f.previousSibling){if(l=i(f,f.firstChild,-1))return ia(R(l.line,l.ch+m),n);m+=f.textContent.length}}function aa(t,e){function i(){t.value=s.getValue()}if((e=e?p(e):{}).value=t.value,!e.tabindex&&t.tabIndex&&(e.tabindex=t.tabIndex),!e.placeholder&&t.placeholder&&(e.placeholder=t.placeholder),null==e.autofocus){var r=h();e.autofocus=r==t||null!=t.getAttribute("autofocus")&&r==document.body}var n;if(t.form&&(Za(t.form,"submit",i),!e.leaveSubmitMethodAlone)){var o=t.form;n=o.submit;try{var a=o.submit=function(){i(),o.submit=n,o.submit(),o.submit=a}}catch(l){}}e.finishInit=function(e){e.save=i,e.getTextArea=function(){return t},e.toTextArea=function(){e.toTextArea=isNaN,i(),t.parentNode.removeChild(e.getWrapperElement()),t.style.display="",t.form&&(Le(t.form,"submit",i),"function"==typeof t.form.submit&&(t.form.submit=n))}},t.style.display="none";var s=zo(function(e){return t.parentNode.insertBefore(e,t.nextSibling)},e);return s}function sa(e){e.off=Le,e.on=Za,e.wheelEventPixels=Pr,e.Doc=Os,e.splitLines=es,e.countColumn=C,e.findColumn=T,e.isWordChar=d,e.Pass=Ha,e.signal=Ne,e.Line=us,e.changeEnd=Br,e.scrollbarModel=ws,e.Pos=R,e.cmpPos=D,e.modes=ns,e.mimeModes=os,e.resolveMode=Ge,e.getMode=Ke,e.modeExtensions=as,e.extendMode=Ve,e.copyState=Ye,e.startState=Qe,e.innerMode=Xe,e.commands=Ws,e.keyMap=Bs,e.keyName=lo,e.isModifierKey=ao,e.lookupKey=oo,e.normalizeKeyMap=no,e.StringStream=ss,e.SharedTextMarker=Ls,e.TextMarker=As,e.LineWidget=Es,e.e_preventDefault=Pe,e.e_stopPropagation=Re,e.e_stop=Fe,e.addClass=r,e.contains=g,e.rmClass=Ma,e.keyNames=Ps}var la=navigator.userAgent,ca=navigator.platform,da=/gecko\/\d/i.test(la),ua=/MSIE \d/.test(la),ha=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(la),pa=/Edge\/(\d+)/.exec(la),fa=ua||ha||pa,ma=fa&&(ua?document.documentMode||6:+(pa||ha)[1]),ga=!pa&&/WebKit\//.test(la),va=ga&&/Qt\/\d+\.\d+/.test(la),ba=!pa&&/Chrome\//.test(la),ya=/Opera\//.test(la),wa=/Apple Computer/.test(navigator.vendor),ka=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(la),xa=/PhantomJS/.test(la),_a=!pa&&/AppleWebKit/.test(la)&&/Mobile\/\w+/.test(la),Ca=/Android/.test(la),Ta=_a||Ca||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(la),Sa=_a||/Mac/.test(ca),Ea=/\bCrOS\b/.test(la),$a=/win/i.test(ca),Aa=ya&&la.match(/Version\/(\d*\.\d*)/);Aa&&(Aa=Number(Aa[1])),Aa&&15<=Aa&&(ga=!(ya=!1));var La,Na=Sa&&(va||ya&&(null==Aa||Aa<12.11)),Oa=da||fa&&9<=ma,Ma=function(e,t){var i=e.className,r=s(t).exec(i);if(r){var n=i.slice(r.index+r[0].length);e.className=i.slice(0,r.index)+(n?r[1]+n:"")}};La=document.createRange?function(e,t,i,r){var n=document.createRange();return n.setEnd(r||e,i),n.setStart(e,t),n}:function(e,t,i){var r=document.body.createTextRange();try{r.moveToElementText(e.parentNode)}catch(n){return r}return r.collapse(!0),r.moveEnd("character",i),r.moveStart("character",t),r};var Ia=function(e){e.select()};_a?Ia=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:fa&&(Ia=function(e){try{e.select()}catch(t){}});var Pa=function(){this.id=null};Pa.prototype.set=function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)};var Ra,Da,Fa,Ba=30,Ha={toString:function(){return"CodeMirror.Pass"}},za={scroll:!1},Wa={origin:"*mouse"},Ua={origin:"+move"},ja=[""],qa=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Ga=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,Ka=!1,Va=!1,Ya=null,Xa=function(){function R(e){return e<=247?t.charAt(e):1424<=e&&e<=1524?"R":1536<=e&&e<=1785?i.charAt(e-1536):1774<=e&&e<=2220?"r":8192<=e&&e<=8203?"w":8204==e?"b":"L"}function D(e,t,i){this.level=e,this.from=t,this.to=i}var t="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",i="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111",F=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,B=/[stwN]/,H=/[LRr]/,z=/[Lb1n]/,W=/[1n]/;return function(e,t){var i="ltr"==t?"L":"R";if(0==e.length||"ltr"==t&&!F.test(e))return!1;for(var r=e.length,n=[],o=0;o<r;++o)n.push(R(e.charCodeAt(o)));for(var a=0,s=i;a<r;++a){var l=n[a];"m"==l?n[a]=s:s=l}for(var c=0,d=i;c<r;++c){var u=n[c];"1"==u&&"r"==d?n[c]="n":H.test(u)&&"r"==(d=u)&&(n[c]="R")}for(var h=1,p=n[0];h<r-1;++h){var f=n[h];"+"==f&&"1"==p&&"1"==n[h+1]?n[h]="1":","!=f||p!=n[h+1]||"1"!=p&&"n"!=p||(n[h]=p),p=f}for(var m=0;m<r;++m){var g=n[m];if(","==g)n[m]="N";else if("%"==g){var v=void 0;for(v=m+1;v<r&&"%"==n[v];++v);for(var b=m&&"!"==n[m-1]||v<r&&"1"==n[v]?"1":"N",y=m;y<v;++y)n[y]=b;m=v-1}}for(var w=0,k=i;w<r;++w){var x=n[w];"L"==k&&"1"==x?n[w]="L":H.test(x)&&(k=x)}for(var _=0;_<r;++_)if(B.test(n[_])){var C=void 0;for(C=_+1;C<r&&B.test(n[C]);++C);for(var T="L"==(_?n[_-1]:i),S=T==("L"==(C<r?n[C]:i))?T?"L":"R":i,E=_;E<C;++E)n[E]=S;_=C-1}for(var $,A=[],L=0;L<r;)if(z.test(n[L])){var N=L;for(++L;L<r&&z.test(n[L]);++L);A.push(new D(0,N,L))}else{var O=L,M=A.length;for(++L;L<r&&"L"!=n[L];++L);for(var I=O;I<L;)if(W.test(n[I])){O<I&&A.splice(M,0,new D(1,O,I));var P=I;for(++I;I<L&&W.test(n[I]);++I);A.splice(M,0,new D(2,P,I)),O=I}else++I;O<L&&A.splice(M,0,new D(1,O,L))}return 1==A[0].level&&($=e.match(/^\s+/))&&(A[0].from=$[0].length,A.unshift(new D(0,0,$[0].length))),1==U(A).level&&($=e.match(/\s+$/))&&(U(A).to-=$[0].length,A.push(new D(0,r-$[0].length,r))),"rtl"==t?A.reverse():A}}(),Qa=[],Za=function(e,t,i){if(e.addEventListener)e.addEventListener(t,i,!1);else if(e.attachEvent)e.attachEvent("on"+t,i);else{var r=e._handlers||(e._handlers={});r[t]=(r[t]||Qa).concat(i)}},Ja=function(){if(fa&&ma<9)return!1;var e=w("div");return"draggable"in e||"dragDrop"in e}(),es=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,i=[],r=e.length;t<=r;){var n=e.indexOf("\n",t);-1==n&&(n=e.length);var o=e.slice(t,"\r"==e.charAt(n-1)?n-1:n),a=o.indexOf("\r");-1!=a?(i.push(o.slice(0,a)),t+=a+1):(i.push(o),t=n+1)}return i}:function(e){return e.split(/\r\n?|\n/)},ts=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(i){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},is="oncopy"in(Fa=w("div"))||(Fa.setAttribute("oncopy","return;"),"function"==typeof Fa.oncopy),rs=null,ns={},os={},as={},ss=function(e,t,i){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=i};ss.prototype.eol=function(){return this.pos>=this.string.length},ss.prototype.sol=function(){return this.pos==this.lineStart},ss.prototype.peek=function(){return this.string.charAt(this.pos)||undefined},ss.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},ss.prototype.eat=function(e){var t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e.test?e.test(t):e(t)))return++this.pos,t},ss.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},ss.prototype.eatSpace=function(){for(var e=this,t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++e.pos;return this.pos>t},ss.prototype.skipToEnd=function(){this.pos=this.string.length},ss.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(-1<t)return this.pos=t,!0},ss.prototype.backUp=function(e){this.pos-=e},ss.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=C(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?C(this.string,this.lineStart,this.tabSize):0)},ss.prototype.indentation=function(){return C(this.string,null,this.tabSize)-(this.lineStart?C(this.string,this.lineStart,this.tabSize):0)},ss.prototype.match=function(e,t,i){if("string"!=typeof e){var r=this.string.slice(this.pos).match(e);return r&&0<r.index?null:(r&&!1!==t&&(this.pos+=r[0].length),r)}var n=function(e){return i?e.toLowerCase():e};if(n(this.string.substr(this.pos,e.length))==n(e))return!1!==t&&(this.pos+=e.length),!0},ss.prototype.current=function(){return this.string.slice(this.start,this.pos)},ss.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},ss.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)};var ls=function(e,t){this.state=e,this.lookAhead=t},cs=function(e,t,i,r){this.state=t,this.doc=e,this.line=i,this.maxLookAhead=r||0};cs.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);return null!=t&&e>this.maxLookAhead&&(this.maxLookAhead=e),t},cs.prototype.nextLine=function(){this.line++,0<this.maxLookAhead&&this.maxLookAhead--},cs.fromSaved=function(e,t,i){return t instanceof ls?new cs(e,Ye(e.mode,t.state),i,t.lookAhead):new cs(e,Ye(e.mode,t),i)},cs.prototype.save=function(e){var t=!1!==e?Ye(this.doc.mode,this.state):this.state;return 0<this.maxLookAhead?new ls(t,this.maxLookAhead):t};var ds=function(e,t,i){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=i},us=function(e,t,i){this.text=e,oe(this,t),this.height=i?i(this):1};us.prototype.lineNo=function(){return O(this)},e(us);var hs,ps={},fs={},ms=null,gs=null,vs={left:0,right:0,top:0,bottom:0},bs=function(e,t,i){this.cm=i;var r=this.vert=w("div",[w("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),n=this.horiz=w("div",[w("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");e(r),e(n),Za(r,"scroll",function(){r.clientHeight&&t(r.scrollTop,"vertical")}),Za(n,"scroll",function(){n.clientWidth&&t(n.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,fa&&ma<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};bs.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,i=e.scrollHeight>e.clientHeight+1,r=e.nativeBarWidth;if(i){this.vert.style.display="block",this.vert.style.bottom=t?r+"px":"0";var n=e.viewHeight-(t?r:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+n)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=i?r+"px":"0",this.horiz.style.left=e.barLeft+"px";var o=e.viewWidth-e.barLeft-(i?r:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&0<e.clientHeight&&(0==r&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:i?r:0,bottom:t?r:0}},bs.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},bs.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},bs.prototype.zeroWidthHack=function(){var e=Sa&&!ka?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new Pa,this.disableVert=new Pa},bs.prototype.enableZeroWidthBar=function(t,i,r){function n(){var e=t.getBoundingClientRect();("vert"==r?document.elementFromPoint(e.right-1,(e.top+e.bottom)/2):document.elementFromPoint((e.right+e.left)/2,e.bottom-1))!=t?t.style.pointerEvents="none":i.set(1e3,n)}t.style.pointerEvents="auto",i.set(1e3,n)},bs.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};var ys=function(){};ys.prototype.update=function(){return{bottom:0,right:0}},ys.prototype.setScrollLeft=function(){},ys.prototype.setScrollTop=function(){},ys.prototype.clear=function(){};var ws={"native":bs,"null":ys},ks=0,xs=function(e,t,i){var r=e.display;this.viewport=t,this.visible=Di(r,e.doc,t),this.editorIsHidden=!r.wrapper.offsetWidth,this.wrapperHeight=r.wrapper.clientHeight,this.wrapperWidth=r.wrapper.clientWidth,this.oldDisplayWidth=jt(e),this.force=i,this.dims=wi(e),this.events=[]};xs.prototype.signal=function(e,t){Ie(e,t)&&this.events.push(arguments)},xs.prototype.finish=function(){for(var e=this,t=0;t<this.events.length;t++)Ne.apply(null,e.events[t])};var _s=0,Cs=null;fa?Cs=-.53:da?Cs=15:ba?Cs=-.7:wa&&(Cs=-1/3);var Ts=function(e,t){this.ranges=e,this.primIndex=t};Ts.prototype.primary=function(){return this.ranges[this.primIndex]},Ts.prototype.equals=function(e){var t=this;if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var i=0;i<this.ranges.length;i++){var r=t.ranges[i],n=e.ranges[i];if(!F(r.anchor,n.anchor)||!F(r.head,n.head))return!1}return!0},Ts.prototype.deepCopy=function(){for(var e=this,t=[],i=0;i<this.ranges.length;i++)t[i]=new Ss(B(e.ranges[i].anchor),B(e.ranges[i].head));return new Ts(t,this.primIndex)},Ts.prototype.somethingSelected=function(){for(var e=this,t=0;t<this.ranges.length;t++)if(!e.ranges[t].empty())return!0;return!1},Ts.prototype.contains=function(e,t){var i=this;t||(t=e);for(var r=0;r<this.ranges.length;r++){var n=i.ranges[r];if(0<=D(t,n.from())&&D(e,n.to())<=0)return r}return-1};var Ss=function(e,t){this.anchor=e,this.head=t};Ss.prototype.from=function(){return z(this.anchor,this.head)},Ss.prototype.to=function(){return H(this.anchor,this.head)},Ss.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},Hn.prototype={chunkSize:function il(){return this.lines.length},removeInner:function rl(e,t){for(var i=this,r=e,n=e+t;r<n;++r){var o=i.lines[r];i.height-=o.height,dt(o),Ct(o,"delete")}this.lines.splice(e,t)},collapse:function nl(e){e.push.apply(e,this.lines)},insertInner:function ol(e,t,i){var r=this;this.height+=i,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var n=0;n<t.length;++n)t[n].parent=r},iterN:function al(e,t,i){for(var r=this,n=e+t;e<n;++e)if(i(r.lines[e]))return!0}},zn.prototype={chunkSize:function il(){return this.size},removeInner:function rl(e,t){var i=this;this.size-=t;for(var r=0;r<this.children.length;++r){var n=i.children[r],o=n.chunkSize();if(e<o){var a=Math.min(t,o-e),
s=n.height;if(n.removeInner(e,a),i.height-=s-n.height,o==a&&(i.children.splice(r--,1),n.parent=null),0==(t-=a))break;e=0}else e-=o}if(this.size-t<25&&(1<this.children.length||!(this.children[0]instanceof Hn))){var l=[];this.collapse(l),this.children=[new Hn(l)],this.children[0].parent=this}},collapse:function nl(e){for(var t=this,i=0;i<this.children.length;++i)t.children[i].collapse(e)},insertInner:function ol(e,t,i){var r=this;this.size+=t.length,this.height+=i;for(var n=0;n<this.children.length;++n){var o=r.children[n],a=o.chunkSize();if(e<=a){if(o.insertInner(e,t,i),o.lines&&50<o.lines.length){for(var s=o.lines.length%25+25,l=s;l<o.lines.length;){var c=new Hn(o.lines.slice(l,l+=25));o.height-=c.height,r.children.splice(++n,0,c),c.parent=r}o.lines=o.lines.slice(0,s),r.maybeSpill()}break}e-=a}},maybeSpill:function sl(){if(!(this.children.length<=10)){var e=this;do{var t=new zn(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;var i=m(e.parent.children,e);e.parent.children.splice(i+1,0,t)}else{var r=new zn(e.children);(r.parent=e).children=[r,t],e=r}t.parent=e.parent}while(10<e.children.length);e.parent.maybeSpill()}},iterN:function al(e,t,i){for(var r=this,n=0;n<this.children.length;++n){var o=r.children[n],a=o.chunkSize();if(e<a){var s=Math.min(t,a-e);if(o.iterN(e,s,i))return!0;if(0==(t-=s))break;e=0}else e-=a}}};var Es=function(e,t,i){var r=this;if(i)for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n]);this.doc=e,this.node=t};Es.prototype.clear=function(){var e=this,t=this.doc.cm,i=this.line.widgets,r=this.line,n=O(r);if(null!=n&&i){for(var o=0;o<i.length;++o)i[o]==e&&i.splice(o--,1);i.length||(r.widgets=null);var a=Ft(this);N(r,Math.max(0,r.height-a)),t&&(ur(t,function(){Wn(t,r,-a),gr(t,n,"widget")}),Ct(t,"lineWidgetCleared",t,this,n))}},Es.prototype.changed=function(){var e=this,t=this.height,i=this.doc.cm,r=this.line;this.height=null;var n=Ft(this)-t;n&&(N(r,r.height+n),i&&ur(i,function(){i.curOp.forceUpdate=!0,Wn(i,r,n),Ct(i,"lineWidgetChanged",i,e,O(r))}))},e(Es);var $s=0,As=function(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++$s};As.prototype.clear=function(){var e=this;if(!this.explicitlyCleared){var t=this.doc.cm,i=t&&!t.curOp;if(i&&rr(t),Ie(this,"clear")){var r=this.find();r&&Ct(this,"clear",r.from,r.to)}for(var n=null,o=null,a=0;a<this.lines.length;++a){var s=e.lines[a],l=X(s.markedSpans,e);t&&!e.collapsed?gr(t,O(s),"text"):t&&(null!=l.to&&(o=O(s)),null!=l.from&&(n=O(s))),s.markedSpans=Q(s.markedSpans,l),null==l.from&&e.collapsed&&!ve(e.doc,s)&&t&&N(s,bi(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(var c=0;c<this.lines.length;++c){var d=he(e.lines[c]),u=we(d);u>t.display.maxLineLength&&(t.display.maxLine=d,t.display.maxLineLength=u,t.display.maxLineChanged=!0)}null!=n&&t&&this.collapsed&&mr(t,n,o+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&xn(t.doc)),t&&Ct(t,"markerCleared",t,this,n,o),i&&nr(t),this.parent&&this.parent.clear()}},As.prototype.find=function(e,t){var i,r,n=this;null==e&&"bookmark"==this.type&&(e=1);for(var o=0;o<this.lines.length;++o){var a=n.lines[o],s=X(a.markedSpans,n);if(null!=s.from&&(i=R(t?a:O(a),s.from),-1==e))return i;if(null!=s.to&&(r=R(t?a:O(a),s.to),1==e))return r}return i&&{from:i,to:r}},As.prototype.changed=function(){var o=this,a=this.find(-1,!0),s=this,l=this.doc.cm;a&&l&&ur(l,function(){var e=a.line,t=O(a.line),i=Xt(l,t);if(i&&(ri(i),l.curOp.selectionChanged=l.curOp.forceUpdate=!0),l.curOp.updateMaxLine=!0,!ve(s.doc,e)&&null!=s.height){var r=s.height;s.height=null;var n=Ft(s)-r;n&&N(e,e.height+n)}Ct(l,"markerChanged",l,o)})},As.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=m(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},As.prototype.detachLine=function(e){if(this.lines.splice(m(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},e(As);var Ls=function(e,t){var i=this;this.markers=e,this.primary=t;for(var r=0;r<e.length;++r)e[r].parent=i};Ls.prototype.clear=function(){var e=this;if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var t=0;t<this.markers.length;++t)e.markers[t].clear();Ct(this,"clear")}},Ls.prototype.find=function(e,t){return this.primary.find(e,t)},e(Ls);var Ns=0,Os=function(e,t,i,r,n){if(!(this instanceof Os))return new Os(e,t,i,r,n);null==i&&(i=0),zn.call(this,[new Hn([new us("",null)])]),this.first=i,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=i;var o=R(i,0);this.sel=Fr(o),this.history=new Zr(null),this.id=++Ns,this.modeOption=t,this.lineSep=r,this.direction="rtl"==n?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),Kr(this,{from:o,to:o,text:e}),yn(this,Fr(o),za)};Os.prototype=i(zn.prototype,{constructor:Os,iter:function(e,t,i){i?this.iterN(e-this.first,t-e,i):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var i=0,r=0;r<t.length;++r)i+=t[r].height;this.insertInner(e-this.first,t,i)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=L(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:fr(function(e){var t=R(this.first,0),i=this.first+this.size-1;An(this,{from:t,to:R(i,$(this,i).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&Gi(this.cm,0,0),yn(this,Fr(t),za)}),replaceRange:function(e,t,i,r){Pn(this,e,t=j(this,t),i=i?j(this,i):t,r)},getRange:function(e,t,i){var r=A(this,j(this,e),j(this,t));return!1===i?r:r.join(i||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(I(this,e))return $(this,e)},getLineNumber:function(e){return O(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=$(this,e)),he(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return j(this,e)},getCursor:function(e){var t=this.sel.primary();return null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:fr(function(e,t,i){gn(this,j(this,"number"==typeof e?R(e,t||0):e),null,i)}),setSelection:fr(function(e,t,i){gn(this,j(this,e),j(this,t||e),i)}),extendSelection:fr(function(e,t,i){pn(this,j(this,e),t&&j(this,t),i)}),extendSelections:fr(function(e,t){fn(this,G(this,e),t)}),extendSelectionsBy:fr(function(e,t){fn(this,G(this,v(this.sel.ranges,e)),t)}),setSelections:fr(function(e,t,i){var r=this;if(e.length){for(var n=[],o=0;o<e.length;o++)n[o]=new Ss(j(r,e[o].anchor),j(r,e[o].head));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),yn(this,Dr(n,t),i)}}),addSelection:fr(function(e,t,i){var r=this.sel.ranges.slice(0);r.push(new Ss(j(this,e),j(this,t||e))),yn(this,Dr(r,r.length-1),i)}),getSelection:function(e){for(var t,i=this,r=this.sel.ranges,n=0;n<r.length;n++){var o=A(i,r[n].from(),r[n].to());t=t?t.concat(o):o}return!1===e?t:t.join(e||this.lineSeparator())},getSelections:function(e){for(var t=this,i=[],r=this.sel.ranges,n=0;n<r.length;n++){var o=A(t,r[n].from(),r[n].to());!1!==e&&(o=o.join(e||t.lineSeparator())),i[n]=o}return i},replaceSelection:function(e,t,i){for(var r=[],n=0;n<this.sel.ranges.length;n++)r[n]=e;this.replaceSelections(r,t,i||"+input")},replaceSelections:fr(function(e,t,i){for(var r=this,n=[],o=this.sel,a=0;a<o.ranges.length;a++){var s=o.ranges[a];n[a]={from:s.from(),to:s.to(),text:r.splitLines(e[a]),origin:i}}for(var l=t&&"end"!=t&&Ur(this,n,t),c=n.length-1;0<=c;c--)An(r,n[c]);l?bn(this,l):this.cm&&qi(this.cm)}),undo:fr(function(){Nn(this,"undo")}),redo:fr(function(){Nn(this,"redo")}),undoSelection:fr(function(){Nn(this,"undo",!0)}),redoSelection:fr(function(){Nn(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,i=0,r=0;r<e.done.length;r++)e.done[r].ranges||++t;for(var n=0;n<e.undone.length;n++)e.undone[n].ranges||++i;return{undo:t,redo:i}},clearHistory:function(){this.history=new Zr(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:un(this.history.done),undone:un(this.history.undone)}},setHistory:function(e){var t=this.history=new Zr(this.history.maxGeneration);t.done=un(e.done.slice(0),null,!0),t.undone=un(e.undone.slice(0),null,!0)},setGutterMarker:fr(function(e,i,r){return Bn(this,e,"gutter",function(e){var t=e.gutterMarkers||(e.gutterMarkers={});return!(t[i]=r)&&y(t)&&(e.gutterMarkers=null),!0})}),clearGutter:fr(function(t){var i=this;this.iter(function(e){e.gutterMarkers&&e.gutterMarkers[t]&&Bn(i,e,"gutter",function(){return e.gutterMarkers[t]=null,y(e.gutterMarkers)&&(e.gutterMarkers=null),!0})})}),lineInfo:function(e){var t;if("number"==typeof e){if(!I(this,e))return null;if(!(e=$(this,t=e)))return null}else if(null==(t=O(e)))return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:fr(function(e,i,r){return Bn(this,e,"gutter"==i?"gutter":"class",function(e){var t="text"==i?"textClass":"background"==i?"bgClass":"gutter"==i?"gutterClass":"wrapClass";if(e[t]){if(s(r).test(e[t]))return!1;e[t]+=" "+r}else e[t]=r;return!0})}),removeLineClass:fr(function(e,o,a){return Bn(this,e,"gutter"==o?"gutter":"class",function(e){var t="text"==o?"textClass":"background"==o?"bgClass":"gutter"==o?"gutterClass":"wrapClass",i=e[t];if(!i)return!1;if(null==a)e[t]=null;else{var r=i.match(s(a));if(!r)return!1;var n=r.index+r[0].length;e[t]=i.slice(0,r.index)+(r.index&&n!=i.length?" ":"")+i.slice(n)||null}return!0})}),addLineWidget:fr(function(e,t,i){return Un(this,e,t,i)}),removeLineWidget:function(e){e.clear()},markText:function(e,t,i){return jn(this,j(this,e),j(this,t),i,i&&i.type||"range")},setBookmark:function(e,t){var i={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return jn(this,e=j(this,e),e,i,"bookmark")},findMarksAt:function(e){var t=[],i=$(this,(e=j(this,e)).line).markedSpans;if(i)for(var r=0;r<i.length;++r){var n=i[r];(null==n.from||n.from<=e.ch)&&(null==n.to||n.to>=e.ch)&&t.push(n.marker.parent||n.marker)}return t},findMarks:function(n,o,a){n=j(this,n),o=j(this,o);var s=[],l=n.line;return this.iter(n.line,o.line+1,function(e){var t=e.markedSpans;if(t)for(var i=0;i<t.length;i++){var r=t[i];null!=r.to&&l==n.line&&n.ch>=r.to||null==r.from&&l!=n.line||null!=r.from&&l==o.line&&r.from>=o.ch||a&&!a(r.marker)||s.push(r.marker.parent||r.marker)}++l}),s},getAllMarks:function(){var r=[];return this.iter(function(e){var t=e.markedSpans;if(t)for(var i=0;i<t.length;++i)null!=t[i].from&&r.push(t[i].marker)}),r},posFromIndex:function(i){var r,n=this.first,o=this.lineSeparator().length;return this.iter(function(e){var t=e.text.length+o;if(i<t)return r=i,!0;i-=t,++n}),j(this,R(n,r))},indexFromPos:function(e){var t=(e=j(this,e)).ch;if(e.line<this.first||e.ch<0)return 0;var i=this.lineSeparator().length;return this.iter(this.first,e.line,function(e){t+=e.text.length+i}),t},copy:function(e){var t=new Os(L(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,i=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<i&&(i=e.to);var r=new Os(L(this,t,i),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(r.history=this.history),(this.linked||(this.linked=[])).push({doc:r,sharedHist:e.sharedHist}),r.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],Kn(r,Gn(this)),r},unlinkDoc:function(e){var t=this;if(e instanceof zo&&(e=e.doc),this.linked)for(var i=0;i<this.linked.length;++i){if(t.linked[i].doc==e){t.linked.splice(i,1),e.unlinkDoc(t),Vn(Gn(t));break}}if(e.history==this.history){var r=[e.id];Vr(e,function(e){return r.push(e.id)},!0),e.history=new Zr(null),e.history.done=un(this.history.done,r),e.history.undone=un(this.history.undone,r)}},iterLinkedDocs:function(e){Vr(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):es(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:fr(function(e){"rtl"!=e&&(e="ltr"),e!=this.direction&&(this.direction=e,this.iter(function(e){return e.order=null}),this.cm&&Qr(this.cm))})}),Os.prototype.eachLine=Os.prototype.iter;for(var Ms=0,Is=!1,Ps={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Rs=0;Rs<10;Rs++)Ps[Rs+48]=Ps[Rs+96]=String(Rs);for(var Ds=65;Ds<=90;Ds++)Ps[Ds]=String.fromCharCode(Ds);for(var Fs=1;Fs<=12;Fs++)Ps[Fs+111]=Ps[Fs+63235]="F"+Fs;var Bs={basic:{Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},pcDefault:{"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},emacsy:{"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},macDefault:{"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]}};Bs["default"]=Sa?Bs.macDefault:Bs.pcDefault;var Hs,zs,Ws={selectAll:En,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),za)},killLine:function(i){return uo(i,function(e){if(e.empty()){var t=$(i.doc,e.head.line).text.length;return e.head.ch==t&&e.head.line<i.lastLine()?{from:e.head,to:R(e.head.line+1,0)}:{from:e.head,to:R(e.head.line,t)}}return{from:e.from(),to:e.to()}})},deleteLine:function(t){return uo(t,function(e){return{from:R(e.from().line,0),to:j(t.doc,R(e.to().line+1,0))}})},delLineLeft:function(e){return uo(e,function(e){return{from:R(e.from().line,0),to:e.from()}})},delWrappedLineLeft:function(i){return uo(i,function(e){var t=i.charCoords(e.head,"div").top+5;return{from:i.coordsChar({left:0,top:t},"div"),to:e.from()}})},delWrappedLineRight:function(r){return uo(r,function(e){var t=r.charCoords(e.head,"div").top+5,i=r.coordsChar({left:r.display.lineDiv.offsetWidth+100,top:t},"div");return{from:e.from(),to:i}})},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(R(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(R(e.lastLine()))},goLineStart:function(t){return t.extendSelectionsBy(function(e){return ho(t,e.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(t){return t.extendSelectionsBy(function(e){return fo(t,e.head)},{origin:"+move",bias:1})},goLineEnd:function(t){return t.extendSelectionsBy(function(e){return po(t,e.head.line)},{origin:"+move",bias:-1})},goLineRight:function(i){return i.extendSelectionsBy(function(e){var t=i.cursorCoords(e.head,"div").top+5;return i.coordsChar({left:i.display.lineDiv.offsetWidth+100,top:t},"div")},Ua)},goLineLeft:function(i){return i.extendSelectionsBy(function(e){var t=i.cursorCoords(e.head,"div").top+5;return i.coordsChar({left:0,top:t},"div")},Ua)},goLineLeftSmart:function(r){return r.extendSelectionsBy(function(e){var t=r.cursorCoords(e.head,"div").top+5,i=r.coordsChar({left:0,top:t},"div");return i.ch<r.getLine(i.line).search(/\S/)?fo(r,e.head):i},Ua)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"char")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){for(var t=[],i=e.listSelections(),r=e.options.tabSize,n=0;n<i.length;n++){var o=i[n].from(),a=C(e.getLine(o.line),o.ch,r);t.push(k(r-a%r))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(a){return ur(a,function(){for(var e=a.listSelections(),t=[],i=0;i<e.length;i++)if(e[i].empty()){var r=e[i].head,n=$(a.doc,r.line).text;if(n)if(r.ch==n.length&&(r=new R(r.line,r.ch-1)),0<r.ch)r=new R(r.line,r.ch+1),a.replaceRange(n.charAt(r.ch-1)+n.charAt(r.ch-2),R(r.line,r.ch-2),r,"+transpose");else if(r.line>a.doc.first){var o=$(a.doc,r.line-1).text;o&&(r=new R(r.line,1),a.replaceRange(n.charAt(0)+a.doc.lineSeparator()+o.charAt(o.length-1),R(r.line-1,o.length-1),r,"+transpose"))}t.push(new Ss(r,r))}a.setSelections(t)})},newlineAndIndent:function(r){return ur(r,function(){for(var e=r.listSelections(),t=e.length-1;0<=t;t--)r.replaceRange(r.doc.lineSeparator(),e[t].anchor,e[t].head,"+input");e=r.listSelections();for(var i=0;i<e.length;i++)r.indentLine(e[i].from().line,null,!0);qi(r)})},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}},Us=new Pa,js=null,qs=400,Gs=function(e,t,i){this.time=e,this.pos=t,this.button=i};Gs.prototype.compare=function(e,t,i){return this.time+qs>e&&0==D(t,this.pos)&&i==this.button};var Ks={toString:function(){return"CodeMirror.Init"}},Vs={},Ys={};zo.defaults=Vs,zo.optionHandlers=Ys;var Xs=[];zo.defineInitHook=function(e){return Xs.push(e)};var Qs=null,Zs=function(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Pa,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};Zs.prototype.init=function(e){function t(e){if(!Oe(s,e)){if(s.somethingSelected())jo({lineWise:!1,text:s.getSelections()}),"cut"==e.type&&s.replaceSelection("",null,"cut");else{if(!s.options.lineWiseCopyCut)return;var t=Vo(s);jo({lineWise:!0,text:t.text}),"cut"==e.type&&s.operation(function(){s.setSelections(t.ranges,0,za),s.replaceSelection("",null,"cut")})}if(e.clipboardData){e.clipboardData.clearData();var i=Qs.text.join("\n");if(e.clipboardData.setData("Text",i),e.clipboardData.getData("Text")==i)return void e.preventDefault()}var r=Xo(),n=r.firstChild;s.display.lineSpace.insertBefore(r,s.display.lineSpace.firstChild),n.value=Qs.text.join("\n");var o=document.activeElement;Ia(n),setTimeout(function(){s.display.lineSpace.removeChild(r),o.focus(),o==l&&a.showPrimarySelection()},50)}}var i=this,a=this,s=a.cm,l=a.div=e.lineDiv;Yo(l,s.options.spellcheck),Za(l,"paste",function(e){Oe(s,e)||Go(e,s)||ma<=11&&setTimeout(hr(s,function(){return i.updateFromDOM()}),20)}),Za(l,"compositionstart",function(e){i.composing={data:e.data,done:!1}}),Za(l,"compositionupdate",function(e){i.composing||(i.composing={data:e.data,done:!1})}),Za(l,"compositionend",function(e){i.composing&&(e.data!=i.composing.data&&i.readFromDOMSoon(),i.composing.done=!0)}),Za(l,"touchstart",function(){return a.forceCompositionEnd()}),Za(l,"input",function(){i.composing||i.readFromDOMSoon()}),Za(l,"copy",t),Za(l,"cut",t)},Zs.prototype.prepareSelection=function(){var e=Ei(this.cm,!1);return e.focus=this.cm.state.focused,e},Zs.prototype.showSelection=function(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},Zs.prototype.showPrimarySelection=function(){var e=window.getSelection(),t=this.cm,i=t.doc.sel.primary(),r=i.from(),n=i.to();if(t.display.viewTo==t.display.viewFrom||r.line>=t.display.viewTo||n.line<t.display.viewFrom)e.removeAllRanges();else{var o=na(t,e.anchorNode,e.anchorOffset),a=na(t,e.focusNode,e.focusOffset);if(!o||o.bad||!a||a.bad||0!=D(z(o,a),r)||0!=D(H(o,a),n)){var s=t.display.view,l=r.line>=t.display.viewFrom&&ea(t,r)||{node:s[0].measure.map[2],offset:0},c=n.line<t.display.viewTo&&ea(t,n);if(!c){var d=s[s.length-1].measure,u=d.maps?d.maps[d.maps.length-1]:d.map;c={node:u[u.length-1],offset:u[u.length-2]-u[u.length-3]}}if(l&&c){var h,p=e.rangeCount&&e.getRangeAt(0);try{h=La(l.node,l.offset,c.offset,c.node)}catch(f){}h&&(!da&&t.state.focused?(e.collapse(l.node,l.offset),h.collapsed||(e.removeAllRanges(),e.addRange(h))):(e.removeAllRanges(),e.addRange(h)),p&&null==e.anchorNode?e.addRange(p):da&&this.startGracePeriod()),this.rememberSelection()}else e.removeAllRanges()}}},Zs.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation(function(){return e.cm.curOp.selectionChanged=!0})},20)},Zs.prototype.showMultipleSelections=function(e){o(this.cm.display.cursorDiv,e.cursors),o(this.cm.display.selectionDiv,e.selection)},Zs.prototype.rememberSelection=function(){var e=window.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},Zs.prototype.selectionInEditor=function(){var e=window.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return g(this.div,t)},Zs.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())},Zs.prototype.blur=function(){this.div.blur()},Zs.prototype.getField=function(){return this.div},Zs.prototype.supportsTouch=function(){return!0},Zs.prototype.receivedFocus=function(){function e(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,e))}var t=this;this.selectionInEditor()?this.pollSelection():ur(this.cm,function(){return t.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,e)},Zs.prototype.selectionChanged=function(){var e=window.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},Zs.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var e=window.getSelection(),t=this.cm;if(Ca&&ba&&this.cm.options.gutters.length&&ta(e.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var i=na(t,e.anchorNode,e.anchorOffset),r=na(t,e.focusNode,e.focusOffset);i&&r&&ur(t,function(){yn(t.doc,Fr(i,r),za),(i.bad||r.bad)&&(t.curOp.selectionChanged=!0)})}}},Zs.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e,t,i,r=this.cm,n=r.display,o=r.doc.sel.primary(),a=o.from(),s=o.to();if(0==a.ch&&a.line>r.firstLine()&&(a=R(a.line-1,$(r.doc,a.line-1).length)),s.ch==$(r.doc,s.line).text.length&&s.line<r.lastLine()&&(s=R(s.line+1,0)),a.line<n.viewFrom||s.line>n.viewTo-1)return!1;i=a.line==n.viewFrom||0==(e=Ti(r,a.line))?(t=O(n.view[0].line),n.view[0].node):(t=O(n.view[e].line),n.view[e-1].node.nextSibling);var l,c,d=Ti(r,s.line);if(c=d==n.view.length-1?(l=n.viewTo-1,n.lineDiv.lastChild):(l=O(n.view[d+1].line)-1,n.view[d+1].node.previousSibling),!i)return!1;for(var u=r.doc.splitLines(ra(r,i,c,t,l)),h=A(r.doc,R(t,0),R(l,$(r.doc,l).text.length));1<u.length&&1<h.length;)if(U(u)==U(h))u.pop(),h.pop(),l--;else{if(u[0]!=h[0])break;u.shift(),h.shift(),t++}for(var p=0,f=0,m=u[0],g=h[0],v=Math.min(m.length,g.length);p<v&&m.charCodeAt(p)==g.charCodeAt(p);)++p;for(var b=U(u),y=U(h),w=Math.min(b.length-(1==u.length?p:0),y.length-(1==h.length?p:0));f<w&&b.charCodeAt(b.length-f-1)==y.charCodeAt(y.length-f-1);)++f;if(1==u.length&&1==h.length&&t==a.line)for(;p&&p>a.ch&&b.charCodeAt(b.length-f-1)==y.charCodeAt(y.length-f-1);)p--,f++;u[u.length-1]=b.slice(0,b.length-f).replace(/^\u200b+/,""),u[0]=u[0].slice(p).replace(/\u200b+$/,"");var k=R(t,p),x=R(l,h.length?U(h).length-f:0);return 1<u.length||u[0]||D(k,x)?(Pn(r.doc,u,k,x,"+input"),!0):void 0},Zs.prototype.ensurePolled=function(){this.forceCompositionEnd()},Zs.prototype.reset=function(){this.forceCompositionEnd()},Zs.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},Zs.prototype.readFromDOMSoon=function(){var e=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){if(e.readDOMTimeout=null,e.composing){if(!e.composing.done)return;e.composing=null}e.updateFromDOM()},80))},Zs.prototype.updateFromDOM=function(){var e=this;!this.cm.isReadOnly()&&this.pollContent()||ur(this.cm,function(){return mr(e.cm)})},Zs.prototype.setUneditable=function(e){e.contentEditable="false"},Zs.prototype.onKeyPress=function(e){0!=e.charCode&&(e.preventDefault(),this.cm.isReadOnly()||hr(this.cm,qo)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))},Zs.prototype.readOnlyChanged=function(e){this.div.contentEditable=String("nocursor"!=e)},Zs.prototype.onContextMenu=function(){},Zs.prototype.resetPosition=function(){},Zs.prototype.needsContentAttribute=!0;var Js=function(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new Pa,this.hasSelection=!1,this.composing=null};Js.prototype.init=function(t){function e(e){if(!Oe(n,e)){if(n.somethingSelected())jo({lineWise:!1,text:n.getSelections()});else{if(!n.options.lineWiseCopyCut)return;var t=Vo(n);jo({lineWise:!0,text:t.text}),"cut"==e.type?n.setSelections(t.ranges,null,za):(r.prevInput="",a.value=t.text.join("\n"),Ia(a))}"cut"==e.type&&(n.state.cutIncoming=!0)}}var i=this,r=this,n=this.cm,o=this.wrapper=Xo(),a=this.textarea=o.firstChild;t.wrapper.insertBefore(o,t.wrapper.firstChild),_a&&(a.style.width="0px"),Za(a,"input",function(){fa&&9<=ma&&i.hasSelection&&(i.hasSelection=null),r.poll()}),Za(a,"paste",function(e){Oe(n,e)||Go(e,n)||(n.state.pasteIncoming=!0,r.fastPoll())}),Za(a,"cut",e),Za(a,"copy",e),Za(t.scroller,"paste",function(e){Bt(t,e)||Oe(n,e)||(n.state.pasteIncoming=!0,r.focus())}),Za(t.lineSpace,"selectstart",function(e){Bt(t,e)||Pe(e)}),Za(a,"compositionstart",function(){var e=n.getCursor("from");r.composing&&r.composing.range.clear(),r.composing={start:e,range:n.markText(e,n.getCursor("to"),{className:"CodeMirror-composing"})}}),Za(a,"compositionend",function(){r.composing&&(r.poll(),r.composing.range.clear(),r.composing=null)})},Js.prototype.prepareSelection=function(){var e=this.cm,t=e.display,i=e.doc,r=Ei(e);if(e.options.moveInputWithCursor){var n=ui(e,i.sel.primary().head,"div"),o=t.wrapper.getBoundingClientRect(),a=t.lineDiv.getBoundingClientRect();r.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,n.top+a.top-o.top)),r.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,n.left+a.left-o.left))}return r},Js.prototype.showSelection=function(e){var t=this.cm.display;o(t.cursorDiv,e.cursors),o(t.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},Js.prototype.reset=function(e){if(!this.contextMenuPending&&!this.composing){var t=this.cm;if(t.somethingSelected()){this.prevInput="";var i=t.getSelection();this.textarea.value=i,t.state.focused&&Ia(this.textarea),fa&&9<=ma&&(this.hasSelection=i)}else e||(this.prevInput=this.textarea.value="",fa&&9<=ma&&(this.hasSelection=null))}},Js.prototype.getField=function(){return this.textarea},Js.prototype.supportsTouch=function(){return!1},Js.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!Ta||h()!=this.textarea))try{this.textarea.focus()}catch(e){}},Js.prototype.blur=function(){this.textarea.blur()},Js.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},Js.prototype.receivedFocus=function(){this.slowPoll()},Js.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){e.poll(),e.cm.state.focused&&e.slowPoll()})},Js.prototype.fastPoll=function(){function e(){i.poll()||t?(i.pollingFast=!1,i.slowPoll()):(t=!0,i.polling.set(60,e))}var t=!1,i=this;i.pollingFast=!0,i.polling.set(20,e)},Js.prototype.poll=function(){var e=this,t=this.cm,i=this.textarea,r=this.prevInput;if(this.contextMenuPending||!t.state.focused||ts(i)&&!r&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var n=i.value;if(n==r&&!t.somethingSelected())return!1;if(fa&&9<=ma&&this.hasSelection===n||Sa&&/[\uf700-\uf7ff]/.test(n))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var o=n.charCodeAt(0);if(8203!=o||r||(r="\u200b"),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var a=0,s=Math.min(r.length,n.length);a<s&&r.charCodeAt(a)==n.charCodeAt(a);)++a;return ur(t,function(){qo(t,n.slice(a),r.length-a,null,e.composing?"*compose":null),1e3<n.length||-1<n.indexOf("\n")?i.value=e.prevInput="":e.prevInput=n,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},Js.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},Js.prototype.onKeyPress=function(){fa&&9<=ma&&(this.hasSelection=null),this.fastPoll()},Js.prototype.onContextMenu=function(e){function i(){if(null!=a.selectionStart){var e=n.somethingSelected(
),t="\u200b"+(e?a.value:"");a.value="\u21da",a.value=t,r.prevInput=e?"":"\u200b",a.selectionStart=1,a.selectionEnd=t.length,o.selForContextMenu=n.doc.sel}}function t(){if(r.contextMenuPending=!1,r.wrapper.style.cssText=d,a.style.cssText=c,fa&&ma<9&&o.scrollbars.setScrollTop(o.scroller.scrollTop=l),null!=a.selectionStart){(!fa||fa&&ma<9)&&i();var e=0,t=function(){o.selForContextMenu==n.doc.sel&&0==a.selectionStart&&0<a.selectionEnd&&"\u200b"==r.prevInput?hr(n,En)(n):e++<10?o.detectingSelectAll=setTimeout(t,500):(o.selForContextMenu=null,o.input.reset())};o.detectingSelectAll=setTimeout(t,200)}}var r=this,n=r.cm,o=n.display,a=r.textarea,s=Ci(n,e),l=o.scroller.scrollTop;if(s&&!ya){n.options.resetSelectionOnContextMenu&&-1==n.doc.sel.contains(s)&&hr(n,yn)(n.doc,Fr(s),za);var c=a.style.cssText,d=r.wrapper.style.cssText;r.wrapper.style.cssText="position: absolute";var u,h=r.wrapper.getBoundingClientRect();if(a.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-h.top-5)+"px; left: "+(e.clientX-h.left-5)+"px;\n      z-index: 1000; background: "+(fa?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",ga&&(u=window.scrollY),o.input.focus(),ga&&window.scrollTo(null,u),o.input.reset(),n.somethingSelected()||(a.value=r.prevInput=" "),r.contextMenuPending=!0,o.selForContextMenu=n.doc.sel,clearTimeout(o.detectingSelectAll),fa&&9<=ma&&i(),Oa){Fe(e);var p=function(){Le(window,"mouseup",p),setTimeout(t,20)};Za(window,"mouseup",p)}else setTimeout(t,50)}},Js.prototype.readOnlyChanged=function(e){e||this.reset(),this.textarea.disabled="nocursor"==e},Js.prototype.setUneditable=function(){},Js.prototype.needsContentAttribute=!1,Do(zo),Qo(zo);var el="iter insert remove copy getEditor constructor".split(" ");for(var tl in Os.prototype)Os.prototype.hasOwnProperty(tl)&&m(el,tl)<0&&(zo.prototype[tl]=function(e){return function(){return e.apply(this.doc,arguments)}}(Os.prototype[tl]));return e(Os),zo.inputStyles={textarea:Js,contenteditable:Zs},zo.defineMode=function(e){zo.defaults.mode||"null"==e||(zo.defaults.mode=e),je.apply(this,arguments)},zo.defineMIME=qe,zo.defineMode("null",function(){return{token:function(e){return e.skipToEnd()}}}),zo.defineMIME("text/plain","null"),zo.defineExtension=function(e,t){zo.prototype[e]=t},zo.defineDocExtension=function(e,t){Os.prototype[e]=t},zo.fromTextArea=aa,sa(zo),zo.version="5.28.0",zo}),function(h){h.Redactor.prototype.fontcolor=function(){return{init:function(){var e=["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],t=this.button.add("fontcolor","Text Color");this.button.setIcon(t,'<i class="re-icon-fontcolor"></i>');var i=this.button.addDropdown(t);i.attr("rel","fontcolor"),i.width(242);var r=h('<div style="overflow: hidden; text-align: center;">'),n=h('<span rel="text" class="re-dropdown-box-selector-font" style="background: #eee; float: left; padding: 8px 0; cursor: pointer; font-size: 12px; width: 50%;">Text</span>'),o=h('<span rel="back" class="re-dropdown-box-selector-font" style="float: left; padding: 8px 0; cursor: pointer; font-size: 12px; width: 50%;">Highlight</span>');r.append(n),r.append(o),i.append(r),this.fontcolor.buildPicker(i,"textcolor",e),this.fontcolor.buildPicker(i,"backcolor",e),n.on("mousedown",function(e){e.preventDefault(),i.find(".re-dropdown-box-selector-font").css("background","none"),i.find(".re-dropdown-box-backcolor").hide(),i.find(".re-dropdown-box-textcolor").show(),h(this).css("background","#eee")}),o.on("mousedown",function(e){e.preventDefault(),i.find(".re-dropdown-box-selector-font").css("background","none"),i.find(".re-dropdown-box-textcolor").hide(),i.find(".re-dropdown-box-backcolor").show(),h(this).css("background","#eee")})},buildPicker:function(e,t,i){for(var r=h('<div class="re-dropdown-box-'+t+'">'),n="backcolor"==t?"background-color":"color",o=i.length,a=this,s=function(e){e.preventDefault(),a.fontcolor.set(h(this).data("rule"),h(this).attr("rel"))},l=0;l<o;l++){var c=i[l],d=h('<a rel="'+c+'" data-rule="'+n+'" href="#" style="float: left; box-sizing: border-box; font-size: 0; border: 2px solid #fff; padding: 0; margin: 0; width: 22px; height: 22px;"></a>');d.css("background-color",c),d.on("mousedown",s),r.append(d)}var u=h('<a href="#" style="display: block; clear: both; padding: 8px 5px; box-sizing: border-box; font-size: 12px; line-height: 1;"></a>').html(this.lang.get("none"));u.on("mousedown",h.proxy(function(e){e.preventDefault(),this.fontcolor.remove(n)},this)),r.append(u),e.append(r),"backcolor"==t&&r.hide()},set:function(e,t){console.log(this),this.inline.format("dfn","style",e+": "+t+";"),this.dropdown.hide()},remove:function(e){this.inline.removeStyleRule(e),this.dropdown.hide()}}}}(jQuery),function(o){o.Redactor.prototype.codemirror=function(){return{init:function(){var e=this.button.addFirst("html","HTML");this.button.setIcon(e,'<i class="re-icon-html"></i>'),this.button.addCallback(e,this.codemirror.toggle),this.codemirror.$textarea=o("<textarea />"),this.codemirror.$textarea.hide(),"textarea"===this.opts.type?this.core.box().append(this.codemirror.$textarea):this.core.box().after(this.codemirror.$textarea),this.core.element().on("destroy.callback.redactor",o.proxy(function(){this.codemirror.$textarea.remove()},this));var t="undefined"!=typeof this.opts.codemirror?this.opts.codemirror:{lineNumbers:!0};this.codemirror.editor=CodeMirror.fromTextArea(this.codemirror.$textarea[0],t),this.codemirror.$textarea.next(".CodeMirror").hide()},toggle:function(){this.codemirror.$textarea.hasClass("open")?this.codemirror.hide():(this.codemirror.show(),this.codemirror.$textarea.next(".CodeMirror").on("keyup.redactor-codemirror",o.proxy(function(){var i="";this.codemirror.$textarea.next(".CodeMirror").each(function(e,t){i=t.CodeMirror.getValue()}),this.core.callback("change",i)},this)))},setCaretOnShow:function(){this.codemirror.offset=this.offset.get();o(window).scrollTop(),this.core.editor().innerWidth(),this.core.editor().innerHeight();this.codemirror.start=0,this.codemirror.end=0;var e=o("<div/>").append(o.parseHTML(this.core.editor().html(),document,!0)),t=e.find(".redactor-selection-marker");if(0<t.length){var i=e.html().replace(/&amp;/g,"&");1===t.length?(this.codemirror.start=this.utils.strpos(i,e.find("#selection-marker-1").prop("outerHTML")),this.codemirror.end=this.codemirror.start):2===t.length&&(this.codemirror.start=this.utils.strpos(i,e.find("#selection-marker-1").prop("outerHTML")),this.codemirror.end=this.utils.strpos(i,e.find("#selection-marker-2").prop("outerHTML"))-e.find("#selection-marker-1").prop("outerHTML").toString().length)}},setCaretOnHide:function(){this.codemirror.start=0,this.codemirror.end=0;var i=this,r="";if(this.codemirror.$textarea.next(".CodeMirror").each(function(e,t){i.codemirror.selection=t.CodeMirror.listSelections(),i.codemirror.start=t.CodeMirror.indexFromPos(i.codemirror.selection[0].anchor),i.codemirror.end=t.CodeMirror.indexFromPos(i.codemirror.selection[0].head),r=t.CodeMirror.getValue()}),this.codemirror.start>this.codemirror.end&&0<this.codemirror.end){var e=this.codemirror.end,t=this.codemirror.start;this.codemirror.start=e,this.codemirror.end=t}if(this.codemirror.start=this.codemirror.enlargeOffset(r,this.codemirror.start),this.codemirror.end=this.codemirror.enlargeOffset(r,this.codemirror.end),r=r.substr(0,this.codemirror.start)+this.marker.html(1)+r.substr(this.codemirror.start),this.codemirror.end>this.codemirror.start){var n=this.marker.html(1).toString().length;r=r.substr(0,this.codemirror.end+n)+this.marker.html(2)+r.substr(this.codemirror.end+n)}return r},hide:function(){var e;this.codemirror.$textarea.removeClass("open").next(".CodeMirror").hide(),this.codemirror.$textarea.next(".CodeMirror").off(".redactor-codemirror"),e=this.codemirror.setCaretOnHide(e),e=(e=this.paragraphize.load(e)).replace('&amp;<span id="selection-marker-1" class="redactor-selection-marker">\u200b</span>','<span id="selection-marker-1" class="redactor-selection-marker">\u200b</span>&amp;'),this.code.start(e),this.button.enableAll(),this.core.editor().show().focus(),this.selection.restore(),this.placeholder.enable(),this.core.callback("visual")},show:function(){this.selection.save(),this.codemirror.setCaretOnShow();var i=this.core.editor().height(),r=this.code.get();r=this.core.callback("source",r),this.core.editor().hide(),this.button.disableAll("html"),this.marker.remove(),this.codemirror.$textarea.val(r).height(i).addClass("open"),this.codemirror.$textarea.next(".CodeMirror").on("keyup.redactor-codemirror",o.proxy(function(){"textarea"===this.opts.type&&this.codemirror.$textarea.next(".CodeMirror").each(o.proxy(function(e,t){this.core.textarea().val(t.CodeMirror.getValue())},this))},this));var n=this;this.codemirror.$textarea.next(".CodeMirror").each(function(e,t){o(t).show(),t.CodeMirror.setValue(r),t.CodeMirror.setSize("100%",i),t.CodeMirror.refresh(),n.codemirror.start===n.codemirror.end?t.CodeMirror.setCursor(t.CodeMirror.posFromIndex(n.codemirror.start).line,t.CodeMirror.posFromIndex(n.codemirror.end).ch):t.CodeMirror.setSelection({line:t.CodeMirror.posFromIndex(n.codemirror.start).line,ch:t.CodeMirror.posFromIndex(n.codemirror.start).ch},{line:t.CodeMirror.posFromIndex(n.codemirror.end).line,ch:t.CodeMirror.posFromIndex(n.codemirror.end).ch}),t.CodeMirror.focus()})},enlargeOffset:function(e,t){var i=e.length,r=0;if(">"===e[t])r++;else for(var n=t;n<=i&&(r++,">"!==e[n]);n++)if("<"===e[n]||n===i){r=0;break}return t+r}}}}(jQuery),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(T){"use strict";var S={autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,caseFold:!0},E={autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,caseFold:!1};T.defineMode("xml",function(e,t){function a(t,i){function e(e){return(i.tokenize=e)(t,i)}var r=t.next();return"<"==r?t.eat("!")?t.eat("[")?t.match("CDATA[")?e(o("atom","]]>")):null:t.match("--")?e(o("comment","-->")):t.match("DOCTYPE",!0,!0)?(t.eatWhile(/[\w\._\-]/),e(l(1))):null:t.eat("?")?(t.eatWhile(/[\w\._\-]/),i.tokenize=o("meta","?>"),"meta"):(w=t.eat("/")?"closeTag":"openTag",i.tokenize=s,"tag bracket"):"&"!=r?(t.eatWhile(/[^&<]/),null):(t.eat("#")?t.eat("x")?t.eatWhile(/[a-fA-F\d]/)&&t.eat(";"):t.eatWhile(/[\d]/)&&t.eat(";"):t.eatWhile(/[\w\.\-:]/)&&t.eat(";"))?"atom":"error"}function s(e,t){var i=e.next();if(">"==i||"/"==i&&e.eat(">"))return t.tokenize=a,w=">"==i?"endTag":"selfcloseTag","tag bracket";if("="==i)return w="equals",null;if("<"!=i)return/[\'\"]/.test(i)?(t.tokenize=n(i),t.stringStartCol=e.column(),t.tokenize(e,t)):(e.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/),"word");t.tokenize=a,t.state=h,t.tagName=t.tagStart=null;var r=t.tokenize(e,t);return r?r+" tag error":"tag error"}function n(i){var e=function(e,t){for(;!e.eol();)if(e.next()==i){t.tokenize=s;break}return"string"};return e.isInAttribute=!0,e}function o(i,r){return function(e,t){for(;!e.eol();){if(e.match(r)){t.tokenize=a;break}e.next()}return i}}function l(r){return function(e,t){for(var i;null!=(i=e.next());){if("<"==i)return t.tokenize=l(r+1),t.tokenize(e,t);if(">"==i){if(1!=r)return t.tokenize=l(r-1),t.tokenize(e,t);t.tokenize=a;break}}return"meta"}}function c(e,t,i){this.prev=e.context,this.tagName=t,this.indent=e.indented,this.startOfLine=i,(_.doNotIndent.hasOwnProperty(t)||e.context&&e.context.noIndent)&&(this.noIndent=!0)}function d(e){e.context&&(e.context=e.context.prev)}function u(e,t){for(var i;;){if(!e.context)return;if(i=e.context.tagName,!_.contextGrabbers.hasOwnProperty(i)||!_.contextGrabbers[i].hasOwnProperty(t))return;d(e)}}function h(e,t,i){return"openTag"==e?(i.tagStart=t.column(),r):"closeTag"==e?p:h}function r(e,t,i){return"word"==e?(i.tagName=t.current(),k="tag",g):(k="error",r)}function p(e,t,i){if("word"!=e)return k="error",m;var r=t.current();return i.context&&i.context.tagName!=r&&_.implicitlyClosed.hasOwnProperty(i.context.tagName)&&d(i),i.context&&i.context.tagName==r||!1===_.matchClosing?(k="tag",f):(k="tag error",m)}function f(e,t,i){return"endTag"!=e?(k="error",f):(d(i),h)}function m(e,t,i){return k="error",f(e,t,i)}function g(e,t,i){if("word"==e)return k="attribute",v;if("endTag"!=e&&"selfcloseTag"!=e)return k="error",g;var r=i.tagName,n=i.tagStart;return i.tagName=i.tagStart=null,"selfcloseTag"==e||_.autoSelfClosers.hasOwnProperty(r)?u(i,r):(u(i,r),i.context=new c(i,r,n==i.indented)),h}function v(e,t,i){return"equals"==e?b:(_.allowMissing||(k="error"),g(e,t,i))}function b(e,t,i){return"string"==e?y:"word"==e&&_.allowUnquoted?(k="string",g):(k="error",g(e,t,i))}function y(e,t,i){return"string"==e?y:g(e,t,i)}var w,k,x=e.indentUnit,_={},i=t.htmlMode?S:E;for(var C in i)_[C]=i[C];for(var C in t)_[C]=t[C];return a.isInText=!0,{startState:function(e){var t={tokenize:a,state:h,indented:e||0,tagName:null,tagStart:null,context:null};return null!=e&&(t.baseIndent=e),t},token:function(e,t){if(!t.tagName&&e.sol()&&(t.indented=e.indentation()),e.eatSpace())return null;w=null;var i=t.tokenize(e,t);return(i||w)&&"comment"!=i&&(k=null,t.state=t.state(w||i,e,t),k&&(i="error"==k?i+" error":k)),i},indent:function(e,t,i){var r=e.context;if(e.tokenize.isInAttribute)return e.tagStart==e.indented?e.stringStartCol+1:e.indented+x;if(r&&r.noIndent)return T.Pass;if(e.tokenize!=s&&e.tokenize!=a)return i?i.match(/^(\s*)/)[0].length:0;if(e.tagName)return!1!==_.multilineTagIndentPastTag?e.tagStart+e.tagName.length+2:e.tagStart+x*(_.multilineTagIndentFactor||1);if(_.alignCDATA&&/<!\[CDATA\[/.test(t))return 0;var n=t&&/^<(\/)?([\w_:\.-]*)/.exec(t);if(n&&n[1])for(;r;){if(r.tagName==n[2]){r=r.prev;break}if(!_.implicitlyClosed.hasOwnProperty(r.tagName))break;r=r.prev}else if(n)for(;r;){var o=_.contextGrabbers[r.tagName];if(!o||!o.hasOwnProperty(n[2]))break;r=r.prev}for(;r&&r.prev&&!r.startOfLine;)r=r.prev;return r?r.indent+x:e.baseIndent||0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"<!--",blockCommentEnd:"-->",configuration:_.htmlMode?"html":"xml",helperType:_.htmlMode?"html":"xml",skipAttribute:function(e){e.state==b&&(e.state=g)}}}),T.defineMIME("text/xml","xml"),T.defineMIME("application/xml","xml"),T.mimeModes.hasOwnProperty("text/html")||T.defineMIME("text/html",{name:"xml",htmlMode:!0})});var _self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},Prism=function(){var l=/\blang(?:uage)?-(\w+)\b/i,t=0,A=_self.Prism={util:{encode:function(e){return e instanceof a?new a(e.type,A.util.encode(e.content),e.alias):"Array"===A.util.type(e)?e.map(A.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++t}),e.__id},clone:function(e){switch(A.util.type(e)){case"Object":var t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=A.util.clone(e[i]));return t;case"Array":return e.map&&e.map(function(e){return A.util.clone(e)})}return e}},languages:{extend:function(e,t){var i=A.util.clone(A.languages[e]);for(var r in t)i[r]=t[r];return i},insertBefore:function(i,e,t,r){var n=(r=r||A.languages)[i];if(2==arguments.length){for(var o in t=e)t.hasOwnProperty(o)&&(n[o]=t[o]);return n}var a={};for(var s in n)if(n.hasOwnProperty(s)){if(s==e)for(var o in t)t.hasOwnProperty(o)&&(a[o]=t[o]);a[s]=n[s]}return A.languages.DFS(A.languages,function(e,t){t===r[i]&&e!=i&&(this[e]=a)}),r[i]=a},DFS:function(e,t,i,r){for(var n in r=r||{},e)e.hasOwnProperty(n)&&(t.call(e,n,e[n],i||n),"Object"!==A.util.type(e[n])||r[A.util.objId(e[n])]?"Array"!==A.util.type(e[n])||r[A.util.objId(e[n])]||(r[A.util.objId(e[n])]=!0,A.languages.DFS(e[n],t,n,r)):(r[A.util.objId(e[n])]=!0,A.languages.DFS(e[n],t,null,r)))}},plugins:{},highlightAll:function(e,t){var i={callback:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};A.hooks.run("before-highlightall",i);for(var r,n=i.elements||document.querySelectorAll(i.selector),o=0;r=n[o++];)A.highlightElement(r,!0===e,i.callback)},highlightElement:function(e,t,i){for(var r,n,o=e;o&&!l.test(o.className);)o=o.parentNode;o&&(r=(o.className.match(l)||[,""])[1].toLowerCase(),n=A.languages[r]),e.className=e.className.replace(l,"").replace(/\s+/g," ")+" language-"+r,o=e.parentNode,/pre/i.test(o.nodeName)&&(o.className=o.className.replace(l,"").replace(/\s+/g," ")+" language-"+r);var a={element:e,language:r,grammar:n,code:e.textContent};if(A.hooks.run("before-sanity-check",a),!a.code||!a.grammar)return a.code&&(a.element.textContent=a.code),void A.hooks.run("complete",a);if(A.hooks.run("before-highlight",a),t&&_self.Worker){var s=new Worker(A.filename);s.onmessage=function(e){a.highlightedCode=e.data,A.hooks.run("before-insert",a),a.element.innerHTML=a.highlightedCode,i&&i.call(a.element),A.hooks.run("after-highlight",a),A.hooks.run("complete",a)},s.postMessage(JSON.stringify({language:a.language,code:a.code,immediateClose:!0}))}else a.highlightedCode=A.highlight(a.code,a.grammar,a.language),A.hooks.run("before-insert",a),a.element.innerHTML=a.highlightedCode,i&&i.call(e),A.hooks.run("after-highlight",a),A.hooks.run("complete",a)},highlight:function(e,t,i){var r=A.tokenize(e,t);return a.stringify(A.util.encode(r),i)},tokenize:function(e,t){var i=A.Token,r=[e],n=t.rest;if(n){for(var o in n)t[o]=n[o];delete t.rest}e:for(var o in t)if(t.hasOwnProperty(o)&&t[o]){var a=t[o];a="Array"===A.util.type(a)?a:[a];for(var s=0;s<a.length;++s){var l=a[s],c=l.inside,d=!!l.lookbehind,u=!!l.greedy,h=0,p=l.alias;if(u&&!l.pattern.global){var f=l.pattern.toString().match(/[imuy]*$/)[0];l.pattern=RegExp(l.pattern.source,f+"g")}l=l.pattern||l;for(var m=0,g=0;m<r.length;g+=r[m].length,++m){var v=r[m];if(r.length>e.length)break e;if(!(v instanceof i)){l.lastIndex=0;var b=1;if(!(C=l.exec(v))&&u&&m!=r.length-1){if(l.lastIndex=g,!(C=l.exec(e)))break;for(var y=C.index+(d?C[1].length:0),w=C.index+C[0].length,k=m,x=g,_=r.length;k<_&&x<w;++k)(x+=r[k].length)<=y&&(++m,g=x);if(r[m]instanceof i||r[k-1].greedy)continue;b=k-m,v=e.slice(g,x),C.index-=g}if(C){d&&(h=C[1].length);w=(y=C.index+h)+(C=C[0].slice(h)).length;var C,T=v.slice(0,y),S=v.slice(w),E=[m,b];T&&E.push(T);var $=new i(o,c?A.tokenize(C,c):C,p,C,u);E.push($),S&&E.push(S),Array.prototype.splice.apply(r,E)}}}}}return r},hooks:{all:{},add:function(e,t){var i=A.hooks.all;i[e]=i[e]||[],i[e].push(t)},run:function(e,t){var i=A.hooks.all[e];if(i&&i.length)for(var r,n=0;r=i[n++];)r(t)}}},a=A.Token=function(e,t,i,r,n){this.type=e,this.content=t,this.alias=i,this.length=0|(r||"").length,this.greedy=!!n};if(a.stringify=function(t,i,e){if("string"==typeof t)return t;if("Array"===A.util.type(t))return t.map(function(e){return a.stringify(e,i,t)}).join("");var r={type:t.type,content:a.stringify(t.content,i,e),tag:"span",classes:["token",t.type],attributes:{},language:i,parent:e};if("comment"==r.type&&(r.attributes.spellcheck="true"),t.alias){var n="Array"===A.util.type(t.alias)?t.alias:[t.alias];Array.prototype.push.apply(r.classes,n)}A.hooks.run("wrap",r);var o=Object.keys(r.attributes).map(function(e){return e+'="'+(r.attributes[e]||"").replace(/"/g,"&quot;")+'"'}).join(" ");return"<"+r.tag+' class="'+r.classes.join(" ")+'"'+(o?" "+o:"")+">"+r.content+"</"+r.tag+">"},!_self.document)return _self.addEventListener&&_self.addEventListener("message",function(e){var t=JSON.parse(e.data),i=t.language,r=t.code,n=t.immediateClose;_self.postMessage(A.highlight(r,A.languages[i],i)),n&&_self.close()},!1),_self.Prism;var e=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();return e&&(A.filename=e.src,document.addEventListener&&!e.hasAttribute("data-manual")&&("loading"!==document.readyState?window.requestAnimationFrame?window.requestAnimationFrame(A.highlightAll):window.setTimeout(A.highlightAll,16):document.addEventListener("DOMContentLoaded",A.highlightAll))),_self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism),"undefined"!=typeof global&&(global.Prism=Prism),Prism.languages.markup={comment:/<!--[\w\W]*?-->/,prolog:/<\?[\w\W]+?\?>/,doctype:/<!DOCTYPE[\w\W]+?>/i,cdata:/<!\[CDATA\[[\w\W]*?]]>/i,tag:{pattern:/<\/?(?!\d)[^\s>\/=$<]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\\1|\\?(?!\1)[\w\W])*\1|[^\s'">=]+))?)*\s*\/?>/i,inside:{tag:{pattern:/^<\/?[^\s>\/]+/i,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"attr-value":{pattern:/=(?:('|")[\w\W]*?(\1)|[^\s>]+)/i,inside:{punctuation:/[=>"']/}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:/&#?[\da-z]{1,8};/i},Prism.hooks.add("wrap",function(e){"entity"===e.type&&(e.attributes.title=e.content.replace(/&amp;/,"&"))}),Prism.languages.xml=Prism.languages.markup,Prism.languages.html=Prism.languages.markup,Prism.languages.mathml=Prism.languages.markup,Prism.languages.svg=Prism.languages.markup,Prism.languages.css={comment:/\/\*[\w\W]*?\*\//,atrule:{pattern:/@[\w-]+?.*?(;|(?=\s*\{))/i,inside:{rule:/@[\w-]+/}},url:/url\((?:(["'])(\\(?:\r\n|[\w\W])|(?!\1)[^\\\r\n])*\1|.*?)\)/i,selector:/[^\{\}\s][^\{\};]*?(?=\s*\{)/,string:{pattern:/("|')(\\(?:\r\n|[\w\W])|(?!\1)[^\\\r\n])*\1/,greedy:!0},property:/(\b|\B)[\w-]+(?=\s*:)/i,important:/\B!important\b/i,"function":/[-a-z0-9]+(?=\()/i,punctuation:/[(){};:]/},Prism.languages.css.atrule.inside.rest=Prism.util.clone(Prism.languages.css),Prism.languages.markup&&(Prism.languages.insertBefore("markup","tag",{style:{pattern:/(<style[\w\W]*?>)[\w\W]*?(?=<\/style>)/i,lookbehind:!0,inside:Prism.languages.css,alias:"language-css"}}),Prism.languages.insertBefore("inside","attr-value",{"style-attr":{pattern:/\s*style=("|').*?\1/i,inside:{"attr-name":{pattern:/^\s*style/i,inside:Prism.languages.markup.tag.inside},punctuation:/^\s*=\s*['"]|['"]\s*$/,"attr-value":{pattern:/.+/i,inside:Prism.languages.css}},alias:"language-css"}},Prism.languages.markup.tag)),Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\w\W]*?\*\//,lookbehind:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0}],string:{pattern:/(["'])(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/((?:\b(?:class|interface|extends|implements|trait|instanceof|new)\s+)|(?:catch\s+\())[a-z0-9_\.\\]+/i,lookbehind:!0,inside:{punctuation:/(\.|\\)/}},keyword:/\b(if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,"boolean":/\b(true|false)\b/,"function":/[a-z0-9_]+(?=\()/i,number:/\b-?(?:0x[\da-f]+|\d*\.?\d+(?:e[+-]?\d+)?)\b/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*|\/|~|\^|%/,punctuation:/[{}[\];(),.:]/},Prism.languages.javascript=Prism.languages.extend("clike",{keyword:/\b(as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield)\b/,number:/\b-?(0x[\dA-Fa-f]+|0b[01]+|0o[0-7]+|\d*\.?\d+([Ee][+-]?\d+)?|NaN|Infinity)\b/,"function":/[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*(?=\()/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*\*?|\/|~|\^|%|\.{3}/}),Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:/(^|[^/])\/(?!\/)(\[.+?]|\\.|[^/\\\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/,lookbehind:!0,greedy:!0}}),Prism.languages.insertBefore("javascript","string",{"template-string":{pattern:/`(?:\\\\|\\?[^\\])*?`/,greedy:!0,inside:{interpolation:{pattern:/\$\{[^}]+\}/,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}}}),Prism.languages.markup&&Prism.languages.insertBefore("markup","tag",{script:{pattern:/(<script[\w\W]*?>)[\w\W]*?(?=<\/script>)/i,lookbehind:!0,inside:Prism.languages.javascript,alias:"language-javascript"}}),Prism.languages.js=Prism.languages.javascript,Prism.languages.aspnet=Prism.languages.extend("markup",{"page-directive tag":{pattern:/<%\s*@.*%>/i,inside:{"page-directive tag":/<%\s*@\s*(?:Assembly|Control|Implements|Import|Master(?:Type)?|OutputCache|Page|PreviousPageType|Reference|Register)?|%>/i,rest:Prism.languages.markup.tag.inside}},"directive tag":{pattern:/<%.*%>/i,inside:{"directive tag":/<%\s*?[$=%#:]{0,2}|%>/i,rest:Prism.languages.csharp}}}),Prism.languages.aspnet.tag.pattern=/<(?!%)\/?[^\s>\/]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\\1|\\?(?!\1)[\w\W])*\1|[^\s'">=]+))?)*\s*\/?>/i,Prism.languages.insertBefore("inside","punctuation",{"directive tag":Prism.languages.aspnet["directive tag"]},Prism.languages.aspnet.tag.inside["attr-value"]),Prism.languages.insertBefore("aspnet","comment",{"asp comment":/<%--[\w\W]*?--%>/}),Prism.languages.insertBefore("aspnet",Prism.languages.javascript?"script":"tag",{"asp script":{pattern:/(<script(?=.*runat=['"]?server['"]?)[\w\W]*?>)[\w\W]*?(?=<\/script>)/i,lookbehind:!0,inside:Prism.languages.csharp||{}}}),function(e){var t={variable:[{pattern:/\$?\(\([\w\W]+?\)\)/,inside:{variable:[{pattern:/(^\$\(\([\w\W]+)\)\)/,lookbehind:!0},/^\$\(\(/],number:/\b-?(?:0x[\dA-Fa-f]+|\d*\.?\d+(?:[Ee]-?\d+)?)\b/,operator:/--?|-=|\+\+?|\+=|!=?|~|\*\*?|\*=|\/=?|%=?|<<=?|>>=?|<=?|>=?|==?|&&?|&=|\^=?|\|\|?|\|=|\?|:/,punctuation:/\(\(?|\)\)?|,|;/}},{pattern:/\$\([^)]+\)|`[^`]+`/,inside:{variable:/^\$\(|^`|\)$|`$/}},/\$(?:[a-z0-9_#\?\*!@]+|\{[^}]+\})/i]};e.languages.bash={shebang:{pattern:/^#!\s*\/bin\/bash|^#!\s*\/bin\/sh/,alias:"important"},comment:{pattern:/(^|[^"{\\])#.*/,lookbehind:!0},string:[{pattern:/((?:^|[^<])<<\s*)(?:"|')?(\w+?)(?:"|')?\s*\r?\n(?:[\s\S])*?\r?\n\2/g,lookbehind:!0,greedy:!0,inside:t},{pattern:/(["'])(?:\\\\|\\?[^\\])*?\1/g,greedy:!0,inside:t}],variable:t.variable,"function":{pattern:/(^|\s|;|\||&)(?:alias|apropos|apt-get|aptitude|aspell|awk|basename|bash|bc|bg|builtin|bzip2|cal|cat|cd|cfdisk|chgrp|chmod|chown|chroot|chkconfig|cksum|clear|cmp|comm|command|cp|cron|crontab|csplit|cut|date|dc|dd|ddrescue|df|diff|diff3|dig|dir|dircolors|dirname|dirs|dmesg|du|egrep|eject|enable|env|ethtool|eval|exec|expand|expect|export|expr|fdformat|fdisk|fg|fgrep|file|find|fmt|fold|format|free|fsck|ftp|fuser|gawk|getopts|git|grep|groupadd|groupdel|groupmod|groups|gzip|hash|head|help|hg|history|hostname|htop|iconv|id|ifconfig|ifdown|ifup|import|install|jobs|join|kill|killall|less|link|ln|locate|logname|logout|look|lpc|lpr|lprint|lprintd|lprintq|lprm|ls|lsof|make|man|mkdir|mkfifo|mkisofs|mknod|more|most|mount|mtools|mtr|mv|mmv|nano|netstat|nice|nl|nohup|notify-send|npm|nslookup|open|op|passwd|paste|pathchk|ping|pkill|popd|pr|printcap|printenv|printf|ps|pushd|pv|pwd|quota|quotacheck|quotactl|ram|rar|rcp|read|readarray|readonly|reboot|rename|renice|remsync|rev|rm|rmdir|rsync|screen|scp|sdiff|sed|seq|service|sftp|shift|shopt|shutdown|sleep|slocate|sort|source|split|ssh|stat|strace|su|sudo|sum|suspend|sync|tail|tar|tee|test|time|timeout|times|touch|top|traceroute|trap|tr|tsort|tty|type|ulimit|umask|umount|unalias|uname|unexpand|uniq|units|unrar|unshar|uptime|useradd|userdel|usermod|users|uuencode|uudecode|v|vdir|vi|vmstat|wait|watch|wc|wget|whereis|which|who|whoami|write|xargs|xdg-open|yes|zip)(?=$|\s|;|\||&)/,lookbehind:!0},keyword:{pattern:/(^|\s|;|\||&)(?:let|:|\.|if|then|else|elif|fi|for|break|continue|while|in|case|function|select|do|done|until|echo|exit|return|set|declare)(?=$|\s|;|\||&)/,lookbehind:!0},"boolean":{pattern:/(^|\s|;|\||&)(?:true|false)(?=$|\s|;|\||&)/,lookbehind:!0},operator:/&&?|\|\|?|==?|!=?|<<<?|>>|<=?|>=?|=~/,punctuation:/\$?\(\(?|\)\)?|\.\.|[{}[\];]/};var i=t.variable[1].inside;i["function"]=e.languages.bash["function"],i.keyword=e.languages.bash.keyword,i["boolean"]=e.languages.bash["boolean"],i.operator=e.languages.bash.operator,i.punctuation=e.languages.bash.punctuation}(Prism),Prism.languages.csharp=Prism.languages.extend("clike",{keyword:/\b(abstract|as|async|await|base|bool|break|byte|case|catch|char|checked|class|const|continue|decimal|default|delegate|do|double|else|enum|event|explicit|extern|false|finally|fixed|float|for|foreach|goto|if|implicit|in|int|interface|internal|is|lock|long|namespace|new|null|object|operator|out|override|params|private|protected|public|readonly|ref|return|sbyte|sealed|short|sizeof|stackalloc|static|string|struct|switch|this|throw|true|try|typeof|uint|ulong|unchecked|unsafe|ushort|using|virtual|void|volatile|while|add|alias|ascending|async|await|descending|dynamic|from|get|global|group|into|join|let|orderby|partial|remove|select|set|value|var|where|yield)\b/,string:[/@("|')(\1\1|\\\1|\\?(?!\1)[\s\S])*\1/,/("|')(\\?.)*?\1/],number:/\b-?(0x[\da-f]+|\d*\.?\d+f?)\b/i}),Prism.languages.insertBefore("csharp","keyword",{"generic-method":{pattern:/[a-z0-9_]+\s*<[^>\r\n]+?>\s*(?=\()/i,alias:"function",inside:{keyword:Prism.languages.csharp.keyword,punctuation:/[<>(),.:]/}},preprocessor:{pattern:/(^\s*)#.*/m,lookbehind:!0,alias:"property",inside:{directive:{pattern:/(\s*#)\b(define|elif|else|endif|endregion|error|if|line|pragma|region|undef|warning)\b/,lookbehind:!0,alias:"keyword"}}}}),function(e){e.languages.ruby=e.languages.extend("clike",{comment:/#(?!\{[^\r\n]*?\}).*/,keyword:/\b(alias|and|BEGIN|begin|break|case|class|def|define_method|defined|do|each|else|elsif|END|end|ensure|false|for|if|in|module|new|next|nil|not|or|raise|redo|require|rescue|retry|return|self|super|then|throw|true|undef|unless|until|when|while|yield)\b/});var t={pattern:/#\{[^}]+\}/,inside:{delimiter:{pattern:/^#\{|\}$/,alias:"tag"},rest:e.util.clone(e.languages.ruby)}};e.languages.insertBefore("ruby","keyword",{regex:[{pattern:/%r([^a-zA-Z0-9\s\{\(\[<])(?:[^\\]|\\[\s\S])*?\1[gim]{0,3}/,inside:{interpolation:t}},{pattern:/%r\((?:[^()\\]|\\[\s\S])*\)[gim]{0,3}/,inside:{interpolation:t}},{pattern:/%r\{(?:[^#{}\\]|#(?:\{[^}]+\})?|\\[\s\S])*\}[gim]{0,3}/,inside:{interpolation:t}},{pattern:/%r\[(?:[^\[\]\\]|\\[\s\S])*\][gim]{0,3}/,inside:{interpolation:t}},{pattern:/%r<(?:[^<>\\]|\\[\s\S])*>[gim]{0,3}/,inside:{interpolation:t}},{pattern:/(^|[^/])\/(?!\/)(\[.+?]|\\.|[^/\r\n])+\/[gim]{0,3}(?=\s*($|[\r\n,.;})]))/,lookbehind:!0}],variable:/[@$]+[a-zA-Z_][a-zA-Z_0-9]*(?:[?!]|\b)/,symbol:/:[a-zA-Z_][a-zA-Z_0-9]*(?:[?!]|\b)/}),e.languages.insertBefore("ruby","number",{builtin:/\b(Array|Bignum|Binding|Class|Continuation|Dir|Exception|FalseClass|File|Stat|File|Fixnum|Float|Hash|Integer|IO|MatchData|Method|Module|NilClass|Numeric|Object|Proc|Range|Regexp|String|Struct|TMS|Symbol|ThreadGroup|Thread|Time|TrueClass)\b/,constant:/\b[A-Z][a-zA-Z_0-9]*(?:[?!]|\b)/}),e.languages.ruby.string=[{pattern:/%[qQiIwWxs]?([^a-zA-Z0-9\s\{\(\[<])(?:[^\\]|\\[\s\S])*?\1/,greedy:!0,inside:{interpolation:t}},{pattern:/%[qQiIwWxs]?\((?:[^()\\]|\\[\s\S])*\)/,greedy:!0,inside:{interpolation:t}},{pattern:/%[qQiIwWxs]?\{(?:[^#{}\\]|#(?:\{[^}]+\})?|\\[\s\S])*\}/,greedy:!0,inside:{interpolation:t}},{pattern:/%[qQiIwWxs]?\[(?:[^\[\]\\]|\\[\s\S])*\]/,greedy:!0,inside:{interpolation:t}},{pattern:/%[qQiIwWxs]?<(?:[^<>\\]|\\[\s\S])*>/,greedy:!0,inside:{interpolation:t}},{pattern:/("|')(#\{[^}]+\}|\\(?:\r?\n|\r)|\\?.)*?\1/,greedy:!0,inside:{interpolation:t}}]}(Prism),Prism.languages.css.selector={pattern:/[^\{\}\s][^\{\}]*(?=\s*\{)/,inside:{
"pseudo-element":/:(?:after|before|first-letter|first-line|selection)|::[-\w]+/,"pseudo-class":/:[-\w]+(?:\(.*\))?/,"class":/\.[-:\.\w]+/,id:/#[-:\.\w]+/,attribute:/\[[^\]]+\]/}},Prism.languages.insertBefore("css","function",{hexcode:/#[\da-f]{3,6}/i,entity:/\\[\da-f]{1,8}/i,number:/[\d%\.]+/}),Prism.languages.git={comment:/^#.*/m,deleted:/^[-\u2013].*/m,inserted:/^\+.*/m,string:/("|')(\\?.)*?\1/m,command:{pattern:/^.*\$ git .*$/m,inside:{parameter:/\s(--|-)\w+/m}},coord:/^@@.*@@$/m,commit_sha1:/^commit \w{40}$/m},Prism.languages.http={"request-line":{pattern:/^(POST|GET|PUT|DELETE|OPTIONS|PATCH|TRACE|CONNECT)\b\shttps?:\/\/\S+\sHTTP\/[0-9.]+/m,inside:{property:/^(POST|GET|PUT|DELETE|OPTIONS|PATCH|TRACE|CONNECT)\b/,"attr-name":/:\w+/}},"response-status":{pattern:/^HTTP\/1.[01] [0-9]+.*/m,inside:{property:{pattern:/(^HTTP\/1.[01] )[0-9]+.*/i,lookbehind:!0}}},"header-name":{pattern:/^[\w-]+:(?=.)/m,alias:"keyword"}};var httpLanguages={"application/json":Prism.languages.javascript,"application/xml":Prism.languages.markup,"text/xml":Prism.languages.markup,"text/html":Prism.languages.markup};for(var contentType in httpLanguages)if(httpLanguages[contentType]){var options={};options[contentType]={pattern:new RegExp("(content-type:\\s*"+contentType+"[\\w\\W]*?)(?:\\r?\\n|\\r){2}[\\w\\W]*","i"),lookbehind:!0,inside:{rest:httpLanguages[contentType]}},Prism.languages.insertBefore("http","header-name",options)}!function(e){e.languages.jade={comment:{pattern:/(^([\t ]*))\/\/.*((?:\r?\n|\r)\2[\t ]+.+)*/m,lookbehind:!0},"multiline-script":{pattern:/(^([\t ]*)script\b.*\.[\t ]*)((?:\r?\n|\r(?!\n))(?:\2[\t ]+.+|\s*?(?=\r?\n|\r)))+/m,lookbehind:!0,inside:{rest:e.languages.javascript}},filter:{pattern:/(^([\t ]*)):.+((?:\r?\n|\r(?!\n))(?:\2[\t ]+.+|\s*?(?=\r?\n|\r)))+/m,lookbehind:!0,inside:{"filter-name":{pattern:/^:[\w-]+/,alias:"variable"}}},"multiline-plain-text":{pattern:/(^([\t ]*)[\w\-#.]+\.[\t ]*)((?:\r?\n|\r(?!\n))(?:\2[\t ]+.+|\s*?(?=\r?\n|\r)))+/m,lookbehind:!0},markup:{pattern:/(^[\t ]*)<.+/m,lookbehind:!0,inside:{rest:e.languages.markup}},doctype:{pattern:/((?:^|\n)[\t ]*)doctype(?: .+)?/,lookbehind:!0},"flow-control":{pattern:/(^[\t ]*)(?:if|unless|else|case|when|default|each|while)\b(?: .+)?/m,lookbehind:!0,inside:{each:{pattern:/^each .+? in\b/,inside:{keyword:/\b(?:each|in)\b/,punctuation:/,/}},branch:{pattern:/^(?:if|unless|else|case|when|default|while)\b/,alias:"keyword"},rest:e.languages.javascript}},keyword:{pattern:/(^[\t ]*)(?:block|extends|include|append|prepend)\b.+/m,lookbehind:!0},mixin:[{pattern:/(^[\t ]*)mixin .+/m,lookbehind:!0,inside:{keyword:/^mixin/,"function":/\w+(?=\s*\(|\s*$)/,punctuation:/[(),.]/}},{pattern:/(^[\t ]*)\+.+/m,lookbehind:!0,inside:{name:{pattern:/^\+\w+/,alias:"function"},rest:e.languages.javascript}}],script:{pattern:/(^[\t ]*script(?:(?:&[^(]+)?\([^)]+\))*[\t ]+).+/m,lookbehind:!0,inside:{rest:e.languages.javascript}},"plain-text":{pattern:/(^[\t ]*(?!-)[\w\-#.]*[\w\-](?:(?:&[^(]+)?\([^)]+\))*\/?[\t ]+).+/m,lookbehind:!0},tag:{pattern:/(^[\t ]*)(?!-)[\w\-#.]*[\w\-](?:(?:&[^(]+)?\([^)]+\))*\/?:?/m,lookbehind:!0,inside:{attributes:[{pattern:/&[^(]+\([^)]+\)/,inside:{rest:e.languages.javascript}},{pattern:/\([^)]+\)/,inside:{"attr-value":{pattern:/(=\s*)(?:\{[^}]*\}|[^,)\r\n]+)/,lookbehind:!0,inside:{rest:e.languages.javascript}},"attr-name":/[\w-]+(?=\s*!?=|\s*[,)])/,punctuation:/[!=(),]+/}}],punctuation:/:/}},code:[{pattern:/(^[\t ]*(?:-|!?=)).+/m,lookbehind:!0,inside:{rest:e.languages.javascript}}],punctuation:/[.\-!=|]+/};for(var t="(^([\\t ]*)):{{filter_name}}((?:\\r?\\n|\\r(?!\\n))(?:\\2[\\t ]+.+|\\s*?(?=\\r?\\n|\\r)))+",i=[{filter:"atpl",language:"twig"},{filter:"coffee",language:"coffeescript"},"ejs","handlebars","hogan","less","livescript","markdown","mustache","plates",{filter:"sass",language:"scss"},"stylus","swig"],r={},n=0,o=i.length;n<o;n++){var a=i[n];a="string"==typeof a?{filter:a,language:a}:a,e.languages[a.language]&&(r["filter-"+a.filter]={pattern:RegExp(t.replace("{{filter_name}}",a.filter),"m"),lookbehind:!0,inside:{"filter-name":{pattern:/^:[\w-]+/,alias:"variable"},rest:e.languages[a.language]}})}e.languages.insertBefore("jade","filter",r)}(Prism),Prism.languages.java=Prism.languages.extend("clike",{keyword:/\b(abstract|continue|for|new|switch|assert|default|goto|package|synchronized|boolean|do|if|private|this|break|double|implements|protected|throw|byte|else|import|public|throws|case|enum|instanceof|return|transient|catch|extends|int|short|try|char|final|interface|static|void|class|finally|long|strictfp|volatile|const|float|native|super|while)\b/,number:/\b0b[01]+\b|\b0x[\da-f]*\.?[\da-fp\-]+\b|\b\d*\.?\d+(?:e[+-]?\d+)?[df]?\b/i,operator:{pattern:/(^|[^.])(?:\+[+=]?|-[-=]?|!=?|<<?=?|>>?>?=?|==?|&[&=]?|\|[|=]?|\*=?|\/=?|%=?|\^=?|[?:~])/m,lookbehind:!0}}),Prism.languages.insertBefore("java","function",{annotation:{alias:"punctuation",pattern:/(^|[^.])@\w+/,lookbehind:!0}}),Prism.languages.json={property:/"(?:\\.|[^\\"])*"(?=\s*:)/gi,string:/"(?!:)(?:\\.|[^\\"])*"(?!:)/g,number:/\b-?(0x[\dA-Fa-f]+|\d*\.?\d+([Ee][+-]?\d+)?)\b/g,punctuation:/[{}[\]);,]/g,operator:/:/g,"boolean":/\b(true|false)\b/gi,"null":/\bnull\b/gi},Prism.languages.jsonp=Prism.languages.json,Prism.languages.less=Prism.languages.extend("css",{comment:[/\/\*[\w\W]*?\*\//,{pattern:/(^|[^\\])\/\/.*/,lookbehind:!0}],atrule:{pattern:/@[\w-]+?(?:\([^{}]+\)|[^(){};])*?(?=\s*\{)/i,inside:{punctuation:/[:()]/}},selector:{pattern:/(?:@\{[\w-]+\}|[^{};\s@])(?:@\{[\w-]+\}|\([^{}]*\)|[^{};@])*?(?=\s*\{)/,inside:{variable:/@+[\w-]+/}},property:/(?:@\{[\w-]+\}|[\w-])+(?:\+_?)?(?=\s*:)/i,punctuation:/[{}();:,]/,operator:/[+\-*\/]/}),Prism.languages.insertBefore("less","punctuation",{"function":Prism.languages.less["function"]}),Prism.languages.insertBefore("less","property",{variable:[{pattern:/@[\w-]+\s*:/,inside:{punctuation:/:/}},/@@?[\w-]+/],"mixin-usage":{pattern:/([{;]\s*)[.#](?!\d)[\w-]+.*?(?=[(;])/,lookbehind:!0,alias:"function"}}),Prism.languages.markdown=Prism.languages.extend("markup",{}),Prism.languages.insertBefore("markdown","prolog",{blockquote:{pattern:/^>(?:[\t ]*>)*/m,alias:"punctuation"},code:[{pattern:/^(?: {4}|\t).+/m,alias:"keyword"},{pattern:/``.+?``|`[^`\n]+`/,alias:"keyword"}],title:[{pattern:/\w+.*(?:\r?\n|\r)(?:==+|--+)/,alias:"important",inside:{punctuation:/==+$|--+$/}},{pattern:/(^\s*)#+.+/m,lookbehind:!0,alias:"important",inside:{punctuation:/^#+|#+$/}}],hr:{pattern:/(^\s*)([*-])([\t ]*\2){2,}(?=\s*$)/m,lookbehind:!0,alias:"punctuation"},list:{pattern:/(^\s*)(?:[*+-]|\d+\.)(?=[\t ].)/m,lookbehind:!0,alias:"punctuation"},"url-reference":{pattern:/!?\[[^\]]+\]:[\t ]+(?:\S+|<(?:\\.|[^>\\])+>)(?:[\t ]+(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\)))?/,inside:{variable:{pattern:/^(!?\[)[^\]]+/,lookbehind:!0},string:/(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\))$/,punctuation:/^[\[\]!:]|[<>]/},alias:"url"},bold:{pattern:/(^|[^\\])(\*\*|__)(?:(?:\r?\n|\r)(?!\r?\n|\r)|.)+?\2/,lookbehind:!0,inside:{punctuation:/^\*\*|^__|\*\*$|__$/}},italic:{pattern:/(^|[^\\])([*_])(?:(?:\r?\n|\r)(?!\r?\n|\r)|.)+?\2/,lookbehind:!0,inside:{punctuation:/^[*_]|[*_]$/}},url:{pattern:/!?\[[^\]]+\](?:\([^\s)]+(?:[\t ]+"(?:\\.|[^"\\])*")?\)| ?\[[^\]\n]*\])/,inside:{variable:{pattern:/(!?\[)[^\]]+(?=\]$)/,lookbehind:!0},string:{pattern:/"(?:\\.|[^"\\])*"(?=\)$)/}}}}),Prism.languages.markdown.bold.inside.url=Prism.util.clone(Prism.languages.markdown.url),Prism.languages.markdown.italic.inside.url=Prism.util.clone(Prism.languages.markdown.url),Prism.languages.markdown.bold.inside.italic=Prism.util.clone(Prism.languages.markdown.italic),Prism.languages.markdown.italic.inside.bold=Prism.util.clone(Prism.languages.markdown.bold),Prism.languages.nginx=Prism.languages.extend("clike",{comment:{pattern:/(^|[^"{\\])#.*/,lookbehind:!0},keyword:/\b(?:CONTENT_|DOCUMENT_|GATEWAY_|HTTP_|HTTPS|if_not_empty|PATH_|QUERY_|REDIRECT_|REMOTE_|REQUEST_|SCGI|SCRIPT_|SERVER_|http|server|events|location|include|accept_mutex|accept_mutex_delay|access_log|add_after_body|add_before_body|add_header|addition_types|aio|alias|allow|ancient_browser|ancient_browser_value|auth|auth_basic|auth_basic_user_file|auth_http|auth_http_header|auth_http_timeout|autoindex|autoindex_exact_size|autoindex_localtime|break|charset|charset_map|charset_types|chunked_transfer_encoding|client_body_buffer_size|client_body_in_file_only|client_body_in_single_buffer|client_body_temp_path|client_body_timeout|client_header_buffer_size|client_header_timeout|client_max_body_size|connection_pool_size|create_full_put_path|daemon|dav_access|dav_methods|debug_connection|debug_points|default_type|deny|devpoll_changes|devpoll_events|directio|directio_alignment|disable_symlinks|empty_gif|env|epoll_events|error_log|error_page|expires|fastcgi_buffer_size|fastcgi_buffers|fastcgi_busy_buffers_size|fastcgi_cache|fastcgi_cache_bypass|fastcgi_cache_key|fastcgi_cache_lock|fastcgi_cache_lock_timeout|fastcgi_cache_methods|fastcgi_cache_min_uses|fastcgi_cache_path|fastcgi_cache_purge|fastcgi_cache_use_stale|fastcgi_cache_valid|fastcgi_connect_timeout|fastcgi_hide_header|fastcgi_ignore_client_abort|fastcgi_ignore_headers|fastcgi_index|fastcgi_intercept_errors|fastcgi_keep_conn|fastcgi_max_temp_file_size|fastcgi_next_upstream|fastcgi_no_cache|fastcgi_param|fastcgi_pass|fastcgi_pass_header|fastcgi_read_timeout|fastcgi_redirect_errors|fastcgi_send_timeout|fastcgi_split_path_info|fastcgi_store|fastcgi_store_access|fastcgi_temp_file_write_size|fastcgi_temp_path|flv|geo|geoip_city|geoip_country|google_perftools_profiles|gzip|gzip_buffers|gzip_comp_level|gzip_disable|gzip_http_version|gzip_min_length|gzip_proxied|gzip_static|gzip_types|gzip_vary|if|if_modified_since|ignore_invalid_headers|image_filter|image_filter_buffer|image_filter_jpeg_quality|image_filter_sharpen|image_filter_transparency|imap_capabilities|imap_client_buffer|include|index|internal|ip_hash|keepalive|keepalive_disable|keepalive_requests|keepalive_timeout|kqueue_changes|kqueue_events|large_client_header_buffers|limit_conn|limit_conn_log_level|limit_conn_zone|limit_except|limit_rate|limit_rate_after|limit_req|limit_req_log_level|limit_req_zone|limit_zone|lingering_close|lingering_time|lingering_timeout|listen|location|lock_file|log_format|log_format_combined|log_not_found|log_subrequest|map|map_hash_bucket_size|map_hash_max_size|master_process|max_ranges|memcached_buffer_size|memcached_connect_timeout|memcached_next_upstream|memcached_pass|memcached_read_timeout|memcached_send_timeout|merge_slashes|min_delete_depth|modern_browser|modern_browser_value|mp4|mp4_buffer_size|mp4_max_buffer_size|msie_padding|msie_refresh|multi_accept|open_file_cache|open_file_cache_errors|open_file_cache_min_uses|open_file_cache_valid|open_log_file_cache|optimize_server_names|override_charset|pcre_jit|perl|perl_modules|perl_require|perl_set|pid|pop3_auth|pop3_capabilities|port_in_redirect|post_action|postpone_output|protocol|proxy|proxy_buffer|proxy_buffer_size|proxy_buffering|proxy_buffers|proxy_busy_buffers_size|proxy_cache|proxy_cache_bypass|proxy_cache_key|proxy_cache_lock|proxy_cache_lock_timeout|proxy_cache_methods|proxy_cache_min_uses|proxy_cache_path|proxy_cache_use_stale|proxy_cache_valid|proxy_connect_timeout|proxy_cookie_domain|proxy_cookie_path|proxy_headers_hash_bucket_size|proxy_headers_hash_max_size|proxy_hide_header|proxy_http_version|proxy_ignore_client_abort|proxy_ignore_headers|proxy_intercept_errors|proxy_max_temp_file_size|proxy_method|proxy_next_upstream|proxy_no_cache|proxy_pass|proxy_pass_error_message|proxy_pass_header|proxy_pass_request_body|proxy_pass_request_headers|proxy_read_timeout|proxy_redirect|proxy_redirect_errors|proxy_send_lowat|proxy_send_timeout|proxy_set_body|proxy_set_header|proxy_ssl_session_reuse|proxy_store|proxy_store_access|proxy_temp_file_write_size|proxy_temp_path|proxy_timeout|proxy_upstream_fail_timeout|proxy_upstream_max_fails|random_index|read_ahead|real_ip_header|recursive_error_pages|request_pool_size|reset_timedout_connection|resolver|resolver_timeout|return|rewrite|root|rtsig_overflow_events|rtsig_overflow_test|rtsig_overflow_threshold|rtsig_signo|satisfy|satisfy_any|secure_link_secret|send_lowat|send_timeout|sendfile|sendfile_max_chunk|server|server_name|server_name_in_redirect|server_names_hash_bucket_size|server_names_hash_max_size|server_tokens|set|set_real_ip_from|smtp_auth|smtp_capabilities|so_keepalive|source_charset|split_clients|ssi|ssi_silent_errors|ssi_types|ssi_value_length|ssl|ssl_certificate|ssl_certificate_key|ssl_ciphers|ssl_client_certificate|ssl_crl|ssl_dhparam|ssl_engine|ssl_prefer_server_ciphers|ssl_protocols|ssl_session_cache|ssl_session_timeout|ssl_verify_client|ssl_verify_depth|starttls|stub_status|sub_filter|sub_filter_once|sub_filter_types|tcp_nodelay|tcp_nopush|timeout|timer_resolution|try_files|types|types_hash_bucket_size|types_hash_max_size|underscores_in_headers|uninitialized_variable_warn|upstream|use|user|userid|userid_domain|userid_expires|userid_name|userid_p3p|userid_path|userid_service|valid_referers|variables_hash_bucket_size|variables_hash_max_size|worker_connections|worker_cpu_affinity|worker_priority|worker_processes|worker_rlimit_core|worker_rlimit_nofile|worker_rlimit_sigpending|working_directory|xclient|xml_entities|xslt_entities|xslt_stylesheet|xslt_types)\b/i}),Prism.languages.insertBefore("nginx","keyword",{variable:/\$[a-z_]+/i}),Prism.languages.php=Prism.languages.extend("clike",{keyword:/\b(and|or|xor|array|as|break|case|cfunction|class|const|continue|declare|default|die|do|else|elseif|enddeclare|endfor|endforeach|endif|endswitch|endwhile|extends|for|foreach|function|include|include_once|global|if|new|return|static|switch|use|require|require_once|var|while|abstract|interface|public|implements|private|protected|parent|throw|null|echo|print|trait|namespace|final|yield|goto|instanceof|finally|try|catch)\b/i,constant:/\b[A-Z0-9_]{2,}\b/,comment:{pattern:/(^|[^\\])(?:\/\*[\w\W]*?\*\/|\/\/.*)/,lookbehind:!0,greedy:!0}}),Prism.languages.insertBefore("php","class-name",{"shell-comment":{pattern:/(^|[^\\])#.*/,lookbehind:!0,alias:"comment"}}),Prism.languages.insertBefore("php","keyword",{delimiter:/\?>|<\?(?:php)?/i,variable:/\$\w+\b/i,"package":{pattern:/(\\|namespace\s+|use\s+)[\w\\]+/,lookbehind:!0,inside:{punctuation:/\\/}}}),Prism.languages.insertBefore("php","operator",{property:{pattern:/(->)[\w]+/,lookbehind:!0}}),Prism.languages.markup&&(Prism.hooks.add("before-highlight",function(t){"php"===t.language&&(t.tokenStack=[],t.backupCode=t.code,t.code=t.code.replace(/(?:<\?php|<\?)[\w\W]*?(?:\?>)/gi,function(e){return t.tokenStack.push(e),"{{{PHP"+t.tokenStack.length+"}}}"}))}),Prism.hooks.add("before-insert",function(e){"php"===e.language&&(e.code=e.backupCode,delete e.backupCode)}),Prism.hooks.add("after-highlight",function(e){if("php"===e.language){for(var t,i=0;t=e.tokenStack[i];i++)e.highlightedCode=e.highlightedCode.replace("{{{PHP"+(i+1)+"}}}",Prism.highlight(t,e.grammar,"php").replace(/\$/g,"$$$$"));e.element.innerHTML=e.highlightedCode}}),Prism.hooks.add("wrap",function(e){"php"===e.language&&"markup"===e.type&&(e.content=e.content.replace(/(\{\{\{PHP[0-9]+\}\}\})/g,'<span class="token php">$1</span>'))}),Prism.languages.insertBefore("php","comment",{markup:{pattern:/<[^?]\/?(.*?)>/,inside:Prism.languages.markup},php:/\{\{\{PHP[0-9]+\}\}\}/})),Prism.languages.insertBefore("php","variable",{"this":/\$this\b/,global:/\$(?:_(?:SERVER|GET|POST|FILES|REQUEST|SESSION|ENV|COOKIE)|GLOBALS|HTTP_RAW_POST_DATA|argc|argv|php_errormsg|http_response_header)/,scope:{pattern:/\b[\w\\]+::/,inside:{keyword:/(static|self|parent)/,punctuation:/(::|\\)/}}}),Prism.languages.python={"triple-quoted-string":{pattern:/"""[\s\S]+?"""|'''[\s\S]+?'''/,alias:"string"},comment:{pattern:/(^|[^\\])#.*/,lookbehind:!0},string:{pattern:/("|')(?:\\\\|\\?[^\\\r\n])*?\1/,greedy:!0},"function":{pattern:/((?:^|\s)def[ \t]+)[a-zA-Z_][a-zA-Z0-9_]*(?=\()/g,lookbehind:!0},"class-name":{pattern:/(\bclass\s+)[a-z0-9_]+/i,lookbehind:!0},keyword:/\b(?:as|assert|async|await|break|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|pass|print|raise|return|try|while|with|yield)\b/,"boolean":/\b(?:True|False)\b/,number:/\b-?(?:0[bo])?(?:(?:\d|0x[\da-f])[\da-f]*\.?\d*|\.\d+)(?:e[+-]?\d+)?j?\b/i,operator:/[-+%=]=?|!=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]|\b(?:or|and|not)\b/,punctuation:/[{}[\];(),.:]/},Prism.languages.r={comment:/#.*/,string:/(['"])(?:\\?.)*?\1/,"percent-operator":{pattern:/%[^%\s]*%/,alias:"operator"},"boolean":/\b(?:TRUE|FALSE)\b/,ellipsis:/\.\.(?:\.|\d+)/,number:[/\b(?:NaN|Inf)\b/,/\b(?:0x[\dA-Fa-f]+(?:\.\d*)?|\d*\.?\d+)(?:[EePp][+-]?\d+)?[iL]?\b/],keyword:/\b(?:if|else|repeat|while|function|for|in|next|break|NULL|NA|NA_integer_|NA_real_|NA_complex_|NA_character_)\b/,operator:/->?>?|<(?:=|<?-)?|[>=!]=?|::?|&&?|\|\|?|[+*\/^$@~]/,punctuation:/[(){}\[\],;]/},function(e){var t=e.util.clone(e.languages.javascript);e.languages.jsx=e.languages.extend("markup",t),e.languages.jsx.tag.pattern=/<\/?[\w\.:-]+\s*(?:\s+[\w\.:-]+(?:=(?:("|')(\\?[\w\W])*?\1|[^\s'">=]+|(\{[\w\W]*?\})))?\s*)*\/?>/i,e.languages.jsx.tag.inside["attr-value"].pattern=/=[^\{](?:('|")[\w\W]*?(\1)|[^\s>]+)/i;var i=e.util.clone(e.languages.jsx);delete i.punctuation,i=e.languages.insertBefore("jsx","operator",{punctuation:/=(?={)|[{}[\];(),.:]/},{jsx:i}),e.languages.insertBefore("inside","attr-value",{script:{pattern:/=(\{(?:\{[^}]*\}|[^}])+\})/i,inside:i,alias:"language-javascript"}},e.languages.jsx.tag)}(Prism),function(e){e.languages.sass=e.languages.extend("css",{comment:{pattern:/^([ \t]*)\/[\/*].*(?:(?:\r?\n|\r)\1[ \t]+.+)*/m,lookbehind:!0}}),e.languages.insertBefore("sass","atrule",{"atrule-line":{pattern:/^(?:[ \t]*)[@+=].+/m,inside:{atrule:/(?:@[\w-]+|[+=])/m}}}),delete e.languages.sass.atrule;var t=/((\$[-_\w]+)|(#\{\$[-_\w]+\}))/i,i=[/[+*\/%]|[=!]=|<=?|>=?|\b(?:and|or|not)\b/,{pattern:/(\s+)-(?=\s)/,lookbehind:!0}];e.languages.insertBefore("sass","property",{"variable-line":{pattern:/^[ \t]*\$.+/m,inside:{punctuation:/:/,variable:t,operator:i}},"property-line":{pattern:/^[ \t]*(?:[^:\s]+ *:.*|:[^:\s]+.*)/m,inside:{property:[/[^:\s]+(?=\s*:)/,{pattern:/(:)[^:\s]+/,lookbehind:!0}],punctuation:/:/,variable:t,operator:i,important:e.languages.sass.important}}}),delete e.languages.sass.property,delete e.languages.sass.important,delete e.languages.sass.selector,e.languages.insertBefore("sass","punctuation",{selector:{pattern:/([ \t]*)\S(?:,?[^,\r\n]+)*(?:,(?:\r?\n|\r)\1[ \t]+\S(?:,?[^,\r\n]+)*)*/,lookbehind:!0}})}(Prism),Prism.languages.scss=Prism.languages.extend("css",{comment:{pattern:/(^|[^\\])(?:\/\*[\w\W]*?\*\/|\/\/.*)/,lookbehind:!0},atrule:{pattern:/@[\w-]+(?:\([^()]+\)|[^(])*?(?=\s+[{;])/,inside:{rule:/@[\w-]+/}},url:/(?:[-a-z]+-)*url(?=\()/i,selector:{pattern:/(?=\S)[^@;\{\}\(\)]?([^@;\{\}\(\)]|&|#\{\$[-_\w]+\})+(?=\s*\{(\}|\s|[^\}]+(:|\{)[^\}]+))/m,inside:{parent:{pattern:/&/,alias:"important"},placeholder:/%[-_\w]+/,variable:/\$[-_\w]+|#\{\$[-_\w]+\}/}}}),Prism.languages.insertBefore("scss","atrule",{keyword:[/@(?:if|else(?: if)?|for|each|while|import|extend|debug|warn|mixin|include|function|return|content)/i,{pattern:/( +)(?:from|through)(?= )/,lookbehind:!0}]}),Prism.languages.scss.property={pattern:/(?:[\w-]|\$[-_\w]+|#\{\$[-_\w]+\})+(?=\s*:)/i,inside:{variable:/\$[-_\w]+|#\{\$[-_\w]+\}/}},Prism.languages.insertBefore("scss","important",{variable:/\$[-_\w]+|#\{\$[-_\w]+\}/}),Prism.languages.insertBefore("scss","function",{placeholder:{pattern:/%[-_\w]+/,alias:"selector"},statement:{pattern:/\B!(?:default|optional)\b/i,alias:"keyword"},"boolean":/\b(?:true|false)\b/,"null":/\bnull\b/,operator:{pattern:/(\s)(?:[-+*\/%]|[=!]=|<=?|>=?|and|or|not)(?=\s)/,lookbehind:!0}}),Prism.languages.scss.atrule.inside.rest=Prism.util.clone(Prism.languages.scss),Prism.languages.sql={comment:{pattern:/(^|[^\\])(?:\/\*[\w\W]*?\*\/|(?:--|\/\/|#).*)/,lookbehind:!0},string:{pattern:/(^|[^@\\])("|')(?:\\?[\s\S])*?\2/,lookbehind:!0},variable:/@[\w.$]+|@("|'|`)(?:\\?[\s\S])+?\1/,"function":/\b(?:COUNT|SUM|AVG|MIN|MAX|FIRST|LAST|UCASE|LCASE|MID|LEN|ROUND|NOW|FORMAT)(?=\s*\()/i,keyword:/\b(?:ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR VARYING|CHARACTER (?:SET|VARYING)|CHARSET|CHECK|CHECKPOINT|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMN|COLUMNS|COMMENT|COMMIT|COMMITTED|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS|CONTAINSTABLE|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|DATA(?:BASES?)?|DATE(?:TIME)?|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITER(?:S)?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE(?: PRECISION)?|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE KEY|ELSE|ENABLE|ENCLOSED BY|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPE(?:D BY)?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|IDENTITY(?:_INSERT|COL)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTO|INVOKER|ISOLATION LEVEL|JOIN|KEYS?|KILL|LANGUAGE SQL|LAST|LEFT|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MODIFIES SQL DATA|MODIFY|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL(?: CHAR VARYING| CHARACTER(?: VARYING)?| VARCHAR)?|NATURAL|NCHAR(?: VARCHAR)?|NEXT|NO(?: SQL|CHECK|CYCLE)?|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READ(?:S SQL DATA|TEXT)?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEATABLE|REPLICATION|REQUIRE|RESTORE|RESTRICT|RETURNS?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE MODE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|START(?:ING BY)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED BY|TEXT(?:SIZE)?|THEN|TIMESTAMP|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNPIVOT|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?)\b/i,"boolean":/\b(?:TRUE|FALSE|NULL)\b/i,number:/\b-?(?:0x)?\d*\.?[\da-f]+\b/,operator:/[-+*\/=%^~]|&&?|\|?\||!=?|<(?:=>?|<|>)?|>[>=]?|\b(?:AND|BETWEEN|IN|LIKE|NOT|OR|IS|DIV|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/i,punctuation:/[;[\]()`,.]/},Prism.languages.swift=Prism.languages.extend("clike",{string:{pattern:/("|')(\\(?:\((?:[^()]|\([^)]+\))+\)|\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0,inside:{interpolation:{pattern:/\\\((?:[^()]|\([^)]+\))+\)/,inside:{delimiter:{pattern:/^\\\(|\)$/,alias:"variable"}}}}},keyword:/\b(as|associativity|break|case|catch|class|continue|convenience|default|defer|deinit|didSet|do|dynamic(?:Type)?|else|enum|extension|fallthrough|final|for|func|get|guard|if|import|in|infix|init|inout|internal|is|lazy|left|let|mutating|new|none|nonmutating|operator|optional|override|postfix|precedence|prefix|private|Protocol|public|repeat|required|rethrows|return|right|safe|self|Self|set|static|struct|subscript|super|switch|throws?|try|Type|typealias|unowned|unsafe|var|weak|where|while|willSet|__(?:COLUMN__|FILE__|FUNCTION__|LINE__))\b/,number:/\b([\d_]+(\.[\de_]+)?|0x[a-f0-9_]+(\.[a-f0-9p_]+)?|0b[01_]+|0o[0-7_]+)\b/i,constant:/\b(nil|[A-Z_]{2,}|k[A-Z][A-Za-z_]+)\b/,atrule:/@\b(IB(?:Outlet|Designable|Action|Inspectable)|class_protocol|exported|noreturn|NS(?:Copying|Managed)|objc|UIApplicationMain|auto_closure)\b/,builtin:/\b([A-Z]\S+|abs|advance|alignof(?:Value)?|assert|contains|count(?:Elements)?|debugPrint(?:ln)?|distance|drop(?:First|Last)|dump|enumerate|equal|filter|find|first|getVaList|indices|isEmpty|join|last|lexicographicalCompare|map|max(?:Element)?|min(?:Element)?|numericCast|overlaps|partition|print(?:ln)?|reduce|reflect|reverse|sizeof(?:Value)?|sort(?:ed)?|split|startsWith|stride(?:of(?:Value)?)?|suffix|swap|toDebugString|toString|transcode|underestimateCount|unsafeBitCast|with(?:ExtendedLifetime|Unsafe(?:MutablePointers?|Pointers?)|VaList))\b/}),Prism.languages.swift.string.inside.interpolation.inside.rest=Prism.util.clone(Prism.languages.swift),Prism.languages.typescript=Prism.languages.extend("javascript",{keyword:/\b(as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield|false|true|module|declare|constructor|string|Function|any|number|boolean|Array|enum|symbol|namespace|abstract|require|type)\b/}),Prism.languages.ts=Prism.languages.typescript,Prism.languages.vim={string:/"(?:[^"\\\r\n]|\\.)*"|'(?:[^'\r\n]|'')*'/,comment:/".*/,"function":/\w+(?=\()/,keyword:/\b(?:ab|abbreviate|abc|abclear|abo|aboveleft|al|all|arga|argadd|argd|argdelete|argdo|arge|argedit|argg|argglobal|argl|arglocal|ar|args|argu|argument|as|ascii|bad|badd|ba|ball|bd|bdelete|be|bel|belowright|bf|bfirst|bl|blast|bm|bmodified|bn|bnext|bN|bNext|bo|botright|bp|bprevious|brea|break|breaka|breakadd|breakd|breakdel|breakl|breaklist|br|brewind|bro|browse|bufdo|b|buffer|buffers|bun|bunload|bw|bwipeout|ca|cabbrev|cabc|cabclear|caddb|caddbuffer|cad|caddexpr|caddf|caddfile|cal|call|cat|catch|cb|cbuffer|cc|ccl|cclose|cd|ce|center|cex|cexpr|cf|cfile|cfir|cfirst|cgetb|cgetbuffer|cgete|cgetexpr|cg|cgetfile|c|change|changes|chd|chdir|che|checkpath|checkt|checktime|cla|clast|cl|clist|clo|close|cmapc|cmapclear|cnew|cnewer|cn|cnext|cN|cNext|cnf|cnfile|cNfcNfile|cnorea|cnoreabbrev|col|colder|colo|colorscheme|comc|comclear|comp|compiler|conf|confirm|con|continue|cope|copen|co|copy|cpf|cpfile|cp|cprevious|cq|cquit|cr|crewind|cuna|cunabbrev|cu|cunmap|cw|cwindow|debugg|debuggreedy|delc|delcommand|d|delete|delf|delfunction|delm|delmarks|diffg|diffget|diffoff|diffpatch|diffpu|diffput|diffsplit|diffthis|diffu|diffupdate|dig|digraphs|di|display|dj|djump|dl|dlist|dr|drop|ds|dsearch|dsp|dsplit|earlier|echoe|echoerr|echom|echomsg|echon|e|edit|el|else|elsei|elseif|em|emenu|endfo|endfor|endf|endfunction|endfun|en|endif|endt|endtry|endw|endwhile|ene|enew|ex|exi|exit|exu|exusage|f|file|files|filetype|fina|finally|fin|find|fini|finish|fir|first|fix|fixdel|fo|fold|foldc|foldclose|folddoc|folddoclosed|foldd|folddoopen|foldo|foldopen|for|fu|fun|function|go|goto|gr|grep|grepa|grepadd|ha|hardcopy|h|help|helpf|helpfind|helpg|helpgrep|helpt|helptags|hid|hide|his|history|ia|iabbrev|iabc|iabclear|if|ij|ijump|il|ilist|imapc|imapclear|in|inorea|inoreabbrev|isearch|isp|isplit|iuna|iunabbrev|iu|iunmap|j|join|ju|jumps|k|keepalt|keepj|keepjumps|kee|keepmarks|laddb|laddbuffer|lad|laddexpr|laddf|laddfile|lan|language|la|last|later|lb|lbuffer|lc|lcd|lch|lchdir|lcl|lclose|let|left|lefta|leftabove|lex|lexpr|lf|lfile|lfir|lfirst|lgetb|lgetbuffer|lgete|lgetexpr|lg|lgetfile|lgr|lgrep|lgrepa|lgrepadd|lh|lhelpgrep|l|list|ll|lla|llast|lli|llist|lmak|lmake|lm|lmap|lmapc|lmapclear|lnew|lnewer|lne|lnext|lN|lNext|lnf|lnfile|lNf|lNfile|ln|lnoremap|lo|loadview|loc|lockmarks|lockv|lockvar|lol|lolder|lop|lopen|lpf|lpfile|lp|lprevious|lr|lrewind|ls|lt|ltag|lu|lunmap|lv|lvimgrep|lvimgrepa|lvimgrepadd|lw|lwindow|mak|make|ma|mark|marks|mat|match|menut|menutranslate|mk|mkexrc|mks|mksession|mksp|mkspell|mkvie|mkview|mkv|mkvimrc|mod|mode|m|move|mzf|mzfile|mz|mzscheme|nbkey|new|n|next|N|Next|nmapc|nmapclear|noh|nohlsearch|norea|noreabbrev|nu|number|nun|nunmap|omapc|omapclear|on|only|o|open|opt|options|ou|ounmap|pc|pclose|ped|pedit|pe|perl|perld|perldo|po|pop|popu|popu|popup|pp|ppop|pre|preserve|prev|previous|p|print|P|Print|profd|profdel|prof|profile|promptf|promptfind|promptr|promptrepl|ps|psearch|pta|ptag|ptf|ptfirst|ptj|ptjump|ptl|ptlast|ptn|ptnext|ptN|ptNext|ptp|ptprevious|ptr|ptrewind|pts|ptselect|pu|put|pw|pwd|pyf|pyfile|py|python|qa|qall|q|quit|quita|quitall|r|read|rec|recover|redi|redir|red|redo|redr|redraw|redraws|redrawstatus|reg|registers|res|resize|ret|retab|retu|return|rew|rewind|ri|right|rightb|rightbelow|rub|ruby|rubyd|rubydo|rubyf|rubyfile|ru|runtime|rv|rviminfo|sal|sall|san|sandbox|sa|sargument|sav|saveas|sba|sball|sbf|sbfirst|sbl|sblast|sbm|sbmodified|sbn|sbnext|sbN|sbNext|sbp|sbprevious|sbr|sbrewind|sb|sbuffer|scripte|scriptencoding|scrip|scriptnames|se|set|setf|setfiletype|setg|setglobal|setl|setlocal|sf|sfind|sfir|sfirst|sh|shell|sign|sil|silent|sim|simalt|sla|slast|sl|sleep|sm|smagic|sm|smap|smapc|smapclear|sme|smenu|sn|snext|sN|sNext|sni|sniff|sno|snomagic|snor|snoremap|snoreme|snoremenu|sor|sort|so|source|spelld|spelldump|spe|spellgood|spelli|spellinfo|spellr|spellrepall|spellu|spellundo|spellw|spellwrong|sp|split|spr|sprevious|sre|srewind|sta|stag|startg|startgreplace|star|startinsert|startr|startreplace|stj|stjump|st|stop|stopi|stopinsert|sts|stselect|sun|sunhide|sunm|sunmap|sus|suspend|sv|sview|syncbind|t|tab|tabc|tabclose|tabd|tabdo|tabe|tabedit|tabf|tabfind|tabfir|tabfirst|tabl|tablast|tabm|tabmove|tabnew|tabn|tabnext|tabN|tabNext|tabo|tabonly|tabp|tabprevious|tabr|tabrewind|tabs|ta|tag|tags|tc|tcl|tcld|tcldo|tclf|tclfile|te|tearoff|tf|tfirst|th|throw|tj|tjump|tl|tlast|tm|tm|tmenu|tn|tnext|tN|tNext|to|topleft|tp|tprevious|tr|trewind|try|ts|tselect|tu|tu|tunmenu|una|unabbreviate|u|undo|undoj|undojoin|undol|undolist|unh|unhide|unlet|unlo|unlockvar|unm|unmap|up|update|verb|verbose|ve|version|vert|vertical|vie|view|vim|vimgrep|vimgrepa|vimgrepadd|vi|visual|viu|viusage|vmapc|vmapclear|vne|vnew|vs|vsplit|vu|vunmap|wa|wall|wh|while|winc|wincmd|windo|winp|winpos|win|winsize|wn|wnext|wN|wNext|wp|wprevious|wq|wqa|wqall|w|write|ws|wsverb|wv|wviminfo|X|xa|xall|x|xit|xm|xmap|xmapc|xmapclear|xme|xmenu|XMLent|XMLns|xn|xnoremap|xnoreme|xnoremenu|xu|xunmap|y|yank)\b/,
builtin:/\b(?:autocmd|acd|ai|akm|aleph|allowrevins|altkeymap|ambiwidth|ambw|anti|antialias|arab|arabic|arabicshape|ari|arshape|autochdir|autoindent|autoread|autowrite|autowriteall|aw|awa|background|backspace|backup|backupcopy|backupdir|backupext|backupskip|balloondelay|ballooneval|balloonexpr|bdir|bdlay|beval|bex|bexpr|bg|bh|bin|binary|biosk|bioskey|bk|bkc|bomb|breakat|brk|browsedir|bs|bsdir|bsk|bt|bufhidden|buflisted|buftype|casemap|ccv|cdpath|cedit|cfu|ch|charconvert|ci|cin|cindent|cink|cinkeys|cino|cinoptions|cinw|cinwords|clipboard|cmdheight|cmdwinheight|cmp|cms|columns|com|comments|commentstring|compatible|complete|completefunc|completeopt|consk|conskey|copyindent|cot|cpo|cpoptions|cpt|cscopepathcomp|cscopeprg|cscopequickfix|cscopetag|cscopetagorder|cscopeverbose|cspc|csprg|csqf|cst|csto|csverb|cuc|cul|cursorcolumn|cursorline|cwh|debug|deco|def|define|delcombine|dex|dg|dict|dictionary|diff|diffexpr|diffopt|digraph|dip|dir|directory|dy|ea|ead|eadirection|eb|ed|edcompatible|ef|efm|ei|ek|enc|encoding|endofline|eol|ep|equalalways|equalprg|errorbells|errorfile|errorformat|esckeys|et|eventignore|expandtab|exrc|fcl|fcs|fdc|fde|fdi|fdl|fdls|fdm|fdn|fdo|fdt|fen|fenc|fencs|fex|ff|ffs|fileencoding|fileencodings|fileformat|fileformats|fillchars|fk|fkmap|flp|fml|fmr|foldcolumn|foldenable|foldexpr|foldignore|foldlevel|foldlevelstart|foldmarker|foldmethod|foldminlines|foldnestmax|foldtext|formatexpr|formatlistpat|formatoptions|formatprg|fp|fs|fsync|ft|gcr|gd|gdefault|gfm|gfn|gfs|gfw|ghr|gp|grepformat|grepprg|gtl|gtt|guicursor|guifont|guifontset|guifontwide|guiheadroom|guioptions|guipty|guitablabel|guitabtooltip|helpfile|helpheight|helplang|hf|hh|hi|hidden|highlight|hk|hkmap|hkmapp|hkp|hl|hlg|hls|hlsearch|ic|icon|iconstring|ignorecase|im|imactivatekey|imak|imc|imcmdline|imd|imdisable|imi|iminsert|ims|imsearch|inc|include|includeexpr|incsearch|inde|indentexpr|indentkeys|indk|inex|inf|infercase|insertmode|isf|isfname|isi|isident|isk|iskeyword|isprint|joinspaces|js|key|keymap|keymodel|keywordprg|km|kmp|kp|langmap|langmenu|laststatus|lazyredraw|lbr|lcs|linebreak|lines|linespace|lisp|lispwords|listchars|loadplugins|lpl|lsp|lz|macatsui|magic|makeef|makeprg|matchpairs|matchtime|maxcombine|maxfuncdepth|maxmapdepth|maxmem|maxmempattern|maxmemtot|mco|mef|menuitems|mfd|mh|mis|mkspellmem|ml|mls|mm|mmd|mmp|mmt|modeline|modelines|modifiable|modified|more|mouse|mousef|mousefocus|mousehide|mousem|mousemodel|mouses|mouseshape|mouset|mousetime|mp|mps|msm|mzq|mzquantum|nf|nrformats|numberwidth|nuw|odev|oft|ofu|omnifunc|opendevice|operatorfunc|opfunc|osfiletype|pa|para|paragraphs|paste|pastetoggle|patchexpr|patchmode|path|pdev|penc|pex|pexpr|pfn|ph|pheader|pi|pm|pmbcs|pmbfn|popt|preserveindent|previewheight|previewwindow|printdevice|printencoding|printexpr|printfont|printheader|printmbcharset|printmbfont|printoptions|prompt|pt|pumheight|pvh|pvw|qe|quoteescape|readonly|remap|report|restorescreen|revins|rightleft|rightleftcmd|rl|rlc|ro|rs|rtp|ruf|ruler|rulerformat|runtimepath|sbo|sc|scb|scr|scroll|scrollbind|scrolljump|scrolloff|scrollopt|scs|sect|sections|secure|sel|selection|selectmode|sessionoptions|sft|shcf|shellcmdflag|shellpipe|shellquote|shellredir|shellslash|shelltemp|shelltype|shellxquote|shiftround|shiftwidth|shm|shortmess|shortname|showbreak|showcmd|showfulltag|showmatch|showmode|showtabline|shq|si|sidescroll|sidescrolloff|siso|sj|slm|smartcase|smartindent|smarttab|smc|smd|softtabstop|sol|spc|spell|spellcapcheck|spellfile|spelllang|spellsuggest|spf|spl|splitbelow|splitright|sps|sr|srr|ss|ssl|ssop|stal|startofline|statusline|stl|stmp|su|sua|suffixes|suffixesadd|sw|swapfile|swapsync|swb|swf|switchbuf|sws|sxq|syn|synmaxcol|syntax|tabline|tabpagemax|tabstop|tagbsearch|taglength|tagrelative|tagstack|tal|tb|tbi|tbidi|tbis|tbs|tenc|term|termbidi|termencoding|terse|textauto|textmode|textwidth|tgst|thesaurus|tildeop|timeout|timeoutlen|title|titlelen|titleold|titlestring|toolbar|toolbariconsize|top|tpm|tsl|tsr|ttimeout|ttimeoutlen|ttm|tty|ttybuiltin|ttyfast|ttym|ttymouse|ttyscroll|ttytype|tw|tx|uc|ul|undolevels|updatecount|updatetime|ut|vb|vbs|vdir|verbosefile|vfile|viewdir|viewoptions|viminfo|virtualedit|visualbell|vop|wak|warn|wb|wc|wcm|wd|weirdinvert|wfh|wfw|whichwrap|wi|wig|wildchar|wildcharm|wildignore|wildmenu|wildmode|wildoptions|wim|winaltkeys|window|winfixheight|winfixwidth|winheight|winminheight|winminwidth|winwidth|wiv|wiw|wm|wmh|wmnu|wmw|wop|wrap|wrapmargin|wrapscan|writeany|writebackup|writedelay|ww|noacd|noai|noakm|noallowrevins|noaltkeymap|noanti|noantialias|noar|noarab|noarabic|noarabicshape|noari|noarshape|noautochdir|noautoindent|noautoread|noautowrite|noautowriteall|noaw|noawa|nobackup|noballooneval|nobeval|nobin|nobinary|nobiosk|nobioskey|nobk|nobl|nobomb|nobuflisted|nocf|noci|nocin|nocindent|nocompatible|noconfirm|noconsk|noconskey|nocopyindent|nocp|nocscopetag|nocscopeverbose|nocst|nocsverb|nocuc|nocul|nocursorcolumn|nocursorline|nodeco|nodelcombine|nodg|nodiff|nodigraph|nodisable|noea|noeb|noed|noedcompatible|noek|noendofline|noeol|noequalalways|noerrorbells|noesckeys|noet|noex|noexpandtab|noexrc|nofen|nofk|nofkmap|nofoldenable|nogd|nogdefault|noguipty|nohid|nohidden|nohk|nohkmap|nohkmapp|nohkp|nohls|noic|noicon|noignorecase|noim|noimc|noimcmdline|noimd|noincsearch|noinf|noinfercase|noinsertmode|nois|nojoinspaces|nojs|nolazyredraw|nolbr|nolinebreak|nolisp|nolist|noloadplugins|nolpl|nolz|noma|nomacatsui|nomagic|nomh|noml|nomod|nomodeline|nomodifiable|nomodified|nomore|nomousef|nomousefocus|nomousehide|nonu|nonumber|noodev|noopendevice|nopaste|nopi|nopreserveindent|nopreviewwindow|noprompt|nopvw|noreadonly|noremap|norestorescreen|norevins|nori|norightleft|norightleftcmd|norl|norlc|noro|nors|noru|noruler|nosb|nosc|noscb|noscrollbind|noscs|nosecure|nosft|noshellslash|noshelltemp|noshiftround|noshortname|noshowcmd|noshowfulltag|noshowmatch|noshowmode|nosi|nosm|nosmartcase|nosmartindent|nosmarttab|nosmd|nosn|nosol|nospell|nosplitbelow|nosplitright|nospr|nosr|nossl|nosta|nostartofline|nostmp|noswapfile|noswf|nota|notagbsearch|notagrelative|notagstack|notbi|notbidi|notbs|notermbidi|noterse|notextauto|notextmode|notf|notgst|notildeop|notimeout|notitle|noto|notop|notr|nottimeout|nottybuiltin|nottyfast|notx|novb|novisualbell|nowa|nowarn|nowb|noweirdinvert|nowfh|nowfw|nowildmenu|nowinfixheight|nowinfixwidth|nowiv|nowmnu|nowrap|nowrapscan|nowrite|nowriteany|nowritebackup|nows|invacd|invai|invakm|invallowrevins|invaltkeymap|invanti|invantialias|invar|invarab|invarabic|invarabicshape|invari|invarshape|invautochdir|invautoindent|invautoread|invautowrite|invautowriteall|invaw|invawa|invbackup|invballooneval|invbeval|invbin|invbinary|invbiosk|invbioskey|invbk|invbl|invbomb|invbuflisted|invcf|invci|invcin|invcindent|invcompatible|invconfirm|invconsk|invconskey|invcopyindent|invcp|invcscopetag|invcscopeverbose|invcst|invcsverb|invcuc|invcul|invcursorcolumn|invcursorline|invdeco|invdelcombine|invdg|invdiff|invdigraph|invdisable|invea|inveb|inved|invedcompatible|invek|invendofline|inveol|invequalalways|inverrorbells|invesckeys|invet|invex|invexpandtab|invexrc|invfen|invfk|invfkmap|invfoldenable|invgd|invgdefault|invguipty|invhid|invhidden|invhk|invhkmap|invhkmapp|invhkp|invhls|invhlsearch|invic|invicon|invignorecase|invim|invimc|invimcmdline|invimd|invincsearch|invinf|invinfercase|invinsertmode|invis|invjoinspaces|invjs|invlazyredraw|invlbr|invlinebreak|invlisp|invlist|invloadplugins|invlpl|invlz|invma|invmacatsui|invmagic|invmh|invml|invmod|invmodeline|invmodifiable|invmodified|invmore|invmousef|invmousefocus|invmousehide|invnu|invnumber|invodev|invopendevice|invpaste|invpi|invpreserveindent|invpreviewwindow|invprompt|invpvw|invreadonly|invremap|invrestorescreen|invrevins|invri|invrightleft|invrightleftcmd|invrl|invrlc|invro|invrs|invru|invruler|invsb|invsc|invscb|invscrollbind|invscs|invsecure|invsft|invshellslash|invshelltemp|invshiftround|invshortname|invshowcmd|invshowfulltag|invshowmatch|invshowmode|invsi|invsm|invsmartcase|invsmartindent|invsmarttab|invsmd|invsn|invsol|invspell|invsplitbelow|invsplitright|invspr|invsr|invssl|invsta|invstartofline|invstmp|invswapfile|invswf|invta|invtagbsearch|invtagrelative|invtagstack|invtbi|invtbidi|invtbs|invtermbidi|invterse|invtextauto|invtextmode|invtf|invtgst|invtildeop|invtimeout|invtitle|invto|invtop|invtr|invttimeout|invttybuiltin|invttyfast|invtx|invvb|invvisualbell|invwa|invwarn|invwb|invweirdinvert|invwfh|invwfw|invwildmenu|invwinfixheight|invwinfixwidth|invwiv|invwmnu|invwrap|invwrapscan|invwrite|invwriteany|invwritebackup|invws|t_AB|t_AF|t_al|t_AL|t_bc|t_cd|t_ce|t_Ce|t_cl|t_cm|t_Co|t_cs|t_Cs|t_CS|t_CV|t_da|t_db|t_dl|t_DL|t_EI|t_F1|t_F2|t_F3|t_F4|t_F5|t_F6|t_F7|t_F8|t_F9|t_fs|t_IE|t_IS|t_k1|t_K1|t_k2|t_k3|t_K3|t_k4|t_K4|t_k5|t_K5|t_k6|t_K6|t_k7|t_K7|t_k8|t_K8|t_k9|t_K9|t_KA|t_kb|t_kB|t_KB|t_KC|t_kd|t_kD|t_KD|t_ke|t_KE|t_KF|t_KG|t_kh|t_KH|t_kI|t_KI|t_KJ|t_KK|t_kl|t_KL|t_kN|t_kP|t_kr|t_ks|t_ku|t_le|t_mb|t_md|t_me|t_mr|t_ms|t_nd|t_op|t_RI|t_RV|t_Sb|t_se|t_Sf|t_SI|t_so|t_sr|t_te|t_ti|t_ts|t_ue|t_us|t_ut|t_vb|t_ve|t_vi|t_vs|t_WP|t_WS|t_xs|t_ZH|t_ZR)\b/,number:/\b(?:0x[\da-f]+|\d+(?:\.\d+)?)\b/i,operator:/\|\||&&|[-+.]=?|[=!](?:[=~][#?]?)?|[<>]=?[#?]?|[*\/%?]|\b(?:is(?:not)?)\b/,punctuation:/[{}[\](),;:]/},Prism.languages.yaml={scalar:{pattern:/([\-:]\s*(![^\s]+)?[ \t]*[|>])[ \t]*(?:((?:\r?\n|\r)[ \t]+)[^\r\n]+(?:\3[^\r\n]+)*)/,lookbehind:!0,alias:"string"},comment:/#.*/,key:{pattern:/(\s*(?:^|[:\-,[{\r\n?])[ \t]*(![^\s]+)?[ \t]*)[^\r\n{[\]},#\s]+?(?=\s*:\s)/,lookbehind:!0,alias:"atrule"},directive:{pattern:/(^[ \t]*)%.+/m,lookbehind:!0,alias:"important"},datetime:{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)(\d{4}-\d\d?-\d\d?([tT]|[ \t]+)\d\d?:\d{2}:\d{2}(\.\d*)?[ \t]*(Z|[-+]\d\d?(:\d{2})?)?|\d{4}-\d{2}-\d{2}|\d\d?:\d{2}(:\d{2}(\.\d*)?)?)(?=[ \t]*($|,|]|}))/m,lookbehind:!0,alias:"number"},"boolean":{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)(true|false)[ \t]*(?=$|,|]|})/im,lookbehind:!0,alias:"important"},"null":{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)(null|~)[ \t]*(?=$|,|]|})/im,lookbehind:!0,alias:"important"},string:{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)("(?:[^"\\]|\\.)*"|'(?:[^'\\]|\\.)*')(?=[ \t]*($|,|]|}))/m,lookbehind:!0},number:{pattern:/([:\-,[{]\s*(![^\s]+)?[ \t]*)[+\-]?(0x[\da-f]+|0o[0-7]+|(\d+\.?\d*|\.?\d+)(e[\+\-]?\d+)?|\.inf|\.nan)[ \t]*(?=$|,|]|})/im,lookbehind:!0},tag:/![^\s]+/,important:/[&*][\w]+/,punctuation:/---|[:[\]{}\-,|>?]|\.\.\./},"undefined"!=typeof self&&self.Prism&&self.document&&Prism.hooks.add("complete",function(e){if(e.code){var t=e.element.parentNode,i=/\s*\bline-numbers\b\s*/;if(t&&/pre/i.test(t.nodeName)&&(i.test(t.className)||i.test(e.element.className))&&!e.element.querySelector(".line-numbers-rows")){i.test(e.element.className)&&(e.element.className=e.element.className.replace(i,"")),i.test(t.className)||(t.className+=" line-numbers");var r,n=e.code.match(/\n(?!$)/g),o=n?n.length+1:1,a=new Array(o+1);a=a.join("<span></span>"),(r=document.createElement("span")).setAttribute("aria-hidden","true"),r.className="line-numbers-rows",r.innerHTML=a,t.hasAttribute("data-start")&&(t.style.counterReset="linenumber "+(parseInt(t.getAttribute("data-start"),10)-1)),e.element.appendChild(r)}}}),function(){if("undefined"!=typeof self&&self.Prism&&self.document){var o=[],a={},t=function(){};Prism.plugins.toolbar={};var e=Prism.plugins.toolbar.registerButton=function(e,i){var t;t="function"==typeof i?i:function(e){var t;return"function"==typeof i.onClick?((t=document.createElement("button")).type="button",t.addEventListener("click",function(){i.onClick.call(this,e)})):"string"==typeof i.url?(t=document.createElement("a")).href=i.url:t=document.createElement("span"),t.textContent=i.text,t},o.push(a[e]=t)},i=Prism.plugins.toolbar.hook=function(r){var e=r.element.parentNode;if(e&&/pre/i.test(e.nodeName)&&!e.classList.contains("code-toolbar")){e.classList.add("code-toolbar");var n=document.createElement("div");n.classList.add("toolbar"),document.body.hasAttribute("data-toolbar-order")&&(o=document.body.getAttribute("data-toolbar-order").split(",").map(function(e){return a[e]||t})),o.forEach(function(e){var t=e(r);if(t){var i=document.createElement("div");i.classList.add("toolbar-item"),i.appendChild(t),n.appendChild(i)}}),e.appendChild(n)}};e("label",function(e){var t=e.element.parentNode;if(t&&/pre/i.test(t.nodeName)&&t.hasAttribute("data-label")){var i,r,n=t.getAttribute("data-label");try{r=document.querySelector("template#"+n)}catch(o){}return r?i=r.content:(t.hasAttribute("data-url")?(i=document.createElement("a")).href=t.getAttribute("data-url"):i=document.createElement("span"),i.textContent=n),i}}),Prism.hooks.add("complete",i)}}(),"undefined"!=typeof self&&self.Prism&&self.document&&Prism.hooks.add("before-sanity-check",function(e){if(e.code){var t=e.element.parentNode,i=/\s*\bkeep-initial-line-feed\b\s*/;!t||"pre"!==t.nodeName.toLowerCase()||i.test(t.className)||i.test(e.element.className)||(e.code=e.code.replace(/^(?:\r?\n|\r)/,""))}}),"undefined"!=typeof self&&self.Prism&&self.document&&Prism.hooks.add("complete",function(e){if(e.code){var i=e.element.parentNode,t=/\s*\bcommand-line\b\s*/;if(i&&/pre/i.test(i.nodeName)&&(t.test(i.className)||t.test(e.element.className))&&!e.element.querySelector(".command-line-prompt")){t.test(e.element.className)&&(e.element.className=e.element.className.replace(t,"")),t.test(i.className)||(i.className+=" command-line");var r=function(e,t){return(i.getAttribute(e)||t).replace(/"/g,"&quot")},n=new Array(1+e.code.split("\n").length),o=r("data-prompt","");if(""!==o)n=n.join('<span data-prompt="'+o+'"></span>');else{var a=r("data-user","user"),s=r("data-host","localhost");n=n.join('<span data-user="'+a+'" data-host="'+s+'"></span>')}var l=document.createElement("span");l.className="command-line-prompt",l.innerHTML=n;var c=i.getAttribute("data-output")||"";c=c.split(",");for(var d=0;d<c.length;d++){var u=c[d].split("-"),h=parseInt(u[0]),p=h;if(2===u.length&&(p=parseInt(u[1])),!isNaN(h)&&!isNaN(p))for(var f=h;f<=p&&f<=l.children.length;f++){var m=l.children[f-1];m.removeAttribute("data-user"),m.removeAttribute("data-host"),m.removeAttribute("data-prompt")}}e.element.innerHTML=l.outerHTML+e.element.innerHTML}}});var is_rainbow=!1,search_module=sessionStorage.getItem("search"),serch_reported_mistake=sessionStorage.getItem("mistake"),survey_answer_array=[];$(window).load(function(){}),$(document).ready(function(){setTimeout(function(){changePrism_to_Rainbow()},500),$("body").on("changed.bs.select",".lesson_assignment_select",function(e,t){var i=$(this);t==i[0].length-1?(i.selectpicker("val",null),i.selectpicker("val",0)):null!=i.val()&&i.selectpicker("val",_.without(i.val(),"0")),show_elaborate_textarea(i)}).on("hide.bs.select",".lesson_assignment_select",function(){save_survey_answer($(this))}).on("change",".rating_radio",function(){var e=$(this);e[0].checked&&(e.closest("#survey_effectivity_rating_container").find(".not_sure_checkbox").removeAttr("checked","checked"),save_survey_answer(e),show_elaborate_textarea(e))}).on("change",".not_sure_checkbox",function(){var e=$(this);e[0].checked&&(e.closest("#survey_effectivity_rating_container").find(".rating_radio").removeAttr("checked","checked"),save_survey_answer(e),show_elaborate_textarea(e))}).on("change",".smiley_face_radio",function(){save_survey_answer($(this)),show_elaborate_textarea($(this))}).on("focusout",".survey_textarea",function(){""!=$(this).val().replace(/\s/g,"")&&save_survey_answer($(this))}).on("click","#submit_survey_btn",function(e){e.preventDefault();var t=$(this);t.addClass("disabled"),t.find(".submit_text").text("Processing..."),t.find(".loading_animation").removeClass("hidden"),submit_survey_answer()}).on("submit",".upload_solution_file",function(e){""==$(".browse_solution_upload_file").val()?alert("Please select a file to upload."):upload_solution_file($(this)),e.preventDefault()}).on("change",".browse_solution_upload_file",function(){var e=$(this);if(""==!e.val()){e.siblings("#solution_file_list").html("");for(var t=0;t<e.get(0).files.length;t++)$(this).siblings("#solution_file_list").append("<li>"+$(this).get(0).files[t].name+"</li>")}}).on("click",".copy_url",function(e){var t=$(this),i=$("<textarea>"),r=$(e.target).siblings(".upload_url").attr("data-image-url"),n=!1;$("body").append(i),i.val(r).select(),n=document.execCommand("copy"),t.text("Link Copied!"),i.remove(),1==n&&setTimeout(function(){t.text("Copy Link")},1e3),e.preventDefault()}),$(document).on("change","input, select, textarea",triggerFormChange),$(".module-list-item").on("click",selectModuleByListItem),$("body").on("click",".save-module-button",handleEditModuleSubmit),$("body").on("click","#add-task",handleAddAssignmentTask),$("section.module-info").on("click","#add-task",handleAddAssignmentTask),$("span.chapter-delete").on("click",function(e){e.preventDefault(),$(".delete_chapter_modal").modal("show").find("input[name='chapter_id']").val($(this).attr("data-chapter-id"))}),$("body").on("click",".confirm_delete_chapter",confirmDeleteChapter),$("body").on("click",'div.add-new-choice input[type="submit"]',addChoiceToQuestion),$("body").on("click",'div.add-new-question input[type="submit"]',addQuestionToQuiz),$("body").on("keydown",'input[name="new-question"]',function(e){13==(e.keyCode||e.which)&&($(this).siblings("input[type='submit']").trigger("click"),$(this).focus())}),$("body").on("click","a.remove-question",removeQuestionFromQuiz),$("body").on("click","a.remove-choice",removeChoiceFromQuestion),$("body").on("click","a.remove-assignment",removeAssignmentTask),$(".module_description").on("mouseenter","pre",show_copy_to_clipboard),$(".module_description").on("mouseleave","pre",remove_copy_to_clipboard),$("body").on("click","#copy-toolbar",copy_to_clipboard),$("body").on("keydown",'fieldset.quiz-info input[type="text"]',invokeCorrectSubmitButton),$("body").on("click","#answersheet",change_solution_to_rainbow),$("#sidebar .is_dragable_list").sortable({items:"li:not(.dropdown-menu li)",handle:".dragable_icon",axis:"y",tolerance:"pointer",cursor:"move",stop:handleDrop,placeholder:"ui-sortable-placeholder"}),$(".tab_list").disableSelection(),$("body").on("click",".module-delete",function(e){e.preventDefault(),$(".delete_module_modal").modal("show").find("input[name='module_id']").val($(this).attr("data-module-id"))}),$("body").on("click",".confirm_delete_module",confirmDeleteModule),$("body").on("click",".edit_chapter_name",function(){$(".chapter_module_modal").modal("show").find(".modal_header h4").text("Edit Chapter Name").closest(".modal-content").find(".btn-primary").addClass("save_edit_chapter_btn").siblings("input[type='text']").attr("id","edit-chapter-name").val($(this).closest("li.active").find(".chapter-title").text()),$(".chapter_module_modal input[name='chapter_id']").val($(this).closest(".actions").data("chapter-id"))}),$("body").on("click",".save_edit_chapter_btn",updateChapterName),$("body").on("change","#upload_file",function(){var e=$(this);if(""==!e.val()){e.siblings(".upload_name").text("Choose another file?"),e.siblings("#uploaded_file_list").html("");for(var t=0;t<e.get(0).files.length;t++)$(this).siblings("#uploaded_file_list").append("<li>"+$(this).get(0).files[t].name+"</li>")}}),$("body").on("submit","#new_upload",function(e){""==document.getElementById("upload_file").value?alert("Please select a file to upload."):uploadFile($(this)),e.preventDefault()}),$("body").on("click",".add_criteria_btn ",function(e){e.preventDefault();var t=$(this);t.addClass("disabled"),t.closest(".add_criteria_container").siblings("table").find("tbody").append($(add_criteria_template()).fadeIn());var i="red_belt_exam"==t.closest(".add_criteria_container").siblings("table").attr("id")?1:2;$("input[name*='exam_type']").val(i)}),$("body").on("click",".remove_add_criteria_btn",function(){$(this).closest("table").siblings(".add_criteria_container").find(".add_criteria_btn").removeClass("disabled"),$(this).closest(".add_criteria_row").fadeOut(function(){$(this).remove()})}),$("body").on("click",".save_criteria_btn ",function(e){e.preventDefault();var i=$(this),r=i.closest("table"),t=i.closest(".add_criteria_row").find("textarea").val(),n=i.closest(".add_criteria_row").find(".criteria_pts_input").val(),o=i.closest(".add_criteria_row").find("input[name*='exam_type']").val();i.closest(".add_criteria_row").find(".form-control").each(function(){var e=$(this);""==e.val()?e.addClass("border_red"):e.removeClass("border_red")}),0==r.find(".border_red").length&&(i.addClass("disabled"),i.find("img").removeClass("hidden"),i.find("span").text("Saving..."),$.post("/add_exam_criteria",{criteria:t,points:n,belt_type:o,chapter_module_id:$("input[name*='module_id']").val()},function(t){1==t.status&&setTimeout(function(){i.closest(".add_criteria_row").fadeOut().remove();var e={criteria_id:t.rubrics.id,criteria_text:t.rubrics.criteria,criteria_points:t.rubrics.points};r.append(save_criteria_template(e)),r.siblings(".add_criteria_container").find(".add_criteria_btn").removeClass("disabled"),1==t.rubrics.belt_type?$("#red_belt_total_points").text(t.total_points):$("#black_belt_total_points").text(t.total_points)},1500)},"json"))}),$("body").on("click",".delete_belt_criteria",function(){$(".confirm_delete_rubric_modal").modal("show"),$(".confirm_delete_rubric_modal").find("#rubric_id").val($(this).closest("tr").attr("data-rubric-id"))}),$("body").on("click",".confirm_delete_criteria_btn",function(){var t=$(this);$.post("/delete_exam_criteria",{criteria_id:t.closest(".modal").find("#rubric_id").val()},function(e){1==e.status&&$(".rubric_section").find("table tbody tr[data-rubric-id="+t.closest(".modal").find("#rubric_id").val()+"]").fadeOut("slow",function(){$(this).remove(),1==e.belt_type?$("#red_belt_total_points").text(e.total_points):$("#black_belt_total_points").text(e.total_points)})},"json")}),$("#rubric_upload_file").on("change",function(){if(0<this.files.length){$(this).closest(".upload_rubric_container").find(".right_container").removeClass("hidden");for(var e=0;e<this.files.length;e++){var t=this.files[e].name;$(".upload_files_list").append(upload_file_template({upload_url:"asdasdasdas",upload_name:t}))}}}),$("body").on("click",".add-chapter",function(){$(".chapter_module_modal").modal("show").find(".modal_header h4").text("New Chapter").closest(".modal-content").find(".btn-primary").addClass("save_new_chapter_btn").siblings("input[type='text']").attr("id","new-chapter-title").val("")}),$(".chapter_module_modal").on("shown.bs.modal",function(){$(this).find("input[type='text']").focus()}),$("body").on("click",".save_new_chapter_btn",createNewChapter),$("body").on("click",".add-module",function(){$(".cancel-module-create").removeClass("hidden"),applyRedactorToTextarea()}),$("body").on("keydown","input[name='new-choice']",function(e){13==(e.keyCode||e.which)&&$(this).siblings("input[type='submit']").trigger("click")}),$("body").on("click",".upload_url",function(e){var t=$(this),i=$("#show_image_modal .imagepreview");$("#show_image_modal").find(".modal_loading_container").removeClass("hidden"),e.preventDefault(),$("#show_image_modal").modal("show"),i.attr("src",t.attr("data-image-url")).addClass("hidden"),$("#show_image_modal .imagepreview").on("load",function(){$(this).removeClass("hidden"),$("#show_image_modal").find(".modal_loading_container").addClass("hidden")})}),$.each($("#chapter_list li.text"),function(){}),setTimeout(function(){$.each($("#chapter_list li.text"),function(){var e=$(this),t=e.find("h4").text();28<e.find("h4").text().length&&(e.addClass("is_ellipsis"),e.prop("data-toggle","tooltip"),e.prop("placement","right auto"),e.prop("title",t),e.prop("container","body"),e.tooltip({}))})},1200)}),window.addEventListener("beforeunload",checkBeforeUnload);var hasFormChanged,tiggerFormChangeIfNotFirstSync=function(){var e=!0;return function t(){if(!e)return triggerFormChange();e=!1}}();!function(r){r.Redactor.prototype.custom_plugins_save_undo_redo=function(){return{init:function(){var e=this.button.add("custom_save","Save Module Changes");r(e[0]).closest("li").addClass("pull-right save-module-button");var t=this.button.add("redo","Redo"),i=this.button.add("undo","Undo");r(t[0]).closest("li").addClass("pull-right"),r(i[0]).closest("li").addClass("pull-right"),this.button.addCallback(i,this.buffer.undo),this.button.addCallback(t,this.buffer.redo)}}}}(jQuery);var attempt_count=0,add_criteria_template=_.template('<tr class="add_criteria_row">                                        <td>                                            <textarea placeholder="Criteria here..." class="form-control" rows="1"></textarea>                                        </td>                                        <td>                                            <input type="number" class="criteria_pts_input form-control" placeholder="pts" >                                            <input type="hidden" name="exam_type" value="">                                            <i class="fa fa-times-circle remove_add_criteria_btn" aria-hidden="true"></i>                                            <div class="save_container">                                                <a href="#" class="btn save_criteria_btn btn-default">                                                    <span>Save</span>                                                    <img class="hidden" src="/assets/loading_white.gif" alt="">                                                </a>                                            </div>                                        </td>                                    </tr>'),save_criteria_template=_.template('<tr data-rubric-id = "<%= criteria_id %>"  class="animated tada">                                            <td><%= criteria_text %></td>                                            <td>                                                <span class="points_text"><%= criteria_points %></span>                                                <div class="delete_container">                                                    <button type="button" class="btn btn-default delete_belt_criteria" aria-label="Left Align">                                                        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>                                                    </button>                                                </div>                                            </td>                                        </tr>'),upload_file_template=_.template('<li>                                             <a href="<%= upload_url %>" download> <%= upload_name %> </a>                                            <i class="fa fa-times-circle remove_uploaded_file_btn" aria-hidden="true"></i>                                        </li>'),is_horizontal_view=document.cookie.includes("horizontal_view"),is_module_edit=window.location.href.includes("modules/edit");$(window).load(function(){setTimeout(function(){$("body")[0].scrollTop=0,initialize_module_redactor(),is_horizontal_view&&is_module_edit&&horizontal_tab_view()},1)}),$(document).on("ready",function(){is_horizontal_view&&is_module_edit&&$(".switch_horizontal_tab_view").removeClass("switch_horizontal_tab_view").addClass("switch_vertical_tab_view"),"true"==$("li .current").attr("data-first_module")&&$(".manage_module_modal").modal("show"),$("body").on("click","button.cancel-module-create",handleNewModuleCancel).on("click",".save_module_btn",handleSaveModule).on("click",".add_new_module",function(){show_module_form("new")}).on("hidden.bs.modal",function(){var e=$(".manage_module_modal");e.find(".color_red").removeClass("color_red"),e.find(".border_red").removeClass("border_red")}).on("click",".edit_module_container .module_title, .link_title_container .module_title",function(){$(this).siblings(".edit_module_title").trigger("click")}).on("click",".edit_module_title",showing_edit_module_title).on("blur",".module_title_input",update_module_title).on("click",".module_type_btn",function(){$(this).addClass("active").siblings().removeClass("active")}).on("click",".edit_module",show_module_form).on("submit",".modal_edit_module_form",saving_edited_module).on("click",".duplicate_module",duplicate_module).on("click",".language_rainbow_option_list .language_rainbow_option_item",manage_language_settings).on("click",".switch_horizontal_tab_view",horizontal_tab_view).on("click",".switch_vertical_tab_view",vertical_tab_view).on("click",".move_to_next_chapter",move_next_prev_chapter).on("click",".move_to_previous_chapter",move_next_prev_chapter).on("click",".select_copy_to",show_confirm_modal).on("click",".confirm_copy_to_btn",function(){process_module($(this),"copy")}).on("click",".select_move_to",show_confirm_modal).on("click",".confirm_move_to_btn",function(){process_module($(this),"move")}).on("submit",".add_new_module_form",function(e){e.preventDefault(),saving_new_module($(this))}).on("submit","#new_solution",function(e){e.preventDefault(),create_solution($(this))}).on("click",".delete_solution_btn",function(e){e.preventDefault(),delete_solution($(this))}).on("click",".remove_chapter_upload",remove_chapter_upload),$("body").on("click",".dropdown-submenu a.dropdown-submenu-btn",function(e){if(e.preventDefault(),e.stopPropagation(),$(this).closest(".dropdown-menu-right").find(".dropdown-menu").hide(),$(this).offset().top+160>$(window).height()){var t=$(window).height()-$(this).offset().top;$(this).next("ul").toggle().css("bottom",t-30)}else $(this).next("ul").toggle().css("top",$(this).offset().top)}),$(".dropdown").on("hidden.bs.dropdown",function(){$(this).find(".copy_to_sub_menu, .move_to_sub_menu").hide(),$("html, body").css({overflow:"auto",height:"auto"})}),$(".dropdown").on("show.bs.dropdown",function(){$("html, body").css({overflow:"hidden",height:"100%"});var e=$(this);$(this).offset().top+160>$(window).height()&&e.find(".dropdown-menu.dropdown-menu-right").css({top:"-133px"})}),$("#sidebar.edit_mode").on("update",function(){$(".dropdown").removeClass("open"),$(".dropdown .dropdown-menu-right").find(".dropdown-menu").hide()}),$('[data-toggle="tooltip"]').tooltip(),$("#description").on("mouseenter","pre",init_language_settings),$(document).on("mousemove","body",function(e){0==($(e.target).closest("pre").length||$(e.target).closest(".language_rainbow_dropup").length)&&$(".language_rainbow_dropup").addClass("hidden")}),$(".horizontal_chapter_view_container").on("show.bs.dropdown",".dropdown",function(){var e=$(this).closest("li");$(this).children(".dropdown-menu").css({width:e.outerWidth(),left:e.offset().left,top:e.offset().top+e.outerHeight()-$(window).scrollTop()})}).on("click",".scroll_right_module",navigate_module_ui_adjustment).on("click",".scroll_left_module",navigate_module_ui_adjustment),$(window).scroll(function(){var e=$(".horizontal_chapter_list_view");if(e.length&&e.find(".dropdown.open").length){var t=e.find(".dropdown.open").closest("li");e.find(".dropdown.open .dropdown-menu").css({top:t.offset().top+t.outerHeight()-$(this).scrollTop()})}}),$(window).resize(function(){var e=$(".horizontal_chapter_list_view");if(e.length&&e.find(".dropdown.open").length){var t=e.find(".dropdown.open").closest("li");e.find(".dropdown.open .dropdown-menu").css({left:t.offset().left-$(this).scrollLeft()})}}),$(".questions").sortable({containment:"parent",handle:".drag_icon",placeholder:"ui-state-highlight",tolerance:"pointer"}),$(".choices").sortable({handle:".drag_icon",placeholder:"ui-state-highlight",containment:"parent",tolerance:"pointer"}),$(".tasks").sortable({handle:".glyphicon-th",placeholder:"ui-state-highlight",handle:".drag_icon",containment:"parent"})}),function(n){n.Redactor.prototype.custom_save=function(){return{init:function(){var e=this.button.add("custom_save","Save Module Changes");n(e[0]).closest("li").addClass("pull-right save_module_btn");var t=this.button.add("redo","Redo"),i=this.button.add("undo","Undo"),r=this.$toolbar;n(t[0]).closest("li").addClass("pull-right"),n(i[0]).closest("li").addClass("pull-right"),this.button.addCallback(i,this.buffer.undo),this.button.addCallback(t,this.buffer.redo),setTimeout(function(){n(r).css("visibility","visible","important")},200)}}}}(jQuery);